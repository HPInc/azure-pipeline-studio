#!/usr/bin/env node
(()=>{var e={9031(e){"use strict";function isNumber(e){return"number"==typeof e||(!!/^0x[0-9a-f]+$/i.test(e)||/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(e[-+]?\d+)?$/.test(e))}function isConstructorOrProto(e,t){return"constructor"===t&&"function"==typeof e[t]||"__proto__"===t}e.exports=function(e,t){t||(t={});var n={bools:{},strings:{},unknownFn:null};"function"==typeof t.unknown&&(n.unknownFn=t.unknown),"boolean"==typeof t.boolean&&t.boolean?n.allBools=!0:[].concat(t.boolean).filter(Boolean).forEach(function(e){n.bools[e]=!0});var s={};function aliasIsBoolean(e){return s[e].some(function(e){return n.bools[e]})}Object.keys(t.alias||{}).forEach(function(e){s[e]=[].concat(t.alias[e]),s[e].forEach(function(t){s[t]=[e].concat(s[e].filter(function(e){return t!==e}))})}),[].concat(t.string).filter(Boolean).forEach(function(e){n.strings[e]=!0,s[e]&&[].concat(s[e]).forEach(function(e){n.strings[e]=!0})});var r=t.default||{},i={_:[]};function setKey(e,t,s){for(var r=e,i=0;i<t.length-1;i++){var o=t[i];if(isConstructorOrProto(r,o))return;void 0===r[o]&&(r[o]={}),r[o]!==Object.prototype&&r[o]!==Number.prototype&&r[o]!==String.prototype||(r[o]={}),r[o]===Array.prototype&&(r[o]=[]),r=r[o]}var a=t[t.length-1];isConstructorOrProto(r,a)||(r!==Object.prototype&&r!==Number.prototype&&r!==String.prototype||(r={}),r===Array.prototype&&(r=[]),void 0===r[a]||n.bools[a]||"boolean"==typeof r[a]?r[a]=s:Array.isArray(r[a])?r[a].push(s):r[a]=[r[a],s])}function setArg(e,t,r){if(!r||!n.unknownFn||function argDefined(e,t){return n.allBools&&/^--[^=]+$/.test(t)||n.strings[e]||n.bools[e]||s[e]}(e,r)||!1!==n.unknownFn(r)){var o=!n.strings[e]&&isNumber(t)?Number(t):t;setKey(i,e.split("."),o),(s[e]||[]).forEach(function(e){setKey(i,e.split("."),o)})}}Object.keys(n.bools).forEach(function(e){setArg(e,void 0!==r[e]&&r[e])});var o=[];-1!==e.indexOf("--")&&(o=e.slice(e.indexOf("--")+1),e=e.slice(0,e.indexOf("--")));for(var a=0;a<e.length;a++){var l,c,p=e[a];if(/^--.+=/.test(p)){var u=p.match(/^--([^=]+)=([\s\S]*)$/);l=u[1];var f=u[2];n.bools[l]&&(f="false"!==f),setArg(l,f,p)}else if(/^--no-.+/.test(p))setArg(l=p.match(/^--no-(.+)/)[1],!1,p);else if(/^--.+/.test(p))l=p.match(/^--(.+)/)[1],void 0===(c=e[a+1])||/^(-|--)[^-]/.test(c)||n.bools[l]||n.allBools||s[l]&&aliasIsBoolean(l)?/^(true|false)$/.test(c)?(setArg(l,"true"===c,p),a+=1):setArg(l,!n.strings[l]||"",p):(setArg(l,c,p),a+=1);else if(/^-[^-]+/.test(p)){for(var d=p.slice(1,-1).split(""),h=!1,m=0;m<d.length;m++)if("-"!==(c=p.slice(m+2))){if(/[A-Za-z]/.test(d[m])&&"="===c[0]){setArg(d[m],c.slice(1),p),h=!0;break}if(/[A-Za-z]/.test(d[m])&&/-?\d+(\.\d*)?(e-?\d+)?$/.test(c)){setArg(d[m],c,p),h=!0;break}if(d[m+1]&&d[m+1].match(/\W/)){setArg(d[m],p.slice(m+2),p),h=!0;break}setArg(d[m],!n.strings[d[m]]||"",p)}else setArg(d[m],c,p);l=p.slice(-1)[0],h||"-"===l||(!e[a+1]||/^(-|--)[^-]/.test(e[a+1])||n.bools[l]||s[l]&&aliasIsBoolean(l)?e[a+1]&&/^(true|false)$/.test(e[a+1])?(setArg(l,"true"===e[a+1],p),a+=1):setArg(l,!n.strings[l]||"",p):(setArg(l,e[a+1],p),a+=1))}else if(n.unknownFn&&!1===n.unknownFn(p)||i._.push(n.strings._||!isNumber(p)?p:Number(p)),t.stopEarly){i._.push.apply(i._,e.slice(a+1));break}}return Object.keys(r).forEach(function(e){(function hasKey(e,t){var n=e;return t.slice(0,-1).forEach(function(e){n=n[e]||{}}),t[t.length-1]in n})(i,e.split("."))||(setKey(i,e.split("."),r[e]),(s[e]||[]).forEach(function(t){setKey(i,t.split("."),r[e])}))}),t["--"]?i["--"]=o.slice():o.forEach(function(e){i._.push(e)}),i}},1398(e){"use strict";e.exports=require("vscode")},181(e){"use strict";e.exports=require("buffer")},2250(e){"use strict";e.exports=require("dns")},9896(e){"use strict";e.exports=require("fs")},857(e){"use strict";e.exports=require("os")},6928(e){"use strict";e.exports=require("path")},932(e){"use strict";e.exports=require("process")},948(e){function returnBoolean(e){return e?"__TRUE__":"__FALSE__"}function toBoolean(e){if("boolean"==typeof e)return e;if("number"==typeof e)return 0!==e;if("string"==typeof e){const t=e.toLowerCase();if("__true__"===t||"true"===t)return!0;if("__false__"===t||"false"===t||0===t.length)return!1}return Boolean(e)}function compareValues(e,t){const normalize=e=>{if(null==e)return"";if("string"==typeof e){const t=e.trim();if(0===t.length)return"";const n=t.toLowerCase();return"true"===n||"__true__"===n||"false"!==n&&"__false__"!==n&&(/^-?\d+(?:\.\d+)?$/.test(t)?Number(t):t)}return e},n=normalize(e),s=normalize(t);if(n===s)return 0;if(typeof n==typeof s&&("number"==typeof n||"boolean"==typeof n))return n>s?1:-1;const r=String(n),i=String(s);return r===i?0:r>i?1:-1}function formatString(e){if(!e||0===e.length)return"";let t=String(e[0]);const n=e.slice(1);return t=t.replace(/\{(\d+)(?::([^}]+))?\}/g,(e,t,s)=>{const r=parseInt(t,10);if(r>=n.length)return e;let i=n[r];return s&&i instanceof Date?function formatDateTime(e,t){const pad=(e,t=2)=>String(e).padStart(t,"0");return t.replace(/yyyy/g,e.getFullYear()).replace(/yy/g,String(e.getFullYear()).slice(-2)).replace(/MM/g,pad(e.getMonth()+1)).replace(/M/g,e.getMonth()+1).replace(/dd/g,pad(e.getDate())).replace(/d/g,e.getDate()).replace(/HH/g,pad(e.getHours())).replace(/H/g,e.getHours()).replace(/mm/g,pad(e.getMinutes())).replace(/m/g,e.getMinutes()).replace(/ss/g,pad(e.getSeconds())).replace(/s/g,e.getSeconds()).replace(/ffff/g,pad(e.getMilliseconds(),4)).replace(/ff/g,pad(Math.floor(e.getMilliseconds()/10))).replace(/f/g,Math.floor(e.getMilliseconds()/100))}(i,s):null==i?"":String(i)}),t=t.replace(/\{\{/g,"{").replace(/\}\}/g,"}"),t}const t=new Map;const n={returnBoolean,toBoolean,eq:function eq(e){return returnBoolean(0===compareValues(e[0],e[1]))},ne:function ne(e){return returnBoolean(0!==compareValues(e[0],e[1]))},gt:function gt(e){return returnBoolean(compareValues(e[0],e[1])>0)},ge:function ge(e){return returnBoolean(compareValues(e[0],e[1])>=0)},lt:function lt(e){return returnBoolean(compareValues(e[0],e[1])<0)},le:function le(e){return returnBoolean(compareValues(e[0],e[1])<=0)},and:function and(e){return returnBoolean((e||[]).every(e=>toBoolean(e)))},or:function or(e){return returnBoolean((e||[]).some(e=>toBoolean(e)))},not:function not(e){return returnBoolean(!toBoolean(e[0]))},xor:function xor(e){return returnBoolean(toBoolean(e[0])!==toBoolean(e[1]))},coalesce:function coalesce(e){return(e||[]).find(e=>null!=e&&""!==e)},contains:function containsFn(e){return returnBoolean(function containsHelper(e,t){return"string"==typeof e?"string"==typeof t&&e.includes(t):Array.isArray(e)?e.some(e=>0===compareValues(e,t)):!(!e||"object"!=typeof e)&&Object.prototype.hasOwnProperty.call(e,t)}(e[0],e[1]))},containsValue:function containsValue(e){return returnBoolean(function containsValueHelper(e,t){return Array.isArray(e)?e.some(e=>0===compareValues(e,t)):!(!e||"object"!=typeof e)&&Object.values(e).some(e=>0===compareValues(e,t))}(e[0],e[1]))},in:function inFn(e){return returnBoolean((e||[]).slice(1).some(t=>0===compareValues(e[0],t)))},notIn:function notIn(e){return returnBoolean(!(e||[]).slice(1).some(t=>0===compareValues(e[0],t)))},lower:function lower(e){return"string"==typeof e[0]?e[0].toLowerCase():e[0]},upper:function upper(e){return"string"==typeof e[0]?e[0].toUpperCase():e[0]},startsWith:function startsWith(e){return returnBoolean(function startsWithHelper(e,t){return"string"==typeof e&&"string"==typeof t&&e.toLowerCase().startsWith(t.toLowerCase())}(e[0],e[1]))},endsWith:function endsWith(e){return returnBoolean(function endsWithHelper(e,t){return"string"==typeof e&&"string"==typeof t&&e.toLowerCase().endsWith(t.toLowerCase())}(e[0],e[1]))},trim:function trim(e){return"string"==typeof e[0]?e[0].trim():e[0]},replace:function replace(e){return function replaceString(e,t,n){return"string"!=typeof e?e:("string"!=typeof t&&(t=String(t)),"string"!=typeof n&&(n=String(n)),e.split(t).join(n))}(e[0],e[1],e[2])},split:function split(e){return function splitString(e,t){return"string"!=typeof e?[e]:("string"!=typeof t&&(t=String(t)),e.split(t))}(e[0],e[1])},join:function join(e){return function joinArray(e,t){return Array.isArray(t)?("string"!=typeof e&&(e=String(e)),t.map(e=>null==e||"object"==typeof e?"":String(e)).join(e)):"string"==typeof t?t:String(t)}(e[0],e[1])},format:function format(e){return formatString(e)},length:function length(e){return"string"==typeof e[0]||Array.isArray(e[0])?e[0].length:e[0]&&"object"==typeof e[0]?Object.keys(e[0]).length:0},convertToJson:function convertToJson(e){return function convertToJsonHelper(e){if(void 0===e)return"null";try{return JSON.stringify(e,(e,t)=>"boolean"==typeof t?t?"True":"False":"string"==typeof t&&/^-?\d+(\.\d+)?$/.test(t)?parseFloat(t):t,2)}catch(t){return String(e)}}(e[0])},counter:function counterFn(e){return function counter(e,n){const s=String(e||""),r="number"==typeof n?n:parseInt(n,10)||0;t.has(s)||t.set(s,r);const i=t.get(s);return t.set(s,i+1),i}(e[0],e[1])},iif:function iif(e){return toBoolean(e[0])?e[1]:e[2]},if:function ifFn(e){return toBoolean(e[0])?e[1]:e[2]},elseif:function elseif(e){return toBoolean(e[0])?e[1]:e[2]},always:function always(e){return returnBoolean(!0)},canceled:function canceled(e){return returnBoolean(!1)},failed:function failed(e){return returnBoolean(!1)},succeeded:function succeeded(e){return returnBoolean(!0)},succeededOrFailed:function succeededOrFailed(e){return returnBoolean(!0)}};e.exports=n},5580(e,t,n){n(1198);e.exports={DependencyAnalyzer:class DependencyAnalyzer{constructor(e){this._parser=e}analyzeDependencies(e,t,n={}){return this.analyzePipeline(t,n)}analyzePipeline(e,t={}){try{const{yamlDoc:t,jsonDoc:n}=this._parser.parseYamlDocument(e,void 0,!1),s={stages:[],jobs:[],templates:[],resources:[],dependencyGraph:[]};return this._extractStages(n,s),this._extractJobs(n,s),this._extractTemplates(n,s),this._extractResources(n,s),s}catch(e){return console.error("Failed to analyze pipeline dependencies:",e),{error:e.message,stages:[],jobs:[],templates:[],resources:[],dependencyGraph:[]}}}_extractStages(e,t){e.stages&&Array.isArray(e.stages)&&e.stages.forEach((e,n)=>{const s={name:e.stage||`Stage_${n}`,displayName:e.displayName||e.stage||`Stage ${n+1}`,dependsOn:[]};e.dependsOn&&(s.dependsOn=Array.isArray(e.dependsOn)?e.dependsOn:[e.dependsOn]),e.jobs&&Array.isArray(e.jobs)&&(s.jobs=e.jobs.map((e,t)=>e.job||e.deployment||e.template||`Job_${t}`)),t.stages.push(s),s.dependsOn.length>0&&s.dependsOn.forEach(e=>{t.dependencyGraph.push({type:"stage",from:e,to:s.name})})})}_extractJobs(e,t){let n=[];e.jobs&&Array.isArray(e.jobs)?n=e.jobs:e.stages&&Array.isArray(e.stages)&&e.stages.forEach(e=>{e.jobs&&Array.isArray(e.jobs)&&n.push(...e.jobs.map(t=>({...t,_stage:e.stage})))}),n.forEach((e,n)=>{const s={name:e.job||e.deployment||`Job_${n}`,displayName:e.displayName||e.job||e.deployment||`Job ${n+1}`,dependsOn:[],stage:e._stage};e.dependsOn&&(s.dependsOn=Array.isArray(e.dependsOn)?e.dependsOn:[e.dependsOn]),e.steps&&Array.isArray(e.steps)&&(s.stepCount=e.steps.length),t.jobs.push(s),s.dependsOn.length>0&&s.dependsOn.forEach(e=>{t.dependencyGraph.push({type:"job",from:e,to:s.name,stage:s.stage})})})}_extractTemplates(e,t){this._findTemplateReferences(e,t,[])}_findTemplateReferences(e,t,n){if("object"==typeof e&&null!==e){if(e.template&&"string"==typeof e.template){const s={path:e.template,parameters:e.parameters||{},usedIn:n.length>0?n.join(" > "):"root"};t.templates.push(s)}Array.isArray(e)?e.forEach((e,s)=>{this._findTemplateReferences(e,t,[...n,`[${s}]`])}):Object.keys(e).forEach(s=>{"template"!==s&&"object"==typeof e[s]&&this._findTemplateReferences(e[s],t,[...n,s])})}}_extractResources(e,t){e.resources&&(e.resources.repositories&&Array.isArray(e.resources.repositories)&&e.resources.repositories.forEach(e=>{t.resources.push({type:"repository",name:e.repository||"unknown",repoType:e.type||"unknown",endpoint:e.endpoint})}),e.resources.pipelines&&Array.isArray(e.resources.pipelines)&&e.resources.pipelines.forEach(e=>{t.resources.push({type:"pipeline",name:e.pipeline||"unknown",source:e.source})}),e.resources.containers&&Array.isArray(e.resources.containers)&&e.resources.containers.forEach(e=>{t.resources.push({type:"container",name:e.container||"unknown",image:e.image})}))}generateMermaidDiagram(e){const t=["%%{init: {",'  "theme": "base",','  "themeVariables": {','    "primaryColor": "#374151",','    "primaryBorderColor": "#1F2937",','    "background": "#1F2937",','    "mainBkg": "#374151",','    "secondBkg": "#4B5563",','    "tertiaryColor": "#F3F4F6",','    "lineColor": "#9CA3AF",','    "primaryTextColor": "#FFFFFF",','    "edgeLabelBackground": "#1F2937"',"  }","}}%%","","flowchart LR"],n=this._calculateCriticalPath(e),s=new Set(n),r=new Map;for(let e=0;e<n.length-1;e++){const t=`${n[e]}->${n[e+1]}`;r.set(t,!0)}const getStageType=e=>{const t=e.toLowerCase();return t.includes("configure")?"configure":t.includes("lint")?"lint":t.includes("build")?"build":t.includes("test")||t.includes("unit")||t.includes("unittests")?"test":t.includes("artifact")||t.includes("scan")?"artifactScan":t.includes("sign")?"signing":t.includes("package")||t.includes("publish")?"package":t.includes("release")?"release":"build"},getEmoji=e=>({configure:"âš™ï¸",lint:"âœ¨",build:"ðŸ”¨",test:"ðŸ§ª",artifactScan:"ðŸ”§",signing:"ðŸ”",package:"ðŸ“¦",release:"ðŸš€"}[getStageType(e)]||"ðŸ”§"),i=[];let o=0;return e.stages.length>0&&(e.stages.forEach(e=>{const n=`stage_${this._sanitizeId(e.name)}`,r=getEmoji(e.displayName),i=s.has(e.name)?"critical":getStageType(e.displayName);let o=`${r} ${e.displayName||e.name}`;if(e.jobs&&e.jobs.length>0){o+=`<br/><span style='font-size: 0.85em; opacity: 0.8;'>${e.jobs.map(e=>`&nbsp;&nbsp;&nbsp;&nbsp;â€¢ ${e}`).join("<br/>")}</span>`}t.push(`    ${n}["${o}"]:::${i}`)}),e.dependencyGraph.filter(e=>"stage"===e.type).forEach(e=>{const n=`stage_${this._sanitizeId(e.from)}`,s=`stage_${this._sanitizeId(e.to)}`,a=`${e.from}->${e.to}`,l=r.has(a),c=l?"==>":"--\x3e";t.push(`    ${n} ${c} ${s}`),l&&i.push(o),o++})),e.jobs.length>0&&0===e.stages.length&&(e.jobs.forEach(e=>{const n=`job_${this._sanitizeId(e.name)}`,r=getEmoji(e.displayName),i=s.has(e.name)?"critical":getStageType(e.displayName),o=e.displayName||e.name;t.push(`    ${n}["${r} ${o}"]:::${i}`)}),e.dependencyGraph.filter(e=>"job"===e.type).forEach(e=>{const n=`job_${this._sanitizeId(e.from)}`,s=`job_${this._sanitizeId(e.to)}`,a=`${e.from}->${e.to}`,l=r.has(a),c=l?"==>":"--\x3e";t.push(`    ${n} ${c} ${s}`),l&&i.push(o),o++})),t.push(""),t.push("    %% Minimalist outline style - clean, modern aesthetic"),t.push("    classDef critical stroke:#DC2626,stroke-width:2px,color:#FFFFFF,font-weight:600,rx:5,ry:5,fill:#374151"),t.push("    classDef configure stroke:#60A5FA,stroke-width:1.5px,color:#FFFFFF,font-weight:500,rx:5,ry:5,fill:#4B5563"),t.push("    classDef lint stroke:#60A5FA,stroke-width:1.5px,color:#FFFFFF,font-weight:500,rx:5,ry:5,fill:#4B5563"),t.push("    classDef build stroke:#60A5FA,stroke-width:1.5px,color:#FFFFFF,font-weight:500,rx:5,ry:5,fill:#4B5563"),t.push("    classDef test stroke:#60A5FA,stroke-width:1.5px,color:#FFFFFF,font-weight:500,rx:5,ry:5,fill:#4B5563"),t.push("    classDef artifactScan stroke:#60A5FA,stroke-width:1.5px,color:#FFFFFF,font-weight:500,rx:5,ry:5,fill:#4B5563"),t.push("    classDef signing stroke:#60A5FA,stroke-width:1.75px,color:#FFFFFF,font-weight:600,rx:5,ry:5,fill:#4B5563"),t.push("    classDef package stroke:#60A5FA,stroke-width:1.5px,color:#FFFFFF,font-weight:500,rx:5,ry:5,fill:#4B5563"),t.push("    classDef publish stroke:#60A5FA,stroke-width:1.5px,color:#FFFFFF,font-weight:500,rx:5,ry:5,fill:#4B5563"),t.push("    classDef release stroke:#60A5FA,stroke-width:1.5px,color:#FFFFFF,font-weight:500,rx:5,ry:5,fill:#4B5563"),t.push("    classDef report stroke:#60A5FA,stroke-width:1.5px,color:#FFFFFF,font-weight:500,rx:5,ry:5,fill:#4B5563"),t.push(""),t.push("    %% Link styling"),t.push("    linkStyle default stroke:#9CA3AF,stroke-width:2px"),i.forEach(e=>{t.push(`    linkStyle ${e} stroke:#F87171,stroke-width:2.5px`)}),t.join("\n")}_calculateCriticalPath(e){const t=e.stages.length>0?e.stages:e.jobs,n=e.dependencyGraph.filter(t=>t.type===(e.stages.length>0?"stage":"job"));if(0===t.length)return[];const s=new Map,r=new Map;t.forEach(e=>{s.set(e.name,[]),r.set(e.name,[])}),n.forEach(e=>{s.has(e.from)||s.set(e.from,[]),r.has(e.to)||r.set(e.to,[]),s.get(e.from).push(e.to),r.get(e.to).push(e.from)});const i=new Map,o=new Map;t.forEach(e=>{i.set(e.name,0),o.set(e.name,null)});const a=new Set,l=[],dfs=e=>{if(a.has(e))return;a.add(e);(r.get(e)||[]).forEach(e=>dfs(e)),l.push(e)};t.forEach(e=>dfs(e.name)),l.forEach(e=>{const t=r.get(e)||[];if(0===t.length)i.set(e,1);else{let n=0,s=null;t.forEach(e=>{const t=i.get(e)||0;t>n&&(n=t,s=e)}),i.set(e,n+1),o.set(e,s)}});let c=0,p=null;i.forEach((e,t)=>{(e>c||e===c&&(!p||t<p))&&(c=e,p=t)});const u=[];let f=p;for(;null!==f;)u.unshift(f),f=o.get(f);return u}generateTextReport(e){const t=["# Pipeline Dependencies\n"];if(e.error)return t.push(`âš ï¸ Error: ${e.error}\n`),t.join("\n");const n=this._calculateCriticalPath(e);if(n.length>0&&(t.push("## ðŸ”´ Critical Path\n"),t.push(`${n.join(" â†’ ")}`),t.push(`\n*Path Length: ${n.length} ${e.stages.length>0?"stages":"jobs"}*\n`)),e.stages.length>0&&(t.push("## Stages\n"),e.stages.forEach(e=>{const s=n.includes(e.name)?"ðŸ”´ ":"";t.push(`${s}**${e.displayName}**`),e.dependsOn&&e.dependsOn.length>0&&t.push(`  â†³ ${e.dependsOn.join(", ")}`),e.jobs&&e.jobs.length>0&&t.push(`  â”œâ”€ ${e.jobs.length} job${1!==e.jobs.length?"s":""}`)}),t.push("")),e.jobs.length>0&&0===e.stages.length&&(t.push("## Jobs\n"),e.jobs.forEach(e=>{const s=n.includes(e.name)?"ðŸ”´ ":"";t.push(`${s}**${e.displayName}**`),e.dependsOn&&e.dependsOn.length>0&&t.push(`  â†³ ${e.dependsOn.join(", ")}`),e.stepCount&&t.push(`  â”œâ”€ ${e.stepCount} step${1!==e.stepCount?"s":""}`)}),t.push("")),e.templates.length>0){t.push("## Templates\n");const n=new Map;e.templates.forEach(e=>{n.has(e.path)||n.set(e.path,[]),n.get(e.path).push(e.usedIn)}),n.forEach((e,n)=>{t.push(`\`${n}\``)}),t.push("")}return e.resources.length>0&&(t.push("## Resources\n"),e.resources.forEach(e=>{"repository"===e.type?t.push(`ðŸ“¦ ${e.name}`):"pipeline"===e.type?t.push(`âš™ï¸ ${e.name}`):"container"===e.type&&t.push(`ðŸ³ ${e.name}`)}),t.push("")),0===e.dependencyGraph.length&&0===e.stages.length&&0===e.jobs.length&&t.push("*No dependencies found*\n"),t.join("\n")}_sanitizeId(e){return e.replace(/[^a-zA-Z0-9_]/g,"_")}}}},3307(e,t,n){e=n.nmd(e);const s=n(9896),r=n(6928),i=n(9031),{pickFirstString:o,resolveConfiguredPath:a,normalizeExtension:l}=n(9243),{formatYaml:c}=n(652),{DependencyAnalyzer:p}=n(5580);let u;try{u=n(1398)}catch(e){u=void 0}const{AzurePipelineParser}=n(4339),{NONAME:f}=n(2250);let d,h,m,g;function buildFormatOptionsFromCli(e){if(!Array.isArray(e)||0===e.length)return;const t={};return e.forEach(e=>{if("string"!=typeof e)return;const n=e.indexOf("=");if(n<=0||n===e.length-1)return void console.warn(`Ignoring invalid --format entry '${e}'. Expected key=value.`);const s=e.slice(0,n).trim(),r=e.slice(n+1).trim();if(!s.length)return void console.warn(`Ignoring --format entry with empty key: '${e}'.`);const i={indent:[1,8],lineWidth:[0,Number.MAX_SAFE_INTEGER],firstBlockBlankLines:[0,4],blankLinesBetweenSections:[0,4]};["noArrayIndent","forceQuotes","sortKeys","stepSpacing"].includes(s)?"true"===r||"false"===r?t[s]="true"===r:console.warn(`Ignoring --format ${s}: expected boolean 'true' or 'false'.`):i[s]?function tryAssignIntegerOption(e,t,n,s,r){const i=Number.parseInt(n,10);!Number.isFinite(i)||i<s||i>r?console.warn(`Ignoring --format ${t}: expected integer between ${s} and ${r}.`):e[t]=i}(t,s,r,...i[s]):"newline"===s||"newlineFormat"===s?t.newlineFormat=r.replace(/\\r\\n/g,"\r\n").replace(/\\n/g,"\n").replace(/\\r/g,"\r"):console.warn(`Ignoring unsupported --format option '${s}'.`)}),Object.keys(t).length?t:void 0}function formatFilesRecursively(e,t,n){const i=new Set(Array.isArray(t)?t.map(e=>l(e)).filter(Boolean):[]);i.size||(i.add(".yml"),i.add(".yaml"));const o={totalFiles:0,formattedFiles:[],warnings:[],errors:[]};if(!Array.isArray(e)||!e.length)return o;const a=new Set,walk=e=>{if(!e)return;const t=r.resolve(process.cwd(),e);if(a.has(t))return;let p;a.add(t);try{p=s.lstatSync(t)}catch(e){return void o.errors.push({filePath:t,message:`Cannot access: ${e.message}`})}if(!p.isSymbolicLink()){if(p.isDirectory()){let e;try{e=s.readdirSync(t)}catch(e){return void o.errors.push({filePath:t,message:`Cannot read directory: ${e.message}`})}return void e.forEach(e=>{try{walk(r.join(t,e))}catch(n){o.errors.push({filePath:r.join(t,e),message:`Unexpected error: ${n.message}`})}})}if(p.isFile()){const e=l(r.extname(t));e&&i.has(e)&&(e=>{o.totalFiles+=1;try{const t=s.readFileSync(e,"utf8"),r={...n,fileName:e,suppressConsoleOutput:!0},i=c(t,r);if(i.error)return void o.errors.push({filePath:e,message:i.error});i.warning&&o.warnings.push({filePath:e,message:i.warning}),i.text!==t&&(s.writeFileSync(e,i.text,"utf8"),o.formattedFiles.push(e))}catch(t){o.errors.push({filePath:e,message:t.message})}})(t)}}};return e.forEach(e=>{try{walk(e)}catch(t){o.errors.push({filePath:e,message:`Failed to process target: ${t.message}`})}}),o}e.exports={activate:function activate(e){if(!u)return void console.warn("VS Code API unavailable; activate() skipped (CLI execution detected).");console.log("Azure Pipeline YAML Parser extension is now active!");const t=new AzurePipelineParser,i=new p(t);let l,f,y,b=!1,v=null,x=null;const S="ado-pipeline-expanded",w=new Map,k=new u.EventEmitter;let E,A,C,O="",L=!1,N=null;e.subscriptions.push(k),e.subscriptions.push(u.workspace.registerTextDocumentContentProvider(S,{onDidChange:k.event,provideTextDocumentContent:e=>w.get(e.toString())||""}));const getFormatSettings=e=>{const t={noArrayIndent:!0,indent:2,lineWidth:0,forceQuotes:!1,sortKeys:!1,firstBlockBlankLines:2,betweenSectionBlankLines:1,normalizeAzureVariablePaths:!0,newlineFormat:"\n"};if(!u)return t;try{const n=u.workspace.getConfiguration("azurePipelineStudio",e?.uri),s={...t};["noArrayIndent","forceQuotes","sortKeys","stepSpacing","normalizeAzureVariablePaths"].forEach(e=>{const t=n.get(`format.${e}`);"boolean"==typeof t&&(s[e]=t)});const r=n.get("format.indent");Number.isInteger(r)&&r>0&&r<=8&&(s.indent=r);const i=n.get("format.lineWidth");"number"==typeof i&&i>=0&&(s.lineWidth=i);[{key:"firstBlockBlankLines",min:0,max:4},{key:"betweenSectionBlankLines",min:0,max:4}].forEach(({key:e,min:t,max:r})=>{const i=n.get(`format.${e}`);Number.isInteger(i)&&i>=t&&i<=r&&(s[e]=i)});const o=n.get("format.newlineFormat");return"\n"!==o&&"\r\n"!==o||(s.newlineFormat=o),s}catch(e){return console.warn("Failed to read azurePipelineStudio.format settings:",e),t}};let I=!1,$=null;e.subscriptions.push(u.commands.registerCommand("azurePipelineStudio.openErrorFile",async(e,t)=>{try{const n=await u.workspace.openTextDocument(e),s={preview:!1};if(t&&t>0){const e=new u.Position(t-1,0);s.selection=new u.Range(e,e)}await u.window.showTextDocument(n,s)}catch(t){u.window.showErrorMessage(`Failed to open file: ${e}`)}}));const showErrorWebviewNow=(e,t,n="expansion")=>{const s=e instanceof Error?e:new Error(String(e)),r=s.stack||"";if($){try{$.dispose()}catch(e){}$=null}const i={expansion:"âŒ Pipeline Expansion Error",formatting:"âŒ YAML Formatting Error",dependency:"âŒ Dependency Analysis Error"}[n]||"âŒ Pipeline Error",o=u.window.createWebviewPanel("azurePipelineError",i,u.ViewColumn.Two,{enableScripts:!0});$=o,o.reveal(u.ViewColumn.Two),I=!0,o.onDidDispose(()=>{I=!1,$=null});const escapeHtml=e=>String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),makePathsClickable=e=>{const t=[];let n=0;return e=(e=e.replace(/([^\s\(]+\.ya?ml(?:@[^:]+)?)(?::(\d+))?\s+\((\\\\[^\)]+\.ya?ml|[A-Za-z]:[^\)]+\.ya?ml|\/[^\)]+\.ya?ml)\)/g,(e,s,r,i)=>{if(i&&i.includes("extension-bundle.js"))return e;if(i){const e=i.replace(/\\/g,"\\\\").replace(/'/g,"\\'"),o=r?`${s}:${r}`:s,a=`<a class="file-link" href="#" title="${escapeHtml(i)}" onclick="openFile('${e}', ${r||"null"}); return false;">${escapeHtml(o)}</a>`,l=`___PLACEHOLDER_${n}___`;return t.push(a),n++,l}return e})).replace(/(\\\\[^\s\n:]+\.(?:ya?ml|js|ts))(?::(\d+))?(?::(\d+))?|([A-Za-z]:\\[^\s\n:]+\.(?:ya?ml|js|ts))(?::(\d+))?(?::(\d+))?|(\/[^\s\n:]+\.(?:ya?ml|js|ts))(?::(\d+))?(?::(\d+))?/g,(e,t,n,s,r,i,o,a,l,c)=>{const p=t||r||a,u=n||i||l;if(p&&p.includes("extension-bundle.js"))return e;if(p){const t=p.replace(/\\/g,"\\\\").replace(/'/g,"\\'"),n=u||"null";return`<a class="file-link" href="#" title="${escapeHtml(p)}" onclick="openFile('${t}', ${n}); return false;">${escapeHtml(e)}</a>`}return e}),t.forEach((t,n)=>{e=e.replace(`___PLACEHOLDER_${n}___`,t)}),e},formatErrorMessage=e=>{const t=escapeHtml(e);return makePathsClickable(t).split("\n").map(e=>e.replace(/^( +)/,e=>"&nbsp;".repeat(e.length))).join("<br>")},extractTemplateCallStackFromText=e=>{const t=/Template call stack:\s*([\s\S]*?)(?:\n\s*\n|$)/i.exec(String(e||""));return t&&t[1]?t[1].split("\n").map(e=>e.trim()).filter(e=>e.length>0):[]},a=s.message||String(s),l=/Undefined template parameter '([^']+)'/.exec(a),c=(e=>{const t=String(e||"").split("\n"),n=[],s=[],r=[];let i=0;for(;i<t.length;){const e=t[i].trim(),o=/^.*tips?:/i.exec(e);if("template call stack:"!==e.toLowerCase()){if(o){const n=e.split(":").slice(1).join(":").trim();for(n&&r.push(n),i++;i<t.length&&t[i].trim();)r.push(t[i].trim()),i++;continue}n.push(t[i]),i++}else for(i++;i<t.length&&t[i].trim();)s.push(t[i].trim()),i++}return{messageLines:n,templateLines:s,tipLines:r}})(a);let p=c.messageLines.filter(e=>e.trim().length),f=c.templateLines,d=c.tipLines;if(f.length||(f=extractTemplateCallStackFromText(a)),!f.length&&r&&(f=extractTemplateCallStackFromText(r)),l){const e=l[1];p=[`Undefined template parameter '${e}'.`],d=[`- Ensure '${e}' is declared in the 'parameters' section`,"- Check if the reference should use a loop object instead of parameters (For e.g. {{ each cfg in configurations }}:, properties inside cfg should be referred with cfg.name)"],!f.length&&r&&(f=extractTemplateCallStackFromText(r))}0===d.length&&"expansion"===n&&(d=["- Undefined or circular template references","- Missing or incorrect parameter values","- Malformed YAML structure in referenced templates",'- Use "Pipeline Diagram" to see the complete dependency graph and identify the root cause.']);const h=[];p.length&&h.push(...p),f.length&&(h.push("Template call stack:"),f.forEach(e=>{h.push(`  ${e}`)}));const m=h.join("\n"),g=d.map(e=>e.startsWith("-")||e.startsWith("â€¢")?e:`- ${e}`),y=g.length?`\n                    <h2>Tips</h2>\n                    <div class="error-details">\n                        <code>${formatErrorMessage(g.join("\n"))}</code>\n                    </div>\n            `:"",b=r.split("\n").filter((e,t)=>0===t||e.trim().startsWith("at ")),v=b.length>0?b.map((e,t)=>0===t?e:e.trim().startsWith("at ")?`  ${e.trim()}`:e).join("\n"):"";let x=`\n            <!DOCTYPE html>\n            <html>\n            <head>\n                <style>\n                    body {\n                        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;\n                        line-height: 1.6;\n                        color: #e0e0e0;\n                        background-color: #1e1e1e;\n                        padding: 20px;\n                        margin: 0;\n                    }\n                    .error-container {\n                        max-width: 900px;\n                        margin: 0 auto;\n                    }\n                    h1 {\n                        color: #ff6b6b;\n                        margin-top: 0;\n                        font-size: 1.8em;\n                    }\n                    h2 {\n                        color: #ff9f43;\n                        margin-top: 20px;\n                        font-size: 1.3em;\n                        border-bottom: 1px solid #444;\n                        padding-bottom: 8px;\n                    }\n                    .error-details {\n                        background-color: #252526;\n                        border-left: 3px solid #ff6b6b;\n                        padding: 12px;\n                        margin: 12px 0;\n                        border-radius: 4px;\n                        overflow-x: auto;\n                        line-height: 1.8;\n                    }\n                    .error-details code {\n                        font-family: 'Courier New', Courier, monospace;\n                        font-size: 0.95em;\n                        color: #ce9178;\n                        white-space: normal;\n                        display: block;\n                    }\n                    .tip-box {\n                        background-color: #1f3a2c;\n                        border-left: 3px solid #4ec9b0;\n                        padding: 12px;\n                        margin: 12px 0;\n                        border-radius: 4px;\n                    }\n                    .tip-label {\n                        font-weight: bold;\n                        color: #4ec9b0;\n                        margin-bottom: 8px;\n                    }\n                    ul {\n                        margin: 8px 0;\n                        padding-left: 20px;\n                    }\n                    li {\n                        margin: 4px 0;\n                    }\n                    .file-link {\n                        color: #569cd6;\n                        text-decoration: underline;\n                        cursor: pointer;\n                        font-family: inherit;\n                    }\n                    .file-link:hover {\n                        color: #4fc3f7;\n                    }\n                    .stack-trace {\n                        background-color: #252526;\n                        border-left: 3px solid #888;\n                        padding: 12px;\n                        margin: 12px 0;\n                        border-radius: 4px;\n                        overflow-x: auto;\n                        font-family: 'Courier New', Courier, monospace;\n                        font-size: 0.9em;\n                        color: #d4d4d4;\n                        max-height: 400px;\n                        overflow-y: auto;\n                    }\n                    .file-list {\n                        background-color: #252526;\n                        border-left: 3px solid #569cd6;\n                        padding: 12px;\n                        margin: 12px 0;\n                        border-radius: 4px;\n                    }\n                    .hr {\n                        border: none;\n                        border-top: 1px solid #444;\n                        margin: 16px 0;\n                    }\n                </style>\n            </head>\n            <body>\n                <div class="error-container">\n                    <h1>${escapeHtml(i)}</h1>\n                    \n                    <h2>Error Details</h2>\n                    <div class="error-details">\n                        <code>${formatErrorMessage(m)}</code>\n                    </div>\n\n                    ${y}\n\n                    <h2>Stack Trace</h2>\n                    <div class="stack-trace">\n                        <pre>${makePathsClickable(escapeHtml(v||"No stack trace available"))}</pre>\n                    </div>\n                </div>\n\n                <script>\n                    const vscode = acquireVsCodeApi();\n                    function openFile(filePath, lineNumber) {\n                        vscode.postMessage({\n                            command: 'openFile',\n                            filePath: filePath,\n                            lineNumber: lineNumber\n                        });\n                    }\n                <\/script>\n            </body>\n            </html>\n        `;o.webview.html=x,o.webview.onDidReceiveMessage(e=>{"openFile"===e.command&&u.commands.executeCommand("azurePipelineStudio.openErrorFile",e.filePath,e.lineNumber)})},scheduleErrorDisplay=(e=500)=>{clearTimeout(y),clearTimeout(h),y=h=setTimeout(()=>{if(!x)return;if(b)return void scheduleErrorDisplay(e);const{error:t,context:n,errorType:s}=x;x=null,y=h=void 0,showErrorWebviewNow(t,0,s)},e)},showErrorWebview=(e,t,n="expansion")=>{x={error:e,context:t,errorType:n},scheduleErrorDisplay()},closeErrorPanel=()=>{if($){try{$.dispose()}catch(e){}$=null,I=!1}},scheduleRender=(e,t=500)=>{shouldRenderDocument(e)&&(v=e,clearTimeout(f),clearTimeout(d),f=d=setTimeout(()=>{if(b)return;const e=v;v=null,renderYamlDocument(e,{silent:!0})},t))},renderYamlDocument=async(n,s={})=>{if(!n)return;I&&closeErrorPanel(),l=n;const i=n.getText();b=!0;try{const e=u.workspace.getConfiguration("azurePipelineStudio",n.uri),o=e.get("expansion.variables",{}),a=e.get("expansion.skipSyntaxCheck",!1),l=buildResourceOverridesForDocument(n),p=s.azureCompatible??!1,f={fileName:n.fileName,azureCompatible:p,skipSyntaxCheck:a,...l&&{resources:l},...Object.keys(o).length&&{variables:o}};console.log("Parser overrides:",JSON.stringify(f,null,2));const d=t.expandPipelineFromString(i,f),m=getFormatSettings(n);m.fileName=n.fileName,m.wasExpanded=!0;const g=c(d,m),b=(e=>{const t=r.basename(e.fileName||"pipeline.yml")||"pipeline.yml",n=encodeURIComponent(e.fileName||t);return u.Uri.from({scheme:S,path:"/"+t,query:`${n}|expanded`})})(n);if(w.set(b.toString(),g.text),k.fire(b),clearTimeout(y),clearTimeout(h),y=h=void 0,x=null,closeErrorPanel(),!s.silent){const e=await u.workspace.openTextDocument(b);await u.window.showTextDocument(e,{viewColumn:u.ViewColumn.Two,preview:!1,preserveFocus:!0})}}catch(t){console.error("Error expanding pipeline:",t);const n=t.message||String(t),s=new Error(`Error Expanding Azure Pipeline:\n\n${n}`);s.stack=t.stack,showErrorWebview(s,e,"expansion")}finally{b=!1,v&&scheduleRender(v,0)}};function buildResourceOverridesForDocument(e){if(!u||!e)return;const t=u.workspace.getConfiguration("azurePipelineStudio",e.uri).get("resourceLocations");if(!Array.isArray(t)||!t.length)return;const n=u.workspace.getWorkspaceFolder(e.uri),s=n?.uri.fsPath,i=e.fileName?r.dirname(e.fileName):void 0,l={};for(const e of t){if(!e||"object"!=typeof e)continue;const t=e.repository?.trim(),n=o(e.path,e.location);if(!t||!n)continue;const r=a(n,s,i);if(!r)continue;const c={location:r},p={};["repository","name","endpoint","ref","type"].forEach(t=>{const n=e[t]?.trim();n&&(p[t]=n)}),Object.keys(p).length&&(c.__match=p),l[t]=c}return Object.keys(l).length?{repositories:l}:void 0}const shouldRenderDocument=e=>{if(!e||!e.fileName)return!1;const t=e.fileName.toLowerCase();return t.endsWith(".yaml")||t.endsWith(".yml")},isRelevantDocument=e=>shouldRenderDocument(e)&&l?.fileName===e.fileName,P=u.commands.registerCommand("azurePipelineStudio.showRenderedYaml",async()=>{const e=u.window.activeTextEditor;e&&shouldRenderDocument(e.document)?(closeErrorPanel(),await renderYamlDocument(e.document,{azureCompatible:!1})):u.window.showInformationMessage("Open an Azure Pipeline YAML file to view the expanded contents.")});e.subscriptions.push(P);const _=u.commands.registerCommand("azurePipelineStudio.showRenderedYamlAzureCompatible",async()=>{const e=u.window.activeTextEditor;e&&shouldRenderDocument(e.document)?(closeErrorPanel(),await renderYamlDocument(e.document,{azureCompatible:!0})):u.window.showInformationMessage("Open an Azure Pipeline YAML file to view the expanded contents.")});e.subscriptions.push(_);const T=u.commands.registerCommand("azurePipelineStudio.formatOriginalYaml",async()=>{const t=u.window.activeTextEditor;t&&shouldRenderDocument(t.document)?(closeErrorPanel(),await(async t=>{if(!t)return;const n=t.getText();let s;try{const r=getFormatSettings(t);if(r.fileName=t.fileName,r.wasExpanded=!1,s=c(n,r),s.error){const t=s.error instanceof Error?s.error:new Error(String(s.error));return void showErrorWebview(t,e,"formatting")}}catch(t){const n=t&&t.message?t.message:"An unexpected error occurred during YAML formatting";return void showErrorWebview(n,e,"formatting")}const r=t.validateRange(new u.Range(0,0,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER)),i=new u.WorkspaceEdit;i.replace(t.uri,r,s.text),await u.workspace.applyEdit(i)?(closeErrorPanel(),s.warning?u.window.showWarningMessage(s.warning):u.window.setStatusBarMessage("Applied YAML formatting.",3e3)):u.window.showErrorMessage("Failed to apply YAML formatting changes.")})(t.document)):u.window.showInformationMessage("Open an Azure Pipeline YAML file before formatting.")});e.subscriptions.push(T);const M=u.commands.registerCommand("azurePipelineStudio.configureResourceLocations",async()=>{try{console.log("[Azure Pipeline Studio] Configure Resource Locations command triggered"),await async function handleConfigureResourceLocationRequest(e){const t=l||(u.window.activeTextEditor&&shouldRenderDocument(u.window.activeTextEditor.document)?u.window.activeTextEditor.document:void 0);if(!t)return void u.window.showInformationMessage("Open an Azure Pipeline YAML file before configuring resource locations.");const n=u.workspace.getConfiguration("azurePipelineStudio",t.uri),s=n.get("resourceLocations"),r=Array.isArray(s)?s.filter(e=>e&&"object"==typeof e):[],getRepositoryAlias=e=>{if(!e||"object"!=typeof e)return;const t=[e.repository,e.alias,e.name];for(const e of t)if("string"==typeof e&&e.trim().length)return e.trim()};let i,a="string"==typeof e&&e.trim().length?e.trim():void 0;if(a)i=r.find(e=>getRepositoryAlias(e)===a);else{const e=r.map(e=>{const t=getRepositoryAlias(e);if(t)return{label:t,description:o(e.location,e.path)||"",entry:e}}).filter(Boolean);e.push({label:"$(plus) Add new repository mappingâ€¦",description:"Create a new entry for a repository resource.",newEntry:!0});const t=await u.window.showQuickPick(e,{placeHolder:"Select a repository resource to configure"});if(!t)return;if(t.newEntry){const e=await u.window.showInputBox({prompt:"Repository alias or name",placeHolder:"Name given under resources.repositories[].repository",ignoreFocusOut:!0});if(!e||!e.trim().length)return;a=e.trim()}else a=t.label,i=t.entry}if(!a)return;i||(i=r.find(e=>getRepositoryAlias(e)===a));const c=i?o(i.location,i.path):void 0,p=await u.window.showQuickPick([{label:"$(folder) Browse for folder",description:"Open a folder picker dialog",method:"browse"},{label:"$(edit) Enter path manually",description:"Type or paste a file path",method:"manual"}],{placeHolder:`Select how to specify location for repository '${a}'`,ignoreFocusOut:!0});if(!p)return;let f;if("browse"===p.method){const e=await u.window.showOpenDialog({canSelectFiles:!1,canSelectFolders:!0,canSelectMany:!1,openLabel:`Select location for '${a}'`,defaultUri:c?u.Uri.file(c):void 0});if(!e||0===e.length)return void u.window.showInformationMessage("Repository location not updated.");f=e[0].fsPath,console.log(`[Azure Pipeline Studio] Selected folder location: ${f}`)}else{if(f=await u.window.showInputBox({prompt:`Local path for repository '${a}'`,placeHolder:"${workspaceFolder}/path/to/templates",value:c||"",ignoreFocusOut:!0}),!f||!f.trim().length)return void u.window.showInformationMessage("Repository location not updated.");console.log(`[Azure Pipeline Studio] Entered manual location: ${f}`)}const d=f.trim(),h=[];let m=!1;r.forEach(e=>{if(getRepositoryAlias(e)===a){const t={...e,repository:a,location:d};delete t.path,h.push(t),m=!0}else h.push({...e})}),m||h.push({repository:a,location:d});u.workspace.getWorkspaceFolder(t.uri);const g=u.ConfigurationTarget.Workspace;try{console.log(`[Azure Pipeline Studio] About to save repository '${a}' location: ${d}`),console.log("[Azure Pipeline Studio] Target:",g),console.log("[Azure Pipeline Studio] Entries to save:",JSON.stringify(h,null,2)),await n.update("resourceLocations",h,g),console.log(`[Azure Pipeline Studio] Successfully saved repository '${a}' location: ${d}`),u.window.showInformationMessage(`Repository '${a}' location saved.`),await renderYamlDocument(t)}catch(e){console.error("[Azure Pipeline Studio] Error saving repository location:",e),u.window.showErrorMessage(`Failed to save repository location: ${e.message}`)}}()}catch(e){console.error("[Azure Pipeline Studio] Error in configure command:",e),u.window.showErrorMessage(`Configuration error: ${e.message}`)}});e.subscriptions.push(M);const renderDependenciesPanel=async(e,o={})=>{if(!e||!shouldRenderDocument(e))return void u.window.showInformationMessage("Open an Azure Pipeline YAML file to view dependencies.");const{reveal:a=!1,silent:l=!1}=o;if(closeErrorPanel(),A=e.uri,L)N=e;else{L=!0;try{const o=e.getText(),c=u.workspace.getConfiguration("azurePipelineStudio",e.uri),p=c.get("expansion.variables",{}),f=c.get("expansion.skipSyntaxCheck",!1),d=buildResourceOverridesForDocument(e),h={fileName:e.fileName,azureCompatible:!1,skipSyntaxCheck:f,...d&&{resources:d},...Object.keys(p).length&&{variables:p}};let m,y;l||u.window.setStatusBarMessage("Expanding pipeline templates...",2e3);try{m=t.expandPipelineFromString(o,h)}catch(e){const t=`Error in Pipeline Diagram:\n\n${e.message||"An error occurred while expanding pipeline templates"}\n\nðŸ’¡ Tip: Check your YAML syntax and template references. You can also use "Expand Pipeline" to debug template expansion issues.`,n=new Error(t);return n.stack=e.stack,void showErrorWebviewNow(n,0,"dependency")}l||u.window.setStatusBarMessage("Analyzing dependencies...",2e3);try{y=i.analyzePipeline(m)}catch(e){const t=`Error in Pipeline Diagram:\n\n${e.message||"An error occurred while analyzing pipeline dependencies"}\n\nðŸ’¡ Tip: It's often easier to identify and fix issues using "Expand Pipeline" first. This will show you the full expanded YAML with all template variables and references resolved.`,n=new Error(t);return n.stack=e.stack,void showErrorWebviewNow(n,0,"dependency")}const b=y.stages.length>0||y.jobs.length>0?i.generateMermaidDiagram(y):"",v=e?.fileName||"Pipeline",x=y.stages.length||y.jobs.length||0,S=`<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Pipeline Diagram</title>\n    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"><\/script>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n            background: #1e1e1e;\n            min-height: 100vh;\n            padding: 0;\n            margin: 0;\n        }\n\n        .container {\n            max-width: 100%;\n            margin: 0;\n            background: #252526;\n            overflow: hidden;\n        }\n\n        .header {\n            background: linear-gradient(135deg, #1a1a1a 0%, #0d0d0d 100%);\n            color: white;\n            padding: 20px;\n            border-bottom: 4px solid #0078d4;\n        }\n\n        .header h1 {\n            font-size: 2em;\n            margin-bottom: 10px;\n            display: flex;\n            align-items: center;\n            gap: 15px;\n        }\n\n        .header-icon {\n            font-size: 1.2em;\n        }\n\n        .header-info {\n            display: flex;\n            gap: 30px;\n            margin-top: 15px;\n            font-size: 0.9em;\n            opacity: 0.9;\n        }\n\n        .header-info-item {\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n\n        .content {\n            padding: 20px;\n            min-height: calc(100vh - 200px);\n            background: #252526;\n        }\n\n        .diagram-container {\n            background: #1e1e1e;\n            border-radius: 0;\n            padding: 20px;\n            margin-bottom: 0;\n            overflow: hidden;\n            height: calc(100vh - 250px);\n            position: relative;\n        }\n\n        .mermaid {\n            display: flex;\n            justify-content: center;\n            background: #1e1e1e;\n            border-radius: 0;\n            min-height: 400px;\n            transition: transform 0.1s ease-out;\n        }\n\n        .legend-color {\n            width: 20px;\n            height: 20px;\n            border-radius: 2px;\n        }\n\n        .stage-list {\n            display: grid;\n            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));\n            gap: 20px;\n            margin-top: 20px;\n        }\n\n        .stage-card {\n            background: #1e1e1e;\n            border-radius: 4px;\n            padding: 20px;\n            border-left: 4px solid #4299e1;\n            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);\n            transition: all 0.3s;\n            cursor: pointer;\n        }\n\n        .stage-card:hover {\n            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);\n            transform: translateY(-2px);\n        }\n\n        .stage-divider {\n            grid-column: 1 / -1;\n            height: 1px;\n            background: linear-gradient(to right, transparent, #3e3e42, transparent);\n            margin: 10px 0;\n        }\n\n        .stage-card h3 {\n            color: #ffffff;\n            margin-bottom: 10px;\n            display: flex;\n            align-items: center;\n            justify-content: space-between;\n        }\n\n        .stage-number {\n            display: inline-block;\n            width: 28px;\n            height: 28px;\n            background: #4299e1;\n            color: white;\n            border-radius: 4px;\n            text-align: center;\n            line-height: 28px;\n            font-size: 0.85em;\n            margin-right: 10px;\n        }\n\n        .stage-deps {\n            margin-top: 15px;\n            padding-top: 15px;\n            border-top: 1px solid #3e3e42;\n        }\n\n        .stage-deps-title {\n            font-size: 0.85em;\n            font-weight: 600;\n            color: #cccccc;\n            margin-bottom: 8px;\n        }\n\n        .dep-badge {\n            display: inline-block;\n            background: #3e3e42;\n            color: #e0e0e0;\n            padding: 4px 12px;\n            border-radius: 4px;\n            font-size: 0.8em;\n            margin-right: 6px;\n            margin-bottom: 6px;\n        }\n\n        .stage-details {\n            display: none;\n            margin-top: 20px;\n            padding-top: 20px;\n            border-top: 2px solid #3e3e42;\n            color: #cccccc;\n        }\n\n        .stage-card.expanded .stage-details {\n            display: block;\n        }\n\n        .expand-icon {\n            transition: transform 0.3s;\n        }\n\n        .stage-card.expanded .expand-icon {\n            transform: rotate(180deg);\n        }\n\n        .search-box {\n            margin-bottom: 20px;\n            position: relative;\n        }\n\n        .search-box input {\n            width: 100%;\n            padding: 12px 40px 12px 16px;\n            border: 2px solid #3e3e42;\n            border-radius: 4px;\n            font-size: 1em;\n            background: #1e1e1e;\n            color: #e0e0e0;\n            transition: border-color 0.3s;\n        }\n\n        .search-box input:focus {\n            outline: none;\n            border-color: #D13438;\n        }\n\n        .critical-path-box {\n            background: #ffeef0;\n            border-left: 4px solid #e53e3e;\n            padding: 20px;\n            border-radius: 4px;\n            margin: 20px 0;\n        }\n\n        .critical-path-box h3 {\n            color: #c53030;\n            margin-bottom: 10px;\n        }\n\n        .critical-path-box p {\n            font-family: 'Courier New', monospace;\n            color: #742a2a;\n            line-height: 1.8;\n            margin-bottom: 15px;\n        }\n\n        .resources-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));\n            gap: 20px;\n        }\n\n        .resource-card {\n            background: #1e1e1e;\n            border-radius: 4px;\n            padding: 20px;\n            border-left: 4px solid #48bb78;\n            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);\n        }\n\n        .resource-card h3 {\n            color: #ffffff;\n            margin-bottom: 15px;\n            display: flex;\n            align-items: center;\n            gap: 10px;\n        }\n\n        .resource-type {\n            display: inline-block;\n            background: #48bb78;\n            color: white;\n            padding: 4px 12px;\n            border-radius: 4px;\n            font-size: 0.75em;\n            font-weight: 600;\n            text-transform: uppercase;\n        }\n\n        .resource-details {\n            font-size: 0.9em;\n            color: #cccccc;\n        }\n\n        .resource-details div {\n            padding: 6px 0;\n            border-bottom: 1px solid #3e3e42;\n        }\n\n        .resource-details div:last-child {\n            border-bottom: none;\n        }\n        \n        .resource-details strong {\n            color: #ffffff;\n        }\n\n        @media (max-width: 768px) {\n            .stage-list {\n                grid-template-columns: 1fr;\n            }\n            .header h1 {\n                font-size: 1.5em;\n            }\n        }\n        \n        h2 {\n            color: #ffffff;\n        }\n        \n        p {\n            color: #cccccc;\n        }\n        \n        a:hover {\n            text-decoration: underline !important;\n            opacity: 0.8;\n        }\n        \n        .btn {\n            padding: 6px 12px;\n            border: none;\n            border-radius: 4px;\n            cursor: pointer;\n            font-size: 12px;\n            font-weight: 500;\n            transition: all 0.2s ease;\n            white-space: nowrap;\n        }\n        \n        .btn:hover {\n            transform: translateY(-1px);\n            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);\n        }\n        \n        .btn-primary {\n            background: #0078d4;\n            color: white;\n        }\n        \n        .btn-primary:hover {\n            background: #106ebe;\n        }\n        \n        .btn-secondary {\n            background: #3e3e42;\n            color: white;\n        }\n        \n        .btn-secondary:hover {\n            background: #4e4e52;\n        }\n    </style>\n</head>\n<body>\n    <div class="container">\n        <div class="header">\n            <div style="display: flex; align-items: center; gap: 10px;">\n                <h1 style="margin: 0;">\n                    Pipeline Diagram\n                </h1>\n                <button onclick="openInBrowser()" class="btn btn-primary">ðŸŒ Open in Browser</button>\n            </div>\n            <div class="header-info">\n                <div class="header-info-item">\n                    <button onclick="toggleDiagramSource()" id="source-toggle-btn" class="btn btn-secondary">ðŸ“ View Source</button>\n                </div>\n                <div class="header-info-item">\n                    <span>ðŸ—ï¸</span>\n                    <span>${x} Stage${1!==x?"s":""}</span>\n                </div>\n                <div class="header-info-item" style="display: flex; align-items: center; gap: 8px;">\n                    <div class="legend-color" style="width: 16px; height: 16px; background: #F87171; border-radius: 2px;"></div>\n                    <span style="font-size: 0.9em; color: #F87171;">Longest path</span>\n                </div>\n            </div>\n            <div style="margin-top: 8px; font-size: 0.85em; opacity: 0.7;">\n                <span>ðŸ“„ </span>\n                <a href="#" onclick="event.preventDefault(); const vscode = acquireVsCodeApi(); vscode.postMessage({ command: 'openFile', file: '${v}' });" style="color: #569cd6; text-decoration: none; cursor: pointer;" title="${v}">${v}</a>\n            </div>\n        </div>\n\n        <div class="content">\n            <div>\n                <div class="diagram-container" id="diagram-container" style="cursor: grab; overflow: hidden; position: relative;">\n                    <div class="mermaid" id="mermaid-diagram">\n${b.split("\n").map(e=>"                        "+e).join("\n")}\n                    </div>\n                    <div id="mermaid-error" style="display: none; padding: 20px; background: #2d1f1f; border-left: 4px solid #ff6b6b; color: #ff6b6b; border-radius: 4px; margin-top: 10px;">\n                        <h3 style="margin-top: 0; color: #ff6b6b;">âš ï¸ Diagram Rendering Error</h3>\n                        <p style="color: #cccccc; margin-bottom: 10px;">The Mermaid diagram failed to render. This could be due to:</p>\n                        <ul style="color: #cccccc; margin-left: 20px;">\n                            <li>Invalid Mermaid syntax in the generated diagram</li>\n                            <li>Complex pipeline structure that exceeds rendering limits</li>\n                            <li>Circular dependencies or invalid stage references</li>\n                        </ul>\n                        <p style="color: #cccccc; margin-top: 10px;">ðŸ’¡ <strong>Tip:</strong> View the source code below or check the "Mermaid Source" tab to validate it at <a href="https://mermaid.live" style="color: #569cd6;">mermaid.live</a></p>\n                        <pre id="mermaid-error-details" style="background: #1e1e1e; padding: 10px; border-radius: 4px; overflow-x: auto; margin-top: 10px; color: #ce9178;"></pre>\n                    </div>\n                </div>\n                \n                \x3c!-- Collapsible Source Code Section --\x3e\n                <div id="diagram-source-section" style="display: none; margin-top: 15px; background: #1e1e1e; border-radius: 4px; overflow: hidden; border-left: 4px solid #0078d4;">\n                    <div style="padding: 15px; background: #2d2d2d; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #3e3e42;">\n                        <h3 style="margin: 0; color: #ffffff; font-size: 1.1em;">ðŸ“ Mermaid Source Code</h3>\n                        <div style="display: flex; gap: 10px;">\n                            <button onclick="copyDiagramSource()" style="padding: 6px 12px; background: #0078d4; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 13px; font-weight: 500;">ðŸ“‹ Copy</button>\n                            <button onclick="toggleDiagramSource()" style="padding: 6px 12px; background: #3e3e42; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 13px; font-weight: 500;">âœ– Close</button>\n                        </div>\n                    </div>\n                    <div style="padding: 0;">\n                        <span id="diagram-copy-feedback" style="display: none; position: absolute; right: 20px; margin-top: 10px; color: #4ec9b0; background: #1e1e1e; padding: 5px 10px; border-radius: 4px; font-size: 13px;">âœ“ Copied!</span>\n                        <pre id="diagram-source-code" style="background: #1e1e1e; padding: 20px; margin: 0; overflow-x: auto; color: #ce9178; line-height: 1.6; font-family: 'Courier New', Courier, monospace; font-size: 14px; white-space: pre-wrap; word-wrap: break-word;">${b.replace(/</g,"&lt;").replace(/>/g,"&gt;")}</pre>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script>\n        // Open in browser function\n        window.openInBrowser = function() {\n            const vscode = acquireVsCodeApi();\n            vscode.postMessage({ command: 'openInBrowser' });\n        };\n        \n        // Pan and zoom functionality for diagram\n        (function() {\n            const container = document.getElementById('diagram-container');\n            if (!container) return;\n            \n            let scale = 1;\n            let translateX = 0;\n            let translateY = 0;\n            let isDragging = false;\n            let startX = 0;\n            let startY = 0;\n            \n            const updateTransform = function() {\n                const diagram = container.querySelector('.mermaid');\n                if (diagram) {\n                    diagram.style.transform = 'translate(' + translateX + 'px, ' + translateY + 'px) scale(' + scale + ')';\n                    diagram.style.transformOrigin = '0 0';\n                }\n            };\n            \n            // Mouse wheel zoom\n            container.addEventListener('wheel', function(e) {\n                e.preventDefault();\n                const delta = e.deltaY > 0 ? 0.9 : 1.1;\n                const newScale = scale * delta;\n                if (newScale >= 0.1 && newScale <= 5) {\n                    scale = newScale;\n                    updateTransform();\n                }\n            });\n            \n            // Mouse drag pan\n            container.addEventListener('mousedown', function(e) {\n                isDragging = true;\n                startX = e.clientX - translateX;\n                startY = e.clientY - translateY;\n                container.style.cursor = 'grabbing';\n            });\n            \n            document.addEventListener('mousemove', function(e) {\n                if (!isDragging) return;\n                translateX = e.clientX - startX;\n                translateY = e.clientY - startY;\n                updateTransform();\n            });\n            \n            document.addEventListener('mouseup', function() {\n                isDragging = false;\n                container.style.cursor = 'grab';\n            });\n        })();\n        \n        // Toggle diagram source visibility\n        window.toggleDiagramSource = function() {\n            const sourceSection = document.getElementById('diagram-source-section');\n            const toggleBtn = document.getElementById('source-toggle-btn');\n            if (sourceSection && toggleBtn) {\n                const isVisible = sourceSection.style.display !== 'none';\n                sourceSection.style.display = isVisible ? 'none' : 'block';\n                toggleBtn.textContent = isVisible ? 'ðŸ“ View Source' : 'ðŸ”¼ Hide Source';\n            }\n        };\n        \n        // Copy diagram source to clipboard\n        window.copyDiagramSource = function() {\n            const sourceCode = document.getElementById('diagram-source-code');\n            const feedback = document.getElementById('diagram-copy-feedback');\n            if (sourceCode) {\n                const text = sourceCode.textContent;\n                navigator.clipboard.writeText(text).then(function() {\n                    feedback.style.display = 'inline';\n                    setTimeout(function() {\n                        feedback.style.display = 'none';\n                    }, 2000);\n                }).catch(function(err) {\n                    console.error('Failed to copy:', err);\n                });\n            }\n        };\n        \n        // Initialize Mermaid with error handling\n        mermaid.initialize({ \n            startOnLoad: false,\n            theme: 'dark',\n            flowchart: {\n                useMaxWidth: true,\n                htmlLabels: true,\n                curve: 'basis'\n            }\n        });\n        \n        // Manually render with error handling\n        try {\n            mermaid.run({\n                querySelector: '.mermaid',\n            }).catch(function(error) {\n                console.error('Mermaid rendering error:', error);\n                const diagramDiv = document.getElementById('mermaid-diagram');\n                const errorDiv = document.getElementById('mermaid-error');\n                const errorDetails = document.getElementById('mermaid-error-details');\n                if (diagramDiv && errorDiv && errorDetails) {\n                    diagramDiv.style.display = 'none';\n                    errorDiv.style.display = 'block';\n                    errorDetails.textContent = error.message || String(error);\n                }\n            });\n        } catch (error) {\n            console.error('Mermaid initialization error:', error);\n            const diagramDiv = document.getElementById('mermaid-diagram');\n            const errorDiv = document.getElementById('mermaid-error');\n            const errorDetails = document.getElementById('mermaid-error-details');\n            if (diagramDiv && errorDiv && errorDetails) {\n                diagramDiv.style.display = 'none';\n                errorDiv.style.display = 'block';\n                errorDetails.textContent = error.message || String(error);\n            }\n        }\n        \n        // Initial diagram is already rendered\n    <\/script>\n</body>\n</html>`,w=E||(E=u.window.createWebviewPanel("pipelineDependencies","Pipeline Dependencies",u.ViewColumn.Two,{enableScripts:!0}),E.onDidDispose(()=>{E=g=null,A=void 0}),E.webview.onDidReceiveMessage(async e=>{if("openInBrowser"===e.command)try{const e=n(857),t=r.join(e.tmpdir(),`pipeline-dependencies-${Date.now()}.html`);s.writeFileSync(t,O),await u.env.openExternal(u.Uri.file(t)),u.window.showInformationMessage("Opened dependencies in browser")}catch(e){u.window.showErrorMessage(`Failed to open in browser: ${e.message}`)}else if("openFile"===e.command)try{const t=u.Uri.file(e.file);await u.window.showTextDocument(t)}catch(e){u.window.showErrorMessage(`Failed to open file: ${e.message}`)}}),E);if(!w)return;g=E=w,O=S;try{w.webview.html=S}catch(e){return E=null,void(g=null)}if(a)try{w.reveal(u.ViewColumn.Two,!0)}catch(e){}closeErrorPanel(),l||u.window.setStatusBarMessage("Pipeline dependencies analyzed.",3e3)}catch(e){const t=e.message||"An unexpected error occurred while analyzing dependencies",n=new Error(`Error in Pipeline Diagram:\n\n${t}\n\nðŸ’¡ Tip: This is an unexpected error. Please check the error details below.`);n.stack=e.stack,showErrorWebviewNow(n,0,"dependency")}finally{if(L=!1,N){const e=N;N=null,renderDependenciesPanel(e,{silent:!0})}}}},D=u.commands.registerCommand("azurePipelineStudio.showDependencies",async()=>{const e=u.window.activeTextEditor;e&&shouldRenderDocument(e.document)?await renderDependenciesPanel(e.document,{reveal:!0}):u.window.showInformationMessage("Open an Azure Pipeline YAML file to view dependencies.")});e.subscriptions.push(D),e.subscriptions.push(u.workspace.onDidCloseTextDocument(e=>{e.uri.scheme===S&&w.delete(e.uri.toString())})),e.subscriptions.push(u.workspace.onDidChangeTextDocument(({document:e})=>{isRelevantDocument(e)&&(scheduleRender(e),l&&l.fileName===e.fileName&&renderYamlDocument(e,{silent:!0})),((e,t=500)=>{E&&A&&e.uri.toString()===A.toString()&&(N=e,clearTimeout(C),clearTimeout(m),C=m=setTimeout(()=>{if(!E||L)return;const e=N;N=null,e&&renderDependenciesPanel(e,{silent:!0})},t))})(e)})),e.subscriptions.push(u.workspace.onDidSaveTextDocument(e=>{if(!isRelevantDocument(e))return;u.workspace.getConfiguration("azurePipelineStudio",e.uri).get("refreshOnSave",!0)&&scheduleRender(e,0)}))},deactivate:function deactivate(){if(clearTimeout(d),clearTimeout(h),clearTimeout(m),d=void 0,h=void 0,m=void 0,g){try{g.dispose()}catch(e){}g=null}},AzurePipelineParser,formatYaml:c,formatFilesRecursively,DependencyAnalyzer:p},n.c[n.s]===e&&function runCli(e){if(void 0!==u)return;const t="Usage: node extension.js <file1> <file2> ...\nOptions:\n  -h, --help                   Show this help message\n  -o, --output <file>          Write output to file (default: in-place, only with single file)\n  -r, --repo <alias=path>      Map repository alias to local path\n  -v, --variables <key=value>  Set compile-time variables (e.g., Build.Reason=Manual)\n  -f, --format-option <key=value>  Set format option (e.g., indent=4)\n  -R, --format-recursive <path>    Format files recursively in directory (when used, all paths are treated as recursive targets)\n  -e, --extension <ext>        File extensions to format (default: .yml, .yaml)\n  -x, --expand-templates       Expand Azure Pipeline template expressions (${{}},$[],$())\n  -a, --azure-compatible       Use Azure-compatible expansion mode (adds blank lines, etc.)\n  -s, --skip-syntax-check      Skip syntax checking during expansion\n  -d, --debug                  Print files being formatted",n=i(e,{string:["output","repo","format-option","format-recursive","extension","variables"],boolean:["help","expand-templates","azure-compatible","skip-syntax-check","debug"],alias:{h:"help",o:"output",r:"repo",f:"format-option",R:"format-recursive",e:"extension",v:"variables",x:"expand-templates",a:"azure-compatible",s:"skip-syntax-check",d:"debug"},default:{extension:[],"expand-templates":!1,"azure-compatible":!1,"skip-syntax-check":!1,debug:!1}});n.help&&(console.log(t),process.exit(0));const toArray=e=>[].concat(e||[]),o=toArray(n.repo),l=toArray(n.variables),p=toArray(n["format-option"]),f=n["format-recursive"],d=toArray(f).filter(e=>"string"==typeof e&&e.trim().length),h=e.includes("-R")||e.includes("--format-recursive")||!0===f,m=toArray(n.extension),g=[],y={},b=[];for(const e of o){const[t,...n]=e.split("="),s=n.join("=").trim();t&&t.trim()&&s?g.push({alias:t.trim(),path:s}):b.push(`Invalid repository mapping "${e}". Expected format "alias=path".`)}for(const e of l){const[t,...n]=e.split("="),s=n.join("=").trim();t&&t.trim()&&void 0!==s?y[t.trim()]=s:b.push(`Invalid variable "${e}". Expected format "key=value".`)}for(const e of p)e.includes("=")||b.push(`Invalid format option "${e}". Expected format "key=value".`);if(b.length)return b.forEach(e=>console.error(e)),console.error(t),void(process.exitCode=1);const v=n._,x=h||d.length?[...d,...v]:[];if(h&&0===x.length)return console.error("Error: --format-recursive requires at least one path."),console.error(t),void(process.exitCode=1);if(x.length){const e=buildFormatOptionsFromCli(p)||{},t=formatFilesRecursively(x,m.length?m:[".yml",".yaml"],e);return t.formattedFiles.forEach(e=>{const t=r.relative(process.cwd(),e)||e;console.log(`Formatted: ${t}`)}),console.log(`Processed ${t.totalFiles} file(s); formatted ${t.formattedFiles.length}.`),t.warnings.forEach(e=>{const t=r.relative(process.cwd(),e.filePath)||e.filePath,n=e.message.match(/at line (\d+), column (\d+):/);if(n){const s=n[1],r=n[2],i=e.message.replace(/ at line \d+, column \d+:/,"");console.warn(`[warn] ${t}:${s}:${r}: ${i}`)}else console.warn(`[warn] ${t}: ${e.message}`)}),t.errors.forEach(e=>{const t=r.relative(process.cwd(),e.filePath)||e.filePath,n=e.message.match(/at line (\d+), column (\d+):/);if(n){const s=n[1],r=n[2],i=e.message.replace(/ at line \d+, column \d+:/,"");console.error(`[error] ${t}:${s}:${r}: ${i}`)}else console.error(`[error] ${t}: ${e.message}`)}),void(t.errors.length&&(process.exitCode=1))}if(0===v.length)return console.error(t),void(process.exitCode=1);if(n.output&&v.length>1)return console.error("Error: --output option is only supported when formatting a single file."),console.error(t),void(process.exitCode=1);const S=buildFormatOptionsFromCli(p)||{},w=function buildRepositoryOverridesFromCliEntries(e,t){if(!Array.isArray(e)||0===e.length)return;const n={};return e.forEach(e=>{if(!e||"object"!=typeof e)return;const s=e.alias,r=e.path;if("string"!=typeof s||!s.trim().length||"string"!=typeof r||!r.trim().length)return;const i=a(r,t,void 0);i?n[s]={repository:s,location:i}:console.warn(`Skipping repository mapping '${s}': could not resolve path '${r}'.`)}),Object.keys(n).length?n:void 0}(g,process.cwd()),k=Object.keys(y).length>0?y:void 0,E=n["expand-templates"]?new AzurePipelineParser:null;let A=!1;for(const e of v){const t=r.resolve(process.cwd(),e);n.debug&&console.log(`[DEBUG] Formatting: ${t}`);try{const i=s.readFileSync(t,"utf8");let o=i;if(n["expand-templates"]&&E){const s={fileName:t,azureCompatible:n["azure-compatible"]||!1,skipSyntaxCheck:n["skip-syntax-check"]||!1};if(w){const e={};for(const[t,n]of Object.entries(w))e[t]=n.location||n.path;s.resourceLocations=e,n.debug&&console.log("[DEBUG] Resource locations:",JSON.stringify(e,null,2))}k&&(s.variables=k,n.debug&&console.log("[DEBUG] Compile-time variables:",JSON.stringify(k,null,2)));try{expandedYaml=E.expandPipelineFromString(i,s),o=expandedYaml}catch(t){const s="string"==typeof t?.message?t.message:String(t),r=s.match(/Template\s+'([^']+)'\s+potential issues:([\s\S]*)/);if(r){const t=r[1],n=(r[2]||"").trimEnd(),s=`[${e}] Template(${t}) expansion failed. Potential issues:${n?`${n}`:""}`;console.error(s)}else{const t=s.split("\n"),n=t[0],r=t.slice(1).map(e=>"  "+e).join("\n"),i=r?`[${e}] Template expansion failed\n  ${n}\n${r}`:`[${e}] Template expansion failed\n  ${n}`;console.error(i)}n.debug&&console.error("[DEBUG] Full error:",t),A=!0;continue}}const a={...S||{},fileName:t};delete a.expandTemplates,n["expand-templates"]&&(a.wasExpanded=!0,a.azureCompatible=n["azure-compatible"]||!1);const l=c(o,a);if(l.error){const t=l.error.split("\n").map((e,t)=>0===t?e:"  "+e).join("\n");console.error(`[${e}] ${t}`),A=!0;continue}if(l.warning){const t=l.warning.split("\n").map((e,t)=>0===t?e:"  "+e).join("\n");console.warn(`[${e}] ${t}`)}let p=l.text;if(n["expand-templates"]&&n["azure-compatible"]&&(p=E.addHeredocListSpacing(p)),n.output){const e=r.resolve(process.cwd(),n.output);if(s.writeFileSync(e,p,"utf8"),i!==p){const t=n["expand-templates"]?"Expanded":"Formatted";console.log(`${t} pipeline written to ${e}`)}}else n["expand-templates"]?console.log(p):i!==p&&(s.writeFileSync(t,p,"utf8"),console.log(`Formatted ${e} (in-place)`))}catch(t){console.error(`[${e}] ${t.message}`),A=!0}}A&&(process.exitCode=1)}(process.argv.slice(2))},652(e,t,n){const s=n(1198);function escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function isConditionalDirective(e,t=null){const n=e.trim().replace(/^-\s+/,"");if(/^\$\{\{\s*(if|elseif|else|each|insert)(\s|\})/i.test(n))return!0;if(t){const e=n.match(/^(__EXPR_PLACEHOLDER_\d+__)/);if(e&&t.has(e[1]))return!0}return!1}function replaceTemplateExpressionsWithPlaceholders(e){if(!e)return{content:e,placeholderMap:new Map,conditionalDirectives:new Set};const t=new Map,n=new Set;let s=0;return{content:e.replace(/(\$\{\{[^}]+\}\}|\$\[[^\]]+\])/g,e=>{const r="__EXPR_PLACEHOLDER_"+s+"__";let i=e;return e.startsWith("${{")&&e.endsWith("}}")&&!/[\r\n\t]/.test(e)&&(i=e.replace(/^\$\{\{\s*/,"${{ ").replace(/\s*\}\}$/," }}")),t.set(r,i),isConditionalDirective(i)&&n.add(r),s++,r}),placeholderMap:t,conditionalDirectives:n}}function restoreTemplateExpressions(e,t){if(!e||!t||0===t.size)return e;let n=e;for(const[e,s]of t)n=n.replace(new RegExp(escapeRegExp(e),"g"),s);return n=n.replace(/\}\}\s+:/g,"}}:"),n}function parseFormatDirectives(e){const t={disabled:!1,options:null},n=e.split(/\r?\n/).slice(0,5);for(const e of n){const n=e.trim();if(isComment(e)&&("# aps-format=false"===n||"# aps-format: false"===n))return t.disabled=!0,t;const s=n.match(/^#\s*aps-format[:\s]+(.+)$/);if(s){const e=s[1].trim();t.options=parseDirectiveOptions(e)}if(hasActualContent(e))break}return t}function parseDirectiveOptions(e){const t={},n=e.split(",");for(const e of n){const[n,s]=e.split("=").map(e=>e.trim());if(n&&void 0!==s)switch(n.toLowerCase()){case"newline":case"newlineformat":t.newlineFormat=s.replace(/\\r\\n/g,"\r\n").replace(/\\n/g,"\n").replace(/\\r/g,"\r");break;case"linewidth":const e=parseInt(s,10);isNaN(e)||(t.lineWidth=e);break;case"indent":const n=parseInt(s,10);!isNaN(n)&&n>0&&n<=8&&(t.indent=n);break;case"noarrayindent":t.noArrayIndent="true"===s.toLowerCase();break;case"forcequotes":t.forceQuotes="true"===s.toLowerCase();break;case"sortkeys":t.sortKeys="true"===s.toLowerCase();break;case"preservecomments":t.preserveComments="true"===s.toLowerCase();break;case"stepspacing":t.stepSpacing="true"===s.toLowerCase();break;case"sectionspacing":t.sectionSpacing="true"===s.toLowerCase();break;case"normalizepaths":t.normalizePaths="true"===s.toLowerCase();break;case"expandtemplates":t.expandTemplates="true"===s.toLowerCase()}}return t}function validateTemplateExpressions(e,t){const n=[];let s=0;for(;s<e.length;){const r=e.indexOf("${{",s);if(-1===r)break;const i=e.indexOf("}}",r+3);if(-1===i){n.push(`line ${t}: Missing closing '}}' for template expression starting at column ${r+1}.`);break}s=i+2}const r=e.matchAll(/\$\{\{([\s\S]*?)\}\}/g);for(const e of r){const s=e[1];let r=0,i=0,o=0,a=!1,l=null;for(let e=0;e<s.length;e++){const c=s[e];if('"'===c||"'"===c){let t=!1;if('"'===c){let n=0,r=e-1;for(;r>=0&&"\\"===s[r];)n++,r--;t=n%2==1}t||(a?c===l&&(a=!1,l=null):(a=!0,l=c))}a||("("===c?r++:")"===c?r--:"["===c?i++:"]"===c?i--:"{"===c?o++:"}"===c&&o--,r<0&&(n.push(`line ${t}: Unbalanced parentheses in template expression - extra closing ')' found.`),r=0),i<0&&(n.push(`line ${t}: Unbalanced brackets in template expression - extra closing ']' found.`),i=0),o<0&&(n.push(`line ${t}: Unbalanced braces in template expression - extra closing '}}' found.`),o=0))}a?n.push(`line ${t}: Unclosed string in template expression - missing closing ${l} quote.`):(r>0&&n.push(`line ${t}: Unbalanced parentheses in template expression - missing ${r} closing ')'.`),i>0&&n.push(`line ${t}: Unbalanced brackets in template expression - missing ${i} closing ']'.`),o>0&&n.push(`line ${t}: Unbalanced braces in template expression - missing ${o} closing '}'.`))}return n}function hasExitedJobsBlock(e,t,n,s){return!e&&t<=n&&s.includes(":")&&!s.startsWith("-")&&!s.startsWith("${{")&&!s.startsWith("jobs:")}function isStartingNewJob(e,t,n,s){return e&&(t.match(/^-\s+job:/)||t.startsWith("job:")&&-1!==n&&s<=n)}function analyzeTemplateHints(e,t=new Set){if("string"!=typeof e||!e.length)return[];const n=[],s=e.split(/\r?\n/);let r=!1,i=!1,o=-1,a=-1,l=-1;for(let e=0;e<s.length;e++){const c=s[e],p=c.trim();if(p&&!p.startsWith("#")){const t=c.match(/^(\s*)/)[1].length;if(p.startsWith("jobs:")&&(r=!0,l=t,i=!1,o=-1),r){(p.match(/^-\s+job:/)||p.startsWith("job:"))&&(i=!0,a=e+1,o=-1);const s=p.match(/^\$\{\{/)||p.match(/^\$\[/);if(hasExitedJobsBlock(s,t,l,p)&&(r=!1,i=!1),i&&!s){const s=/^(displayName|dependsOn|condition|workspace|pool|strategy|timeoutInMinutes|cancelTimeoutInMinutes|variables|container|services):/;p.match(s)&&-1===o&&(o=t),p.startsWith("steps:")&&(-1!==o&&t<o&&n.push(`line ${e+1}: 'steps:' is not properly indented under the job.\n    Expected ${o} spaces (same as other job properties like 'displayName' or 'pool'), but found ${t} spaces.\n    The 'steps:' property must be at the same indentation level as other job properties (job starts at line ${a}).`),i=!1);const r=/^-\s+(script|task|bash|pwsh|powershell|checkout|download|publish|template):/;if(p.match(r)){if(-1!==o&&t<o){const s=p.match(r)[1];n.push(`line ${e+1}: Step item '- ${s}:' is not properly indented under the job.\n    Expected ${o} spaces (same as other job properties like 'displayName' or 'pool'), but found ${t} spaces.\n    Step items must be at the same indentation level as other job properties (job starts at line ${a}).`)}i=!1}isStartingNewJob(i,p,o,t)&&-1!==o&&(i=!1)}}}if(isStandaloneExpression(c)&&!isMappingKey(c)&&containsConditionalKeyword(c)){const t="- ${{ if ... }}:";n.push(`line ${e+1}: Add ':' after the expression (e.g., '${t}').`)}hasElseIfTypo(c)&&n.push(`line ${e+1}: Use 'elseif' instead of 'else if' in Azure expressions.`);const u=c.match(/\b(eq|ne|contains|startsWith|endsWith)\s*\(([^)]*)\)/i);if(u){const t=u[2],s=t.includes(","),r=t.trim().split(/\s+/);!s&&r.length>=2&&n.push(`line ${e+1}: Add a comma between arguments (e.g., ${u[1]}(a, b)).`)}if(isExpressionWithColon(p)&&!p.startsWith("-")){let r=!1;const i=getIndent(c);for(let t=e-1;t>=0;t--){const e=s[t];if(!isBlank(e)){if(isListItem(e)){i===getIndent(e)&&(r=!0)}break}}if(!r)for(let t=e+1;t<s.length;t++){const e=s[t];if(!isBlank(e)){if(isListItem(e)){i===getIndent(e)&&(r=!0)}break}}if((r||!isConditionalDirective(p,t))&&r){const t="- ${{ if ... }}:";n.push(`line ${e+1}: Prepend '-' for list items using expressions (e.g., '${t}').`)}}const f=validateTemplateExpressions(c,e+1);n.push(...f)}return n}function findFirstKeyOccurrence(e,t,n){if(!e||"string"!=typeof e)return null;const s=e.split("\n");if(t>=s.length)return null;const r=s[t].slice(n).match(/^(\s*)([^:\s]+)\s*:/);if(!r)return null;const i=r[2],o=n+r[1].length;for(let e=0;e<t;e++){const t=s[e],n=t.trimStart();if(n.startsWith("#")||0===n.length)continue;const r=t.length-n.length,a=new RegExp(`^${i}\\s*:`);if(r===o&&a.test(n))return{line:e,column:r}}return null}function isDuplicateKeyForTemplateExpression(e){if(!e||"object"!=typeof e)return!1;if(!("string"==typeof e.message?e.message:"").includes("duplicated mapping key"))return!1;if(("string"==typeof e.snippet?e.snippet:"").includes("${{"))return!0;return(e.mark&&"string"==typeof e.mark.snippet?e.mark.snippet:"").includes("${{")}function findNextNonBlankLine(e,t){for(let n=t;n<e.length;n++)if(!isBlank(e[n]))return n;return null}function isMainSectionKey(e){return"steps:"===e||"stages:"===e||"jobs:"===e}function isMappingKey(e){return!(!e||"string"!=typeof e)&&e.trim().endsWith(":")}function isComment(e){if(!e||"string"!=typeof e)return!1;return e.trim().startsWith("#")}function isListItem(e){if(!e||"string"!=typeof e)return!1;const t=e.trim();return/^\s*-\s/.test(t)}function isBlank(e){return!e||"string"!=typeof e||""===e.trim()}function hasActualContent(e){return!isBlank(e)&&!isComment(e)}function isBlankOrCommentLine(e){return isBlank(e)||isComment(e)}function isNonCommentContent(e){return e&&!e.startsWith("#")}function isConditionalListItem(e){return/^-\s+\$\{\{\s*(if|else|elseif|each)\s/.test(e)}function containsTemplateExpression(e){return"string"==typeof e&&e.includes("${{")}function containsConditionalKeyword(e){return/\$\{\{\s*(if|else|elseif|each)\s/.test(e)}function hasElseIfTypo(e){const t=e.trim();return/\belse\s+if\b/i.test(t)}function isStandaloneExpression(e){const t=e.trim();return/^-?\s*\$\{\{[^}]+\}\}\s*$/.test(t)}function isExpressionWithColon(e){return/^\$\{\{[^}]+\}\}\s*:/.test(e)||/^__EXPR_PLACEHOLDER_\d+__\s*:/.test(e)}function startsMultiLineScalarBlock(e){return/:\s*[|>][-+]?\s*$/.test(e)}function getIndent(e){return e.length-e.trimStart().length}function getBooleanOption(e,t,n){return e&&"boolean"==typeof e[t]?e[t]:n}function getClampedIntegerOption(e,t,n,s){return!e||!Number.isInteger(e[t])||e[t]<0?s:Math.min(e[t],n)}function getBetweenSectionBlankLines(e){const t=getClampedIntegerOption(e,"betweenSectionBlankLines",4,null);if(null!==t)return t;const n=getClampedIntegerOption(e,"blankLinesBetweenSections",4,null);return null!==n?n:1}function getNewlineFormat(e){const t=e&&"string"==typeof e.newlineFormat?e.newlineFormat:null;return"\n"===t||"\r\n"===t?t:"\n"}function getLineWidth(e){return e&&"number"==typeof e.lineWidth&&e.lineWidth>=0?0===e.lineWidth?-1:e.lineWidth:-1}function getIndentOption(e){return e&&Number.isInteger(e.indent)&&e.indent>0&&e.indent<=8?e.indent:2}const r=/^\s*-\s+(task|bash|powershell|pwsh|script|sh|checkout|download|downloadBuild|getPackage|publish|reviewApp|template):/;function handleCommentLine(e){const{lineNum:t,inMultiLineBlock:n,pass1:s,currentSection:r,spacedSections:i,lines:o,foundFirstMainSection:a}=e,l=o[t],c=t;if(n)return s.push(l),!0;let p=!0;for(let e=c+1;e<o.length;e++)if(hasActualContent(o[e])){p=!1;break}if(!p){let e=!1;const n=getIndent(l);for(let s=t-1;s>=0;s--){const t=o[s];if(isBlank(t)||isComment(t))continue;const r=getIndent(t);if("steps:"===t.trim()&&r<=n){e=!0;break}if(r<n&&!t.trim().startsWith("-"))break}if(function needsBlankBeforeComment(e,t,n,s,r){return e||"steps"===t||n.includes(t)||s&&0===getIndent(r)}(e,r,i,a,l)){const e=s.length>0?s[s.length-1]:null,t=e?e.trim():"",n="steps:"===t||"jobs:"===t||"stages:"===t;!e||isBlank(e)||n||s.push("")}}return s.push(l),!0}function findPreviousNonBlankLine(e,t){for(let n=t;n>=0;n--)if(!isBlank(e[n]))return n;return null}function handleBlankLine(e){const{pass1:t,inMultiLineBlock:n,currentSection:s,spacedSections:r,listItemSections:i,prevWasComment:o,lineNum:a,lines:l}=e,c=findNextNonBlankLine(l,a+1);if(null===c)return{continue:!0,prevWasComment:!1};if(!n&&("parameters"===s||"variables"===s))return{continue:!0,prevWasComment:!1};if(n)return t.push(""),{continue:!0,prevWasComment:!1};const p=getIndent(l[c]);let u=!1;const f=findPreviousNonBlankLine(t,t.length-1),d=null!==f?t[f]:null;if(d){const e=getIndent(d),t=d.trim();if(0===e&&isMainSectionKey(t))u=!0;else if(o)u=!0;else if("variables"===s)u=!1;else if("steps"===s||r.includes(s)){const e=isComment(d),t=isListItem(l[c]);u=!(e&&t)}else i.includes(s)&&(0!==p&&2!==p||(u=!0))}if(u&&isComment(l[c])){let e=!1,n=-1;for(let s=t.length-1;s>=0;s--){if(hasActualContent(t[s])){e=!0,n=s;break}if(isBlankOrCommentLine(t[s]))break}if(e){let e=!1;for(let t=c;t<l.length;t++)if(hasActualContent(l[t])){e=!0;break}if(!e){let e=0;for(let s=n+1;s<t.length;s++)isBlank(t[s])&&e++;e>=1&&(u=!1)}}}return u&&t.push(l[a]),{continue:!0,prevWasComment:!1}}function handleStepSpacing(e){const{pass1:t,lineIndent:n,lineNum:s,lines:i}=e,o=i[s],a=o.trim();let l=-1;isMainSectionKey(a)?containsTemplateExpression(o)||(l=n):l>=0&&n<=l&&isNonCommentContent(a)&&(isMainSectionKey(a)||(l=-1));const c=isListItem(o),p=isConditionalListItem(o),u=c&&!p&&function isStepOrExpressionListItem(e){return r.test(e)||function isExpressionListItem(e){return/^\s*-\s+\$\{\{.*\}\}:?/.test(e)}(e)}(o);return function shouldAddBlankBeforePipelineItem(e,t,n,s,r){const{pass1:i,lastStepInStepsSection:o,inMultiLineBlock:a,variablesIndent:l,startsMultiLineBlock:c,lineIndent:p}=e,u=r&&o>=0,f=l>=0&&p===l&&n,d=i.length>0?i[i.length-1].trim():"",h=isConditionalListItem(d),m=isMainSectionKey(d),g=a&&!c;return(s||u)&&o>=0&&!m&&!h&&!g&&!f}(e,0,c,u,p)&&t.length>0&&!isBlank(t[t.length-1])&&t.push(""),{isPipelineItem:u}}function handleSectionSpacing(e){const{pass1:t,options:n,hasParametersAtStart:s,parametersEnded:r,firstNonEmptyLine:i,foundFirstSection:o,foundFirstMainSection:a,lastRootSectionIndex:l,topLevelSections:c,lineNum:p,lines:u}=e,f=u[p],d=f.trim(),h=!isComment(f)&&!isListItem(f)&&0===getIndent(f)&&(isMappingKey(f)||d.includes(": "));let m=!1,g=r,y=o,b=a;if(s&&!n.wasExpanded&&(!r&&p>i&&h&&(g=!0),g&&!y&&c.some(e=>d===e))){y=!0,m=!0;for(isMainSectionKey(d.includes(":")?d.substring(0,d.indexOf(":")+1).trim():d)&&(b=!0);t.length>0&&isBlank(t[t.length-1]);)t.pop();for(let e=0;e<n.firstBlockBlankLines;e++)t.push("")}let v=l;if(h&&!m&&!n.wasExpanded){const e=d.includes(":")?d.substring(0,d.indexOf(":")+1).trim():d,r=isMainSectionKey(e),i=r&&!b&&(s?g:l>=0);i&&(b=!0,y=!0);let o=!1;for(let e=p+1;e<u.length;e++)if(hasActualContent(u[e])){o=!0;break}let a=0;if((l>=0||s&&g)&&o){for(;t.length>0&&isBlank(t[t.length-1]);)t.pop();a="name:"===e?1:i?n.firstBlockBlankLines:r?1:n.betweenSectionBlankLines;for(let e=0;e<a;e++)t.push("")}}return h&&(v=t.length),{section2HandledThisLine:m,parametersEnded:g,foundFirstSection:y,foundFirstMainSection:b,lastRootSectionIndex:v}}function updateMultiLineBlockStateForSpacing(e){const{line:t,indent:n,inMultiLineBlock:s,multiLineBlockIndent:r}=e;startsMultiLineScalarBlock(t)?(e.inMultiLineBlock=!0,e.multiLineBlockIndent=n):s&&!isBlank(t)&&n<=r&&(e.inMultiLineBlock=!1,e.multiLineBlockIndent=-1)}function updateSectionContextForSpacing(e){const{line:t,indent:n,trimmed:s}=e;if(!isBlank(t)&&!isListItem(t)&&isMappingKey(s)){const t=s.slice(0,-1);"variables"===t||"parameters"===t?(e.insideVariablesOrParameters=!0,e.variablesOrParametersIndent=n):e.currentSection=t}if(e.insideVariablesOrParameters&&n<e.variablesOrParametersIndent&&(e.insideVariablesOrParameters=!1,e.variablesOrParametersIndent=-1),e.insideVariablesOrParameters&&!isBlank(t)&&!isListItem(t)&&isMappingKey(s)){(function shouldExitVariablesOrParametersSection(e,t,n){return"variables"!==e&&"parameters"!==e&&t===n})(s.slice(0,-1),n,e.variablesOrParametersIndent)&&(e.insideVariablesOrParameters=!1,e.variablesOrParametersIndent=-1)}}function updateNestedMappingContextForSpacing(e){const{line:t,indent:n,trimmed:s,insideNestedMapping:r,nestedMappingIndent:i}=e;if(r&&!isBlank(t)&&(n<i||n===i&&!isListItem(t))&&(e.insideNestedMapping=!1,e.nestedMappingIndent=-1),function shouldEnterNestedMappingForSpacing(e){const{line:t,effectivelyInMultiLineBlock:n,sectionStack:s,insideNestedMapping:r}=e;return!n&&!isListItem(t)&&!isComment(t)&&isMappingKey(t)&&s.length>0&&!containsTemplateExpression(t)&&!r}(e)){const t=s.slice(0,-1);new Set(["steps","jobs","stages"]).has(t)||(e.insideNestedMapping=!0,e.nestedMappingIndent=n)}}function updateSectionStackForSpacing(e){const{line:t,indent:n,trimmed:s,sectionStack:r,effectivelyInMultiLineBlock:i}=e;if(i||isBlank(t))return;const o=new Set(["steps","jobs","stages"]);if(!isListItem(t)&&!isComment(t))for(;r.length&&r[r.length-1].indent>=n&&!r[r.length-1].implicit;)r.pop();if(!isListItem(t)&&!isComment(t)&&isMappingKey(t)){const e=s.slice(0,-1);o.has(e)&&r.push({name:e,indent:n})}}function isInsideMainListSectionForSpacing(e){const{sectionStack:t}=e,n=new Set(["steps","jobs","stages"]);for(let e=t.length-1;e>=0;e--)if(n.has(t[e].name))return!0;return!1}function checkAndAddImplicitSectionForSpacing(e){const{sectionStack:t,currentLineIdx:n,lines:s,trimmed:r,indent:i,currentSection:o}=e;if(function isRootLevelAndNotInVariablesOrParameters(e,t,n){return!isInsideMainListSectionForSpacing(e)&&0===t&&"variables"!==n&&"parameters"!==n}(e,i,o)){let e=!1;if(containsTemplateExpression(r))e=!0;else for(let t=n+1;t<Math.min(n+10,s.length);t++)if(!isBlank(s[t])){const n=s[t].trim();getIndent(s[t])>i&&n.match(/^-\s+(stage|job|task):/)&&(e=!0);break}if(e){if(!t.some(e=>e.implicit))return t.push({name:"stages",indent:-1,implicit:!0}),!0}}return!1}function processListItemSpacingForSpacing(e){const{insideNestedMapping:t,insideVariablesOrParameters:n}=e;if(function handleBlanksBetweenParentAndChildForSpacing(e){const{lines:t,currentLineIdx:n,listItemIndent:s,removePositions:r}=e;let i=-1,o=[];for(let e=n+1;e<t.length;e++){if(!isBlank(t[e])){i=e;break}o.push(e)}if(o.length>0&&i>0){const e=t[i];if(getIndent(e)>s&&!isComment(e))for(const e of o)r.push(e)}}(e),t||n)return;let s=isInsideMainListSectionForSpacing(e);if(!s){s=checkAndAddImplicitSectionForSpacing(e)||isInsideMainListSectionForSpacing(e)}if(!s)return;!function processCommentsBeforeItemForSpacing(e){const{lines:t,currentLineIdx:n,removePositions:s}=e;for(let e=n-1;e>=0;e--){const r=t[e];if(isBlank(r))continue;if(!isComment(r))break;let i=!1,o=-1;for(let n=e-1;n>=0;n--){if(!isBlank(t[n])){if(isListItem(t[n])){i=!0;break}break}-1===o&&(o=n)}for(let r=e+1;r<n;r++)isBlank(t[r])&&(i&&r===o||s.push(r));break}}(e);const r=function findNextSiblingListItemForSpacing(e){const{lines:t,currentLineIdx:n,listItemIndent:s}=e;for(let e=n+1;e<t.length;e++){if(isBlank(t[e]))continue;if(isComment(t[e]))continue;const n=getIndent(t[e]),r=isListItem(t[e]);if(r&&n===s)return e;if(r&&n<s)break;if(n<=s&&!r)break}return null}(e);null!==r&&function processSiblingSpacingForSpacing(e,t){const{lines:n,currentLineIdx:s,listItemIndent:r,removePositions:i,insertPositions:o}=e;if(getIndent(n[t])!==r)return;let a=!1,l=!1;for(let e=t-1;e>=0;e--){const r=n[e];if(!isBlank(r)){if(isComment(r)){l=!0;let r=!1,o=-1;for(let t=e-1;t>=s;t--){if(!isBlank(n[t])){if(isListItem(n[t])){r=!0;break}break}-1===o&&(o=t)}for(let s=e+1;s<t;s++)isBlank(n[s])&&(r&&s===o||i.push(s));break}break}a=!0}a||l||o.push(t)}(e,r)}function insertStepSpacing(e){const t={lines:e,insertPositions:[],removePositions:[],sectionStack:[],inMultiLineBlock:!1,multiLineBlockIndent:-1,insideNestedMapping:!1,nestedMappingIndent:-1,currentSection:null,insideVariablesOrParameters:!1,variablesOrParametersIndent:-1,currentLineIdx:0,listItemIndent:0,line:"",indent:0,trimmed:"",effectivelyInMultiLineBlock:!1};for(let n=0;n<e.length;n++){t.currentLineIdx=n,t.line=e[n],t.indent=getIndent(t.line),t.trimmed=t.line.trim();const s=t.inMultiLineBlock;updateMultiLineBlockStateForSpacing(t),t.effectivelyInMultiLineBlock=s&&t.inMultiLineBlock,updateSectionContextForSpacing(t),updateNestedMappingContextForSpacing(t),updateSectionStackForSpacing(t),!t.effectivelyInMultiLineBlock&&isListItem(t.line)&&(t.listItemIndent=t.indent,processListItemSpacingForSpacing(t))}return function applyBlankLineAdjustmentsForSpacing(e,t,n){let s=[...e];for(const e of Array.from(new Set(t)).sort((e,t)=>t-e))s.splice(e,1);const r=n.map(e=>{let n=e;for(const s of t)s<e&&n--;return n});for(const e of Array.from(new Set(r)).sort((e,t)=>t-e))s.splice(e,0,"");return s}(e,t.removePositions,t.insertPositions)}function updateMultiLineBlockState(e){const{lines:t,lineNum:n,lineIndent:s}=e,r=t[n],i=r.trim(),o=startsMultiLineScalarBlock(r);return o?(e.inMultiLineBlock=!0,e.multiLineBlockIndent=s):e.inMultiLineBlock&&s<=e.multiLineBlockIndent&&""!==i&&(e.inMultiLineBlock=!1,e.multiLineBlockIndent=-1),o}function updateVariablesSection(e){const{lines:t,lineNum:n,lineIndent:s}=e,r=t[n],i=r.trim();"variables:"!==i||containsTemplateExpression(r)?e.variablesIndent>=0&&isNonCommentContent(i)&&(s<e.variablesIndent||s===e.variablesIndent&&isMappingKey(i)&&"variables:"!==i)&&(e.variablesIndent=-1):e.variablesIndent=s}function applyPipelineFormatting(e,t,n){if(!e)return e;const s=e.split(t),r=function initializeFormattingState(e,t){let n=!1,s=-1;for(let t=0;t<e.length;t++){const r=e[t].trim();if(isNonCommentContent(r)){s=t,n="parameters:"===r;break}}return{options:t,lines:e,spacedSections:["steps"],listItemSections:["stages","jobs"],topLevelSections:["stages:","jobs:","steps:","trigger:","pr:","resources:","pool:","variables:","name:"],hasParametersAtStart:n,firstNonEmptyLine:s,pass1:[],currentSection:null,prevWasComment:!1,lastStepInStepsSection:-1,variablesIndent:-1,inMultiLineBlock:!1,multiLineBlockIndent:-1,foundFirstSection:!1,foundFirstMainSection:!1,parametersEnded:!1,lastRootSectionIndex:-1,lineNum:-1,lineIndent:0,startsMultiLineBlock:!1}}(s,n);for(let e=0;e<s.length;e++){const t=s[e],i=t.trim(),o=getIndent(t);if(r.lineNum=e,r.lineIndent=o,0===o&&isNonCommentContent(i)&&isMappingKey(i)&&!isListItem(t)&&(r.currentSection=i.slice(0,-1)),isBlank(t)){const e=handleBlankLine(r);if(e.continue){r.prevWasComment=e.prevWasComment;continue}}const a=updateMultiLineBlockState(r);if(r.startsMultiLineBlock=a,updateVariablesSection(r),n.stepSpacing&&!n.wasExpanded){handleStepSpacing(r).isPipelineItem?r.lastStepInStepsSection=r.lineNum:isMainSectionKey(i)&&!containsTemplateExpression(t)&&(r.lastStepInStepsSection=-1)}const l=handleSectionSpacing(r);r.parametersEnded=l.parametersEnded,r.foundFirstSection=l.foundFirstSection,r.foundFirstMainSection=l.foundFirstMainSection,r.lastRootSectionIndex=l.lastRootSectionIndex;if(("jobs:"===i||"steps:"===i)&&o>0&&!l.section2HandledThisLine&&!n.wasExpanded&&(0!==r.pass1.length&&isBlank(r.pass1[r.pass1.length-1])||r.pass1.push("")),isComment(t))handleCommentLine(r),r.prevWasComment=!0;else if(r.pass1.push(t),r.prevWasComment=!1,isMappingKey(i))for(;e+1<s.length&&isBlank(s[e+1]);)e++}const i=function compactBlankLines(e,t){const n=[],s=[],r=new Set(["steps","jobs","stages"]),i=new Set(["dependsOn","parameters","variables"]);for(let t=0;t<e.length;t++){const o=e[t],a=getIndent(o);if(!isListItem(o)&&!isBlank(o)&&!isComment(o))for(;s.length&&s[s.length-1].indent>=a;)s.pop();if(!isListItem(o)&&isMappingKey(o)){const e=o.trim().slice(0,-1);(0===a||i.has(e))&&s.push({name:e,indent:a})}if(isBlank(o)){const n=findPreviousNonBlankLine(e,t-1),i=findNextNonBlankLine(e,t+1);if(null!==n&&null!==i){const t=e[n],o=e[i];if(isMappingKey(t))continue;const a=isListItem(t),l=isListItem(o),c=s.length?s[s.length-1].name:null,p=c&&r.has(c);let u=a;if(l&&!p&&!a){const t=getIndent(o);for(let s=n-1;s>=0;s--)if(!isBlank(e[s])){if(isListItem(e[s])){u=!0;break}if(getIndent(e[s])<=t&&isMappingKey(e[s])&&!isListItem(e[s]))break}}if(u&&l&&!p)continue}}n.push(o)}return n}(r.pass1);return(n?.stepSpacing&&!n?.wasExpanded?insertStepSpacing(i):i).join(t)}e.exports={formatYaml:function formatYaml(e,t={}){const n={text:e,warning:void 0,error:void 0};if(!e)return n;if(parseFormatDirectives(e).disabled)return n;if(/\n---\n/.test(e)){const n=e.split(/\n---\n/),s=[],r=[],i=[];for(let e=0;e<n.length;e++){const o=n[e],a=o.trim();if(!a)continue;if(a.split("\n").every(e=>{const t=e.trim();return!t||t.startsWith("#")})){s.push(o);continue}const l=formatYaml(o,t);l.error?i.push(`Document ${e+1}: ${l.error}`):(l.warning&&r.push(`Document ${e+1}: ${l.warning}`),s.push(l.text.trim()))}return 0===s.length?{text:e,warning:r.length>0?r.join("\n"):void 0,error:i.length>0?i.join("\n"):"All documents failed to format"}:{text:s.join("\n\n---\n"),warning:r.length>0?r.join("\n"):void 0,error:i.length>0?i.join("\n"):void 0}}const r=analyzeTemplateHints(e),i=r.length?`\n  ${r.join("\n  ")}`:"";if(r.length>0&&!t.expandTemplates){if(r.some(e=>e.includes("Missing closing")||e.includes("Unbalanced parentheses")||e.includes("Unbalanced brackets")||e.includes("Unbalanced braces")||e.includes("Unclosed string")))throw new Error(`Template validation failed:${i}`)}const o=parseFormatDirectives(e);o.options&&(t={...t,...o.options});const a={noArrayIndent:getBooleanOption(t,"noArrayIndent",!0),indent:getIndentOption(t),lineWidth:getLineWidth(t),forceQuotes:getBooleanOption(t,"forceQuotes",!1),sortKeys:getBooleanOption(t,"sortKeys",!1),expandTemplates:getBooleanOption(t,"expandTemplates",!1),newlineFormat:getNewlineFormat(t),fileName:t&&t.fileName?t.fileName:void 0,stepSpacing:getBooleanOption(t,"stepSpacing",!0),firstBlockBlankLines:getClampedIntegerOption(t,"firstBlockBlankLines",4,2),betweenSectionBlankLines:getBetweenSectionBlankLines(t),sectionSpacing:getBooleanOption(t,"sectionSpacing",!1),wasExpanded:getBooleanOption(t,"wasExpanded",!1),azureCompatible:getBooleanOption(t,"azureCompatible",!1),suppressConsoleOutput:getBooleanOption(t,"suppressConsoleOutput",!1)};try{let t=e;const{content:n,placeholderMap:r,conditionalDirectives:o}=a.expandTemplates?{content:t,placeholderMap:new Map,conditionalDirectives:new Set}:replaceTemplateExpressionsWithPlaceholders(t),{content:l,commentMap:c}=function protectEmptyValues(e){if(!e)return e;const t=e.split(/\r?\n/),n=[],s=new Map;let r=0;const i=/^(\s*)([^:]+):\s*$/;for(let e=0;e<t.length;e++){const o=t[e];if(isComment(o)||isListItem(o)){n.push(o);continue}const a=o.match(i);if(!a){n.push(o);continue}const l=a[1],c=a[2];let p=e+1,u=!1;for(;p<t.length;){const e=t[p],n=getIndent(e);if(!isBlankOrCommentLine(e)){u=isListItem(t[p])&&n>=l.length||n>l.length;break}p++}if(!u){const i=[];let o=e+1;for(;o<t.length;){const e=t[o];if(isBlank(e))i.push(e),o++;else{if(!isComment(e))break;if(!(getIndent(e)>=l.length))break;i.push(e),o++}}if(i.length>0){const t=`__COMMENT_${r}__`;s.set(t,i),r++,n.push(`${l}${c}: __EMPTY_VALUE_PLACEHOLDER__${t}`),e=o-1}else n.push(`${l}${c}: __EMPTY_VALUE_PLACEHOLDER__`);continue}n.push(o)}return{content:n.join("\n"),commentMap:s}}(n),p=analyzeTemplateHints(l,o);if(p.length>0){const t=`\n  ${p.join("\n  ")}`,n=a.fileName?`[${a.fileName}] `:"",s=`YAML validation warnings:${t}`.split("\n").map((e,t)=>0===t?e:"  "+e).join("\n");return a.suppressConsoleOutput||console.error(`${n}${s}`),{text:e,warning:t,error:void 0}}const u=s.parseDocument(l,{strict:!1,uniqueKeys:!0});if(u.errors&&u.errors.length>0){const t=u.errors.filter(e=>!e.message||!e.message.includes("Invalid escape sequence")).filter(e=>!isDuplicateKeyForTemplateExpression(e));if(t.length>0){const n=t.map(t=>function enrichDuplicateKeyError(e,t,n=""){if(!e||!e.message)return e.message||"";const s=e.message.toLowerCase();if(!s.includes("map keys must be unique")&&!s.includes("duplicated mapping key"))return e.message;const r=e.message.match(/at line (\d+), column (\d+):/);if(!r||!t)return e.message;const i=parseInt(r[1],10)-1,o=parseInt(r[2],10)-1,a=findFirstKeyOccurrence(t,i,o),l=(t.split("\n")[i]||"").slice(o).match(/^(\s*)([^:\s]+)\s*:/),c=l?l[2]:"key";if(a){const e=n?`${n}:`:"";return`Duplicate key '${c}' detected\n  First defined at: ${e}${a.line+1}:${a.column+1}\n  Duplicate found at: ${e}${i+1}:${o+1}`}return e.message}(t,e,a.fileName||"")),s=n.join("\n\n"),r=a.fileName?`[${a.fileName}] `:"",o=`YAML parsing error: ${s}`.split("\n").map((e,t)=>0===t?e:"  "+e).join("\n");a.suppressConsoleOutput||console.error(`${r}${o}`);const l=i,c=s.includes("\n");return{text:e,warning:i||void 0,error:!c&&s.length>100?s.substring(0,100)+"..."+l:`${s}${l}`}}}u.errors=[],u.warnings=[];let f=u.toString({indent:a.indent,indentSeq:!a.noArrayIndent,lineWidth:-1,doubleQuotedAsJSON:!0,doubleQuotedMinMultiLineLength:1/0,singleQuote:null,blockQuote:!0,defaultStringType:"PLAIN",aliasDuplicateObjects:!1});f=restoreTemplateExpressions(f,r),f=function restoreEmptyValues(e,t){if(!e)return e;if(!t||0===t.size)return e.replace(/:\s*__EMPTY_VALUE_PLACEHOLDER__\s*$/gm,":");const n=e.split(/\r?\n/),s=[];for(const e of n){const n=e.match(/^(\s*)([^:]+):\s*__EMPTY_VALUE_PLACEHOLDER__(__COMMENT_\d+__)\s*$/);if(n){const[,e,r,i]=n,o=t.get(i);s.push(`${e}${r}:`),o?.length&&o.forEach(e=>s.push(e))}else e.match(/:\s*__EMPTY_VALUE_PLACEHOLDER__\s*$/)?s.push(e.replace(/:\s*__EMPTY_VALUE_PLACEHOLDER__\s*$/,":")):s.push(e)}return s.join("\n")}(f,c);const d=a.newlineFormat;let h=f.replace(/\r?\n/g,d);return h=applyPipelineFormatting(h,d,a),h=h.split(d).map(e=>e.replace(/[ \t]+$/,"")).join(d),h=a.wasExpanded&&a.azureCompatible?h.replace(new RegExp(`(?:${escapeRegExp(d)})*$`),`${d}${d}${d}`):h.replace(new RegExp(`(?:${escapeRegExp(d)})*$`),d),{text:h,warning:i||void 0,error:void 0}}catch(t){const n=function describeYamlSyntaxError(e,t,n=""){if(!e||"object"!=typeof e)return;if("YAMLException"!==e.name&&"YAMLError"!==e.name&&e.name&&"string"==typeof e.name&&!e.name.includes("YAML"))return;const s=("string"==typeof e.reason&&e.reason.trim().length?e.reason.trim():void 0)||("string"==typeof e.message?e.message.trim():void 0);if(isDuplicateKeyForTemplateExpression(e))return;const r=e.mark&&"object"==typeof e.mark?e.mark:void 0,i=r&&Number.isInteger(r.line),o=r&&Number.isInteger(r.column),a=i?`line ${r.line+1}`:void 0,l=o?`column ${r.column+1}`:void 0,c=a&&l?`${a}, ${l}`:a||l,p=analyzeTemplateHints(t);if((s||"").toLowerCase().includes("duplicated mapping key")&&i&&o&&t){const e=findFirstKeyOccurrence(t,r.line,r.column),s=(t.split("\n")[r.line]||"").slice(r.column).match(/^(\s*)([^:\s]+)\s*:/),i=s?s[2]:"key";if(e){const t=n?`${n}:`:"",s=`${t}${e.line+1}:${e.column+1}`,o=`${t}${r.line+1}:${r.column+1}`;p.unshift(`Duplicate key '${i}' detected.`,`  First defined at: ${s}`,`  Duplicate found at: ${o}`)}}const u=(s||"").toLowerCase();let f;return s&&(u.includes("implicit map key")||u.includes("mapping values are not allowed")?p.unshift("Likely missing a ':' after an Azure expression used as a key (e.g., '- ${{ if ... }}:')."):(u.includes("bad indentation")||u.includes("incomplete explicit mapping"))&&p.unshift("Check indentation for list items and make sure expression lines start with '-'.")),c&&s?f=`YAML syntax error at ${c}: ${s}`:s?f=`YAML syntax error: ${s}`:c&&(f=`YAML syntax error at ${c}.`),f&&p.length&&(f+=`\n  ${p.join("\n")}`),f}(t,e,a.fileName||""),s=a.fileName?`[${a.fileName}] `:"";if(n){const t=n.split("\n").map((e,t)=>0===t?e:"  "+e).join("\n");return a.suppressConsoleOutput||console.error(`${s}${t}`),{text:e,warning:i||void 0,error:n}}const r=`YAML formatting failed: ${t.message}`.split("\n").map((e,t)=>0===t?e:"  "+e).join("\n");return a.suppressConsoleOutput||console.error(`${s}${r}`),{text:e,warning:i||void 0,error:`YAML formatting failed: ${t.message}`}}},escapeRegExp,replaceTemplateExpressionsWithPlaceholders,restoreTemplateExpressions,analyzeTemplateHints,parseFormatDirectives}},132(e){"use strict";class Jsep{static get version(){return"1.4.0"}static toString(){return"JavaScript Expression Parser (JSEP) v"+Jsep.version}static addUnaryOp(e){return Jsep.max_unop_len=Math.max(e.length,Jsep.max_unop_len),Jsep.unary_ops[e]=1,Jsep}static addBinaryOp(e,t,n){return Jsep.max_binop_len=Math.max(e.length,Jsep.max_binop_len),Jsep.binary_ops[e]=t,n?Jsep.right_associative.add(e):Jsep.right_associative.delete(e),Jsep}static addIdentifierChar(e){return Jsep.additional_identifier_chars.add(e),Jsep}static addLiteral(e,t){return Jsep.literals[e]=t,Jsep}static removeUnaryOp(e){return delete Jsep.unary_ops[e],e.length===Jsep.max_unop_len&&(Jsep.max_unop_len=Jsep.getMaxKeyLen(Jsep.unary_ops)),Jsep}static removeAllUnaryOps(){return Jsep.unary_ops={},Jsep.max_unop_len=0,Jsep}static removeIdentifierChar(e){return Jsep.additional_identifier_chars.delete(e),Jsep}static removeBinaryOp(e){return delete Jsep.binary_ops[e],e.length===Jsep.max_binop_len&&(Jsep.max_binop_len=Jsep.getMaxKeyLen(Jsep.binary_ops)),Jsep.right_associative.delete(e),Jsep}static removeAllBinaryOps(){return Jsep.binary_ops={},Jsep.max_binop_len=0,Jsep}static removeLiteral(e){return delete Jsep.literals[e],Jsep}static removeAllLiterals(){return Jsep.literals={},Jsep}get char(){return this.expr.charAt(this.index)}get code(){return this.expr.charCodeAt(this.index)}constructor(e){this.expr=e,this.index=0}static parse(e){return new Jsep(e).parse()}static getMaxKeyLen(e){return Math.max(0,...Object.keys(e).map(e=>e.length))}static isDecimalDigit(e){return e>=48&&e<=57}static binaryPrecedence(e){return Jsep.binary_ops[e]||0}static isIdentifierStart(e){return e>=65&&e<=90||e>=97&&e<=122||e>=128&&!Jsep.binary_ops[String.fromCharCode(e)]||Jsep.additional_identifier_chars.has(String.fromCharCode(e))}static isIdentifierPart(e){return Jsep.isIdentifierStart(e)||Jsep.isDecimalDigit(e)}throwError(e){const t=new Error(e+" at character "+this.index);throw t.index=this.index,t.description=e,t}runHook(e,t){if(Jsep.hooks[e]){const n={context:this,node:t};return Jsep.hooks.run(e,n),n.node}return t}searchHook(e){if(Jsep.hooks[e]){const t={context:this};return Jsep.hooks[e].find(function(e){return e.call(t.context,t),t.node}),t.node}}gobbleSpaces(){let e=this.code;for(;e===Jsep.SPACE_CODE||e===Jsep.TAB_CODE||e===Jsep.LF_CODE||e===Jsep.CR_CODE;)e=this.expr.charCodeAt(++this.index);this.runHook("gobble-spaces")}parse(){this.runHook("before-all");const e=this.gobbleExpressions(),t=1===e.length?e[0]:{type:Jsep.COMPOUND,body:e};return this.runHook("after-all",t)}gobbleExpressions(e){let t,n,s=[];for(;this.index<this.expr.length;)if(t=this.code,t===Jsep.SEMCOL_CODE||t===Jsep.COMMA_CODE)this.index++;else if(n=this.gobbleExpression())s.push(n);else if(this.index<this.expr.length){if(t===e)break;this.throwError('Unexpected "'+this.char+'"')}return s}gobbleExpression(){const e=this.searchHook("gobble-expression")||this.gobbleBinaryExpression();return this.gobbleSpaces(),this.runHook("after-expression",e)}gobbleBinaryOp(){this.gobbleSpaces();let e=this.expr.substr(this.index,Jsep.max_binop_len),t=e.length;for(;t>0;){if(Jsep.binary_ops.hasOwnProperty(e)&&(!Jsep.isIdentifierStart(this.code)||this.index+e.length<this.expr.length&&!Jsep.isIdentifierPart(this.expr.charCodeAt(this.index+e.length))))return this.index+=t,e;e=e.substr(0,--t)}return!1}gobbleBinaryExpression(){let e,t,n,s,r,i,o,a,l;if(i=this.gobbleToken(),!i)return i;if(t=this.gobbleBinaryOp(),!t)return i;for(r={value:t,prec:Jsep.binaryPrecedence(t),right_a:Jsep.right_associative.has(t)},o=this.gobbleToken(),o||this.throwError("Expected expression after "+t),s=[i,r,o];t=this.gobbleBinaryOp();){if(n=Jsep.binaryPrecedence(t),0===n){this.index-=t.length;break}r={value:t,prec:n,right_a:Jsep.right_associative.has(t)},l=t;const comparePrev=e=>r.right_a&&e.right_a?n>e.prec:n<=e.prec;for(;s.length>2&&comparePrev(s[s.length-2]);)o=s.pop(),t=s.pop().value,i=s.pop(),e={type:Jsep.BINARY_EXP,operator:t,left:i,right:o},s.push(e);e=this.gobbleToken(),e||this.throwError("Expected expression after "+l),s.push(r,e)}for(a=s.length-1,e=s[a];a>1;)e={type:Jsep.BINARY_EXP,operator:s[a-1].value,left:s[a-2],right:e},a-=2;return e}gobbleToken(){let e,t,n,s;if(this.gobbleSpaces(),s=this.searchHook("gobble-token"),s)return this.runHook("after-token",s);if(e=this.code,Jsep.isDecimalDigit(e)||e===Jsep.PERIOD_CODE)return this.gobbleNumericLiteral();if(e===Jsep.SQUOTE_CODE||e===Jsep.DQUOTE_CODE)s=this.gobbleStringLiteral();else if(e===Jsep.OBRACK_CODE)s=this.gobbleArray();else{for(t=this.expr.substr(this.index,Jsep.max_unop_len),n=t.length;n>0;){if(Jsep.unary_ops.hasOwnProperty(t)&&(!Jsep.isIdentifierStart(this.code)||this.index+t.length<this.expr.length&&!Jsep.isIdentifierPart(this.expr.charCodeAt(this.index+t.length)))){this.index+=n;const e=this.gobbleToken();return e||this.throwError("missing unaryOp argument"),this.runHook("after-token",{type:Jsep.UNARY_EXP,operator:t,argument:e,prefix:!0})}t=t.substr(0,--n)}Jsep.isIdentifierStart(e)?(s=this.gobbleIdentifier(),Jsep.literals.hasOwnProperty(s.name)?s={type:Jsep.LITERAL,value:Jsep.literals[s.name],raw:s.name}:s.name===Jsep.this_str&&(s={type:Jsep.THIS_EXP})):e===Jsep.OPAREN_CODE&&(s=this.gobbleGroup())}return s?(s=this.gobbleTokenProperty(s),this.runHook("after-token",s)):this.runHook("after-token",!1)}gobbleTokenProperty(e){this.gobbleSpaces();let t=this.code;for(;t===Jsep.PERIOD_CODE||t===Jsep.OBRACK_CODE||t===Jsep.OPAREN_CODE||t===Jsep.QUMARK_CODE;){let n;if(t===Jsep.QUMARK_CODE){if(this.expr.charCodeAt(this.index+1)!==Jsep.PERIOD_CODE)break;n=!0,this.index+=2,this.gobbleSpaces(),t=this.code}this.index++,t===Jsep.OBRACK_CODE?((e={type:Jsep.MEMBER_EXP,computed:!0,object:e,property:this.gobbleExpression()}).property||this.throwError('Unexpected "'+this.char+'"'),this.gobbleSpaces(),t=this.code,t!==Jsep.CBRACK_CODE&&this.throwError("Unclosed ["),this.index++):t===Jsep.OPAREN_CODE?e={type:Jsep.CALL_EXP,arguments:this.gobbleArguments(Jsep.CPAREN_CODE),callee:e}:(t===Jsep.PERIOD_CODE||n)&&(n&&this.index--,this.gobbleSpaces(),e={type:Jsep.MEMBER_EXP,computed:!1,object:e,property:this.gobbleIdentifier()}),n&&(e.optional=!0),this.gobbleSpaces(),t=this.code}return e}gobbleNumericLiteral(){let e,t,n="";for(;Jsep.isDecimalDigit(this.code);)n+=this.expr.charAt(this.index++);if(this.code===Jsep.PERIOD_CODE)for(n+=this.expr.charAt(this.index++);Jsep.isDecimalDigit(this.code);)n+=this.expr.charAt(this.index++);if(e=this.char,"e"===e||"E"===e){for(n+=this.expr.charAt(this.index++),e=this.char,"+"!==e&&"-"!==e||(n+=this.expr.charAt(this.index++));Jsep.isDecimalDigit(this.code);)n+=this.expr.charAt(this.index++);Jsep.isDecimalDigit(this.expr.charCodeAt(this.index-1))||this.throwError("Expected exponent ("+n+this.char+")")}return t=this.code,Jsep.isIdentifierStart(t)?this.throwError("Variable names cannot start with a number ("+n+this.char+")"):(t===Jsep.PERIOD_CODE||1===n.length&&n.charCodeAt(0)===Jsep.PERIOD_CODE)&&this.throwError("Unexpected period"),{type:Jsep.LITERAL,value:parseFloat(n),raw:n}}gobbleStringLiteral(){let e="";const t=this.index,n=this.expr.charAt(this.index++);let s=!1;for(;this.index<this.expr.length;){let t=this.expr.charAt(this.index++);if(t===n){s=!0;break}if("\\"===t)switch(t=this.expr.charAt(this.index++),t){case"n":e+="\n";break;case"r":e+="\r";break;case"t":e+="\t";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:e+=t}else e+=t}return s||this.throwError('Unclosed quote after "'+e+'"'),{type:Jsep.LITERAL,value:e,raw:this.expr.substring(t,this.index)}}gobbleIdentifier(){let e=this.code,t=this.index;for(Jsep.isIdentifierStart(e)?this.index++:this.throwError("Unexpected "+this.char);this.index<this.expr.length&&(e=this.code,Jsep.isIdentifierPart(e));)this.index++;return{type:Jsep.IDENTIFIER,name:this.expr.slice(t,this.index)}}gobbleArguments(e){const t=[];let n=!1,s=0;for(;this.index<this.expr.length;){this.gobbleSpaces();let r=this.code;if(r===e){n=!0,this.index++,e===Jsep.CPAREN_CODE&&s&&s>=t.length&&this.throwError("Unexpected token "+String.fromCharCode(e));break}if(r===Jsep.COMMA_CODE){if(this.index++,s++,s!==t.length)if(e===Jsep.CPAREN_CODE)this.throwError("Unexpected token ,");else if(e===Jsep.CBRACK_CODE)for(let e=t.length;e<s;e++)t.push(null)}else if(t.length!==s&&0!==s)this.throwError("Expected comma");else{const e=this.gobbleExpression();e&&e.type!==Jsep.COMPOUND||this.throwError("Expected comma"),t.push(e)}}return n||this.throwError("Expected "+String.fromCharCode(e)),t}gobbleGroup(){this.index++;let e=this.gobbleExpressions(Jsep.CPAREN_CODE);if(this.code===Jsep.CPAREN_CODE)return this.index++,1===e.length?e[0]:!!e.length&&{type:Jsep.SEQUENCE_EXP,expressions:e};this.throwError("Unclosed (")}gobbleArray(){return this.index++,{type:Jsep.ARRAY_EXP,elements:this.gobbleArguments(Jsep.CBRACK_CODE)}}}const t=new class Hooks{add(e,t,n){if("string"!=typeof arguments[0])for(let e in arguments[0])this.add(e,arguments[0][e],arguments[1]);else(Array.isArray(e)?e:[e]).forEach(function(e){this[e]=this[e]||[],t&&this[e][n?"unshift":"push"](t)},this)}run(e,t){this[e]=this[e]||[],this[e].forEach(function(e){e.call(t&&t.context?t.context:t,t)})}};Object.assign(Jsep,{hooks:t,plugins:new class Plugins{constructor(e){this.jsep=e,this.registered={}}register(...e){e.forEach(e=>{if("object"!=typeof e||!e.name||!e.init)throw new Error("Invalid JSEP plugin format");this.registered[e.name]||(e.init(this.jsep),this.registered[e.name]=e)})}}(Jsep),COMPOUND:"Compound",SEQUENCE_EXP:"SequenceExpression",IDENTIFIER:"Identifier",MEMBER_EXP:"MemberExpression",LITERAL:"Literal",THIS_EXP:"ThisExpression",CALL_EXP:"CallExpression",UNARY_EXP:"UnaryExpression",BINARY_EXP:"BinaryExpression",ARRAY_EXP:"ArrayExpression",TAB_CODE:9,LF_CODE:10,CR_CODE:13,SPACE_CODE:32,PERIOD_CODE:46,COMMA_CODE:44,SQUOTE_CODE:39,DQUOTE_CODE:34,OPAREN_CODE:40,CPAREN_CODE:41,OBRACK_CODE:91,CBRACK_CODE:93,QUMARK_CODE:63,SEMCOL_CODE:59,COLON_CODE:58,unary_ops:{"-":1,"!":1,"~":1,"+":1},binary_ops:{"||":1,"??":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10,"**":11},right_associative:new Set(["**"]),additional_identifier_chars:new Set(["$","_"]),literals:{true:!0,false:!1,null:null},this_str:"this"}),Jsep.max_unop_len=Jsep.getMaxKeyLen(Jsep.unary_ops),Jsep.max_binop_len=Jsep.getMaxKeyLen(Jsep.binary_ops);const jsep=e=>new Jsep(e).parse(),n=Object.getOwnPropertyNames(class Test{});Object.getOwnPropertyNames(Jsep).filter(e=>!n.includes(e)&&void 0===jsep[e]).forEach(e=>{jsep[e]=Jsep[e]}),jsep.Jsep=Jsep;var s={name:"ternary",init(e){e.hooks.add("after-expression",function gobbleTernary(t){if(t.node&&this.code===e.QUMARK_CODE){this.index++;const n=t.node,s=this.gobbleExpression();if(s||this.throwError("Expected expression"),this.gobbleSpaces(),this.code===e.COLON_CODE){this.index++;const r=this.gobbleExpression();if(r||this.throwError("Expected expression"),t.node={type:"ConditionalExpression",test:n,consequent:s,alternate:r},n.operator&&e.binary_ops[n.operator]<=.9){let s=n;for(;s.right.operator&&e.binary_ops[s.right.operator]<=.9;)s=s.right;t.node.test=s.right,s.right=t.node,t.node=n}}else this.throwError("Expected :")}})}};jsep.plugins.register(s),e.exports=jsep},18(e,t,n){"use strict";var s=n(484),r=n(9714),i=n(1755),o=n(6010),a=n(7434),l=n(483),c=n(2291);function resolveCollection(e,t,n,s,r,i){const o="block-map"===n.type?a.resolveBlockMap(e,t,n,s,i):"block-seq"===n.type?l.resolveBlockSeq(e,t,n,s,i):c.resolveFlowCollection(e,t,n,s,i),p=o.constructor;return"!"===r||r===p.tagName?(o.tag=p.tagName,o):(r&&(o.tag=r),o)}t.composeCollection=function composeCollection(e,t,n,a,l){const c=a.tag,p=c?t.directives.tagName(c.source,e=>l(c,"TAG_RESOLVE_FAILED",e)):null;if("block-seq"===n.type){const{anchor:e,newlineAfterProp:t}=a,n=e&&c?e.offset>c.offset?e:c:e??c;if(n&&(!t||t.offset<n.offset)){l(n,"MISSING_CHAR","Missing newline after block sequence props")}}const u="block-map"===n.type?"map":"block-seq"===n.type?"seq":"{"===n.start.source?"map":"seq";if(!c||!p||"!"===p||p===i.YAMLMap.tagName&&"map"===u||p===o.YAMLSeq.tagName&&"seq"===u)return resolveCollection(e,t,n,l,p);let f=t.schema.tags.find(e=>e.tag===p&&e.collection===u);if(!f){const s=t.schema.knownTags[p];if(s?.collection!==u)return s?l(c,"BAD_COLLECTION_TYPE",`${s.tag} used for ${u} collection, but expects ${s.collection??"scalar"}`,!0):l(c,"TAG_RESOLVE_FAILED",`Unresolved tag: ${p}`,!0),resolveCollection(e,t,n,l,p);t.schema.tags.push(Object.assign({},s,{default:!1})),f=s}const d=resolveCollection(e,t,n,l,p,f),h=f.resolve?.(d,e=>l(c,"TAG_RESOLVE_FAILED",e),t.options)??d,m=s.isNode(h)?h:new r.Scalar(h);return m.range=d.range,m.tag=p,f?.format&&(m.format=f.format),m}},2206(e,t,n){"use strict";var s=n(9046),r=n(2782),i=n(6845),o=n(1386);t.composeDoc=function composeDoc(e,t,{offset:n,start:a,value:l,end:c},p){const u=Object.assign({_directives:t},e),f=new s.Document(void 0,u),d={atKey:!1,atRoot:!0,directives:f.directives,options:f.options,schema:f.schema},h=o.resolveProps(a,{indicator:"doc-start",next:l??c?.[0],offset:n,onError:p,parentIndent:0,startOnNewline:!0});h.found&&(f.directives.docStart=!0,!l||"block-map"!==l.type&&"block-seq"!==l.type||h.hasNewline||p(h.end,"MISSING_CHAR","Block collection cannot start on same line with directives-end marker")),f.contents=l?r.composeNode(d,l,h,p):r.composeEmptyNode(d,h.end,a,null,h,p);const m=f.contents.range[2],g=i.resolveEnd(c,m,!1,p);return g.comment&&(f.comment=g.comment),f.range=[n,m,g.offset],f}},2782(e,t,n){"use strict";var s=n(1736),r=n(484),i=n(18),o=n(9094),a=n(6845),l=n(1040);const c={composeNode,composeEmptyNode};function composeNode(e,t,n,l){const p=e.atKey,{spaceBefore:u,comment:f,anchor:d,tag:h}=n;let m,g=!0;switch(t.type){case"alias":m=function composeAlias({options:e},{offset:t,source:n,end:r},i){const o=new s.Alias(n.substring(1));""===o.source&&i(t,"BAD_ALIAS","Alias cannot be an empty string");o.source.endsWith(":")&&i(t+n.length-1,"BAD_ALIAS","Alias ending in : is ambiguous",!0);const l=t+n.length,c=a.resolveEnd(r,l,e.strict,i);o.range=[t,l,c.offset],c.comment&&(o.comment=c.comment);return o}(e,t,l),(d||h)&&l(t,"ALIAS_PROPS","An alias node must not specify any properties");break;case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"block-scalar":m=o.composeScalar(e,t,h,l),d&&(m.anchor=d.source.substring(1));break;case"block-map":case"block-seq":case"flow-collection":m=i.composeCollection(c,e,t,n,l),d&&(m.anchor=d.source.substring(1));break;default:l(t,"UNEXPECTED_TOKEN","error"===t.type?t.message:`Unsupported token (type: ${t.type})`),m=composeEmptyNode(e,t.offset,void 0,null,n,l),g=!1}if(d&&""===m.anchor&&l(d,"BAD_ALIAS","Anchor cannot be an empty string"),p&&e.options.stringKeys&&(!r.isScalar(m)||"string"!=typeof m.value||m.tag&&"tag:yaml.org,2002:str"!==m.tag)){l(h??t,"NON_STRING_KEY","With stringKeys, all keys must be strings")}return u&&(m.spaceBefore=!0),f&&("scalar"===t.type&&""===t.source?m.comment=f:m.commentBefore=f),e.options.keepSourceTokens&&g&&(m.srcToken=t),m}function composeEmptyNode(e,t,n,s,{spaceBefore:r,comment:i,anchor:a,tag:c,end:p},u){const f={type:"scalar",offset:l.emptyScalarPosition(t,n,s),indent:-1,source:""},d=o.composeScalar(e,f,c,u);return a&&(d.anchor=a.source.substring(1),""===d.anchor&&u(a,"BAD_ALIAS","Anchor cannot be an empty string")),r&&(d.spaceBefore=!0),i&&(d.comment=i,d.range[2]=p),d}t.composeEmptyNode=composeEmptyNode,t.composeNode=composeNode},9094(e,t,n){"use strict";var s=n(484),r=n(9714),i=n(4070),o=n(7571);t.composeScalar=function composeScalar(e,t,n,a){const{value:l,type:c,comment:p,range:u}="block-scalar"===t.type?i.resolveBlockScalar(e,t,a):o.resolveFlowScalar(t,e.options.strict,a),f=n?e.directives.tagName(n.source,e=>a(n,"TAG_RESOLVE_FAILED",e)):null;let d,h;d=e.options.stringKeys&&e.atKey?e.schema[s.SCALAR]:f?function findScalarTagByName(e,t,n,r,i){if("!"===n)return e[s.SCALAR];const o=[];for(const t of e.tags)if(!t.collection&&t.tag===n){if(!t.default||!t.test)return t;o.push(t)}for(const e of o)if(e.test?.test(t))return e;const a=e.knownTags[n];if(a&&!a.collection)return e.tags.push(Object.assign({},a,{default:!1,test:void 0})),a;return i(r,"TAG_RESOLVE_FAILED",`Unresolved tag: ${n}`,"tag:yaml.org,2002:str"!==n),e[s.SCALAR]}(e.schema,l,f,n,a):"scalar"===t.type?function findScalarTagByTest({atKey:e,directives:t,schema:n},r,i,o){const a=n.tags.find(t=>(!0===t.default||e&&"key"===t.default)&&t.test?.test(r))||n[s.SCALAR];if(n.compat){const e=n.compat.find(e=>e.default&&e.test?.test(r))??n[s.SCALAR];if(a.tag!==e.tag){o(i,"TAG_RESOLVE_FAILED",`Value may be parsed as either ${t.tagString(a.tag)} or ${t.tagString(e.tag)}`,!0)}}return a}(e,l,t,a):e.schema[s.SCALAR];try{const i=d.resolve(l,e=>a(n??t,"TAG_RESOLVE_FAILED",e),e.options);h=s.isScalar(i)?i:new r.Scalar(i)}catch(e){const s=e instanceof Error?e.message:String(e);a(n??t,"TAG_RESOLVE_FAILED",s),h=new r.Scalar(l)}return h.range=u,h.source=l,c&&(h.type=c),f&&(h.tag=f),d.format&&(h.format=d.format),p&&(h.comment=p),h}},4927(e,t,n){"use strict";var s=n(932),r=n(8673),i=n(9046),o=n(4355),a=n(484),l=n(2206),c=n(6845);function getErrorPos(e){if("number"==typeof e)return[e,e+1];if(Array.isArray(e))return 2===e.length?e:[e[0],e[1]];const{offset:t,source:n}=e;return[t,t+("string"==typeof n?n.length:1)]}function parsePrelude(e){let t="",n=!1,s=!1;for(let r=0;r<e.length;++r){const i=e[r];switch(i[0]){case"#":t+=(""===t?"":s?"\n\n":"\n")+(i.substring(1)||" "),n=!0,s=!1;break;case"%":"#"!==e[r+1]?.[0]&&(r+=1),n=!1;break;default:n||(s=!0),n=!1}}return{comment:t,afterEmptyLine:s}}t.Composer=class Composer{constructor(e={}){this.doc=null,this.atDirectives=!1,this.prelude=[],this.errors=[],this.warnings=[],this.onError=(e,t,n,s)=>{const r=getErrorPos(e);s?this.warnings.push(new o.YAMLWarning(r,t,n)):this.errors.push(new o.YAMLParseError(r,t,n))},this.directives=new r.Directives({version:e.version||"1.2"}),this.options=e}decorate(e,t){const{comment:n,afterEmptyLine:s}=parsePrelude(this.prelude);if(n){const r=e.contents;if(t)e.comment=e.comment?`${e.comment}\n${n}`:n;else if(s||e.directives.docStart||!r)e.commentBefore=n;else if(a.isCollection(r)&&!r.flow&&r.items.length>0){let e=r.items[0];a.isPair(e)&&(e=e.key);const t=e.commentBefore;e.commentBefore=t?`${n}\n${t}`:n}else{const e=r.commentBefore;r.commentBefore=e?`${n}\n${e}`:n}}t?(Array.prototype.push.apply(e.errors,this.errors),Array.prototype.push.apply(e.warnings,this.warnings)):(e.errors=this.errors,e.warnings=this.warnings),this.prelude=[],this.errors=[],this.warnings=[]}streamInfo(){return{comment:parsePrelude(this.prelude).comment,directives:this.directives,errors:this.errors,warnings:this.warnings}}*compose(e,t=!1,n=-1){for(const t of e)yield*this.next(t);yield*this.end(t,n)}*next(e){switch(s.env.LOG_STREAM&&console.dir(e,{depth:null}),e.type){case"directive":this.directives.add(e.source,(t,n,s)=>{const r=getErrorPos(e);r[0]+=t,this.onError(r,"BAD_DIRECTIVE",n,s)}),this.prelude.push(e.source),this.atDirectives=!0;break;case"document":{const t=l.composeDoc(this.options,this.directives,e,this.onError);this.atDirectives&&!t.directives.docStart&&this.onError(e,"MISSING_CHAR","Missing directives-end/doc-start indicator line"),this.decorate(t,!1),this.doc&&(yield this.doc),this.doc=t,this.atDirectives=!1;break}case"byte-order-mark":case"space":break;case"comment":case"newline":this.prelude.push(e.source);break;case"error":{const t=e.source?`${e.message}: ${JSON.stringify(e.source)}`:e.message,n=new o.YAMLParseError(getErrorPos(e),"UNEXPECTED_TOKEN",t);this.atDirectives||!this.doc?this.errors.push(n):this.doc.errors.push(n);break}case"doc-end":{if(!this.doc){const t="Unexpected doc-end without preceding document";this.errors.push(new o.YAMLParseError(getErrorPos(e),"UNEXPECTED_TOKEN",t));break}this.doc.directives.docEnd=!0;const t=c.resolveEnd(e.end,e.offset+e.source.length,this.doc.options.strict,this.onError);if(this.decorate(this.doc,!0),t.comment){const e=this.doc.comment;this.doc.comment=e?`${e}\n${t.comment}`:t.comment}this.doc.range[2]=t.offset;break}default:this.errors.push(new o.YAMLParseError(getErrorPos(e),"UNEXPECTED_TOKEN",`Unsupported token ${e.type}`))}}*end(e=!1,t=-1){if(this.doc)this.decorate(this.doc,!0),yield this.doc,this.doc=null;else if(e){const e=Object.assign({_directives:this.directives},this.options),n=new i.Document(void 0,e);this.atDirectives&&this.onError(t,"MISSING_CHAR","Missing directives-end indicator line"),n.range=[0,t,t],this.decorate(n,!1),yield n}}}},7434(e,t,n){"use strict";var s=n(7902),r=n(1755),i=n(1386),o=n(9378),a=n(8644),l=n(8334);const c="All mapping items must start at the same column";t.resolveBlockMap=function resolveBlockMap({composeNode:e,composeEmptyNode:t},n,p,u,f){const d=new(f?.nodeClass??r.YAMLMap)(n.schema);n.atRoot&&(n.atRoot=!1);let h=p.offset,m=null;for(const r of p.items){const{start:f,key:g,sep:y,value:b}=r,v=i.resolveProps(f,{indicator:"explicit-key-ind",next:g??y?.[0],offset:h,onError:u,parentIndent:p.indent,startOnNewline:!0}),x=!v.found;if(x){if(g&&("block-seq"===g.type?u(h,"BLOCK_AS_IMPLICIT_KEY","A block sequence may not be used as an implicit map key"):"indent"in g&&g.indent!==p.indent&&u(h,"BAD_INDENT",c)),!v.anchor&&!v.tag&&!y){m=v.end,v.comment&&(d.comment?d.comment+="\n"+v.comment:d.comment=v.comment);continue}(v.newlineAfterProp||o.containsNewline(g))&&u(g??f[f.length-1],"MULTILINE_IMPLICIT_KEY","Implicit keys need to be on a single line")}else v.found?.indent!==p.indent&&u(h,"BAD_INDENT",c);n.atKey=!0;const S=v.end,w=g?e(n,g,v,u):t(n,S,f,null,v,u);n.schema.compat&&a.flowIndentCheck(p.indent,g,u),n.atKey=!1,l.mapIncludes(n,d.items,w)&&u(S,"DUPLICATE_KEY","Map keys must be unique");const k=i.resolveProps(y??[],{indicator:"map-value-ind",next:b,offset:w.range[2],onError:u,parentIndent:p.indent,startOnNewline:!g||"block-scalar"===g.type});if(h=k.end,k.found){x&&("block-map"!==b?.type||k.hasNewline||u(h,"BLOCK_AS_IMPLICIT_KEY","Nested mappings are not allowed in compact mappings"),n.options.strict&&v.start<k.found.offset-1024&&u(w.range,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit block mapping key"));const i=b?e(n,b,k,u):t(n,h,y,null,k,u);n.schema.compat&&a.flowIndentCheck(p.indent,b,u),h=i.range[2];const o=new s.Pair(w,i);n.options.keepSourceTokens&&(o.srcToken=r),d.items.push(o)}else{x&&u(w.range,"MISSING_CHAR","Implicit map keys need to be followed by map values"),k.comment&&(w.comment?w.comment+="\n"+k.comment:w.comment=k.comment);const e=new s.Pair(w);n.options.keepSourceTokens&&(e.srcToken=r),d.items.push(e)}}return m&&m<h&&u(m,"IMPOSSIBLE","Map comment with trailing content"),d.range=[p.offset,h,m??h],d}},4070(e,t,n){"use strict";var s=n(9714);t.resolveBlockScalar=function resolveBlockScalar(e,t,n){const r=t.offset,i=function parseBlockScalarHeader({offset:e,props:t},n,s){if("block-scalar-header"!==t[0].type)return s(t[0],"IMPOSSIBLE","Block scalar header not found"),null;const{source:r}=t[0],i=r[0];let o=0,a="",l=-1;for(let t=1;t<r.length;++t){const n=r[t];if(a||"-"!==n&&"+"!==n){const s=Number(n);!o&&s?o=s:-1===l&&(l=e+t)}else a=n}-1!==l&&s(l,"UNEXPECTED_TOKEN",`Block scalar header includes extra characters: ${r}`);let c=!1,p="",u=r.length;for(let e=1;e<t.length;++e){const r=t[e];switch(r.type){case"space":c=!0;case"newline":u+=r.source.length;break;case"comment":if(n&&!c){s(r,"MISSING_CHAR","Comments must be separated from other tokens by white space characters")}u+=r.source.length,p=r.source.substring(1);break;case"error":s(r,"UNEXPECTED_TOKEN",r.message),u+=r.source.length;break;default:{s(r,"UNEXPECTED_TOKEN",`Unexpected token in block scalar header: ${r.type}`);const e=r.source;e&&"string"==typeof e&&(u+=e.length)}}}return{mode:i,indent:o,chomp:a,comment:p,length:u}}(t,e.options.strict,n);if(!i)return{value:"",type:null,comment:"",range:[r,r,r]};const o=">"===i.mode?s.Scalar.BLOCK_FOLDED:s.Scalar.BLOCK_LITERAL,a=t.source?function splitLines(e){const t=e.split(/\n( *)/),n=t[0],s=n.match(/^( *)/),r=[s?.[1]?[s[1],n.slice(s[1].length)]:["",n]];for(let e=1;e<t.length;e+=2)r.push([t[e],t[e+1]]);return r}(t.source):[];let l=a.length;for(let e=a.length-1;e>=0;--e){const t=a[e][1];if(""!==t&&"\r"!==t)break;l=e}if(0===l){const e="+"===i.chomp&&a.length>0?"\n".repeat(Math.max(1,a.length-1)):"";let n=r+i.length;return t.source&&(n+=t.source.length),{value:e,type:o,comment:i.comment,range:[r,n,n]}}let c=t.indent+i.indent,p=t.offset+i.length,u=0;for(let t=0;t<l;++t){const[s,r]=a[t];if(""!==r&&"\r"!==r){if(s.length<c){const e="Block scalars with more-indented leading empty lines must use an explicit indentation indicator";n(p+s.length,"MISSING_CHAR",e)}if(0===i.indent&&(c=s.length),u=t,0===c&&!e.atRoot){n(p,"BAD_INDENT","Block scalar values in collections must be indented")}break}0===i.indent&&s.length>c&&(c=s.length),p+=s.length+r.length+1}for(let e=a.length-1;e>=l;--e)a[e][0].length>c&&(l=e+1);let f="",d="",h=!1;for(let e=0;e<u;++e)f+=a[e][0].slice(c)+"\n";for(let e=u;e<l;++e){let[t,r]=a[e];p+=t.length+r.length+1;const l="\r"===r[r.length-1];if(l&&(r=r.slice(0,-1)),r&&t.length<c){const e=`Block scalar lines must not be less indented than their ${i.indent?"explicit indentation indicator":"first line"}`;n(p-r.length-(l?2:1),"BAD_INDENT",e),t=""}o===s.Scalar.BLOCK_LITERAL?(f+=d+t.slice(c)+r,d="\n"):t.length>c||"\t"===r[0]?(" "===d?d="\n":h||"\n"!==d||(d="\n\n"),f+=d+t.slice(c)+r,d="\n",h=!0):""===r?"\n"===d?f+="\n":d="\n":(f+=d+r,d=" ",h=!1)}switch(i.chomp){case"-":break;case"+":for(let e=l;e<a.length;++e)f+="\n"+a[e][0].slice(c);"\n"!==f[f.length-1]&&(f+="\n");break;default:f+="\n"}const m=r+i.length+t.source.length;return{value:f,type:o,comment:i.comment,range:[r,m,m]}}},483(e,t,n){"use strict";var s=n(6010),r=n(1386),i=n(8644);t.resolveBlockSeq=function resolveBlockSeq({composeNode:e,composeEmptyNode:t},n,o,a,l){const c=new(l?.nodeClass??s.YAMLSeq)(n.schema);n.atRoot&&(n.atRoot=!1),n.atKey&&(n.atKey=!1);let p=o.offset,u=null;for(const{start:s,value:l}of o.items){const f=r.resolveProps(s,{indicator:"seq-item-ind",next:l,offset:p,onError:a,parentIndent:o.indent,startOnNewline:!0});if(!f.found){if(!(f.anchor||f.tag||l)){u=f.end,f.comment&&(c.comment=f.comment);continue}"block-seq"===l?.type?a(f.end,"BAD_INDENT","All sequence items must start at the same column"):a(p,"MISSING_CHAR","Sequence item without - indicator")}const d=l?e(n,l,f,a):t(n,f.end,s,null,f,a);n.schema.compat&&i.flowIndentCheck(o.indent,l,a),p=d.range[2],c.items.push(d)}return c.range=[o.offset,p,u??p],c}},6845(e,t){"use strict";t.resolveEnd=function resolveEnd(e,t,n,s){let r="";if(e){let i=!1,o="";for(const a of e){const{source:e,type:l}=a;switch(l){case"space":i=!0;break;case"comment":{n&&!i&&s(a,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");const t=e.substring(1)||" ";r?r+=o+t:r=t,o="";break}case"newline":r&&(o+=e),i=!0;break;default:s(a,"UNEXPECTED_TOKEN",`Unexpected ${l} at node end`)}t+=e.length}}return{comment:r,offset:t}}},2291(e,t,n){"use strict";var s=n(484),r=n(7902),i=n(1755),o=n(6010),a=n(6845),l=n(1386),c=n(9378),p=n(8334);const u="Block collections are not allowed within flow collections",isBlock=e=>e&&("block-map"===e.type||"block-seq"===e.type);t.resolveFlowCollection=function resolveFlowCollection({composeNode:e,composeEmptyNode:t},n,f,d,h){const m="{"===f.start.source,g=m?"flow map":"flow sequence",y=new(h?.nodeClass??(m?i.YAMLMap:o.YAMLSeq))(n.schema);y.flow=!0;const b=n.atRoot;b&&(n.atRoot=!1),n.atKey&&(n.atKey=!1);let v=f.offset+f.start.source.length;for(let o=0;o<f.items.length;++o){const a=f.items[o],{start:h,key:b,sep:x,value:S}=a,w=l.resolveProps(h,{flow:g,indicator:"explicit-key-ind",next:b??x?.[0],offset:v,onError:d,parentIndent:f.indent,startOnNewline:!1});if(!w.found){if(!(w.anchor||w.tag||x||S)){0===o&&w.comma?d(w.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${g}`):o<f.items.length-1&&d(w.start,"UNEXPECTED_TOKEN",`Unexpected empty item in ${g}`),w.comment&&(y.comment?y.comment+="\n"+w.comment:y.comment=w.comment),v=w.end;continue}!m&&n.options.strict&&c.containsNewline(b)&&d(b,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line")}if(0===o)w.comma&&d(w.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${g}`);else if(w.comma||d(w.start,"MISSING_CHAR",`Missing , between ${g} items`),w.comment){let e="";e:for(const t of h)switch(t.type){case"comma":case"space":break;case"comment":e=t.source.substring(1);break e;default:break e}if(e){let t=y.items[y.items.length-1];s.isPair(t)&&(t=t.value??t.key),t.comment?t.comment+="\n"+e:t.comment=e,w.comment=w.comment.substring(e.length+1)}}if(m||x||w.found){n.atKey=!0;const s=w.end,o=b?e(n,b,w,d):t(n,s,h,null,w,d);isBlock(b)&&d(o.range,"BLOCK_IN_FLOW",u),n.atKey=!1;const c=l.resolveProps(x??[],{flow:g,indicator:"map-value-ind",next:S,offset:o.range[2],onError:d,parentIndent:f.indent,startOnNewline:!1});if(c.found){if(!m&&!w.found&&n.options.strict){if(x)for(const e of x){if(e===c.found)break;if("newline"===e.type){d(e,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line");break}}w.start<c.found.offset-1024&&d(c.found,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit flow sequence key")}}else S&&("source"in S&&":"===S.source?.[0]?d(S,"MISSING_CHAR",`Missing space after : in ${g}`):d(c.start,"MISSING_CHAR",`Missing , or : between ${g} items`));const k=S?e(n,S,c,d):c.found?t(n,c.end,x,null,c,d):null;k?isBlock(S)&&d(k.range,"BLOCK_IN_FLOW",u):c.comment&&(o.comment?o.comment+="\n"+c.comment:o.comment=c.comment);const E=new r.Pair(o,k);if(n.options.keepSourceTokens&&(E.srcToken=a),m){const e=y;p.mapIncludes(n,e.items,o)&&d(s,"DUPLICATE_KEY","Map keys must be unique"),e.items.push(E)}else{const e=new i.YAMLMap(n.schema);e.flow=!0,e.items.push(E);const t=(k??o).range;e.range=[o.range[0],t[1],t[2]],y.items.push(e)}v=k?k.range[2]:c.end}else{const s=S?e(n,S,w,d):t(n,w.end,x,null,w,d);y.items.push(s),v=s.range[2],isBlock(S)&&d(s.range,"BLOCK_IN_FLOW",u)}}const x=m?"}":"]",[S,...w]=f.end;let k=v;if(S?.source===x)k=S.offset+S.source.length;else{const e=g[0].toUpperCase()+g.substring(1);d(v,b?"MISSING_CHAR":"BAD_INDENT",b?`${e} must end with a ${x}`:`${e} in block collection must be sufficiently indented and end with a ${x}`),S&&1!==S.source.length&&w.unshift(S)}if(w.length>0){const e=a.resolveEnd(w,k,n.options.strict,d);e.comment&&(y.comment?y.comment+="\n"+e.comment:y.comment=e.comment),y.range=[f.offset,k,e.offset]}else y.range=[f.offset,k,k];return y}},7571(e,t,n){"use strict";var s=n(9714),r=n(6845);function foldLines(e){let t,n;try{t=new RegExp("(.*?)(?<![ \t])[ \t]*\r?\n","sy"),n=new RegExp("[ \t]*(.*?)(?:(?<![ \t])[ \t]*)?\r?\n","sy")}catch{t=/(.*?)[ \t]*\r?\n/sy,n=/[ \t]*(.*?)[ \t]*\r?\n/sy}let s=t.exec(e);if(!s)return e;let r=s[1],i=" ",o=t.lastIndex;for(n.lastIndex=o;s=n.exec(e);)""===s[1]?"\n"===i?r+=i:i="\n":(r+=i+s[1],i=" "),o=n.lastIndex;const a=/[ \t]*(.*)/sy;return a.lastIndex=o,s=a.exec(e),r+i+(s?.[1]??"")}function foldNewline(e,t){let n="",s=e[t+1];for(;!(" "!==s&&"\t"!==s&&"\n"!==s&&"\r"!==s||"\r"===s&&"\n"!==e[t+2]);)"\n"===s&&(n+="\n"),s=e[(t+=1)+1];return n||(n=" "),{fold:n,offset:t}}const i={0:"\0",a:"",b:"\b",e:"",f:"\f",n:"\n",r:"\r",t:"\t",v:"\v",N:"Â…",_:"Â ",L:"\u2028",P:"\u2029"," ":" ",'"':'"',"/":"/","\\":"\\","\t":"\t"};function parseCharCode(e,t,n,s){const r=e.substr(t,n),i=r.length===n&&/^[0-9a-fA-F]+$/.test(r)?parseInt(r,16):NaN;if(isNaN(i)){const r=e.substr(t-2,n+2);return s(t-2,"BAD_DQ_ESCAPE",`Invalid escape sequence ${r}`),r}return String.fromCodePoint(i)}t.resolveFlowScalar=function resolveFlowScalar(e,t,n){const{offset:o,type:a,source:l,end:c}=e;let p,u;const _onError=(e,t,s)=>n(o+e,t,s);switch(a){case"scalar":p=s.Scalar.PLAIN,u=function plainValue(e,t){let n="";switch(e[0]){case"\t":n="a tab character";break;case",":n="flow indicator character ,";break;case"%":n="directive indicator character %";break;case"|":case">":n=`block scalar indicator ${e[0]}`;break;case"@":case"`":n=`reserved character ${e[0]}`}n&&t(0,"BAD_SCALAR_START",`Plain value cannot start with ${n}`);return foldLines(e)}(l,_onError);break;case"single-quoted-scalar":p=s.Scalar.QUOTE_SINGLE,u=function singleQuotedValue(e,t){"'"===e[e.length-1]&&1!==e.length||t(e.length,"MISSING_CHAR","Missing closing 'quote");return foldLines(e.slice(1,-1)).replace(/''/g,"'")}(l,_onError);break;case"double-quoted-scalar":p=s.Scalar.QUOTE_DOUBLE,u=function doubleQuotedValue(e,t){let n="";for(let s=1;s<e.length-1;++s){const r=e[s];if("\r"!==r||"\n"!==e[s+1])if("\n"===r){const{fold:t,offset:r}=foldNewline(e,s);n+=t,s=r}else if("\\"===r){let r=e[++s];const o=i[r];if(o)n+=o;else if("\n"===r)for(r=e[s+1];" "===r||"\t"===r;)r=e[1+ ++s];else if("\r"===r&&"\n"===e[s+1])for(r=e[1+ ++s];" "===r||"\t"===r;)r=e[1+ ++s];else if("x"===r||"u"===r||"U"===r){const i={x:2,u:4,U:8}[r];n+=parseCharCode(e,s+1,i,t),s+=i}else{const r=e.substr(s-1,2);t(s-1,"BAD_DQ_ESCAPE",`Invalid escape sequence ${r}`),n+=r}}else if(" "===r||"\t"===r){const t=s;let i=e[s+1];for(;" "===i||"\t"===i;)i=e[1+ ++s];"\n"===i||"\r"===i&&"\n"===e[s+2]||(n+=s>t?e.slice(t,s+1):r)}else n+=r}'"'===e[e.length-1]&&1!==e.length||t(e.length,"MISSING_CHAR",'Missing closing "quote');return n}(l,_onError);break;default:return n(e,"UNEXPECTED_TOKEN",`Expected a flow scalar value, but found: ${a}`),{value:"",type:null,comment:"",range:[o,o+l.length,o+l.length]}}const f=o+l.length,d=r.resolveEnd(c,f,t,n);return{value:u,type:p,comment:d.comment,range:[o,f,d.offset]}}},1386(e,t){"use strict";t.resolveProps=function resolveProps(e,{flow:t,indicator:n,next:s,offset:r,onError:i,parentIndent:o,startOnNewline:a}){let l=!1,c=a,p=a,u="",f="",d=!1,h=!1,m=null,g=null,y=null,b=null,v=null,x=null,S=null;for(const r of e)switch(h&&("space"!==r.type&&"newline"!==r.type&&"comma"!==r.type&&i(r.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),h=!1),m&&(c&&"comment"!==r.type&&"newline"!==r.type&&i(m,"TAB_AS_INDENT","Tabs are not allowed as indentation"),m=null),r.type){case"space":t||"doc-start"===n&&"flow-collection"===s?.type||!r.source.includes("\t")||(m=r),p=!0;break;case"comment":{p||i(r,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");const e=r.source.substring(1)||" ";u?u+=f+e:u=e,f="",c=!1;break}case"newline":c?u?u+=r.source:x&&"seq-item-ind"===n||(l=!0):f+=r.source,c=!0,d=!0,(g||y)&&(b=r),p=!0;break;case"anchor":g&&i(r,"MULTIPLE_ANCHORS","A node can have at most one anchor"),r.source.endsWith(":")&&i(r.offset+r.source.length-1,"BAD_ALIAS","Anchor ending in : is ambiguous",!0),g=r,S??(S=r.offset),c=!1,p=!1,h=!0;break;case"tag":y&&i(r,"MULTIPLE_TAGS","A node can have at most one tag"),y=r,S??(S=r.offset),c=!1,p=!1,h=!0;break;case n:(g||y)&&i(r,"BAD_PROP_ORDER",`Anchors and tags must be after the ${r.source} indicator`),x&&i(r,"UNEXPECTED_TOKEN",`Unexpected ${r.source} in ${t??"collection"}`),x=r,c="seq-item-ind"===n||"explicit-key-ind"===n,p=!1;break;case"comma":if(t){v&&i(r,"UNEXPECTED_TOKEN",`Unexpected , in ${t}`),v=r,c=!1,p=!1;break}default:i(r,"UNEXPECTED_TOKEN",`Unexpected ${r.type} token`),c=!1,p=!1}const w=e[e.length-1],k=w?w.offset+w.source.length:r;return h&&s&&"space"!==s.type&&"newline"!==s.type&&"comma"!==s.type&&("scalar"!==s.type||""!==s.source)&&i(s.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),m&&(c&&m.indent<=o||"block-map"===s?.type||"block-seq"===s?.type)&&i(m,"TAB_AS_INDENT","Tabs are not allowed as indentation"),{comma:v,found:x,spaceBefore:l,comment:u,hasNewline:d,anchor:g,tag:y,newlineAfterProp:b,end:k,start:S??k}}},9378(e,t){"use strict";t.containsNewline=function containsNewline(e){if(!e)return null;switch(e.type){case"alias":case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":if(e.source.includes("\n"))return!0;if(e.end)for(const t of e.end)if("newline"===t.type)return!0;return!1;case"flow-collection":for(const t of e.items){for(const e of t.start)if("newline"===e.type)return!0;if(t.sep)for(const e of t.sep)if("newline"===e.type)return!0;if(containsNewline(t.key)||containsNewline(t.value))return!0}return!1;default:return!0}}},1040(e,t){"use strict";t.emptyScalarPosition=function emptyScalarPosition(e,t,n){if(t){n??(n=t.length);for(let s=n-1;s>=0;--s){let n=t[s];switch(n.type){case"space":case"comment":case"newline":e-=n.source.length;continue}for(n=t[++s];"space"===n?.type;)e+=n.source.length,n=t[++s];break}}return e}},8644(e,t,n){"use strict";var s=n(9378);t.flowIndentCheck=function flowIndentCheck(e,t,n){if("flow-collection"===t?.type){const r=t.end[0];if(r.indent===e&&("]"===r.source||"}"===r.source)&&s.containsNewline(t)){n(r,"BAD_INDENT","Flow end indicator should be more indented than parent",!0)}}}},8334(e,t,n){"use strict";var s=n(484);t.mapIncludes=function mapIncludes(e,t,n){const{uniqueKeys:r}=e.options;if(!1===r)return!1;const i="function"==typeof r?r:(e,t)=>e===t||s.isScalar(e)&&s.isScalar(t)&&e.value===t.value;return t.some(e=>i(e.key,n))}},9046(e,t,n){"use strict";var s=n(1736),r=n(1614),i=n(484),o=n(7902),a=n(3732),l=n(625),c=n(1768),p=n(6261),u=n(6906),f=n(5219),d=n(8673);class Document{constructor(e,t,n){this.commentBefore=null,this.comment=null,this.errors=[],this.warnings=[],Object.defineProperty(this,i.NODE_TYPE,{value:i.DOC});let s=null;"function"==typeof t||Array.isArray(t)?s=t:void 0===n&&t&&(n=t,t=void 0);const r=Object.assign({intAsBigInt:!1,keepSourceTokens:!1,logLevel:"warn",prettyErrors:!0,strict:!0,stringKeys:!1,uniqueKeys:!0,version:"1.2"},n);this.options=r;let{version:o}=r;n?._directives?(this.directives=n._directives.atDocument(),this.directives.yaml.explicit&&(o=this.directives.yaml.version)):this.directives=new d.Directives({version:o}),this.setSchema(o,n),this.contents=void 0===e?null:this.createNode(e,s,n)}clone(){const e=Object.create(Document.prototype,{[i.NODE_TYPE]:{value:i.DOC}});return e.commentBefore=this.commentBefore,e.comment=this.comment,e.errors=this.errors.slice(),e.warnings=this.warnings.slice(),e.options=Object.assign({},this.options),this.directives&&(e.directives=this.directives.clone()),e.schema=this.schema.clone(),e.contents=i.isNode(this.contents)?this.contents.clone(e.schema):this.contents,this.range&&(e.range=this.range.slice()),e}add(e){assertCollection(this.contents)&&this.contents.add(e)}addIn(e,t){assertCollection(this.contents)&&this.contents.addIn(e,t)}createAlias(e,t){if(!e.anchor){const n=p.anchorNames(this);e.anchor=!t||n.has(t)?p.findNewAnchor(t||"a",n):t}return new s.Alias(e.anchor)}createNode(e,t,n){let s;if("function"==typeof t)e=t.call({"":e},"",e),s=t;else if(Array.isArray(t)){const keyToStr=e=>"number"==typeof e||e instanceof String||e instanceof Number,e=t.filter(keyToStr).map(String);e.length>0&&(t=t.concat(e)),s=t}else void 0===n&&t&&(n=t,t=void 0);const{aliasDuplicateObjects:r,anchorPrefix:o,flow:a,keepUndefined:l,onTagObj:c,tag:u}=n??{},{onAnchor:d,setAnchors:h,sourceObjects:m}=p.createNodeAnchors(this,o||"a"),g={aliasDuplicateObjects:r??!0,keepUndefined:l??!1,onAnchor:d,onTagObj:c,replacer:s,schema:this.schema,sourceObjects:m},y=f.createNode(e,u,g);return a&&i.isCollection(y)&&(y.flow=!0),h(),y}createPair(e,t,n={}){const s=this.createNode(e,null,n),r=this.createNode(t,null,n);return new o.Pair(s,r)}delete(e){return!!assertCollection(this.contents)&&this.contents.delete(e)}deleteIn(e){return r.isEmptyPath(e)?null!=this.contents&&(this.contents=null,!0):!!assertCollection(this.contents)&&this.contents.deleteIn(e)}get(e,t){return i.isCollection(this.contents)?this.contents.get(e,t):void 0}getIn(e,t){return r.isEmptyPath(e)?!t&&i.isScalar(this.contents)?this.contents.value:this.contents:i.isCollection(this.contents)?this.contents.getIn(e,t):void 0}has(e){return!!i.isCollection(this.contents)&&this.contents.has(e)}hasIn(e){return r.isEmptyPath(e)?void 0!==this.contents:!!i.isCollection(this.contents)&&this.contents.hasIn(e)}set(e,t){null==this.contents?this.contents=r.collectionFromPath(this.schema,[e],t):assertCollection(this.contents)&&this.contents.set(e,t)}setIn(e,t){r.isEmptyPath(e)?this.contents=t:null==this.contents?this.contents=r.collectionFromPath(this.schema,Array.from(e),t):assertCollection(this.contents)&&this.contents.setIn(e,t)}setSchema(e,t={}){let n;switch("number"==typeof e&&(e=String(e)),e){case"1.1":this.directives?this.directives.yaml.version="1.1":this.directives=new d.Directives({version:"1.1"}),n={resolveKnownTags:!1,schema:"yaml-1.1"};break;case"1.2":case"next":this.directives?this.directives.yaml.version=e:this.directives=new d.Directives({version:e}),n={resolveKnownTags:!0,schema:"core"};break;case null:this.directives&&delete this.directives,n=null;break;default:{const t=JSON.stringify(e);throw new Error(`Expected '1.1', '1.2' or null as first argument, but found: ${t}`)}}if(t.schema instanceof Object)this.schema=t.schema;else{if(!n)throw new Error("With a null YAML version, the { schema: Schema } option is required");this.schema=new l.Schema(Object.assign(n,t))}}toJS({json:e,jsonArg:t,mapAsMap:n,maxAliasCount:s,onAnchor:r,reviver:i}={}){const o={anchors:new Map,doc:this,keep:!e,mapAsMap:!0===n,mapKeyWarned:!1,maxAliasCount:"number"==typeof s?s:100},l=a.toJS(this.contents,t??"",o);if("function"==typeof r)for(const{count:e,res:t}of o.anchors.values())r(t,e);return"function"==typeof i?u.applyReviver(i,{"":l},"",l):l}toJSON(e,t){return this.toJS({json:!0,jsonArg:e,mapAsMap:!1,onAnchor:t})}toString(e={}){if(this.errors.length>0)throw new Error("Document with errors cannot be stringified");if("indent"in e&&(!Number.isInteger(e.indent)||Number(e.indent)<=0)){const t=JSON.stringify(e.indent);throw new Error(`"indent" option must be a positive integer, not ${t}`)}return c.stringifyDocument(this,e)}}function assertCollection(e){if(i.isCollection(e))return!0;throw new Error("Expected a YAML collection as document contents")}t.Document=Document},6261(e,t,n){"use strict";var s=n(484),r=n(9125);function anchorNames(e){const t=new Set;return r.visit(e,{Value(e,n){n.anchor&&t.add(n.anchor)}}),t}function findNewAnchor(e,t){for(let n=1;;++n){const s=`${e}${n}`;if(!t.has(s))return s}}t.anchorIsValid=function anchorIsValid(e){if(/[\x00-\x19\s,[\]{}]/.test(e)){const t=JSON.stringify(e);throw new Error(`Anchor must not contain whitespace or control characters: ${t}`)}return!0},t.anchorNames=anchorNames,t.createNodeAnchors=function createNodeAnchors(e,t){const n=[],r=new Map;let i=null;return{onAnchor:s=>{n.push(s),i??(i=anchorNames(e));const r=findNewAnchor(t,i);return i.add(r),r},setAnchors:()=>{for(const e of n){const t=r.get(e);if("object"!=typeof t||!t.anchor||!s.isScalar(t.node)&&!s.isCollection(t.node)){const t=new Error("Failed to resolve repeated object (this should not happen)");throw t.source=e,t}t.node.anchor=t.anchor}},sourceObjects:r}},t.findNewAnchor=findNewAnchor},6906(e,t){"use strict";t.applyReviver=function applyReviver(e,t,n,s){if(s&&"object"==typeof s)if(Array.isArray(s))for(let t=0,n=s.length;t<n;++t){const n=s[t],r=applyReviver(e,s,String(t),n);void 0===r?delete s[t]:r!==n&&(s[t]=r)}else if(s instanceof Map)for(const t of Array.from(s.keys())){const n=s.get(t),r=applyReviver(e,s,t,n);void 0===r?s.delete(t):r!==n&&s.set(t,r)}else if(s instanceof Set)for(const t of Array.from(s)){const n=applyReviver(e,s,t,t);void 0===n?s.delete(t):n!==t&&(s.delete(t),s.add(n))}else for(const[t,n]of Object.entries(s)){const r=applyReviver(e,s,t,n);void 0===r?delete s[t]:r!==n&&(s[t]=r)}return e.call(t,n,s)}},5219(e,t,n){"use strict";var s=n(1736),r=n(484),i=n(9714);t.createNode=function createNode(e,t,n){if(r.isDocument(e)&&(e=e.contents),r.isNode(e))return e;if(r.isPair(e)){const t=n.schema[r.MAP].createNode?.(n.schema,null,n);return t.items.push(e),t}(e instanceof String||e instanceof Number||e instanceof Boolean||"undefined"!=typeof BigInt&&e instanceof BigInt)&&(e=e.valueOf());const{aliasDuplicateObjects:o,onAnchor:a,onTagObj:l,schema:c,sourceObjects:p}=n;let u;if(o&&e&&"object"==typeof e){if(u=p.get(e),u)return u.anchor??(u.anchor=a(e)),new s.Alias(u.anchor);u={anchor:null,node:null},p.set(e,u)}t?.startsWith("!!")&&(t="tag:yaml.org,2002:"+t.slice(2));let f=function findTagObject(e,t,n){if(t){const e=n.filter(e=>e.tag===t),s=e.find(e=>!e.format)??e[0];if(!s)throw new Error(`Tag ${t} not found`);return s}return n.find(t=>t.identify?.(e)&&!t.format)}(e,t,c.tags);if(!f){if(e&&"function"==typeof e.toJSON&&(e=e.toJSON()),!e||"object"!=typeof e){const t=new i.Scalar(e);return u&&(u.node=t),t}f=e instanceof Map?c[r.MAP]:Symbol.iterator in Object(e)?c[r.SEQ]:c[r.MAP]}l&&(l(f),delete n.onTagObj);const d=f?.createNode?f.createNode(n.schema,e,n):"function"==typeof f?.nodeClass?.from?f.nodeClass.from(n.schema,e,n):new i.Scalar(e);return t?d.tag=t:f.default||(d.tag=f.tag),u&&(u.node=d),d}},8673(e,t,n){"use strict";var s=n(484),r=n(9125);const i={"!":"%21",",":"%2C","[":"%5B","]":"%5D","{":"%7B","}":"%7D"},escapeTagName=e=>e.replace(/[!,[\]{}]/g,e=>i[e]);class Directives{constructor(e,t){this.docStart=null,this.docEnd=!1,this.yaml=Object.assign({},Directives.defaultYaml,e),this.tags=Object.assign({},Directives.defaultTags,t)}clone(){const e=new Directives(this.yaml,this.tags);return e.docStart=this.docStart,e}atDocument(){const e=new Directives(this.yaml,this.tags);switch(this.yaml.version){case"1.1":this.atNextDocument=!0;break;case"1.2":this.atNextDocument=!1,this.yaml={explicit:Directives.defaultYaml.explicit,version:"1.2"},this.tags=Object.assign({},Directives.defaultTags)}return e}add(e,t){this.atNextDocument&&(this.yaml={explicit:Directives.defaultYaml.explicit,version:"1.1"},this.tags=Object.assign({},Directives.defaultTags),this.atNextDocument=!1);const n=e.trim().split(/[ \t]+/),s=n.shift();switch(s){case"%TAG":{if(2!==n.length&&(t(0,"%TAG directive should contain exactly two parts"),n.length<2))return!1;const[e,s]=n;return this.tags[e]=s,!0}case"%YAML":{if(this.yaml.explicit=!0,1!==n.length)return t(0,"%YAML directive should contain exactly one part"),!1;const[e]=n;if("1.1"===e||"1.2"===e)return this.yaml.version=e,!0;return t(6,`Unsupported YAML version ${e}`,/^\d+\.\d+$/.test(e)),!1}default:return t(0,`Unknown directive ${s}`,!0),!1}}tagName(e,t){if("!"===e)return"!";if("!"!==e[0])return t(`Not a valid tag: ${e}`),null;if("<"===e[1]){const n=e.slice(2,-1);return"!"===n||"!!"===n?(t(`Verbatim tags aren't resolved, so ${e} is invalid.`),null):(">"!==e[e.length-1]&&t("Verbatim tags must end with a >"),n)}const[,n,s]=e.match(/^(.*!)([^!]*)$/s);s||t(`The ${e} tag has no suffix`);const r=this.tags[n];if(r)try{return r+decodeURIComponent(s)}catch(e){return t(String(e)),null}return"!"===n?e:(t(`Could not resolve tag: ${e}`),null)}tagString(e){for(const[t,n]of Object.entries(this.tags))if(e.startsWith(n))return t+escapeTagName(e.substring(n.length));return"!"===e[0]?e:`!<${e}>`}toString(e){const t=this.yaml.explicit?[`%YAML ${this.yaml.version||"1.2"}`]:[],n=Object.entries(this.tags);let i;if(e&&n.length>0&&s.isNode(e.contents)){const t={};r.visit(e.contents,(e,n)=>{s.isNode(n)&&n.tag&&(t[n.tag]=!0)}),i=Object.keys(t)}else i=[];for(const[s,r]of n)"!!"===s&&"tag:yaml.org,2002:"===r||e&&!i.some(e=>e.startsWith(r))||t.push(`%TAG ${s} ${r}`);return t.join("\n")}}Directives.defaultYaml={explicit:!1,version:"1.2"},Directives.defaultTags={"!!":"tag:yaml.org,2002:"},t.Directives=Directives},4355(e,t){"use strict";class YAMLError extends Error{constructor(e,t,n,s){super(),this.name=e,this.code=n,this.message=s,this.pos=t}}t.YAMLError=YAMLError,t.YAMLParseError=class YAMLParseError extends YAMLError{constructor(e,t,n){super("YAMLParseError",e,t,n)}},t.YAMLWarning=class YAMLWarning extends YAMLError{constructor(e,t,n){super("YAMLWarning",e,t,n)}},t.prettifyError=(e,t)=>n=>{if(-1===n.pos[0])return;n.linePos=n.pos.map(e=>t.linePos(e));const{line:s,col:r}=n.linePos[0];n.message+=` at line ${s}, column ${r}`;let i=r-1,o=e.substring(t.lineStarts[s-1],t.lineStarts[s]).replace(/[\n\r]+$/,"");if(i>=60&&o.length>80){const e=Math.min(i-39,o.length-79);o="â€¦"+o.substring(e),i-=e-1}if(o.length>80&&(o=o.substring(0,79)+"â€¦"),s>1&&/^ *$/.test(o.substring(0,i))){let n=e.substring(t.lineStarts[s-2],t.lineStarts[s-1]);n.length>80&&(n=n.substring(0,79)+"â€¦\n"),o=n+o}if(/[^ ]/.test(o)){let e=1;const t=n.linePos[1];t?.line===s&&t.col>r&&(e=Math.max(1,Math.min(t.col-r,80-i)));const a=" ".repeat(i)+"^".repeat(e);n.message+=`:\n\n${o}\n${a}\n`}}},1198(e,t,n){"use strict";var s=n(4927),r=n(9046),i=n(625),o=n(4355),a=n(1736),l=n(484),c=n(7902),p=n(9714),u=n(1755),f=n(6010),d=n(9112),h=n(5752),m=n(2864),g=n(6247),y=n(1332),b=n(9125);t.Composer=s.Composer,t.Document=r.Document,t.Schema=i.Schema,t.YAMLError=o.YAMLError,t.YAMLParseError=o.YAMLParseError,t.YAMLWarning=o.YAMLWarning,t.Alias=a.Alias,t.isAlias=l.isAlias,t.isCollection=l.isCollection,t.isDocument=l.isDocument,t.isMap=l.isMap,t.isNode=l.isNode,t.isPair=l.isPair,t.isScalar=l.isScalar,t.isSeq=l.isSeq,t.Pair=c.Pair,t.Scalar=p.Scalar,t.YAMLMap=u.YAMLMap,t.YAMLSeq=f.YAMLSeq,t.CST=d,t.Lexer=h.Lexer,t.LineCounter=m.LineCounter,t.Parser=g.Parser,t.parse=y.parse,t.parseAllDocuments=y.parseAllDocuments,t.parseDocument=y.parseDocument,t.stringify=y.stringify,t.visit=b.visit,t.visitAsync=b.visitAsync},7444(e,t,n){"use strict";var s=n(932);t.debug=function debug(e,...t){"debug"===e&&console.log(...t)},t.warn=function warn(e,t){"debug"!==e&&"warn"!==e||("function"==typeof s.emitWarning?s.emitWarning(t):console.warn(t))}},1736(e,t,n){"use strict";var s=n(6261),r=n(9125),i=n(484),o=n(8898),a=n(3732);class Alias extends o.NodeBase{constructor(e){super(i.ALIAS),this.source=e,Object.defineProperty(this,"tag",{set(){throw new Error("Alias nodes cannot have tags")}})}resolve(e,t){let n,s;t?.aliasResolveCache?n=t.aliasResolveCache:(n=[],r.visit(e,{Node:(e,t)=>{(i.isAlias(t)||i.hasAnchor(t))&&n.push(t)}}),t&&(t.aliasResolveCache=n));for(const e of n){if(e===this)break;e.anchor===this.source&&(s=e)}return s}toJSON(e,t){if(!t)return{source:this.source};const{anchors:n,doc:s,maxAliasCount:r}=t,i=this.resolve(s,t);if(!i){const e=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new ReferenceError(e)}let o=n.get(i);if(o||(a.toJS(i,null,t),o=n.get(i)),void 0===o?.res){throw new ReferenceError("This should not happen: Alias anchor was not resolved?")}if(r>=0&&(o.count+=1,0===o.aliasCount&&(o.aliasCount=getAliasCount(s,i,n)),o.count*o.aliasCount>r)){throw new ReferenceError("Excessive alias count indicates a resource exhaustion attack")}return o.res}toString(e,t,n){const r=`*${this.source}`;if(e){if(s.anchorIsValid(this.source),e.options.verifyAliasOrder&&!e.anchors.has(this.source)){const e=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new Error(e)}if(e.implicitKey)return`${r} `}return r}}function getAliasCount(e,t,n){if(i.isAlias(t)){const s=t.resolve(e),r=n&&s&&n.get(s);return r?r.count*r.aliasCount:0}if(i.isCollection(t)){let s=0;for(const r of t.items){const t=getAliasCount(e,r,n);t>s&&(s=t)}return s}if(i.isPair(t)){const s=getAliasCount(e,t.key,n),r=getAliasCount(e,t.value,n);return Math.max(s,r)}return 1}t.Alias=Alias},1614(e,t,n){"use strict";var s=n(5219),r=n(484),i=n(8898);function collectionFromPath(e,t,n){let r=n;for(let e=t.length-1;e>=0;--e){const n=t[e];if("number"==typeof n&&Number.isInteger(n)&&n>=0){const e=[];e[n]=r,r=e}else r=new Map([[n,r]])}return s.createNode(r,void 0,{aliasDuplicateObjects:!1,keepUndefined:!1,onAnchor:()=>{throw new Error("This should not happen, please report a bug.")},schema:e,sourceObjects:new Map})}const isEmptyPath=e=>null==e||"object"==typeof e&&!!e[Symbol.iterator]().next().done;class Collection extends i.NodeBase{constructor(e,t){super(e),Object.defineProperty(this,"schema",{value:t,configurable:!0,enumerable:!1,writable:!0})}clone(e){const t=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return e&&(t.schema=e),t.items=t.items.map(t=>r.isNode(t)||r.isPair(t)?t.clone(e):t),this.range&&(t.range=this.range.slice()),t}addIn(e,t){if(isEmptyPath(e))this.add(t);else{const[n,...s]=e,i=this.get(n,!0);if(r.isCollection(i))i.addIn(s,t);else{if(void 0!==i||!this.schema)throw new Error(`Expected YAML collection at ${n}. Remaining path: ${s}`);this.set(n,collectionFromPath(this.schema,s,t))}}}deleteIn(e){const[t,...n]=e;if(0===n.length)return this.delete(t);const s=this.get(t,!0);if(r.isCollection(s))return s.deleteIn(n);throw new Error(`Expected YAML collection at ${t}. Remaining path: ${n}`)}getIn(e,t){const[n,...s]=e,i=this.get(n,!0);return 0===s.length?!t&&r.isScalar(i)?i.value:i:r.isCollection(i)?i.getIn(s,t):void 0}hasAllNullValues(e){return this.items.every(t=>{if(!r.isPair(t))return!1;const n=t.value;return null==n||e&&r.isScalar(n)&&null==n.value&&!n.commentBefore&&!n.comment&&!n.tag})}hasIn(e){const[t,...n]=e;if(0===n.length)return this.has(t);const s=this.get(t,!0);return!!r.isCollection(s)&&s.hasIn(n)}setIn(e,t){const[n,...s]=e;if(0===s.length)this.set(n,t);else{const e=this.get(n,!0);if(r.isCollection(e))e.setIn(s,t);else{if(void 0!==e||!this.schema)throw new Error(`Expected YAML collection at ${n}. Remaining path: ${s}`);this.set(n,collectionFromPath(this.schema,s,t))}}}}t.Collection=Collection,t.collectionFromPath=collectionFromPath,t.isEmptyPath=isEmptyPath},8898(e,t,n){"use strict";var s=n(6906),r=n(484),i=n(3732);t.NodeBase=class NodeBase{constructor(e){Object.defineProperty(this,r.NODE_TYPE,{value:e})}clone(){const e=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return this.range&&(e.range=this.range.slice()),e}toJS(e,{mapAsMap:t,maxAliasCount:n,onAnchor:o,reviver:a}={}){if(!r.isDocument(e))throw new TypeError("A document argument is required");const l={anchors:new Map,doc:e,keep:!0,mapAsMap:!0===t,mapKeyWarned:!1,maxAliasCount:"number"==typeof n?n:100},c=i.toJS(this,"",l);if("function"==typeof o)for(const{count:e,res:t}of l.anchors.values())o(t,e);return"function"==typeof a?s.applyReviver(a,{"":c},"",c):c}}},7902(e,t,n){"use strict";var s=n(5219),r=n(8017),i=n(5139),o=n(484);class Pair{constructor(e,t=null){Object.defineProperty(this,o.NODE_TYPE,{value:o.PAIR}),this.key=e,this.value=t}clone(e){let{key:t,value:n}=this;return o.isNode(t)&&(t=t.clone(e)),o.isNode(n)&&(n=n.clone(e)),new Pair(t,n)}toJSON(e,t){const n=t?.mapAsMap?new Map:{};return i.addPairToJSMap(t,n,this)}toString(e,t,n){return e?.doc?r.stringifyPair(this,e,t,n):JSON.stringify(this)}}t.Pair=Pair,t.createPair=function createPair(e,t,n){const r=s.createNode(e,void 0,n),i=s.createNode(t,void 0,n);return new Pair(r,i)}},9714(e,t,n){"use strict";var s=n(484),r=n(8898),i=n(3732);class Scalar extends r.NodeBase{constructor(e){super(s.SCALAR),this.value=e}toJSON(e,t){return t?.keep?this.value:i.toJS(this.value,e,t)}toString(){return String(this.value)}}Scalar.BLOCK_FOLDED="BLOCK_FOLDED",Scalar.BLOCK_LITERAL="BLOCK_LITERAL",Scalar.PLAIN="PLAIN",Scalar.QUOTE_DOUBLE="QUOTE_DOUBLE",Scalar.QUOTE_SINGLE="QUOTE_SINGLE",t.Scalar=Scalar,t.isScalarValue=e=>!e||"function"!=typeof e&&"object"!=typeof e},1755(e,t,n){"use strict";var s=n(81),r=n(5139),i=n(1614),o=n(484),a=n(7902),l=n(9714);function findPair(e,t){const n=o.isScalar(t)?t.value:t;for(const s of e)if(o.isPair(s)){if(s.key===t||s.key===n)return s;if(o.isScalar(s.key)&&s.key.value===n)return s}}class YAMLMap extends i.Collection{static get tagName(){return"tag:yaml.org,2002:map"}constructor(e){super(o.MAP,e),this.items=[]}static from(e,t,n){const{keepUndefined:s,replacer:r}=n,i=new this(e),add=(e,o)=>{if("function"==typeof r)o=r.call(t,e,o);else if(Array.isArray(r)&&!r.includes(e))return;(void 0!==o||s)&&i.items.push(a.createPair(e,o,n))};if(t instanceof Map)for(const[e,n]of t)add(e,n);else if(t&&"object"==typeof t)for(const e of Object.keys(t))add(e,t[e]);return"function"==typeof e.sortMapEntries&&i.items.sort(e.sortMapEntries),i}add(e,t){let n;n=o.isPair(e)?e:e&&"object"==typeof e&&"key"in e?new a.Pair(e.key,e.value):new a.Pair(e,e?.value);const s=findPair(this.items,n.key),r=this.schema?.sortMapEntries;if(s){if(!t)throw new Error(`Key ${n.key} already set`);o.isScalar(s.value)&&l.isScalarValue(n.value)?s.value.value=n.value:s.value=n.value}else if(r){const e=this.items.findIndex(e=>r(n,e)<0);-1===e?this.items.push(n):this.items.splice(e,0,n)}else this.items.push(n)}delete(e){const t=findPair(this.items,e);if(!t)return!1;return this.items.splice(this.items.indexOf(t),1).length>0}get(e,t){const n=findPair(this.items,e),s=n?.value;return(!t&&o.isScalar(s)?s.value:s)??void 0}has(e){return!!findPair(this.items,e)}set(e,t){this.add(new a.Pair(e,t),!0)}toJSON(e,t,n){const s=n?new n:t?.mapAsMap?new Map:{};t?.onCreate&&t.onCreate(s);for(const e of this.items)r.addPairToJSMap(t,s,e);return s}toString(e,t,n){if(!e)return JSON.stringify(this);for(const e of this.items)if(!o.isPair(e))throw new Error(`Map items must all be pairs; found ${JSON.stringify(e)} instead`);return!e.allNullValues&&this.hasAllNullValues(!1)&&(e=Object.assign({},e,{allNullValues:!0})),s.stringifyCollection(this,e,{blockItemPrefix:"",flowChars:{start:"{",end:"}"},itemIndent:e.indent||"",onChompKeep:n,onComment:t})}}t.YAMLMap=YAMLMap,t.findPair=findPair},6010(e,t,n){"use strict";var s=n(5219),r=n(81),i=n(1614),o=n(484),a=n(9714),l=n(3732);class YAMLSeq extends i.Collection{static get tagName(){return"tag:yaml.org,2002:seq"}constructor(e){super(o.SEQ,e),this.items=[]}add(e){this.items.push(e)}delete(e){const t=asItemIndex(e);if("number"!=typeof t)return!1;return this.items.splice(t,1).length>0}get(e,t){const n=asItemIndex(e);if("number"!=typeof n)return;const s=this.items[n];return!t&&o.isScalar(s)?s.value:s}has(e){const t=asItemIndex(e);return"number"==typeof t&&t<this.items.length}set(e,t){const n=asItemIndex(e);if("number"!=typeof n)throw new Error(`Expected a valid index, not ${e}.`);const s=this.items[n];o.isScalar(s)&&a.isScalarValue(t)?s.value=t:this.items[n]=t}toJSON(e,t){const n=[];t?.onCreate&&t.onCreate(n);let s=0;for(const e of this.items)n.push(l.toJS(e,String(s++),t));return n}toString(e,t,n){return e?r.stringifyCollection(this,e,{blockItemPrefix:"- ",flowChars:{start:"[",end:"]"},itemIndent:(e.indent||"")+"  ",onChompKeep:n,onComment:t}):JSON.stringify(this)}static from(e,t,n){const{replacer:r}=n,i=new this(e);if(t&&Symbol.iterator in Object(t)){let e=0;for(let o of t){if("function"==typeof r){const n=t instanceof Set?o:String(e++);o=r.call(t,n,o)}i.items.push(s.createNode(o,void 0,n))}}return i}}function asItemIndex(e){let t=o.isScalar(e)?e.value:e;return t&&"string"==typeof t&&(t=Number(t)),"number"==typeof t&&Number.isInteger(t)&&t>=0?t:null}t.YAMLSeq=YAMLSeq},5139(e,t,n){"use strict";var s=n(7444),r=n(9637),i=n(3793),o=n(484),a=n(3732);t.addPairToJSMap=function addPairToJSMap(e,t,{key:n,value:l}){if(o.isNode(n)&&n.addToJSMap)n.addToJSMap(e,t,l);else if(r.isMergeKey(e,n))r.addMergeToJSMap(e,t,l);else{const r=a.toJS(n,"",e);if(t instanceof Map)t.set(r,a.toJS(l,r,e));else if(t instanceof Set)t.add(r);else{const c=function stringifyKey(e,t,n){if(null===t)return"";if("object"!=typeof t)return String(t);if(o.isNode(e)&&n?.doc){const t=i.createStringifyContext(n.doc,{});t.anchors=new Set;for(const e of n.anchors.keys())t.anchors.add(e.anchor);t.inFlow=!0,t.inStringifyKey=!0;const r=e.toString(t);if(!n.mapKeyWarned){let e=JSON.stringify(r);e.length>40&&(e=e.substring(0,36)+'..."'),s.warn(n.doc.options.logLevel,`Keys with collection values will be stringified due to JS Object restrictions: ${e}. Set mapAsMap: true to use object keys.`),n.mapKeyWarned=!0}return r}return JSON.stringify(t)}(n,r,e),p=a.toJS(l,c,e);c in t?Object.defineProperty(t,c,{value:p,writable:!0,enumerable:!0,configurable:!0}):t[c]=p}}return t}},484(e,t){"use strict";const n=Symbol.for("yaml.alias"),s=Symbol.for("yaml.document"),r=Symbol.for("yaml.map"),i=Symbol.for("yaml.pair"),o=Symbol.for("yaml.scalar"),a=Symbol.for("yaml.seq"),l=Symbol.for("yaml.node.type"),isScalar=e=>!!e&&"object"==typeof e&&e[l]===o;function isCollection(e){if(e&&"object"==typeof e)switch(e[l]){case r:case a:return!0}return!1}t.ALIAS=n,t.DOC=s,t.MAP=r,t.NODE_TYPE=l,t.PAIR=i,t.SCALAR=o,t.SEQ=a,t.hasAnchor=e=>(isScalar(e)||isCollection(e))&&!!e.anchor,t.isAlias=e=>!!e&&"object"==typeof e&&e[l]===n,t.isCollection=isCollection,t.isDocument=e=>!!e&&"object"==typeof e&&e[l]===s,t.isMap=e=>!!e&&"object"==typeof e&&e[l]===r,t.isNode=function isNode(e){if(e&&"object"==typeof e)switch(e[l]){case n:case r:case o:case a:return!0}return!1},t.isPair=e=>!!e&&"object"==typeof e&&e[l]===i,t.isScalar=isScalar,t.isSeq=e=>!!e&&"object"==typeof e&&e[l]===a},3732(e,t,n){"use strict";var s=n(484);t.toJS=function toJS(e,t,n){if(Array.isArray(e))return e.map((e,t)=>toJS(e,String(t),n));if(e&&"function"==typeof e.toJSON){if(!n||!s.hasAnchor(e))return e.toJSON(t,n);const r={aliasCount:0,count:1,res:void 0};n.anchors.set(e,r),n.onCreate=e=>{r.res=e,delete n.onCreate};const i=e.toJSON(t,n);return n.onCreate&&n.onCreate(i),i}return"bigint"!=typeof e||n?.keep?e:Number(e)}},5141(e,t,n){"use strict";var s=n(4070),r=n(7571),i=n(4355),o=n(7180);function addEndtoBlockProps(e,t){if(t)for(const n of t)switch(n.type){case"space":case"comment":e.push(n);break;case"newline":return e.push(n),!0}return!1}function setFlowScalarValue(e,t,n){switch(e.type){case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":e.type=n,e.source=t;break;case"block-scalar":{const s=e.props.slice(1);let r=t.length;"block-scalar-header"===e.props[0].type&&(r-=e.props[0].source.length);for(const e of s)e.offset+=r;delete e.props,Object.assign(e,{type:n,source:t,end:s});break}case"block-map":case"block-seq":{const s={type:"newline",offset:e.offset+t.length,indent:e.indent,source:"\n"};delete e.items,Object.assign(e,{type:n,source:t,end:[s]});break}default:{const s="indent"in e?e.indent:-1,r="end"in e&&Array.isArray(e.end)?e.end.filter(e=>"space"===e.type||"comment"===e.type||"newline"===e.type):[];for(const t of Object.keys(e))"type"!==t&&"offset"!==t&&delete e[t];Object.assign(e,{type:n,indent:s,source:t,end:r})}}}t.createScalarToken=function createScalarToken(e,t){const{implicitKey:n=!1,indent:s,inFlow:r=!1,offset:i=-1,type:a="PLAIN"}=t,l=o.stringifyString({type:a,value:e},{implicitKey:n,indent:s>0?" ".repeat(s):"",inFlow:r,options:{blockQuote:!0,lineWidth:-1}}),c=t.end??[{type:"newline",offset:-1,indent:s,source:"\n"}];switch(l[0]){case"|":case">":{const e=l.indexOf("\n"),t=l.substring(0,e),n=l.substring(e+1)+"\n",r=[{type:"block-scalar-header",offset:i,indent:s,source:t}];return addEndtoBlockProps(r,c)||r.push({type:"newline",offset:-1,indent:s,source:"\n"}),{type:"block-scalar",offset:i,indent:s,props:r,source:n}}case'"':return{type:"double-quoted-scalar",offset:i,indent:s,source:l,end:c};case"'":return{type:"single-quoted-scalar",offset:i,indent:s,source:l,end:c};default:return{type:"scalar",offset:i,indent:s,source:l,end:c}}},t.resolveAsScalar=function resolveAsScalar(e,t=!0,n){if(e){const _onError=(e,t,s)=>{const r="number"==typeof e?e:Array.isArray(e)?e[0]:e.offset;if(!n)throw new i.YAMLParseError([r,r+1],t,s);n(r,t,s)};switch(e.type){case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return r.resolveFlowScalar(e,t,_onError);case"block-scalar":return s.resolveBlockScalar({options:{strict:t}},e,_onError)}}return null},t.setScalarValue=function setScalarValue(e,t,n={}){let{afterKey:s=!1,implicitKey:r=!1,inFlow:i=!1,type:a}=n,l="indent"in e?e.indent:null;if(s&&"number"==typeof l&&(l+=2),!a)switch(e.type){case"single-quoted-scalar":a="QUOTE_SINGLE";break;case"double-quoted-scalar":a="QUOTE_DOUBLE";break;case"block-scalar":{const t=e.props[0];if("block-scalar-header"!==t.type)throw new Error("Invalid block scalar header");a=">"===t.source[0]?"BLOCK_FOLDED":"BLOCK_LITERAL";break}default:a="PLAIN"}const c=o.stringifyString({type:a,value:t},{implicitKey:r||null===l,indent:null!==l&&l>0?" ".repeat(l):"",inFlow:i,options:{blockQuote:!0,lineWidth:-1}});switch(c[0]){case"|":case">":!function setBlockScalarValue(e,t){const n=t.indexOf("\n"),s=t.substring(0,n),r=t.substring(n+1)+"\n";if("block-scalar"===e.type){const t=e.props[0];if("block-scalar-header"!==t.type)throw new Error("Invalid block scalar header");t.source=s,e.source=r}else{const{offset:t}=e,n="indent"in e?e.indent:-1,i=[{type:"block-scalar-header",offset:t,indent:n,source:s}];addEndtoBlockProps(i,"end"in e?e.end:void 0)||i.push({type:"newline",offset:-1,indent:n,source:"\n"});for(const t of Object.keys(e))"type"!==t&&"offset"!==t&&delete e[t];Object.assign(e,{type:"block-scalar",indent:n,props:i,source:r})}}(e,c);break;case'"':setFlowScalarValue(e,c,"double-quoted-scalar");break;case"'":setFlowScalarValue(e,c,"single-quoted-scalar");break;default:setFlowScalarValue(e,c,"scalar")}}},7808(e,t){"use strict";function stringifyToken(e){switch(e.type){case"block-scalar":{let t="";for(const n of e.props)t+=stringifyToken(n);return t+e.source}case"block-map":case"block-seq":{let t="";for(const n of e.items)t+=stringifyItem(n);return t}case"flow-collection":{let t=e.start.source;for(const n of e.items)t+=stringifyItem(n);for(const n of e.end)t+=n.source;return t}case"document":{let t=stringifyItem(e);if(e.end)for(const n of e.end)t+=n.source;return t}default:{let t=e.source;if("end"in e&&e.end)for(const n of e.end)t+=n.source;return t}}}function stringifyItem({start:e,key:t,sep:n,value:s}){let r="";for(const t of e)r+=t.source;if(t&&(r+=stringifyToken(t)),n)for(const e of n)r+=e.source;return s&&(r+=stringifyToken(s)),r}t.stringify=e=>"type"in e?stringifyToken(e):stringifyItem(e)},5970(e,t){"use strict";const n=Symbol("break visit"),s=Symbol("skip children"),r=Symbol("remove item");function visit(e,t){"type"in e&&"document"===e.type&&(e={start:e.start,value:e.value}),_visit(Object.freeze([]),e,t)}function _visit(e,t,s){let i=s(t,e);if("symbol"==typeof i)return i;for(const o of["key","value"]){const a=t[o];if(a&&"items"in a){for(let t=0;t<a.items.length;++t){const i=_visit(Object.freeze(e.concat([[o,t]])),a.items[t],s);if("number"==typeof i)t=i-1;else{if(i===n)return n;i===r&&(a.items.splice(t,1),t-=1)}}"function"==typeof i&&"key"===o&&(i=i(t,e))}}return"function"==typeof i?i(t,e):i}visit.BREAK=n,visit.SKIP=s,visit.REMOVE=r,visit.itemAtPath=(e,t)=>{let n=e;for(const[e,s]of t){const t=n?.[e];if(!t||!("items"in t))return;n=t.items[s]}return n},visit.parentCollection=(e,t)=>{const n=visit.itemAtPath(e,t.slice(0,-1)),s=t[t.length-1][0],r=n?.[s];if(r&&"items"in r)return r;throw new Error("Parent collection not found")},t.visit=visit},9112(e,t,n){"use strict";var s=n(5141),r=n(7808),i=n(5970);t.createScalarToken=s.createScalarToken,t.resolveAsScalar=s.resolveAsScalar,t.setScalarValue=s.setScalarValue,t.stringify=r.stringify,t.visit=i.visit,t.BOM="\ufeff",t.DOCUMENT="",t.FLOW_END="",t.SCALAR="",t.isCollection=e=>!!e&&"items"in e,t.isScalar=e=>!!e&&("scalar"===e.type||"single-quoted-scalar"===e.type||"double-quoted-scalar"===e.type||"block-scalar"===e.type),t.prettyToken=function prettyToken(e){switch(e){case"\ufeff":return"<BOM>";case"":return"<DOC>";case"":return"<FLOW_END>";case"":return"<SCALAR>";default:return JSON.stringify(e)}},t.tokenType=function tokenType(e){switch(e){case"\ufeff":return"byte-order-mark";case"":return"doc-mode";case"":return"flow-error-end";case"":return"scalar";case"---":return"doc-start";case"...":return"doc-end";case"":case"\n":case"\r\n":return"newline";case"-":return"seq-item-ind";case"?":return"explicit-key-ind";case":":return"map-value-ind";case"{":return"flow-map-start";case"}":return"flow-map-end";case"[":return"flow-seq-start";case"]":return"flow-seq-end";case",":return"comma"}switch(e[0]){case" ":case"\t":return"space";case"#":return"comment";case"%":return"directive-line";case"*":return"alias";case"&":return"anchor";case"!":return"tag";case"'":return"single-quoted-scalar";case'"':return"double-quoted-scalar";case"|":case">":return"block-scalar-header"}return null}},5752(e,t,n){"use strict";var s=n(9112);function isEmpty(e){switch(e){case void 0:case" ":case"\n":case"\r":case"\t":return!0;default:return!1}}const r=new Set("0123456789ABCDEFabcdef"),i=new Set("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-#;/?:@&=+$_.!~*'()"),o=new Set(",[]{}"),a=new Set(" ,[]{}\n\r\t"),isNotAnchorChar=e=>!e||a.has(e);t.Lexer=class Lexer{constructor(){this.atEnd=!1,this.blockScalarIndent=-1,this.blockScalarKeep=!1,this.buffer="",this.flowKey=!1,this.flowLevel=0,this.indentNext=0,this.indentValue=0,this.lineEndPos=null,this.next=null,this.pos=0}*lex(e,t=!1){if(e){if("string"!=typeof e)throw TypeError("source is not a string");this.buffer=this.buffer?this.buffer+e:e,this.lineEndPos=null}this.atEnd=!t;let n=this.next??"stream";for(;n&&(t||this.hasChars(1));)n=yield*this.parseNext(n)}atLineEnd(){let e=this.pos,t=this.buffer[e];for(;" "===t||"\t"===t;)t=this.buffer[++e];return!t||"#"===t||"\n"===t||"\r"===t&&"\n"===this.buffer[e+1]}charAt(e){return this.buffer[this.pos+e]}continueScalar(e){let t=this.buffer[e];if(this.indentNext>0){let n=0;for(;" "===t;)t=this.buffer[++n+e];if("\r"===t){const t=this.buffer[n+e+1];if("\n"===t||!t&&!this.atEnd)return e+n+1}return"\n"===t||n>=this.indentNext||!t&&!this.atEnd?e+n:-1}if("-"===t||"."===t){const t=this.buffer.substr(e,3);if(("---"===t||"..."===t)&&isEmpty(this.buffer[e+3]))return-1}return e}getLine(){let e=this.lineEndPos;return("number"!=typeof e||-1!==e&&e<this.pos)&&(e=this.buffer.indexOf("\n",this.pos),this.lineEndPos=e),-1===e?this.atEnd?this.buffer.substring(this.pos):null:("\r"===this.buffer[e-1]&&(e-=1),this.buffer.substring(this.pos,e))}hasChars(e){return this.pos+e<=this.buffer.length}setNext(e){return this.buffer=this.buffer.substring(this.pos),this.pos=0,this.lineEndPos=null,this.next=e,null}peek(e){return this.buffer.substr(this.pos,e)}*parseNext(e){switch(e){case"stream":return yield*this.parseStream();case"line-start":return yield*this.parseLineStart();case"block-start":return yield*this.parseBlockStart();case"doc":return yield*this.parseDocument();case"flow":return yield*this.parseFlowCollection();case"quoted-scalar":return yield*this.parseQuotedScalar();case"block-scalar":return yield*this.parseBlockScalar();case"plain-scalar":return yield*this.parsePlainScalar()}}*parseStream(){let e=this.getLine();if(null===e)return this.setNext("stream");if(e[0]===s.BOM&&(yield*this.pushCount(1),e=e.substring(1)),"%"===e[0]){let t=e.length,n=e.indexOf("#");for(;-1!==n;){const s=e[n-1];if(" "===s||"\t"===s){t=n-1;break}n=e.indexOf("#",n+1)}for(;;){const n=e[t-1];if(" "!==n&&"\t"!==n)break;t-=1}const s=(yield*this.pushCount(t))+(yield*this.pushSpaces(!0));return yield*this.pushCount(e.length-s),this.pushNewline(),"stream"}if(this.atLineEnd()){const t=yield*this.pushSpaces(!0);return yield*this.pushCount(e.length-t),yield*this.pushNewline(),"stream"}return yield s.DOCUMENT,yield*this.parseLineStart()}*parseLineStart(){const e=this.charAt(0);if(!e&&!this.atEnd)return this.setNext("line-start");if("-"===e||"."===e){if(!this.atEnd&&!this.hasChars(4))return this.setNext("line-start");const e=this.peek(3);if(("---"===e||"..."===e)&&isEmpty(this.charAt(3)))return yield*this.pushCount(3),this.indentValue=0,this.indentNext=0,"---"===e?"doc":"stream"}return this.indentValue=yield*this.pushSpaces(!1),this.indentNext>this.indentValue&&!isEmpty(this.charAt(1))&&(this.indentNext=this.indentValue),yield*this.parseBlockStart()}*parseBlockStart(){const[e,t]=this.peek(2);if(!t&&!this.atEnd)return this.setNext("block-start");if(("-"===e||"?"===e||":"===e)&&isEmpty(t)){const e=(yield*this.pushCount(1))+(yield*this.pushSpaces(!0));return this.indentNext=this.indentValue+1,this.indentValue+=e,yield*this.parseBlockStart()}return"doc"}*parseDocument(){yield*this.pushSpaces(!0);const e=this.getLine();if(null===e)return this.setNext("doc");let t=yield*this.pushIndicators();switch(e[t]){case"#":yield*this.pushCount(e.length-t);case void 0:return yield*this.pushNewline(),yield*this.parseLineStart();case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel=1,"flow";case"}":case"]":return yield*this.pushCount(1),"doc";case"*":return yield*this.pushUntil(isNotAnchorChar),"doc";case'"':case"'":return yield*this.parseQuotedScalar();case"|":case">":return t+=(yield*this.parseBlockScalarHeader()),t+=(yield*this.pushSpaces(!0)),yield*this.pushCount(e.length-t),yield*this.pushNewline(),yield*this.parseBlockScalar();default:return yield*this.parsePlainScalar()}}*parseFlowCollection(){let e,t,n=-1;do{e=yield*this.pushNewline(),e>0?(t=yield*this.pushSpaces(!1),this.indentValue=n=t):t=0,t+=(yield*this.pushSpaces(!0))}while(e+t>0);const r=this.getLine();if(null===r)return this.setNext("flow");if(-1!==n&&n<this.indentNext&&"#"!==r[0]||0===n&&(r.startsWith("---")||r.startsWith("..."))&&isEmpty(r[3])){if(!(n===this.indentNext-1&&1===this.flowLevel&&("]"===r[0]||"}"===r[0])))return this.flowLevel=0,yield s.FLOW_END,yield*this.parseLineStart()}let i=0;for(;","===r[i];)i+=(yield*this.pushCount(1)),i+=(yield*this.pushSpaces(!0)),this.flowKey=!1;switch(i+=(yield*this.pushIndicators()),r[i]){case void 0:return"flow";case"#":return yield*this.pushCount(r.length-i),"flow";case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel+=1,"flow";case"}":case"]":return yield*this.pushCount(1),this.flowKey=!0,this.flowLevel-=1,this.flowLevel?"flow":"doc";case"*":return yield*this.pushUntil(isNotAnchorChar),"flow";case'"':case"'":return this.flowKey=!0,yield*this.parseQuotedScalar();case":":{const e=this.charAt(1);if(this.flowKey||isEmpty(e)||","===e)return this.flowKey=!1,yield*this.pushCount(1),yield*this.pushSpaces(!0),"flow"}default:return this.flowKey=!1,yield*this.parsePlainScalar()}}*parseQuotedScalar(){const e=this.charAt(0);let t=this.buffer.indexOf(e,this.pos+1);if("'"===e)for(;-1!==t&&"'"===this.buffer[t+1];)t=this.buffer.indexOf("'",t+2);else for(;-1!==t;){let e=0;for(;"\\"===this.buffer[t-1-e];)e+=1;if(e%2==0)break;t=this.buffer.indexOf('"',t+1)}const n=this.buffer.substring(0,t);let s=n.indexOf("\n",this.pos);if(-1!==s){for(;-1!==s;){const e=this.continueScalar(s+1);if(-1===e)break;s=n.indexOf("\n",e)}-1!==s&&(t=s-("\r"===n[s-1]?2:1))}if(-1===t){if(!this.atEnd)return this.setNext("quoted-scalar");t=this.buffer.length}return yield*this.pushToIndex(t+1,!1),this.flowLevel?"flow":"doc"}*parseBlockScalarHeader(){this.blockScalarIndent=-1,this.blockScalarKeep=!1;let e=this.pos;for(;;){const t=this.buffer[++e];if("+"===t)this.blockScalarKeep=!0;else if(t>"0"&&t<="9")this.blockScalarIndent=Number(t)-1;else if("-"!==t)break}return yield*this.pushUntil(e=>isEmpty(e)||"#"===e)}*parseBlockScalar(){let e,t=this.pos-1,n=0;e:for(let s=this.pos;e=this.buffer[s];++s)switch(e){case" ":n+=1;break;case"\n":t=s,n=0;break;case"\r":{const e=this.buffer[s+1];if(!e&&!this.atEnd)return this.setNext("block-scalar");if("\n"===e)break}default:break e}if(!e&&!this.atEnd)return this.setNext("block-scalar");if(n>=this.indentNext){-1===this.blockScalarIndent?this.indentNext=n:this.indentNext=this.blockScalarIndent+(0===this.indentNext?1:this.indentNext);do{const e=this.continueScalar(t+1);if(-1===e)break;t=this.buffer.indexOf("\n",e)}while(-1!==t);if(-1===t){if(!this.atEnd)return this.setNext("block-scalar");t=this.buffer.length}}let r=t+1;for(e=this.buffer[r];" "===e;)e=this.buffer[++r];if("\t"===e){for(;"\t"===e||" "===e||"\r"===e||"\n"===e;)e=this.buffer[++r];t=r-1}else if(!this.blockScalarKeep)for(;;){let e=t-1,s=this.buffer[e];"\r"===s&&(s=this.buffer[--e]);const r=e;for(;" "===s;)s=this.buffer[--e];if(!("\n"===s&&e>=this.pos&&e+1+n>r))break;t=e}return yield s.SCALAR,yield*this.pushToIndex(t+1,!0),yield*this.parseLineStart()}*parsePlainScalar(){const e=this.flowLevel>0;let t,n=this.pos-1,r=this.pos-1;for(;t=this.buffer[++r];)if(":"===t){const t=this.buffer[r+1];if(isEmpty(t)||e&&o.has(t))break;n=r}else if(isEmpty(t)){let s=this.buffer[r+1];if("\r"===t&&("\n"===s?(r+=1,t="\n",s=this.buffer[r+1]):n=r),"#"===s||e&&o.has(s))break;if("\n"===t){const e=this.continueScalar(r+1);if(-1===e)break;r=Math.max(r,e-2)}}else{if(e&&o.has(t))break;n=r}return t||this.atEnd?(yield s.SCALAR,yield*this.pushToIndex(n+1,!0),e?"flow":"doc"):this.setNext("plain-scalar")}*pushCount(e){return e>0?(yield this.buffer.substr(this.pos,e),this.pos+=e,e):0}*pushToIndex(e,t){const n=this.buffer.slice(this.pos,e);return n?(yield n,this.pos+=n.length,n.length):(t&&(yield""),0)}*pushIndicators(){switch(this.charAt(0)){case"!":return(yield*this.pushTag())+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"&":return(yield*this.pushUntil(isNotAnchorChar))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"-":case"?":case":":{const e=this.flowLevel>0,t=this.charAt(1);if(isEmpty(t)||e&&o.has(t))return e?this.flowKey&&(this.flowKey=!1):this.indentNext=this.indentValue+1,(yield*this.pushCount(1))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators())}}return 0}*pushTag(){if("<"===this.charAt(1)){let e=this.pos+2,t=this.buffer[e];for(;!isEmpty(t)&&">"!==t;)t=this.buffer[++e];return yield*this.pushToIndex(">"===t?e+1:e,!1)}{let e=this.pos+1,t=this.buffer[e];for(;t;)if(i.has(t))t=this.buffer[++e];else{if("%"!==t||!r.has(this.buffer[e+1])||!r.has(this.buffer[e+2]))break;t=this.buffer[e+=3]}return yield*this.pushToIndex(e,!1)}}*pushNewline(){const e=this.buffer[this.pos];return"\n"===e?yield*this.pushCount(1):"\r"===e&&"\n"===this.charAt(1)?yield*this.pushCount(2):0}*pushSpaces(e){let t,n=this.pos-1;do{t=this.buffer[++n]}while(" "===t||e&&"\t"===t);const s=n-this.pos;return s>0&&(yield this.buffer.substr(this.pos,s),this.pos=n),s}*pushUntil(e){let t=this.pos,n=this.buffer[t];for(;!e(n);)n=this.buffer[++t];return yield*this.pushToIndex(t,!1)}}},2864(e,t){"use strict";t.LineCounter=class LineCounter{constructor(){this.lineStarts=[],this.addNewLine=e=>this.lineStarts.push(e),this.linePos=e=>{let t=0,n=this.lineStarts.length;for(;t<n;){const s=t+n>>1;this.lineStarts[s]<e?t=s+1:n=s}if(this.lineStarts[t]===e)return{line:t+1,col:1};if(0===t)return{line:0,col:e};return{line:t,col:e-this.lineStarts[t-1]+1}}}}},6247(e,t,n){"use strict";var s=n(932),r=n(9112),i=n(5752);function includesToken(e,t){for(let n=0;n<e.length;++n)if(e[n].type===t)return!0;return!1}function findNonEmptyIndex(e){for(let t=0;t<e.length;++t)switch(e[t].type){case"space":case"comment":case"newline":break;default:return t}return-1}function isFlowToken(e){switch(e?.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"flow-collection":return!0;default:return!1}}function getPrevProps(e){switch(e.type){case"document":return e.start;case"block-map":{const t=e.items[e.items.length-1];return t.sep??t.start}case"block-seq":return e.items[e.items.length-1].start;default:return[]}}function getFirstKeyStartProps(e){if(0===e.length)return[];let t=e.length;e:for(;--t>=0;)switch(e[t].type){case"doc-start":case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":case"newline":break e}for(;"space"===e[++t]?.type;);return e.splice(t,e.length)}function fixFlowSeqItems(e){if("flow-seq-start"===e.start.type)for(const t of e.items)!t.sep||t.value||includesToken(t.start,"explicit-key-ind")||includesToken(t.sep,"map-value-ind")||(t.key&&(t.value=t.key),delete t.key,isFlowToken(t.value)?t.value.end?Array.prototype.push.apply(t.value.end,t.sep):t.value.end=t.sep:Array.prototype.push.apply(t.start,t.sep),delete t.sep)}t.Parser=class Parser{constructor(e){this.atNewLine=!0,this.atScalar=!1,this.indent=0,this.offset=0,this.onKeyLine=!1,this.stack=[],this.source="",this.type="",this.lexer=new i.Lexer,this.onNewLine=e}*parse(e,t=!1){this.onNewLine&&0===this.offset&&this.onNewLine(0);for(const n of this.lexer.lex(e,t))yield*this.next(n);t||(yield*this.end())}*next(e){if(this.source=e,s.env.LOG_TOKENS&&console.log("|",r.prettyToken(e)),this.atScalar)return this.atScalar=!1,yield*this.step(),void(this.offset+=e.length);const t=r.tokenType(e);if(t)if("scalar"===t)this.atNewLine=!1,this.atScalar=!0,this.type="scalar";else{switch(this.type=t,yield*this.step(),t){case"newline":this.atNewLine=!0,this.indent=0,this.onNewLine&&this.onNewLine(this.offset+e.length);break;case"space":this.atNewLine&&" "===e[0]&&(this.indent+=e.length);break;case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":this.atNewLine&&(this.indent+=e.length);break;case"doc-mode":case"flow-error-end":return;default:this.atNewLine=!1}this.offset+=e.length}else{const t=`Not a YAML token: ${e}`;yield*this.pop({type:"error",offset:this.offset,message:t,source:e}),this.offset+=e.length}}*end(){for(;this.stack.length>0;)yield*this.pop()}get sourceToken(){return{type:this.type,offset:this.offset,indent:this.indent,source:this.source}}*step(){const e=this.peek(1);if("doc-end"!==this.type||"doc-end"===e?.type){if(!e)return yield*this.stream();switch(e.type){case"document":return yield*this.document(e);case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return yield*this.scalar(e);case"block-scalar":return yield*this.blockScalar(e);case"block-map":return yield*this.blockMap(e);case"block-seq":return yield*this.blockSequence(e);case"flow-collection":return yield*this.flowCollection(e);case"doc-end":return yield*this.documentEnd(e)}yield*this.pop()}else{for(;this.stack.length>0;)yield*this.pop();this.stack.push({type:"doc-end",offset:this.offset,source:this.source})}}peek(e){return this.stack[this.stack.length-e]}*pop(e){const t=e??this.stack.pop();if(t)if(0===this.stack.length)yield t;else{const e=this.peek(1);switch("block-scalar"===t.type?t.indent="indent"in e?e.indent:0:"flow-collection"===t.type&&"document"===e.type&&(t.indent=0),"flow-collection"===t.type&&fixFlowSeqItems(t),e.type){case"document":e.value=t;break;case"block-scalar":e.props.push(t);break;case"block-map":{const n=e.items[e.items.length-1];if(n.value)return e.items.push({start:[],key:t,sep:[]}),void(this.onKeyLine=!0);if(!n.sep)return Object.assign(n,{key:t,sep:[]}),void(this.onKeyLine=!n.explicitKey);n.value=t;break}case"block-seq":{const n=e.items[e.items.length-1];n.value?e.items.push({start:[],value:t}):n.value=t;break}case"flow-collection":{const n=e.items[e.items.length-1];return void(!n||n.value?e.items.push({start:[],key:t,sep:[]}):n.sep?n.value=t:Object.assign(n,{key:t,sep:[]}))}default:yield*this.pop(),yield*this.pop(t)}if(!("document"!==e.type&&"block-map"!==e.type&&"block-seq"!==e.type||"block-map"!==t.type&&"block-seq"!==t.type)){const n=t.items[t.items.length-1];n&&!n.sep&&!n.value&&n.start.length>0&&-1===findNonEmptyIndex(n.start)&&(0===t.indent||n.start.every(e=>"comment"!==e.type||e.indent<t.indent))&&("document"===e.type?e.end=n.start:e.items.push({start:n.start}),t.items.splice(-1,1))}}else{const e="Tried to pop an empty stack";yield{type:"error",offset:this.offset,source:"",message:e}}}*stream(){switch(this.type){case"directive-line":return void(yield{type:"directive",offset:this.offset,source:this.source});case"byte-order-mark":case"space":case"comment":case"newline":return void(yield this.sourceToken);case"doc-mode":case"doc-start":{const e={type:"document",offset:this.offset,start:[]};return"doc-start"===this.type&&e.start.push(this.sourceToken),void this.stack.push(e)}}yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML stream`,source:this.source}}*document(e){if(e.value)return yield*this.lineEnd(e);switch(this.type){case"doc-start":return void(-1!==findNonEmptyIndex(e.start)?(yield*this.pop(),yield*this.step()):e.start.push(this.sourceToken));case"anchor":case"tag":case"space":case"comment":case"newline":return void e.start.push(this.sourceToken)}const t=this.startBlockValue(e);t?this.stack.push(t):yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML document`,source:this.source}}*scalar(e){if("map-value-ind"===this.type){const t=getFirstKeyStartProps(getPrevProps(this.peek(2)));let n;e.end?(n=e.end,n.push(this.sourceToken),delete e.end):n=[this.sourceToken];const s={type:"block-map",offset:e.offset,indent:e.indent,items:[{start:t,key:e,sep:n}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=s}else yield*this.lineEnd(e)}*blockScalar(e){switch(this.type){case"space":case"comment":case"newline":return void e.props.push(this.sourceToken);case"scalar":if(e.source=this.source,this.atNewLine=!0,this.indent=0,this.onNewLine){let e=this.source.indexOf("\n")+1;for(;0!==e;)this.onNewLine(this.offset+e),e=this.source.indexOf("\n",e)+1}yield*this.pop();break;default:yield*this.pop(),yield*this.step()}}*blockMap(e){const t=e.items[e.items.length-1];switch(this.type){case"newline":if(this.onKeyLine=!1,t.value){const n="end"in t.value?t.value.end:void 0,s=Array.isArray(n)?n[n.length-1]:void 0;"comment"===s?.type?n?.push(this.sourceToken):e.items.push({start:[this.sourceToken]})}else t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"space":case"comment":if(t.value)e.items.push({start:[this.sourceToken]});else if(t.sep)t.sep.push(this.sourceToken);else{if(this.atIndentedComment(t.start,e.indent)){const n=e.items[e.items.length-2],s=n?.value?.end;if(Array.isArray(s))return Array.prototype.push.apply(s,t.start),s.push(this.sourceToken),void e.items.pop()}t.start.push(this.sourceToken)}return}if(this.indent>=e.indent){const n=!this.onKeyLine&&this.indent===e.indent,s=n&&(t.sep||t.explicitKey)&&"seq-item-ind"!==this.type;let r=[];if(s&&t.sep&&!t.value){const n=[];for(let s=0;s<t.sep.length;++s){const r=t.sep[s];switch(r.type){case"newline":n.push(s);break;case"space":break;case"comment":r.indent>e.indent&&(n.length=0);break;default:n.length=0}}n.length>=2&&(r=t.sep.splice(n[1]))}switch(this.type){case"anchor":case"tag":return void(s||t.value?(r.push(this.sourceToken),e.items.push({start:r}),this.onKeyLine=!0):t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken));case"explicit-key-ind":return t.sep||t.explicitKey?s||t.value?(r.push(this.sourceToken),e.items.push({start:r,explicitKey:!0})):this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken],explicitKey:!0}]}):(t.start.push(this.sourceToken),t.explicitKey=!0),void(this.onKeyLine=!0);case"map-value-ind":if(t.explicitKey)if(t.sep)if(t.value)e.items.push({start:[],key:null,sep:[this.sourceToken]});else if(includesToken(t.sep,"map-value-ind"))this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:r,key:null,sep:[this.sourceToken]}]});else if(isFlowToken(t.key)&&!includesToken(t.sep,"newline")){const e=getFirstKeyStartProps(t.start),n=t.key,s=t.sep;s.push(this.sourceToken),delete t.key,delete t.sep,this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:e,key:n,sep:s}]})}else r.length>0?t.sep=t.sep.concat(r,this.sourceToken):t.sep.push(this.sourceToken);else if(includesToken(t.start,"newline"))Object.assign(t,{key:null,sep:[this.sourceToken]});else{const e=getFirstKeyStartProps(t.start);this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:e,key:null,sep:[this.sourceToken]}]})}else t.sep?t.value||s?e.items.push({start:r,key:null,sep:[this.sourceToken]}):includesToken(t.sep,"map-value-ind")?this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[],key:null,sep:[this.sourceToken]}]}):t.sep.push(this.sourceToken):Object.assign(t,{key:null,sep:[this.sourceToken]});return void(this.onKeyLine=!0);case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{const n=this.flowScalar(this.type);return void(s||t.value?(e.items.push({start:r,key:n,sep:[]}),this.onKeyLine=!0):t.sep?this.stack.push(n):(Object.assign(t,{key:n,sep:[]}),this.onKeyLine=!0))}default:{const s=this.startBlockValue(e);if(s){if("block-seq"===s.type){if(!t.explicitKey&&t.sep&&!includesToken(t.sep,"newline"))return void(yield*this.pop({type:"error",offset:this.offset,message:"Unexpected block-seq-ind on same line with key",source:this.source}))}else n&&e.items.push({start:r});return void this.stack.push(s)}}}}yield*this.pop(),yield*this.step()}*blockSequence(e){const t=e.items[e.items.length-1];switch(this.type){case"newline":if(t.value){const n="end"in t.value?t.value.end:void 0,s=Array.isArray(n)?n[n.length-1]:void 0;"comment"===s?.type?n?.push(this.sourceToken):e.items.push({start:[this.sourceToken]})}else t.start.push(this.sourceToken);return;case"space":case"comment":if(t.value)e.items.push({start:[this.sourceToken]});else{if(this.atIndentedComment(t.start,e.indent)){const n=e.items[e.items.length-2],s=n?.value?.end;if(Array.isArray(s))return Array.prototype.push.apply(s,t.start),s.push(this.sourceToken),void e.items.pop()}t.start.push(this.sourceToken)}return;case"anchor":case"tag":if(t.value||this.indent<=e.indent)break;return void t.start.push(this.sourceToken);case"seq-item-ind":if(this.indent!==e.indent)break;return void(t.value||includesToken(t.start,"seq-item-ind")?e.items.push({start:[this.sourceToken]}):t.start.push(this.sourceToken))}if(this.indent>e.indent){const t=this.startBlockValue(e);if(t)return void this.stack.push(t)}yield*this.pop(),yield*this.step()}*flowCollection(e){const t=e.items[e.items.length-1];if("flow-error-end"===this.type){let e;do{yield*this.pop(),e=this.peek(1)}while("flow-collection"===e?.type)}else if(0===e.end.length){switch(this.type){case"comma":case"explicit-key-ind":return void(!t||t.sep?e.items.push({start:[this.sourceToken]}):t.start.push(this.sourceToken));case"map-value-ind":return void(!t||t.value?e.items.push({start:[],key:null,sep:[this.sourceToken]}):t.sep?t.sep.push(this.sourceToken):Object.assign(t,{key:null,sep:[this.sourceToken]}));case"space":case"comment":case"newline":case"anchor":case"tag":return void(!t||t.value?e.items.push({start:[this.sourceToken]}):t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken));case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{const n=this.flowScalar(this.type);return void(!t||t.value?e.items.push({start:[],key:n,sep:[]}):t.sep?this.stack.push(n):Object.assign(t,{key:n,sep:[]}))}case"flow-map-end":case"flow-seq-end":return void e.end.push(this.sourceToken)}const n=this.startBlockValue(e);n?this.stack.push(n):(yield*this.pop(),yield*this.step())}else{const t=this.peek(2);if("block-map"===t.type&&("map-value-ind"===this.type&&t.indent===e.indent||"newline"===this.type&&!t.items[t.items.length-1].sep))yield*this.pop(),yield*this.step();else if("map-value-ind"===this.type&&"flow-collection"!==t.type){const n=getFirstKeyStartProps(getPrevProps(t));fixFlowSeqItems(e);const s=e.end.splice(1,e.end.length);s.push(this.sourceToken);const r={type:"block-map",offset:e.offset,indent:e.indent,items:[{start:n,key:e,sep:s}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=r}else yield*this.lineEnd(e)}}flowScalar(e){if(this.onNewLine){let e=this.source.indexOf("\n")+1;for(;0!==e;)this.onNewLine(this.offset+e),e=this.source.indexOf("\n",e)+1}return{type:e,offset:this.offset,indent:this.indent,source:this.source}}startBlockValue(e){switch(this.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return this.flowScalar(this.type);case"block-scalar-header":return{type:"block-scalar",offset:this.offset,indent:this.indent,props:[this.sourceToken],source:""};case"flow-map-start":case"flow-seq-start":return{type:"flow-collection",offset:this.offset,indent:this.indent,start:this.sourceToken,items:[],end:[]};case"seq-item-ind":return{type:"block-seq",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken]}]};case"explicit-key-ind":{this.onKeyLine=!0;const t=getFirstKeyStartProps(getPrevProps(e));return t.push(this.sourceToken),{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:t,explicitKey:!0}]}}case"map-value-ind":{this.onKeyLine=!0;const t=getFirstKeyStartProps(getPrevProps(e));return{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:t,key:null,sep:[this.sourceToken]}]}}}return null}atIndentedComment(e,t){return"comment"===this.type&&(!(this.indent<=t)&&e.every(e=>"newline"===e.type||"space"===e.type))}*documentEnd(e){"doc-mode"!==this.type&&(e.end?e.end.push(this.sourceToken):e.end=[this.sourceToken],"newline"===this.type&&(yield*this.pop()))}*lineEnd(e){switch(this.type){case"comma":case"doc-start":case"doc-end":case"flow-seq-end":case"flow-map-end":case"map-value-ind":yield*this.pop(),yield*this.step();break;case"newline":this.onKeyLine=!1;default:e.end?e.end.push(this.sourceToken):e.end=[this.sourceToken],"newline"===this.type&&(yield*this.pop())}}}},1332(e,t,n){"use strict";var s=n(4927),r=n(9046),i=n(4355),o=n(7444),a=n(484),l=n(2864),c=n(6247);function parseOptions(e){const t=!1!==e.prettyErrors;return{lineCounter:e.lineCounter||t&&new l.LineCounter||null,prettyErrors:t}}function parseDocument(e,t={}){const{lineCounter:n,prettyErrors:r}=parseOptions(t),o=new c.Parser(n?.addNewLine),a=new s.Composer(t);let l=null;for(const t of a.compose(o.parse(e),!0,e.length))if(l){if("silent"!==l.options.logLevel){l.errors.push(new i.YAMLParseError(t.range.slice(0,2),"MULTIPLE_DOCS","Source contains multiple documents; please use YAML.parseAllDocuments()"));break}}else l=t;return r&&n&&(l.errors.forEach(i.prettifyError(e,n)),l.warnings.forEach(i.prettifyError(e,n))),l}t.parse=function parse(e,t,n){let s;"function"==typeof t?s=t:void 0===n&&t&&"object"==typeof t&&(n=t);const r=parseDocument(e,n);if(!r)return null;if(r.warnings.forEach(e=>o.warn(r.options.logLevel,e)),r.errors.length>0){if("silent"!==r.options.logLevel)throw r.errors[0];r.errors=[]}return r.toJS(Object.assign({reviver:s},n))},t.parseAllDocuments=function parseAllDocuments(e,t={}){const{lineCounter:n,prettyErrors:r}=parseOptions(t),o=new c.Parser(n?.addNewLine),a=new s.Composer(t),l=Array.from(a.compose(o.parse(e)));if(r&&n)for(const t of l)t.errors.forEach(i.prettifyError(e,n)),t.warnings.forEach(i.prettifyError(e,n));return l.length>0?l:Object.assign([],{empty:!0},a.streamInfo())},t.parseDocument=parseDocument,t.stringify=function stringify(e,t,n){let s=null;if("function"==typeof t||Array.isArray(t)?s=t:void 0===n&&t&&(n=t),"string"==typeof n&&(n=n.length),"number"==typeof n){const e=Math.round(n);n=e<1?void 0:e>8?{indent:8}:{indent:e}}if(void 0===e){const{keepUndefined:e}=n??t??{};if(!e)return}return a.isDocument(e)&&!s?e.toString(n):new r.Document(e,s,n).toString(n)}},625(e,t,n){"use strict";var s=n(484),r=n(3334),i=n(1919),o=n(8531),a=n(975);const sortMapEntriesByKey=(e,t)=>e.key<t.key?-1:e.key>t.key?1:0;class Schema{constructor({compat:e,customTags:t,merge:n,resolveKnownTags:l,schema:c,sortMapEntries:p,toStringDefaults:u}){this.compat=Array.isArray(e)?a.getTags(e,"compat"):e?a.getTags(null,e):null,this.name="string"==typeof c&&c||"core",this.knownTags=l?a.coreKnownTags:{},this.tags=a.getTags(t,this.name,n),this.toStringOptions=u??null,Object.defineProperty(this,s.MAP,{value:r.map}),Object.defineProperty(this,s.SCALAR,{value:o.string}),Object.defineProperty(this,s.SEQ,{value:i.seq}),this.sortMapEntries="function"==typeof p?p:!0===p?sortMapEntriesByKey:null}clone(){const e=Object.create(Schema.prototype,Object.getOwnPropertyDescriptors(this));return e.tags=this.tags.slice(),e}}t.Schema=Schema},3334(e,t,n){"use strict";var s=n(484),r=n(1755);const i={collection:"map",default:!0,nodeClass:r.YAMLMap,tag:"tag:yaml.org,2002:map",resolve:(e,t)=>(s.isMap(e)||t("Expected a mapping for this tag"),e),createNode:(e,t,n)=>r.YAMLMap.from(e,t,n)};t.map=i},6055(e,t,n){"use strict";var s=n(9714);const r={identify:e=>null==e,createNode:()=>new s.Scalar(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^(?:~|[Nn]ull|NULL)?$/,resolve:()=>new s.Scalar(null),stringify:({source:e},t)=>"string"==typeof e&&r.test.test(e)?e:t.options.nullStr};t.nullTag=r},1919(e,t,n){"use strict";var s=n(484),r=n(6010);const i={collection:"seq",default:!0,nodeClass:r.YAMLSeq,tag:"tag:yaml.org,2002:seq",resolve:(e,t)=>(s.isSeq(e)||t("Expected a sequence for this tag"),e),createNode:(e,t,n)=>r.YAMLSeq.from(e,t,n)};t.seq=i},8531(e,t,n){"use strict";var s=n(7180);const r={identify:e=>"string"==typeof e,default:!0,tag:"tag:yaml.org,2002:str",resolve:e=>e,stringify:(e,t,n,r)=>(t=Object.assign({actualString:!0},t),s.stringifyString(e,t,n,r))};t.string=r},5132(e,t,n){"use strict";var s=n(9714);const r={identify:e=>"boolean"==typeof e,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:[Tt]rue|TRUE|[Ff]alse|FALSE)$/,resolve:e=>new s.Scalar("t"===e[0]||"T"===e[0]),stringify({source:e,value:t},n){if(e&&r.test.test(e)){if(t===("t"===e[0]||"T"===e[0]))return e}return t?n.options.trueStr:n.options.falseStr}};t.boolTag=r},988(e,t,n){"use strict";var s=n(9714),r=n(3144);const i={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:e=>"nan"===e.slice(-3).toLowerCase()?NaN:"-"===e[0]?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:r.stringifyNumber},o={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:\.[0-9]+|[0-9]+(?:\.[0-9]*)?)[eE][-+]?[0-9]+$/,resolve:e=>parseFloat(e),stringify(e){const t=Number(e.value);return isFinite(t)?t.toExponential():r.stringifyNumber(e)}},a={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:\.[0-9]+|[0-9]+\.[0-9]*)$/,resolve(e){const t=new s.Scalar(parseFloat(e)),n=e.indexOf(".");return-1!==n&&"0"===e[e.length-1]&&(t.minFractionDigits=e.length-n-1),t},stringify:r.stringifyNumber};t.float=a,t.floatExp=o,t.floatNaN=i},2891(e,t,n){"use strict";var s=n(3144);const intIdentify=e=>"bigint"==typeof e||Number.isInteger(e),intResolve=(e,t,n,{intAsBigInt:s})=>s?BigInt(e):parseInt(e.substring(t),n);function intStringify(e,t,n){const{value:r}=e;return intIdentify(r)&&r>=0?n+r.toString(t):s.stringifyNumber(e)}const r={identify:e=>intIdentify(e)&&e>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^0o[0-7]+$/,resolve:(e,t,n)=>intResolve(e,2,8,n),stringify:e=>intStringify(e,8,"0o")},i={identify:intIdentify,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9]+$/,resolve:(e,t,n)=>intResolve(e,0,10,n),stringify:s.stringifyNumber},o={identify:e=>intIdentify(e)&&e>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^0x[0-9a-fA-F]+$/,resolve:(e,t,n)=>intResolve(e,2,16,n),stringify:e=>intStringify(e,16,"0x")};t.int=i,t.intHex=o,t.intOct=r},8523(e,t,n){"use strict";var s=n(3334),r=n(6055),i=n(1919),o=n(8531),a=n(5132),l=n(988),c=n(2891);const p=[s.map,i.seq,o.string,r.nullTag,a.boolTag,c.intOct,c.int,c.intHex,l.floatNaN,l.floatExp,l.float];t.schema=p},4988(e,t,n){"use strict";var s=n(9714),r=n(3334),i=n(1919);function intIdentify(e){return"bigint"==typeof e||Number.isInteger(e)}const stringifyJSON=({value:e})=>JSON.stringify(e),o=[{identify:e=>"string"==typeof e,default:!0,tag:"tag:yaml.org,2002:str",resolve:e=>e,stringify:stringifyJSON},{identify:e=>null==e,createNode:()=>new s.Scalar(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^null$/,resolve:()=>null,stringify:stringifyJSON},{identify:e=>"boolean"==typeof e,default:!0,tag:"tag:yaml.org,2002:bool",test:/^true$|^false$/,resolve:e=>"true"===e,stringify:stringifyJSON},{identify:intIdentify,default:!0,tag:"tag:yaml.org,2002:int",test:/^-?(?:0|[1-9][0-9]*)$/,resolve:(e,t,{intAsBigInt:n})=>n?BigInt(e):parseInt(e,10),stringify:({value:e})=>intIdentify(e)?e.toString():JSON.stringify(e)},{identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",test:/^-?(?:0|[1-9][0-9]*)(?:\.[0-9]*)?(?:[eE][-+]?[0-9]+)?$/,resolve:e=>parseFloat(e),stringify:stringifyJSON}],a={default:!0,tag:"",test:/^/,resolve:(e,t)=>(t(`Unresolved plain scalar ${JSON.stringify(e)}`),e)},l=[r.map,i.seq].concat(o,a);t.schema=l},975(e,t,n){"use strict";var s=n(3334),r=n(6055),i=n(1919),o=n(8531),a=n(5132),l=n(988),c=n(2891),p=n(8523),u=n(4988),f=n(8080),d=n(9637),h=n(692),m=n(8416),g=n(5822),y=n(2557),b=n(5437);const v=new Map([["core",p.schema],["failsafe",[s.map,i.seq,o.string]],["json",u.schema],["yaml11",g.schema],["yaml-1.1",g.schema]]),x={binary:f.binary,bool:a.boolTag,float:l.float,floatExp:l.floatExp,floatNaN:l.floatNaN,floatTime:b.floatTime,int:c.int,intHex:c.intHex,intOct:c.intOct,intTime:b.intTime,map:s.map,merge:d.merge,null:r.nullTag,omap:h.omap,pairs:m.pairs,seq:i.seq,set:y.set,timestamp:b.timestamp},S={"tag:yaml.org,2002:binary":f.binary,"tag:yaml.org,2002:merge":d.merge,"tag:yaml.org,2002:omap":h.omap,"tag:yaml.org,2002:pairs":m.pairs,"tag:yaml.org,2002:set":y.set,"tag:yaml.org,2002:timestamp":b.timestamp};t.coreKnownTags=S,t.getTags=function getTags(e,t,n){const s=v.get(t);if(s&&!e)return n&&!s.includes(d.merge)?s.concat(d.merge):s.slice();let r=s;if(!r){if(!Array.isArray(e)){const e=Array.from(v.keys()).filter(e=>"yaml11"!==e).map(e=>JSON.stringify(e)).join(", ");throw new Error(`Unknown schema "${t}"; use one of ${e} or define customTags array`)}r=[]}if(Array.isArray(e))for(const t of e)r=r.concat(t);else"function"==typeof e&&(r=e(r.slice()));return n&&(r=r.concat(d.merge)),r.reduce((e,t)=>{const n="string"==typeof t?x[t]:t;if(!n){const e=JSON.stringify(t),n=Object.keys(x).map(e=>JSON.stringify(e)).join(", ");throw new Error(`Unknown custom tag ${e}; use one of ${n}`)}return e.includes(n)||e.push(n),e},[])}},8080(e,t,n){"use strict";var s=n(181),r=n(9714),i=n(7180);const o={identify:e=>e instanceof Uint8Array,default:!1,tag:"tag:yaml.org,2002:binary",resolve(e,t){if("function"==typeof s.Buffer)return s.Buffer.from(e,"base64");if("function"==typeof atob){const t=atob(e.replace(/[\n\r]/g,"")),n=new Uint8Array(t.length);for(let e=0;e<t.length;++e)n[e]=t.charCodeAt(e);return n}return t("This environment does not support reading binary tags; either Buffer or atob is required"),e},stringify({comment:e,type:t,value:n},o,a,l){if(!n)return"";const c=n;let p;if("function"==typeof s.Buffer)p=c instanceof s.Buffer?c.toString("base64"):s.Buffer.from(c.buffer).toString("base64");else{if("function"!=typeof btoa)throw new Error("This environment does not support writing binary tags; either Buffer or btoa is required");{let e="";for(let t=0;t<c.length;++t)e+=String.fromCharCode(c[t]);p=btoa(e)}}if(t??(t=r.Scalar.BLOCK_LITERAL),t!==r.Scalar.QUOTE_DOUBLE){const e=Math.max(o.options.lineWidth-o.indent.length,o.options.minContentWidth),n=Math.ceil(p.length/e),s=new Array(n);for(let t=0,r=0;t<n;++t,r+=e)s[t]=p.substr(r,e);p=s.join(t===r.Scalar.BLOCK_LITERAL?"\n":" ")}return i.stringifyString({comment:e,type:t,value:p},o,a,l)}};t.binary=o},7969(e,t,n){"use strict";var s=n(9714);function boolStringify({value:e,source:t},n){return t&&(e?r:i).test.test(t)?t:e?n.options.trueStr:n.options.falseStr}const r={identify:e=>!0===e,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:Y|y|[Yy]es|YES|[Tt]rue|TRUE|[Oo]n|ON)$/,resolve:()=>new s.Scalar(!0),stringify:boolStringify},i={identify:e=>!1===e,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:N|n|[Nn]o|NO|[Ff]alse|FALSE|[Oo]ff|OFF)$/,resolve:()=>new s.Scalar(!1),stringify:boolStringify};t.falseTag=i,t.trueTag=r},7191(e,t,n){"use strict";var s=n(9714),r=n(3144);const i={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:e=>"nan"===e.slice(-3).toLowerCase()?NaN:"-"===e[0]?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:r.stringifyNumber},o={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:[0-9][0-9_]*)?(?:\.[0-9_]*)?[eE][-+]?[0-9]+$/,resolve:e=>parseFloat(e.replace(/_/g,"")),stringify(e){const t=Number(e.value);return isFinite(t)?t.toExponential():r.stringifyNumber(e)}},a={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:[0-9][0-9_]*)?\.[0-9_]*$/,resolve(e){const t=new s.Scalar(parseFloat(e.replace(/_/g,""))),n=e.indexOf(".");if(-1!==n){const s=e.substring(n+1).replace(/_/g,"");"0"===s[s.length-1]&&(t.minFractionDigits=s.length)}return t},stringify:r.stringifyNumber};t.float=a,t.floatExp=o,t.floatNaN=i},6936(e,t,n){"use strict";var s=n(3144);const intIdentify=e=>"bigint"==typeof e||Number.isInteger(e);function intResolve(e,t,n,{intAsBigInt:s}){const r=e[0];if("-"!==r&&"+"!==r||(t+=1),e=e.substring(t).replace(/_/g,""),s){switch(n){case 2:e=`0b${e}`;break;case 8:e=`0o${e}`;break;case 16:e=`0x${e}`}const t=BigInt(e);return"-"===r?BigInt(-1)*t:t}const i=parseInt(e,n);return"-"===r?-1*i:i}function intStringify(e,t,n){const{value:r}=e;if(intIdentify(r)){const e=r.toString(t);return r<0?"-"+n+e.substr(1):n+e}return s.stringifyNumber(e)}const r={identify:intIdentify,default:!0,tag:"tag:yaml.org,2002:int",format:"BIN",test:/^[-+]?0b[0-1_]+$/,resolve:(e,t,n)=>intResolve(e,2,2,n),stringify:e=>intStringify(e,2,"0b")},i={identify:intIdentify,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^[-+]?0[0-7_]+$/,resolve:(e,t,n)=>intResolve(e,1,8,n),stringify:e=>intStringify(e,8,"0")},o={identify:intIdentify,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9][0-9_]*$/,resolve:(e,t,n)=>intResolve(e,0,10,n),stringify:s.stringifyNumber},a={identify:intIdentify,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^[-+]?0x[0-9a-fA-F_]+$/,resolve:(e,t,n)=>intResolve(e,2,16,n),stringify:e=>intStringify(e,16,"0x")};t.int=o,t.intBin=r,t.intHex=a,t.intOct=i},9637(e,t,n){"use strict";var s=n(484),r=n(9714);const i="<<",o={identify:e=>e===i||"symbol"==typeof e&&e.description===i,default:"key",tag:"tag:yaml.org,2002:merge",test:/^<<$/,resolve:()=>Object.assign(new r.Scalar(Symbol(i)),{addToJSMap:addMergeToJSMap}),stringify:()=>i};function addMergeToJSMap(e,t,n){if(n=e&&s.isAlias(n)?n.resolve(e.doc):n,s.isSeq(n))for(const s of n.items)mergeValue(e,t,s);else if(Array.isArray(n))for(const s of n)mergeValue(e,t,s);else mergeValue(e,t,n)}function mergeValue(e,t,n){const r=e&&s.isAlias(n)?n.resolve(e.doc):n;if(!s.isMap(r))throw new Error("Merge sources must be maps or map aliases");const i=r.toJSON(null,e,Map);for(const[e,n]of i)t instanceof Map?t.has(e)||t.set(e,n):t instanceof Set?t.add(e):Object.prototype.hasOwnProperty.call(t,e)||Object.defineProperty(t,e,{value:n,writable:!0,enumerable:!0,configurable:!0});return t}t.addMergeToJSMap=addMergeToJSMap,t.isMergeKey=(e,t)=>(o.identify(t)||s.isScalar(t)&&(!t.type||t.type===r.Scalar.PLAIN)&&o.identify(t.value))&&e?.doc.schema.tags.some(e=>e.tag===o.tag&&e.default),t.merge=o},692(e,t,n){"use strict";var s=n(484),r=n(3732),i=n(1755),o=n(6010),a=n(8416);class YAMLOMap extends o.YAMLSeq{constructor(){super(),this.add=i.YAMLMap.prototype.add.bind(this),this.delete=i.YAMLMap.prototype.delete.bind(this),this.get=i.YAMLMap.prototype.get.bind(this),this.has=i.YAMLMap.prototype.has.bind(this),this.set=i.YAMLMap.prototype.set.bind(this),this.tag=YAMLOMap.tag}toJSON(e,t){if(!t)return super.toJSON(e);const n=new Map;t?.onCreate&&t.onCreate(n);for(const e of this.items){let i,o;if(s.isPair(e)?(i=r.toJS(e.key,"",t),o=r.toJS(e.value,i,t)):i=r.toJS(e,"",t),n.has(i))throw new Error("Ordered maps must not include duplicate keys");n.set(i,o)}return n}static from(e,t,n){const s=a.createPairs(e,t,n),r=new this;return r.items=s.items,r}}YAMLOMap.tag="tag:yaml.org,2002:omap";const l={collection:"seq",identify:e=>e instanceof Map,nodeClass:YAMLOMap,default:!1,tag:"tag:yaml.org,2002:omap",resolve(e,t){const n=a.resolvePairs(e,t),r=[];for(const{key:e}of n.items)s.isScalar(e)&&(r.includes(e.value)?t(`Ordered maps must not include duplicate keys: ${e.value}`):r.push(e.value));return Object.assign(new YAMLOMap,n)},createNode:(e,t,n)=>YAMLOMap.from(e,t,n)};t.YAMLOMap=YAMLOMap,t.omap=l},8416(e,t,n){"use strict";var s=n(484),r=n(7902),i=n(9714),o=n(6010);function resolvePairs(e,t){if(s.isSeq(e))for(let n=0;n<e.items.length;++n){let o=e.items[n];if(!s.isPair(o)){if(s.isMap(o)){o.items.length>1&&t("Each pair must have its own sequence indicator");const e=o.items[0]||new r.Pair(new i.Scalar(null));if(o.commentBefore&&(e.key.commentBefore=e.key.commentBefore?`${o.commentBefore}\n${e.key.commentBefore}`:o.commentBefore),o.comment){const t=e.value??e.key;t.comment=t.comment?`${o.comment}\n${t.comment}`:o.comment}o=e}e.items[n]=s.isPair(o)?o:new r.Pair(o)}}else t("Expected a sequence for this tag");return e}function createPairs(e,t,n){const{replacer:s}=n,i=new o.YAMLSeq(e);i.tag="tag:yaml.org,2002:pairs";let a=0;if(t&&Symbol.iterator in Object(t))for(let e of t){let o,l;if("function"==typeof s&&(e=s.call(t,String(a++),e)),Array.isArray(e)){if(2!==e.length)throw new TypeError(`Expected [key, value] tuple: ${e}`);o=e[0],l=e[1]}else if(e&&e instanceof Object){const t=Object.keys(e);if(1!==t.length)throw new TypeError(`Expected tuple with one key, not ${t.length} keys`);o=t[0],l=e[o]}else o=e;i.items.push(r.createPair(o,l,n))}return i}const a={collection:"seq",default:!1,tag:"tag:yaml.org,2002:pairs",resolve:resolvePairs,createNode:createPairs};t.createPairs=createPairs,t.pairs=a,t.resolvePairs=resolvePairs},5822(e,t,n){"use strict";var s=n(3334),r=n(6055),i=n(1919),o=n(8531),a=n(8080),l=n(7969),c=n(7191),p=n(6936),u=n(9637),f=n(692),d=n(8416),h=n(2557),m=n(5437);const g=[s.map,i.seq,o.string,r.nullTag,l.trueTag,l.falseTag,p.intBin,p.intOct,p.int,p.intHex,c.floatNaN,c.floatExp,c.float,a.binary,u.merge,f.omap,d.pairs,h.set,m.intTime,m.floatTime,m.timestamp];t.schema=g},2557(e,t,n){"use strict";var s=n(484),r=n(7902),i=n(1755);class YAMLSet extends i.YAMLMap{constructor(e){super(e),this.tag=YAMLSet.tag}add(e){let t;t=s.isPair(e)?e:e&&"object"==typeof e&&"key"in e&&"value"in e&&null===e.value?new r.Pair(e.key,null):new r.Pair(e,null);i.findPair(this.items,t.key)||this.items.push(t)}get(e,t){const n=i.findPair(this.items,e);return!t&&s.isPair(n)?s.isScalar(n.key)?n.key.value:n.key:n}set(e,t){if("boolean"!=typeof t)throw new Error("Expected boolean value for set(key, value) in a YAML set, not "+typeof t);const n=i.findPair(this.items,e);n&&!t?this.items.splice(this.items.indexOf(n),1):!n&&t&&this.items.push(new r.Pair(e))}toJSON(e,t){return super.toJSON(e,t,Set)}toString(e,t,n){if(!e)return JSON.stringify(this);if(this.hasAllNullValues(!0))return super.toString(Object.assign({},e,{allNullValues:!0}),t,n);throw new Error("Set items must all have null values")}static from(e,t,n){const{replacer:s}=n,i=new this(e);if(t&&Symbol.iterator in Object(t))for(let e of t)"function"==typeof s&&(e=s.call(t,e,e)),i.items.push(r.createPair(e,null,n));return i}}YAMLSet.tag="tag:yaml.org,2002:set";const o={collection:"map",identify:e=>e instanceof Set,nodeClass:YAMLSet,default:!1,tag:"tag:yaml.org,2002:set",createNode:(e,t,n)=>YAMLSet.from(e,t,n),resolve(e,t){if(s.isMap(e)){if(e.hasAllNullValues(!0))return Object.assign(new YAMLSet,e);t("Set items must all have null values")}else t("Expected a mapping for this tag");return e}};t.YAMLSet=YAMLSet,t.set=o},5437(e,t,n){"use strict";var s=n(3144);function parseSexagesimal(e,t){const n=e[0],s="-"===n||"+"===n?e.substring(1):e,num=e=>t?BigInt(e):Number(e),r=s.replace(/_/g,"").split(":").reduce((e,t)=>e*num(60)+num(t),num(0));return"-"===n?num(-1)*r:r}function stringifySexagesimal(e){let{value:t}=e,num=e=>e;if("bigint"==typeof t)num=e=>BigInt(e);else if(isNaN(t)||!isFinite(t))return s.stringifyNumber(e);let n="";t<0&&(n="-",t*=num(-1));const r=num(60),i=[t%r];return t<60?i.unshift(0):(t=(t-i[0])/r,i.unshift(t%r),t>=60&&(t=(t-i[0])/r,i.unshift(t))),n+i.map(e=>String(e).padStart(2,"0")).join(":").replace(/000000\d*$/,"")}const r={identify:e=>"bigint"==typeof e||Number.isInteger(e),default:!0,tag:"tag:yaml.org,2002:int",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+$/,resolve:(e,t,{intAsBigInt:n})=>parseSexagesimal(e,n),stringify:stringifySexagesimal},i={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\.[0-9_]*$/,resolve:e=>parseSexagesimal(e,!1),stringify:stringifySexagesimal},o={identify:e=>e instanceof Date,default:!0,tag:"tag:yaml.org,2002:timestamp",test:RegExp("^([0-9]{4})-([0-9]{1,2})-([0-9]{1,2})(?:(?:t|T|[ \\t]+)([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2}(\\.[0-9]+)?)(?:[ \\t]*(Z|[-+][012]?[0-9](?::[0-9]{2})?))?)?$"),resolve(e){const t=e.match(o.test);if(!t)throw new Error("!!timestamp expects a date, starting with yyyy-mm-dd");const[,n,s,r,i,a,l]=t.map(Number),c=t[7]?Number((t[7]+"00").substr(1,3)):0;let p=Date.UTC(n,s-1,r,i||0,a||0,l||0,c);const u=t[8];if(u&&"Z"!==u){let e=parseSexagesimal(u,!1);Math.abs(e)<30&&(e*=60),p-=6e4*e}return new Date(p)},stringify:({value:e})=>e?.toISOString().replace(/(T00:00:00)?\.000Z$/,"")??""};t.floatTime=i,t.intTime=r,t.timestamp=o},6170(e,t){"use strict";const n="block",s="quoted";function consumeMoreIndentedLines(e,t,n){let s=t,r=t+1,i=e[r];for(;" "===i||"\t"===i;)if(t<r+n)i=e[++t];else{do{i=e[++t]}while(i&&"\n"!==i);s=t,r=t+1,i=e[r]}return s}t.FOLD_BLOCK=n,t.FOLD_FLOW="flow",t.FOLD_QUOTED=s,t.foldFlowLines=function foldFlowLines(e,t,r="flow",{indentAtStart:i,lineWidth:o=80,minContentWidth:a=20,onFold:l,onOverflow:c}={}){if(!o||o<0)return e;o<a&&(a=0);const p=Math.max(1+a,1+o-t.length);if(e.length<=p)return e;const u=[],f={};let d,h,m=o-t.length;"number"==typeof i&&(i>o-Math.max(2,a)?u.push(0):m=o-i);let g=!1,y=-1,b=-1,v=-1;r===n&&(y=consumeMoreIndentedLines(e,y,t.length),-1!==y&&(m=y+p));for(let i;i=e[y+=1];){if(r===s&&"\\"===i){switch(b=y,e[y+1]){case"x":y+=3;break;case"u":y+=5;break;case"U":y+=9;break;default:y+=1}v=y}if("\n"===i)r===n&&(y=consumeMoreIndentedLines(e,y,t.length)),m=y+t.length+p,d=void 0;else{if(" "===i&&h&&" "!==h&&"\n"!==h&&"\t"!==h){const t=e[y+1];t&&" "!==t&&"\n"!==t&&"\t"!==t&&(d=y)}if(y>=m)if(d)u.push(d),m=d+p,d=void 0;else if(r===s){for(;" "===h||"\t"===h;)h=i,i=e[y+=1],g=!0;const t=y>v+1?y-2:b-1;if(f[t])return e;u.push(t),f[t]=!0,m=t+p,d=void 0}else g=!0}h=i}if(g&&c&&c(),0===u.length)return e;l&&l();let x=e.slice(0,u[0]);for(let n=0;n<u.length;++n){const i=u[n],o=u[n+1]||e.length;0===i?x=`\n${t}${e.slice(0,o)}`:(r===s&&f[i]&&(x+=`${e[i]}\\`),x+=`\n${t}${e.slice(i+1,o)}`)}return x}},3793(e,t,n){"use strict";var s=n(6261),r=n(484),i=n(248),o=n(7180);t.createStringifyContext=function createStringifyContext(e,t){const n=Object.assign({blockQuote:!0,commentString:i.stringifyComment,defaultKeyType:null,defaultStringType:"PLAIN",directives:null,doubleQuotedAsJSON:!1,doubleQuotedMinMultiLineLength:40,falseStr:"false",flowCollectionPadding:!0,indentSeq:!0,lineWidth:80,minContentWidth:20,nullStr:"null",simpleKeys:!1,singleQuote:null,trueStr:"true",verifyAliasOrder:!0},e.schema.toStringOptions,t);let s;switch(n.collectionStyle){case"block":s=!1;break;case"flow":s=!0;break;default:s=null}return{anchors:new Set,doc:e,flowCollectionPadding:n.flowCollectionPadding?" ":"",indent:"",indentStep:"number"==typeof n.indent?" ".repeat(n.indent):"  ",inFlow:s,options:n}},t.stringify=function stringify(e,t,n,i){if(r.isPair(e))return e.toString(t,n,i);if(r.isAlias(e)){if(t.doc.directives)return e.toString(t);if(t.resolvedAliases?.has(e))throw new TypeError("Cannot stringify circular structure without alias nodes");t.resolvedAliases?t.resolvedAliases.add(e):t.resolvedAliases=new Set([e]),e=e.resolve(t.doc)}let a;const l=r.isNode(e)?e:t.doc.createNode(e,{onTagObj:e=>a=e});a??(a=function getTagObject(e,t){if(t.tag){const n=e.filter(e=>e.tag===t.tag);if(n.length>0)return n.find(e=>e.format===t.format)??n[0]}let n,s;if(r.isScalar(t)){s=t.value;let r=e.filter(e=>e.identify?.(s));if(r.length>1){const e=r.filter(e=>e.test);e.length>0&&(r=e)}n=r.find(e=>e.format===t.format)??r.find(e=>!e.format)}else s=t,n=e.find(e=>e.nodeClass&&s instanceof e.nodeClass);if(!n)throw new Error(`Tag not resolved for ${s?.constructor?.name??(null===s?"null":typeof s)} value`);return n}(t.doc.schema.tags,l));const c=function stringifyProps(e,t,{anchors:n,doc:i}){if(!i.directives)return"";const o=[],a=(r.isScalar(e)||r.isCollection(e))&&e.anchor;a&&s.anchorIsValid(a)&&(n.add(a),o.push(`&${a}`));const l=e.tag??(t.default?null:t.tag);return l&&o.push(i.directives.tagString(l)),o.join(" ")}(l,a,t);c.length>0&&(t.indentAtStart=(t.indentAtStart??0)+c.length+1);const p="function"==typeof a.stringify?a.stringify(l,t,n,i):r.isScalar(l)?o.stringifyString(l,t,n,i):l.toString(t,n,i);return c?r.isScalar(l)||"{"===p[0]||"["===p[0]?`${c} ${p}`:`${c}\n${t.indent}${p}`:p}},81(e,t,n){"use strict";var s=n(484),r=n(3793),i=n(248);function stringifyBlockCollection({comment:e,items:t},n,{blockItemPrefix:o,flowChars:a,itemIndent:l,onChompKeep:c,onComment:p}){const{indent:u,options:{commentString:f}}=n,d=Object.assign({},n,{indent:l,type:null});let h=!1;const m=[];for(let e=0;e<t.length;++e){const a=t[e];let c=null;if(s.isNode(a))!h&&a.spaceBefore&&m.push(""),addCommentBefore(n,m,a.commentBefore,h),a.comment&&(c=a.comment);else if(s.isPair(a)){const e=s.isNode(a.key)?a.key:null;e&&(!h&&e.spaceBefore&&m.push(""),addCommentBefore(n,m,e.commentBefore,h))}h=!1;let p=r.stringify(a,d,()=>c=null,()=>h=!0);c&&(p+=i.lineComment(p,l,f(c))),h&&c&&(h=!1),m.push(o+p)}let g;if(0===m.length)g=a.start+a.end;else{g=m[0];for(let e=1;e<m.length;++e){const t=m[e];g+=t?`\n${u}${t}`:"\n"}}return e?(g+="\n"+i.indentComment(f(e),u),p&&p()):h&&c&&c(),g}function stringifyFlowCollection({items:e},t,{flowChars:n,itemIndent:o}){const{indent:a,indentStep:l,flowCollectionPadding:c,options:{commentString:p}}=t;o+=l;const u=Object.assign({},t,{indent:o,inFlow:!0,type:null});let f=!1,d=0;const h=[];for(let n=0;n<e.length;++n){const a=e[n];let l=null;if(s.isNode(a))a.spaceBefore&&h.push(""),addCommentBefore(t,h,a.commentBefore,!1),a.comment&&(l=a.comment);else if(s.isPair(a)){const e=s.isNode(a.key)?a.key:null;e&&(e.spaceBefore&&h.push(""),addCommentBefore(t,h,e.commentBefore,!1),e.comment&&(f=!0));const n=s.isNode(a.value)?a.value:null;n?(n.comment&&(l=n.comment),n.commentBefore&&(f=!0)):null==a.value&&e?.comment&&(l=e.comment)}l&&(f=!0);let c=r.stringify(a,u,()=>l=null);n<e.length-1&&(c+=","),l&&(c+=i.lineComment(c,o,p(l))),!f&&(h.length>d||c.includes("\n"))&&(f=!0),h.push(c),d=h.length}const{start:m,end:g}=n;if(0===h.length)return m+g;if(!f){const e=h.reduce((e,t)=>e+t.length+2,2);f=t.options.lineWidth>0&&e>t.options.lineWidth}if(f){let e=m;for(const t of h)e+=t?`\n${l}${a}${t}`:"\n";return`${e}\n${a}${g}`}return`${m}${c}${h.join(" ")}${c}${g}`}function addCommentBefore({indent:e,options:{commentString:t}},n,s,r){if(s&&r&&(s=s.replace(/^\n+/,"")),s){const r=i.indentComment(t(s),e);n.push(r.trimStart())}}t.stringifyCollection=function stringifyCollection(e,t,n){return(t.inFlow??e.flow?stringifyFlowCollection:stringifyBlockCollection)(e,t,n)}},248(e,t){"use strict";function indentComment(e,t){return/^\n+$/.test(e)?e.substring(1):t?e.replace(/^(?! *$)/gm,t):e}t.indentComment=indentComment,t.lineComment=(e,t,n)=>e.endsWith("\n")?indentComment(n,t):n.includes("\n")?"\n"+indentComment(n,t):(e.endsWith(" ")?"":" ")+n,t.stringifyComment=e=>e.replace(/^(?!$)(?: $)?/gm,"#")},1768(e,t,n){"use strict";var s=n(484),r=n(3793),i=n(248);t.stringifyDocument=function stringifyDocument(e,t){const n=[];let o=!0===t.directives;if(!1!==t.directives&&e.directives){const t=e.directives.toString(e);t?(n.push(t),o=!0):e.directives.docStart&&(o=!0)}o&&n.push("---");const a=r.createStringifyContext(e,t),{commentString:l}=a.options;if(e.commentBefore){1!==n.length&&n.unshift("");const t=l(e.commentBefore);n.unshift(i.indentComment(t,""))}let c=!1,p=null;if(e.contents){if(s.isNode(e.contents)){if(e.contents.spaceBefore&&o&&n.push(""),e.contents.commentBefore){const t=l(e.contents.commentBefore);n.push(i.indentComment(t,""))}a.forceBlockIndent=!!e.comment,p=e.contents.comment}const t=p?void 0:()=>c=!0;let u=r.stringify(e.contents,a,()=>p=null,t);p&&(u+=i.lineComment(u,"",l(p))),"|"!==u[0]&&">"!==u[0]||"---"!==n[n.length-1]?n.push(u):n[n.length-1]=`--- ${u}`}else n.push(r.stringify(e.contents,a));if(e.directives?.docEnd)if(e.comment){const t=l(e.comment);t.includes("\n")?(n.push("..."),n.push(i.indentComment(t,""))):n.push(`... ${t}`)}else n.push("...");else{let t=e.comment;t&&c&&(t=t.replace(/^\n+/,"")),t&&(c&&!p||""===n[n.length-1]||n.push(""),n.push(i.indentComment(l(t),"")))}return n.join("\n")+"\n"}},3144(e,t){"use strict";t.stringifyNumber=function stringifyNumber({format:e,minFractionDigits:t,tag:n,value:s}){if("bigint"==typeof s)return String(s);const r="number"==typeof s?s:Number(s);if(!isFinite(r))return isNaN(r)?".nan":r<0?"-.inf":".inf";let i=Object.is(s,-0)?"-0":JSON.stringify(s);if(!e&&t&&(!n||"tag:yaml.org,2002:float"===n)&&/^\d/.test(i)){let e=i.indexOf(".");e<0&&(e=i.length,i+=".");let n=t-(i.length-e-1);for(;n-- >0;)i+="0"}return i}},8017(e,t,n){"use strict";var s=n(484),r=n(9714),i=n(3793),o=n(248);t.stringifyPair=function stringifyPair({key:e,value:t},n,a,l){const{allNullValues:c,doc:p,indent:u,indentStep:f,options:{commentString:d,indentSeq:h,simpleKeys:m}}=n;let g=s.isNode(e)&&e.comment||null;if(m){if(g)throw new Error("With simple keys, key nodes cannot have comments");if(s.isCollection(e)||!s.isNode(e)&&"object"==typeof e){throw new Error("With simple keys, collection cannot be used as a key value")}}let y=!m&&(!e||g&&null==t&&!n.inFlow||s.isCollection(e)||(s.isScalar(e)?e.type===r.Scalar.BLOCK_FOLDED||e.type===r.Scalar.BLOCK_LITERAL:"object"==typeof e));n=Object.assign({},n,{allNullValues:!1,implicitKey:!y&&(m||!c),indent:u+f});let b,v,x,S=!1,w=!1,k=i.stringify(e,n,()=>S=!0,()=>w=!0);if(!y&&!n.inFlow&&k.length>1024){if(m)throw new Error("With simple keys, single line scalar must not span more than 1024 characters");y=!0}if(n.inFlow){if(c||null==t)return S&&a&&a(),""===k?"?":y?`? ${k}`:k}else if(c&&!m||null==t&&y)return k=`? ${k}`,g&&!S?k+=o.lineComment(k,n.indent,d(g)):w&&l&&l(),k;S&&(g=null),y?(g&&(k+=o.lineComment(k,n.indent,d(g))),k=`? ${k}\n${u}:`):(k=`${k}:`,g&&(k+=o.lineComment(k,n.indent,d(g)))),s.isNode(t)?(b=!!t.spaceBefore,v=t.commentBefore,x=t.comment):(b=!1,v=null,x=null,t&&"object"==typeof t&&(t=p.createNode(t))),n.implicitKey=!1,y||g||!s.isScalar(t)||(n.indentAtStart=k.length+1),w=!1,h||!(f.length>=2)||n.inFlow||y||!s.isSeq(t)||t.flow||t.tag||t.anchor||(n.indent=n.indent.substring(2));let E=!1;const A=i.stringify(t,n,()=>E=!0,()=>w=!0);let C=" ";if(g||b||v){if(C=b?"\n":"",v){const e=d(v);C+=`\n${o.indentComment(e,n.indent)}`}""!==A||n.inFlow?C+=`\n${n.indent}`:"\n"===C&&x&&(C="\n\n")}else if(!y&&s.isCollection(t)){const e=A[0],s=A.indexOf("\n"),r=-1!==s,i=n.inFlow??t.flow??0===t.items.length;if(r||!i){let t=!1;if(r&&("&"===e||"!"===e)){let n=A.indexOf(" ");"&"===e&&-1!==n&&n<s&&"!"===A[n+1]&&(n=A.indexOf(" ",n+1)),(-1===n||s<n)&&(t=!0)}t||(C=`\n${n.indent}`)}}else""!==A&&"\n"!==A[0]||(C="");return k+=C+A,n.inFlow?E&&a&&a():x&&!E?k+=o.lineComment(k,n.indent,d(x)):w&&l&&l(),k}},7180(e,t,n){"use strict";var s=n(9714),r=n(6170);const getFoldOptions=(e,t)=>({indentAtStart:t?e.indent.length:e.indentAtStart,lineWidth:e.options.lineWidth,minContentWidth:e.options.minContentWidth}),containsDocumentMarker=e=>/^(%|---|\.\.\.)/m.test(e);function doubleQuotedString(e,t){const n=JSON.stringify(e);if(t.options.doubleQuotedAsJSON)return n;const{implicitKey:s}=t,i=t.options.doubleQuotedMinMultiLineLength,o=t.indent||(containsDocumentMarker(e)?"  ":"");let a="",l=0;for(let e=0,t=n[e];t;t=n[++e])if(" "===t&&"\\"===n[e+1]&&"n"===n[e+2]&&(a+=n.slice(l,e)+"\\ ",e+=1,l=e,t="\\"),"\\"===t)switch(n[e+1]){case"u":{a+=n.slice(l,e);const t=n.substr(e+2,4);switch(t){case"0000":a+="\\0";break;case"0007":a+="\\a";break;case"000b":a+="\\v";break;case"001b":a+="\\e";break;case"0085":a+="\\N";break;case"00a0":a+="\\_";break;case"2028":a+="\\L";break;case"2029":a+="\\P";break;default:"00"===t.substr(0,2)?a+="\\x"+t.substr(2):a+=n.substr(e,6)}e+=5,l=e+1}break;case"n":if(s||'"'===n[e+2]||n.length<i)e+=1;else{for(a+=n.slice(l,e)+"\n\n";"\\"===n[e+2]&&"n"===n[e+3]&&'"'!==n[e+4];)a+="\n",e+=2;a+=o," "===n[e+2]&&(a+="\\"),e+=1,l=e+1}break;default:e+=1}return a=l?a+n.slice(l):n,s?a:r.foldFlowLines(a,o,r.FOLD_QUOTED,getFoldOptions(t,!1))}function singleQuotedString(e,t){if(!1===t.options.singleQuote||t.implicitKey&&e.includes("\n")||/[ \t]\n|\n[ \t]/.test(e))return doubleQuotedString(e,t);const n=t.indent||(containsDocumentMarker(e)?"  ":""),s="'"+e.replace(/'/g,"''").replace(/\n+/g,`$&\n${n}`)+"'";return t.implicitKey?s:r.foldFlowLines(s,n,r.FOLD_FLOW,getFoldOptions(t,!1))}function quotedString(e,t){const{singleQuote:n}=t.options;let s;if(!1===n)s=doubleQuotedString;else{const t=e.includes('"'),r=e.includes("'");s=t&&!r?singleQuotedString:r&&!t?doubleQuotedString:n?singleQuotedString:doubleQuotedString}return s(e,t)}let i;try{i=new RegExp("(^|(?<!\n))\n+(?!\n|$)","g")}catch{i=/\n+(?!\n|$)/g}function blockString({comment:e,type:t,value:n},o,a,l){const{blockQuote:c,commentString:p,lineWidth:u}=o.options;if(!c||/\n[\t ]+$/.test(n))return quotedString(n,o);const f=o.indent||(o.forceBlockIndent||containsDocumentMarker(n)?"  ":""),d="literal"===c||"folded"!==c&&t!==s.Scalar.BLOCK_FOLDED&&(t===s.Scalar.BLOCK_LITERAL||!function lineLengthOverLimit(e,t,n){if(!t||t<0)return!1;const s=t-n,r=e.length;if(r<=s)return!1;for(let t=0,n=0;t<r;++t)if("\n"===e[t]){if(t-n>s)return!0;if(n=t+1,r-n<=s)return!1}return!0}(n,u,f.length));if(!n)return d?"|\n":">\n";let h,m;for(m=n.length;m>0;--m){const e=n[m-1];if("\n"!==e&&"\t"!==e&&" "!==e)break}let g=n.substring(m);const y=g.indexOf("\n");-1===y?h="-":n===g||y!==g.length-1?(h="+",l&&l()):h="",g&&(n=n.slice(0,-g.length),"\n"===g[g.length-1]&&(g=g.slice(0,-1)),g=g.replace(i,`$&${f}`));let b,v=!1,x=-1;for(b=0;b<n.length;++b){const e=n[b];if(" "===e)v=!0;else{if("\n"!==e)break;x=b}}let S=n.substring(0,x<b?x+1:b);S&&(n=n.substring(S.length),S=S.replace(/\n+/g,`$&${f}`));let w=(v?f?"2":"1":"")+h;if(e&&(w+=" "+p(e.replace(/ ?[\r\n]+/g," ")),a&&a()),!d){const e=n.replace(/\n+/g,"\n$&").replace(/(?:^|\n)([\t ].*)(?:([\n\t ]*)\n(?![\n\t ]))?/g,"$1$2").replace(/\n+/g,`$&${f}`);let i=!1;const a=getFoldOptions(o,!0);"folded"!==c&&t!==s.Scalar.BLOCK_FOLDED&&(a.onOverflow=()=>{i=!0});const l=r.foldFlowLines(`${S}${e}${g}`,f,r.FOLD_BLOCK,a);if(!i)return`>${w}\n${f}${l}`}return`|${w}\n${f}${S}${n=n.replace(/\n+/g,`$&${f}`)}${g}`}t.stringifyString=function stringifyString(e,t,n,i){const{implicitKey:o,inFlow:a}=t,l="string"==typeof e.value?e:Object.assign({},e,{value:String(e.value)});let{type:c}=e;c!==s.Scalar.QUOTE_DOUBLE&&/[\x00-\x08\x0b-\x1f\x7f-\x9f\u{D800}-\u{DFFF}]/u.test(l.value)&&(c=s.Scalar.QUOTE_DOUBLE);const _stringify=e=>{switch(e){case s.Scalar.BLOCK_FOLDED:case s.Scalar.BLOCK_LITERAL:return o||a?quotedString(l.value,t):blockString(l,t,n,i);case s.Scalar.QUOTE_DOUBLE:return doubleQuotedString(l.value,t);case s.Scalar.QUOTE_SINGLE:return singleQuotedString(l.value,t);case s.Scalar.PLAIN:return function plainString(e,t,n,i){const{type:o,value:a}=e,{actualString:l,implicitKey:c,indent:p,indentStep:u,inFlow:f}=t;if(c&&a.includes("\n")||f&&/[[\]{},]/.test(a))return quotedString(a,t);if(/^[\n\t ,[\]{}#&*!|>'"%@`]|^[?-]$|^[?-][ \t]|[\n:][ \t]|[ \t]\n|[\n\t ]#|[\n\t :]$/.test(a))return c||f||!a.includes("\n")?quotedString(a,t):blockString(e,t,n,i);if(!c&&!f&&o!==s.Scalar.PLAIN&&a.includes("\n"))return blockString(e,t,n,i);if(containsDocumentMarker(a)){if(""===p)return t.forceBlockIndent=!0,blockString(e,t,n,i);if(c&&p===u)return quotedString(a,t)}const d=a.replace(/\n+/g,`$&\n${p}`);if(l){const test=e=>e.default&&"tag:yaml.org,2002:str"!==e.tag&&e.test?.test(d),{compat:e,tags:n}=t.doc.schema;if(n.some(test)||e?.some(test))return quotedString(a,t)}return c?d:r.foldFlowLines(d,p,r.FOLD_FLOW,getFoldOptions(t,!1))}(l,t,n,i);default:return null}};let p=_stringify(c);if(null===p){const{defaultKeyType:e,defaultStringType:n}=t.options,s=o&&e||n;if(p=_stringify(s),null===p)throw new Error(`Unsupported default string type ${s}`)}return p}},9125(e,t,n){"use strict";var s=n(484);const r=Symbol("break visit"),i=Symbol("skip children"),o=Symbol("remove node");function visit(e,t){const n=initVisitor(t);if(s.isDocument(e)){visit_(null,e.contents,n,Object.freeze([e]))===o&&(e.contents=null)}else visit_(null,e,n,Object.freeze([]))}function visit_(e,t,n,i){const a=callVisitor(e,t,n,i);if(s.isNode(a)||s.isPair(a))return replaceNode(e,i,a),visit_(e,a,n,i);if("symbol"!=typeof a)if(s.isCollection(t)){i=Object.freeze(i.concat(t));for(let e=0;e<t.items.length;++e){const s=visit_(e,t.items[e],n,i);if("number"==typeof s)e=s-1;else{if(s===r)return r;s===o&&(t.items.splice(e,1),e-=1)}}}else if(s.isPair(t)){i=Object.freeze(i.concat(t));const e=visit_("key",t.key,n,i);if(e===r)return r;e===o&&(t.key=null);const s=visit_("value",t.value,n,i);if(s===r)return r;s===o&&(t.value=null)}return a}async function visitAsync(e,t){const n=initVisitor(t);if(s.isDocument(e)){await visitAsync_(null,e.contents,n,Object.freeze([e]))===o&&(e.contents=null)}else await visitAsync_(null,e,n,Object.freeze([]))}async function visitAsync_(e,t,n,i){const a=await callVisitor(e,t,n,i);if(s.isNode(a)||s.isPair(a))return replaceNode(e,i,a),visitAsync_(e,a,n,i);if("symbol"!=typeof a)if(s.isCollection(t)){i=Object.freeze(i.concat(t));for(let e=0;e<t.items.length;++e){const s=await visitAsync_(e,t.items[e],n,i);if("number"==typeof s)e=s-1;else{if(s===r)return r;s===o&&(t.items.splice(e,1),e-=1)}}}else if(s.isPair(t)){i=Object.freeze(i.concat(t));const e=await visitAsync_("key",t.key,n,i);if(e===r)return r;e===o&&(t.key=null);const s=await visitAsync_("value",t.value,n,i);if(s===r)return r;s===o&&(t.value=null)}return a}function initVisitor(e){return"object"==typeof e&&(e.Collection||e.Node||e.Value)?Object.assign({Alias:e.Node,Map:e.Node,Scalar:e.Node,Seq:e.Node},e.Value&&{Map:e.Value,Scalar:e.Value,Seq:e.Value},e.Collection&&{Map:e.Collection,Seq:e.Collection},e):e}function callVisitor(e,t,n,r){return"function"==typeof n?n(e,t,r):s.isMap(t)?n.Map?.(e,t,r):s.isSeq(t)?n.Seq?.(e,t,r):s.isPair(t)?n.Pair?.(e,t,r):s.isScalar(t)?n.Scalar?.(e,t,r):s.isAlias(t)?n.Alias?.(e,t,r):void 0}function replaceNode(e,t,n){const r=t[t.length-1];if(s.isCollection(r))r.items[e]=n;else if(s.isPair(r))"key"===e?r.key=n:r.value=n;else{if(!s.isDocument(r)){const e=s.isAlias(r)?"alias":"scalar";throw new Error(`Cannot replace node with ${e} parent`)}r.contents=n}}visit.BREAK=r,visit.SKIP=i,visit.REMOVE=o,visitAsync.BREAK=r,visitAsync.SKIP=i,visitAsync.REMOVE=o,t.visit=visit,t.visitAsync=visitAsync},4339(e,t,n){e=n.nmd(e);const s=n(9896),r=n(857),i=n(6928),o=n(1198),a=n(132),l=n(948),{analyzeTemplateHints:c}=n(652),p="6d15af64-176c-496d-b583-fd2ae21d4df4@1",u=Object.freeze({script:"CmdLine@2",bash:"Bash@3",pwsh:"PowerShell@2",powershell:"PowerShell@2",checkout:p});class AzurePipelineParser{constructor(e={}){this.expressionCache=new Map,this.globQuotePattern=/[\*\?\[\]]|\/[\*\?\[]|[*/]\/|\/[*/]/,this.skipSyntax=e.skipSyntax||!1}expandPipelineFromFile(e,t={}){const n=s.readFileSync(e,"utf8"),r={...t,fileName:e,baseDir:i.dirname(e),templateStack:[e]};return this.expandPipelineFromString(n,r)}expandPipelineFromString(e,t={}){const{yaml:n}=this.expandPipeline(e,t);return n}expandPipeline(e,t={}){const n=void 0!==t.skipSyntax?t.skipSyntax:this.skipSyntax,{yamlDoc:s,jsonDoc:r}=this.parseYamlDocument(e,void 0,n),i=this.buildExecutionContext(r,t);i.errors=[],i.sourceLines=e.split("\n"),i.sourceText=e;const{quoteStyles:a,save:l}=this.captureQuoteStyles(s.contents,[]);i.quoteResult={quoteStyles:a,save:l},i.quoteResult.stringsWithExpressions=new Set,i.quoteResult.fullParameterExpressions=new Set,i.azureCompatible=t.azureCompatible||!1,i.templateQuoteStyles=new Map;const c=this.expandNode(r,i);if(i.errors.length>0){const e=[],t=new Set;for(const n of i.errors)t.has(n.message)||(e.push(n.message),t.add(n.message));const n=e.join("\n\n");throw new Error(n)}this.convertVariablesToArrayFormat(c,i);const p=o.parseDocument(o.stringify(c));this.restoreQuoteStyles(p.contents,[],i),console.log(`Azure Compatibility mode: ${i.azureCompatible}`),this.applyBlockScalarStyles(p.contents,i);let u=p.toString({lineWidth:0,indent:2,defaultStringType:"PLAIN",defaultKeyType:"PLAIN",simpleKeys:!1,aliasDuplicateObjects:!1});return u=u.replace(/^(\s*(?:-\s+)?[^":\n]+:\s*)["'](\d+(?:\.\d+)?)["']/gm,(e,t,n)=>t.includes('"')?e:t+n),u=u.replace(/(['\"]?)__(TRUE|FALSE)__\1/g,(e,t,n)=>{const s="TRUE"===n?"True":"False";return t?`${t}${s}${t}`:s}),i.azureCompatible?(u=u.replace(/^(\S.+)\n\n(\s*-\s)/gm,"$1\n$2"),u=u.replace(/^(\S.+)\n\n(\s*\w+:)/gm,"$1\n$2"),u.endsWith("\n\n\n")||(u=u.replace(/\n*$/,"\n\n\n"))):u=u.replace(/\n*$/,"\n"),i.azureCompatible&&(u=this.addHeredocListSpacing(u)),{document:c,yaml:u,context:i}}convertVariablesToArrayFormat(e,t){if(!e.variables||"object"!=typeof e.variables||Array.isArray(e.variables))return;const n=new Map,s=this.getQuoteStylesMap(t);Object.entries(e.variables).forEach(([e,t])=>{if("string"==typeof t){const r=this.getQuoteStyleUniqueKey(["variables",e],t),i=s.get(r);i&&n.set(e,{value:t,quoteStyle:i})}}),e.variables=Object.entries(e.variables).map(([e,t])=>({name:e,value:t})),0!==n.size&&e.variables.forEach((e,t)=>{const r=n.get(e.name);if(r&&r.value===e.value){const n=this.getQuoteStyleUniqueKey(["variables",t,"value"],e.value);s.set(n,r.quoteStyle)}})}extractQuoteStyles(e,t,n){const s=this.buildQuoteHandler(this.setQuoteStyle.bind(this),{});this.traverseQuoteStyleNodes(e,t,s,n)}captureQuoteStyles(e,t){const n=new Map;try{this.extractQuoteStyles(e,t,n)}catch(e){}return{quoteStyles:n,save:(e,t)=>{const s=new Map(n);if(t&&t.templateQuoteStyles)for(const[,e]of t.templateQuoteStyles.entries())for(const[t,n]of e.entries())s.has(t)||s.set(t,n);return e.__quoteStyles=s,s}}}validateYamlSyntaxHints(e,t){const n=c(e);if(n.length){const e=`\n  ${n.join("\n  ")}`;throw new Error(t?`Template '${t}' potential issues:${e}`:`Potential template issues:${e}`)}}parseYamlDocument(e,t,n=!1,s=void 0,r=null){if(!n)try{this.validateYamlSyntaxHints(e,t)}catch(e){const t=e&&e.message?e.message:String(e);throw new Error(this.formatErrorWithStack(t,s,r))}try{let t;try{if(t=o.parseAllDocuments(e).find(e=>null!==e.contents&&void 0!==e.contents),!t)throw new Error("Empty YAML document")}catch(n){t=o.parseDocument(e)}const n=t.toJSON()||{};return{yamlDoc:t,jsonDoc:n}}catch(e){const n=t?`Failed to parse template '${t}': ${e.message}`:`Failed to parse YAML: ${e.message}`;throw new Error(this.formatErrorWithStack(n,s,r))}}restoreQuoteStyles(e,t,n={}){const s=this.getQuoteStylesMap(n),r=this.buildQuoteHandler(this.getQuoteStyle.bind(this),{post:(e,t,s)=>{if(!this.isStringNodeValue(t))return;const r=t.value,i=this.hasFullParameterExpression(r,s,n);""===r?t.type="QUOTE_DOUBLE"!==e||i?"QUOTE_SINGLE":"QUOTE_DOUBLE":i?this.hasColon(r)||this.isConditionExpression(r)||(this.isGlobPattern(r)||this.isKeyValueLike(r))&&(t.type="QUOTE_SINGLE"):this.hadMixedExpression(r,s,n)||this.hasRuntimeVariable(r)?t.type="PLAIN":this.isKeyValueLike(r)?t.type="QUOTE_SINGLE":e&&(t.type=e)}});this.traverseQuoteStyleNodes(e,t,r,s)}getQuoteStyleUniqueKey(e,t){return`${e.filter(e=>!this.hasTemplateExpr(e)).join(".")}:${t}`}setQuoteStyle(e,t,n,s){const r=n.type;if("QUOTE_SINGLE"!==r&&"QUOTE_DOUBLE"!==r)return;if("string"!=typeof n.value)return;const i=this.getQuoteStyleUniqueKey(e,n.value);s.set(i,r)}getQuoteStyle(e,t,n,s){if(!s)return;const r=t&&t.value?t.value:void 0,i=this.isStringNodeValue(n)?n.value:void 0;if(void 0!==r&&void 0!==i){const t=this.getQuoteStyleUniqueKey(e,i);return s.get(t)}}traverseQuoteStyleNodes(e,t,n,s=new Map){if(e)if(e.items&&"YAMLMap"===e.constructor.name)for(const r of e.items){const e=r.key;if(e&&e.value){t.push(e.value);try{n(r,t,s)}catch(e){}r.value&&this.traverseQuoteStyleNodes(r.value,t,n,s),t.pop()}}else if(e.items&&"YAMLSeq"===e.constructor.name)for(let r=0;r<e.items.length;r+=1)t.push(r),this.traverseQuoteStyleNodes(e.items[r],t,n,s),t.pop()}buildQuoteHandler(e,t={}){const{post:n=null}=t;return(t,s,r)=>{const i=t.key,o=t.value;if(!this.isStringNodeValue(i)||!this.isStringNodeValue(o))return;const a=e(s,i,o,r);if("function"==typeof n)try{n(a,o,s)}catch(e){}}}applyBlockScalarStyles(e,t={}){if(e)if(e.items&&"YAMLMap"===e.constructor.name)for(const n of e.items){if(!n.key?.value||!n.value)continue;const{value:e}=n;if(!this.isMultilineString(e.value)){this.applyBlockScalarStyles(e,t);continue}let s=e.value;const r=t.azureCompatible&&this.hasTrailingSpaces(s);if(r||"QUOTE_DOUBLE"===e.type){r&&(e.type="QUOTE_DOUBLE"),this.applyBlockScalarStyles(e,t);continue}const i=s.replace(/\s+$/,""),o=t.scriptsWithExpressions?.has(i);e.type=o&&t.azureCompatible?"BLOCK_FOLDED":"BLOCK_LITERAL",e.value=this.normalizeTrailingNewlines(s,t.azureCompatible),this.applyBlockScalarStyles(e,t)}else if(e.items&&"YAMLSeq"===e.constructor.name)for(const n of e.items)this.applyBlockScalarStyles(n,t)}buildExecutionContext(e,t){const{parameters:n,parameterMap:s}=this.extractParameters(e),r=this.extractVariables(e),o=this.normalizeResourcesConfig(e&&"object"==typeof e?e.resources:void 0),a=t.parameters||{},l=t.variables||{},c=this.normalizeResourcesConfig(t.resources),p=t.locals||{},u=t.baseDir||(t.fileName?i.dirname(t.fileName):process.cwd()),f=void 0!==t.repoBaseDir?t.repoBaseDir:u,d=void 0!==t.rootRepoBaseDir?t.rootRepoBaseDir:f,h=this.mergeResourcesConfig(o,c),m=t.resourceLocations||{},g=void 0!==t.skipSyntax?t.skipSyntax:this.skipSyntax,y=t.fileName||t.rootTemplate||"pipeline",b=t.fileScopes||{};return b[y]||(b[y]={...r,...l}),{parameters:{...n,...a},parameterMap:{...s},variables:{...r,...l},globalVariables:{...r,...l},stageVariables:{},jobVariables:{},resources:h,locals:{...p},baseDir:u,repoBaseDir:f,rootRepoBaseDir:d,resourceLocations:m,templateStack:t.templateStack||[],rootTemplate:t.rootTemplate||t.fileName||(Array.isArray(t.templateStack)?t.templateStack[0]:void 0),expansionPath:[],scriptsWithExpressions:new Set,scriptsWithLastLineExpressions:new Set,stringsWithExpressions:new Set,stageIndex:-1,jobIndex:-1,stepIndex:-1,skipSyntax:g,currentFile:y,fileScopes:b}}normalizeResourcesConfig(e){if(!e||"object"!=typeof e)return{};const t=Object.keys(e).reduce((t,n)=>("repositories"===n||(t[n]=this.deepClone(e[n])),t),{});return void 0!==e.repositories&&(t.repositories=this.normalizeRepositoryList(e.repositories)),t}mergeResourcesConfig(e={},t={}){const n={};return Object.entries(e||{}).forEach(([e,t])=>{"repositories"!==e&&(n[e]=this.deepClone(t))}),n.repositories=this.mergeRepositoryConfigs(e?.repositories,t?.repositories),Object.entries(t||{}).forEach(([e,t])=>{"repositories"!==e&&(n[e]=this.deepClone(t))}),n}normalizeRepositoryList(e){if(!e)return[];const t=[];if(Array.isArray(e))for(const n of e)n&&"object"==typeof n&&t.push(this.deepClone(n));else if("object"==typeof e)for(const[n,s]of Object.entries(e)){if(!s||"object"!=typeof s)continue;const e=this.deepClone(s);!e.repository&&n&&(e.repository=n),t.push(e)}return this.attachRepositoryAliases(t)}mergeRepositoryConfigs(e,t){const n=this.normalizeRepositoryList(e),s=this.normalizeRepositoryList(t);if(!s.length)return n;const r=[],i=new Map,addEntry=(e,t)=>{if(!e||"object"!=typeof e)return;const n=this.deepClone(e),s=n.__match&&"object"==typeof n.__match?n.__match:void 0;s&&delete n.__match;const o=this.getRepositoryAlias(n),a=o&&!this.isNumericString(o)?o:`__index_${r.length}`;n.repository||!o||this.isNumericString(o)||(n.repository=o);const l=i.get(a);"override"===t&&l&&s&&!this.repositoryMatchesCriteria(l,s)||("override"===t&&n.location&&l&&!l.location&&(l.location=n.location),l?i.set(a,{...l,...n}):(i.set(a,n),r.push(a)))};n.forEach(e=>addEntry(e,"base")),s.forEach(e=>addEntry(e,"override"));const o=r.map(e=>this.deepClone(i.get(e)));return this.attachRepositoryAliases(o)}attachRepositoryAliases(e){if(!Array.isArray(e))return e;const t=new Set;return e.forEach(n=>{const s=this.getRepositoryAlias(n);!s||this.isNumericString(s)||t.has(s)||(Object.defineProperty(e,s,{value:n,writable:!0,enumerable:!0,configurable:!0}),t.add(s))}),e}getRepositoryAlias(e){if(e&&"object"==typeof e)return"string"==typeof e.repository&&e.repository.length?e.repository:"string"==typeof e.alias&&e.alias.length?e.alias:"string"==typeof e.name&&e.name.length?e.name:void 0}repositoryMatchesCriteria(e,t={}){if(!e||"object"!=typeof e)return!1;for(const[n,s]of Object.entries(t))if(null!=s&&""!==s){if(!Object.prototype.hasOwnProperty.call(e,n))return!1;if(e[n]!==s)return!1}return!0}deepClone(e){return null==e||"object"!=typeof e?e:JSON.parse(JSON.stringify(e))}isNumericString(e){return"string"==typeof e&&/^\d+$/.test(e)}extractParameters(e){const t={parameters:{},parameterMap:{}};if(!e||"object"!=typeof e)return t;const{parameters:n}=e;if(!n)return t;if(Array.isArray(n)){for(const e of n)if(e&&"object"==typeof e&&e.name){const s=e.default;t.parameters[e.name]=void 0!==s?s:null,t.parameterMap[`parameters.${e.name}`]=`parameters.${n.indexOf(e)}.default`}}else if("object"==typeof n)for(const[e,s]of Object.entries(n)){if(s&&"object"==typeof s){const n=s.default;t.parameters[e]=void 0!==n?n:null}else t.parameters[e]=s;t.parameterMap[`parameters.${e}`]=`parameters.${e}`}return t}validateTemplateParameters(e,t,n,s){if(!e||"object"!=typeof e||!e.parameters)return;const r={missingRequired:[],invalidValues:[],typeErrors:[],unknownParameters:[]},checkParameter=(e,n)=>this.validateParameter(e,n,t,r);if(Array.isArray(e.parameters))for(const t of e.parameters)checkParameter(t);else if("object"==typeof e.parameters)for(const[t,n]of Object.entries(e.parameters))checkParameter(n,t);this.checkUnknownParameters(e.parameters,t,r),this.reportValidationErrors(r,n,s)}validateParameter(e,t,n,s){if(!e||"object"!=typeof e)return;const r=t||e.name;if(!r)return;const i=void 0!==e.default||void 0!==e.value||void 0!==e.values,o=n&&Object.prototype.hasOwnProperty.call(n,r),a=o?n[r]:void 0;i||o||s.missingRequired.push(r);const l="string"==typeof a&&/\$\([^)]+\)/.test(a);if(o&&void 0!==e.type&&void 0!==a&&!l){const t=this.validateParameterType(r,e.type,a);t&&s.typeErrors.push(t)}o&&e.values&&Array.isArray(e.values)&&(l||e.values.includes(a)||s.invalidValues.push({name:r,value:a,allowed:e.values}))}validateParameterType(e,t,n){const s=String(t).toLowerCase(),r=typeof n;switch(s){case"string":if(!["string","number","boolean"].includes(r))return{name:e,expected:"string",actual:r,value:n};break;case"number":if("number"!==r&&("string"!==r||isNaN(n)))return{name:e,expected:"number",actual:r,value:n};break;case"boolean":if("boolean"!==r){if("string"!==r)return{name:e,expected:"boolean",actual:r,value:n};{const t=n.toLowerCase();if(!["true","false","__true__","__false__"].includes(t))return{name:e,expected:"boolean",actual:r,value:n}}}break;case"object":if("dependsOn"===e){if("string"!==r&&("object"!==r||null===n))return{name:e,expected:"object",actual:r,value:n}}else if("object"!==r||null===n)return{name:e,expected:"object",actual:r,value:n};break;case"step":case"steplist":case"job":case"joblist":case"deployment":case"deploymentlist":case"stage":case"stagelist":if(!Array.isArray(n))return{name:e,expected:"array ("+s+")",actual:r,value:n}}return null}checkUnknownParameters(e,t,n){if(!t||"object"!=typeof t)return;const s=new Set;Array.isArray(e)?e.forEach(e=>e?.name&&s.add(e.name)):"object"==typeof e&&Object.keys(e).forEach(e=>s.add(e)),Object.keys(t).forEach(e=>{""===e||s.has(e)||n.unknownParameters.push(e)})}getTemplateCallStack(e,t){const n=Array.isArray(e?.templateStack)?[...e.templateStack]:[];if(e?.rootTemplate&&(0!==n.length&&n[0]===e.rootTemplate||n.unshift(e.rootTemplate)),0===n.length)return"";const s=[];s.push("Template call stack:");let r=null;if(n.length>1){const e=n[1].match(/:(\d+)(?=\s|$|\()/);e&&(r=e[1])}else t&&(r=t);const i=r?`${n[0]}:${r}`:n[0];s.push("  "+i);for(let e=1;e<n.length;e++){let r=n[e];if(e===n.length-1&&t)r=r.includes(":")?r.replace(/:(\d+)(?=\s|$|\()/,`:${t}`):r.replace(/(@[^:\s\(]+)(?=\s|$|\()/,`$1:${t}`).replace(/(\.ya?ml)(?=\s|$|\()/,`$1:${t}`);else if(e<n.length-1){const t=n[e+1].match(/:(\d+)(?=\s|$|\()/);if(t){const e=t[1];r=r.includes(":")?r.replace(/:(\d+)(?=\s|$|\()/,`:${e}`):r.replace(/(@[^:\s\(]+)(?=\s|$|\()/,`$1:${e}`).replace(/(\.ya?ml)(?=\s|$|\()/,`$1:${e}`)}}s.push("  "+"  ".repeat(e)+"â””â”€â”€ "+r)}return"\n"+s.join("\n")}formatErrorWithStack(e,t,n=null){try{if(e.includes("Template call stack:"))return e;const s=this.getTemplateCallStack(t,n||void 0);return s?`${e}${s}`:e}catch(t){return e}}reportValidationErrors(e,t,n){const s=[],r=t||"template";if(e.missingRequired.length>0){const t=e.missingRequired.map(e=>`  * ${e}`).join("\n");s.push(`Missing required parameter(s) for template '${r}'\nFollowing parameters do not have default values and must be provided when calling the template.\n${t}`)}if(e.typeErrors.length>0){const t=e.typeErrors.map(e=>`Parameter '${e.name}' expects type '${e.expected}' but received '${e.actual}' (value: ${JSON.stringify(e.value)})`).join("\n  ");s.push(`Invalid parameter type(s) for template '${r}':\n  ${t}`)}if(e.invalidValues.length>0){const t=e.invalidValues.map(e=>`Parameter '${e.name}' has value '${e.value}' which is not in allowed values: [${e.allowed.join(", ")}]`).join("\n  ");s.push(`Invalid parameter value(s) for template '${r}':\n  ${t}`)}if(e.unknownParameters.length>0){const t=e.unknownParameters.map(e=>`* ${e}`).join("\n  ");s.push(`Unknown parameter(s) for template: '${r}'\nFollowing parameters are not defined in the template\n  ${t}`)}if(s.length>0){let t=s.join("\n\n"),r=null;if(n.sourceLines&&Array.isArray(n.sourceLines)){let t=null;if(e.typeErrors.length>0?t=e.typeErrors[0].name:e.missingRequired.length>0?t=e.missingRequired[0]:e.invalidValues.length>0&&(t=e.invalidValues[0].name),t)for(let e=0;e<n.sourceLines.length;e++){if(n.sourceLines[e].match(new RegExp(`^\\s*${t}\\s*:`))){r=e+1;break}}}const i=this.getTemplateCallStack(n,r);throw i&&(t+=i),new Error(t)}}extractVariables(e){const t={};if(!e||"object"!=typeof e)return t;const{variables:n}=e;if(!n)return t;if(Array.isArray(n))for(const e of n)e&&"object"==typeof e&&e.name&&(t[e.name]=e.value);else if("object"==typeof n)for(const[e,s]of Object.entries(n))t[e]=s&&"object"==typeof s&&"value"in s?s.value:s;return t}expandNode(e,t,n=null){let s;if(s=Array.isArray(e)?this.expandArray(e,t,n):e&&"object"==typeof e?this.expandObject(e,t,n):this.expandScalar(e,t),null===n&&this.isNonArrayObject(s)){s.__scriptsWithExpressions=t.scriptsWithExpressions||new Set,s.__scriptsWithLastLineExpressions=t.scriptsWithLastLineExpressions||new Set;const e=t.quoteResult;e&&"function"==typeof e.save&&e.save(s,t),t.scriptsWithExpressions=s.__scriptsWithExpressions||new Set,delete s.__scriptsWithExpressions,t.scriptsWithLastLineExpressions=s.__scriptsWithLastLineExpressions||new Set,delete s.__scriptsWithLastLineExpressions,s.__quoteStyles&&delete s.__quoteStyles}return s}expandArray(e,t,n=null){const s=[],r="variables"===n;for(let i=0;i<e.length;i+=1){const o=e[i];if(!o)continue;const a=this.isTemplateReference(o),l=this.isSingleKeyObject(o)&&(this.isConditionalDirective(Object.keys(o)[0])||this.isEachDirective(Object.keys(o)[0])),c=l||a?i:this.trackIndicesForItems(o,n,t,i);t.expansionPath&&!l&&t.expansionPath.push(c);try{if(a){this.expandTemplateReferenceToResult(o,t,s,n);continue}const l=this.handleSingleKeyObject(o,e,i,t,s,n);if(l.handled){i="number"==typeof l.nextIndex?l.nextIndex:i;continue}const c=this.createScopedContext(t,o,n),p=this.expandNode(o,c,n);if(void 0===p)continue;const u=Array.isArray(p)?p:[p];this.expandAndAppendArrayItems(u,t,s,r)}finally{t.expansionPath&&!l&&t.expansionPath.pop()}}return s}expandTemplateReferenceToResult(e,t,n,s=""){const r=e.template,o=this.expandTemplateReference(e,t);if(Array.isArray(o)&&o.length){const e=n.length,a={steps:t.stepIndex,jobs:t.jobIndex,stages:t.stageIndex},l=Object.prototype.hasOwnProperty.call(a,s)?a[s]+1:e;if(n.push(...o),!t.expansionPath||t.expansionPath.length<2)return;for(let n=0;n<o.length;n++){const r=o[n];r&&"object"==typeof r&&!Array.isArray(r)&&("variables"===s&&r.name&&void 0!==r.value&&(t.variables[r.name]=r.value,t.currentFile&&t.fileScopes&&(t.fileScopes[t.currentFile]||(t.fileScopes[t.currentFile]={}),t.fileScopes[t.currentFile][r.name]=r.value)),this.trackIndicesForItems(r,s,t,e+n))}let c=[];if(c="jobs"===s?["stages",t.stageIndex]:"steps"===s?["stages",t.stageIndex,"jobs",t.jobIndex]:t.expansionPath.slice(0,-2),r&&t.templateQuoteStyles){const e=this.replaceExpressionsInString(r,t);for(const[n]of t.templateQuoteStyles.entries())(n.includes(e)||e.includes(i.basename(n)))&&this.remapTemplateQuoteStylesByValue(n,s,o,l,c,t)}}}remapTemplateQuoteStylesByValue(e,t,n,s,r,i){const o=this.getQuoteStylesMap(i),a=i.templateQuoteStyles.get(e);if(a&&0!==a.size)for(const[e,i]of a.entries()){const a=e.lastIndexOf(":");if(-1===a)continue;const l=e.substring(0,a),c=e.substring(a+1);if(l.startsWith("parameters."))continue;const p=l.split(".");if(p[0]!==t)continue;const u=parseInt(p[1],10);if(isNaN(u))continue;const f=p.slice(2).join(".");let d=-1;if(u>=0&&u<n.length){const e=n[u];if(e&&"object"==typeof e){this.getNestedValue(e,f)===c&&(d=u)}}if(-1===d)for(let e=0;e<n.length;e++){const t=n[e];if(!t||"object"!=typeof t)continue;if(this.getNestedValue(t,f)===c){d=e;break}}if(-1===d)continue;const h=[...r,t,s+d];f&&h.push(...f.split("."));const m=`${h.join(".")}:${c}`;o.set(m,i)}}getNestedValue(e,t){if(!t)return e;const n=t.split(".");let s=e;for(const e of n){if(null==s||"object"!=typeof s)return;s=s[e]}return s}expandAndAppendArrayItems(e,t,n,s){for(const r of e)this.isTemplateReference(r)?this.expandTemplateReferenceToResult(r,t,n,s):(n.push(r),this.updateVariableContext(r,s,t))}updateVariableContext(e,t,n){if(!t||!e||"object"!=typeof e||Array.isArray(e))return;const s=e.name,r=e.value;s&&void 0!==r&&(n.variables[s]=r,n.currentFile&&n.fileScopes&&(n.fileScopes[n.currentFile]||(n.fileScopes[n.currentFile]={}),n.fileScopes[n.currentFile][s]=r),n.jobIndex>=0?n.jobVariables[s]=r:n.stageIndex>=0?n.stageVariables[s]=r:n.globalVariables[s]=r)}getQuoteStylesMap(e){return e.quoteResult?.quoteStyles||new Map}ensureContextSet(e,t){const n=e&&e[t];if(n instanceof Set)return n;const s=new Set;return e&&(e[t]=s),s}ensureStringsWithExpressions(e){return this.ensureContextSet(e.quoteResult,"stringsWithExpressions")}ensureFullParameterExpressions(e){return this.ensureContextSet(e.quoteResult,"fullParameterExpressions")}trackExpressionValue(e,t,n){const{hadMultilineExpr:s,lastLineHadExpression:r}=n;if(!s||"string"!=typeof e)return;const i=e.replace(/\s+$/,"");this.ensureContextSet(t,"scriptsWithExpressions").add(i),r&&this.ensureContextSet(t,"scriptsWithLastLineExpressions").add(i)}trackQuoteStylesForExpressions(e,t,n,s){const{isMixedExpression:r,isSingleLineFullExpression:i}=s;if(!n.expansionPath||"string"!=typeof e)return;const o=this.getQuoteStylesMap(n);let a=[];if(n.stepIndex>=0){const e=this.relativePathAfterKey(n.expansionPath,"steps");a=["stages",n.stageIndex,"jobs",n.jobIndex,"steps",n.stepIndex,...e]}else if(n.jobIndex>=0){const e=this.relativePathAfterKey(n.expansionPath,"jobs");a=["stages",n.stageIndex,"jobs",n.jobIndex,...e]}else if(n.stageIndex>=0){const e=this.relativePathAfterKey(n.expansionPath,"stages");a=["stages",n.stageIndex,...e]}else a=[...n.expansionPath];const l=this.getQuoteStyleUniqueKey(a,e);if(r&&!this.isMultilineString(e))return void(this.isKeyValueLike(e)||this.ensureStringsWithExpressions(n).add(l));let c=null;if(i){const s=this.getQuoteStyleUniqueKey(a,t),r=this.isConditionExpression(e);if(c=o.get(s),!c&&(""===e||this.isGlobPattern(e)&&!r)){const s=this.stripExpressionDelimiters(t);let i=null;if(s.includes("(")&&s.includes(")")?i=this.extractSourceParameter(s):this.isParameter(t)&&(i=s),i){let t=a;n.parameterMap[i]&&(t=n.parameterMap[i].split("."));const s=this.getQuoteStyleUniqueKey(t,e);this.hasColon(e)||(c=o.get(s))}c||!this.isGlobPattern(e)||r||(c="QUOTE_SINGLE")}if(c&&(this.hasColon(e)||o.set(l,this.isKeyValueLike(e)?"QUOTE_SINGLE":c),n.expansionPath.length>=3&&"variables"===n.expansionPath[2])){const t=n.expansionPath.filter((e,t)=>2!==t),s=this.getQuoteStyleUniqueKey(t,e);o.set(s,c)}if(this.ensureFullParameterExpressions(n).add(l),""===e){const t=this.getQuoteStyleUniqueKey(a,e);this.ensureStringsWithExpressions(n).add(t)}}}trackIndicesForItems(e,t,n,s=0){return Array.isArray(e)?s:"stages"===t&&e&&"object"==typeof e&&"stage"in e?(n.stageIndex+=1,n.jobIndex=-1,n.stepIndex=-1,n.stageIndex):"jobs"===t&&e&&"object"==typeof e&&"job"in e?(n.jobIndex+=1,n.stepIndex=-1,n.jobIndex):"steps"===t&&e&&"object"==typeof e?(n.stepIndex+=1,n.stepIndex):s}handleSingleKeyObject(e,t,n,s,r,i=null){if(!this.isSingleKeyObject(e))return{handled:!1};const o=Object.keys(e)[0];if(this.isEachDirective(o)){const t=this.applyEachDirective(o,e[o],s);return t&&Array.isArray(t.items)&&t.items.length&&(this.trackIndicesForItems(t.items,i,s),r.push(...t.items)),{handled:!0}}if(this.isConditionalDirective(o)){const e=this.expandConditionalBlock(t,n,s,i);return e&&Array.isArray(e.items)&&e.items.length&&(this.trackIndicesForItems(e.items,i,s),r.push(...e.items)),{handled:!0,nextIndex:e.nextIndex}}return{handled:!1}}expandObject(e,t,n=null){const s=Object.entries(e),r={};for(let e=0;e<s.length;e+=1){const[n,i]=s[e];if(this.isEachDirective(n)){const n=this.expandEachEntries(s,e,t);Object.assign(r,n.merged),e=n.nextIndex;continue}if(this.isConditionalDirective(n)){const n=this.expandConditionalEntries(s,e,t);Object.assign(r,n.merged),e=n.nextIndex;continue}if(this.isInsertDirective(n)){const e=this.expandNodePreservingTemplates(i,t);this.isNonArrayObject(e)&&Object.assign(r,e);continue}const o=this.replaceExpressionsInString(n,t);t.expansionPath&&t.expansionPath.push(o);try{const e={hadMultilineExpr:this.hasTemplateExpr(i)&&this.isMultilineString(i),stringHadExpressions:this.hasTemplateExpr(i),lastLineHadExpression:this.lastLineHasTemplateExpression(i)&&this.isMultilineString(i),isSingleLineFullExpression:this.isSingleLineFullExpression(i),isMixedExpression:!1};e.isMixedExpression=e.stringHadExpressions&&!e.isSingleLineFullExpression;const n=this.expandNode(i,t,o);if(void 0===n)continue;if(this.trackQuoteStylesForExpressions(n,i,t,e),this.trackExpressionValue(n,t,e),e.isSingleLineFullExpression&&this.isMultilineString(n)){const e=n.replace(/\s+$/,"");t.scriptsWithExpressions.add(e),t.scriptsWithLastLineExpressions.add(e)}r[o]=n}finally{t.expansionPath&&t.expansionPath.pop()}}const i=["bash","script","pwsh","powershell","checkout"].find(e=>Object.prototype.hasOwnProperty.call(r,e));if(i&&!r.task&&!r.inputs&&!r.targetType&&"inputs"!==n){const e=r[i];delete r[i];const t={task:u[i]};if("checkout"===i){const{condition:n,displayName:s,...i}=r;s&&(t.displayName=s);const o=void 0!==n?n:"none"!==e&&void 0;void 0!==o&&(t.condition=o),t.inputs=Object.assign({repository:e},i)}else{const{workingDirectory:n,...s}=r;let o;Object.assign(t,s),"script"!==i?(o={targetType:"inline",script:e},"pwsh"===i&&(o.pwsh=!0)):o={script:e},void 0!==n&&(o.workingDirectory=n),t.inputs=o}return t}return r.pool&&"string"==typeof r.pool&&(r.pool={name:r.pool}),r.dependsOn&&"string"==typeof r.dependsOn&&(r.dependsOn=[r.dependsOn]),r.task!==p||"none"!==r.inputs?.repository||r.condition||(r.condition=!1),r}expandScalar(e,t){if("string"!=typeof e)return e;const n=e.trim();if(this.isFullExpression(n)){const e=this.stripExpressionDelimiters(n),s=this.evaluateExpression(e,t);if(this.isTemplateReference(s)){const e=this.expandTemplateReference(s,t);return 1===e.length?e[0]:e}return"boolean"==typeof s?this.returnBoolean(s):s}return this.replaceExpressionsInString(e,t,{preserveEmptyLines:this.isMultilineString(e)})}expandConditionalBlock(e,t,n,s=null){let r=t,i=!1,o=[];for(;r<e.length;){const a=e[r];if(!this.isSingleKeyObject(a))break;const[l]=Object.keys(a),c=a[l];if(!this.isConditionalDirective(l))break;if(this.isIfDirective(l)&&r!==t)break;if(!i&&this.evaluateConditional(l,n)&&(o=this.flattenBranchValue(c,n,s),i=!0),r+=1,this.isElseDirective(l))break}return{items:o,nextIndex:r-1}}expandConditionalEntries(e,t,n){let s=t,r=!1,i={};for(;s<e.length;){const[t,o]=e[s];if(!this.isConditionalDirective(t))break;if(!r&&this.evaluateConditional(t,n)&&(i=this.expandConditionalMappingBranch(o,n),r=!0),s+=1,this.isElseDirective(t))break}return{merged:i,nextIndex:Math.max(t,s-1)}}expandConditionalMappingBranch(e,t){if(Array.isArray(e))return this.expandArray(e,t).reduce((e,t)=>this.isNonArrayObject(t)?{...e,...t}:e,{});if(e&&"object"==typeof e){return this.expandObject(e,t)}const n=this.expandScalar(e,t);return void 0===n?{}:{value:n}}expandEachEntries(e,t,n){let s=t;const r={};for(;s<e.length;){const[t,i]=e[s];if(!this.isEachDirective(t))break;const o=this.parseEachDirective(t);if(!o){s+=1;continue}const a=this.evaluateExpression(o.collection,n);this.normalizeCollection(a).forEach((e,t)=>{const s={[o.variable]:e,[`${o.variable}Index`]:t},a=this.createChildContext(n,s),l=this.expandConditionalMappingBranch(i,a);if(Object.prototype.hasOwnProperty.call(l,"--")){const n=this.resolveEachIterationKey(e,t,a,o.variable),s=l["--"];delete l["--"],null!=n&&(r[n]=s)}Object.assign(r,l)}),s+=1}return{merged:r,nextIndex:Math.max(t,s-1)}}resolveEachIterationKey(e,t,n,s){if(null==e)return String(t);const unwrap=e=>{if(null!=e)return"string"==typeof e||"number"==typeof e||"boolean"==typeof e?String(e):void 0},r=unwrap(e);if(void 0!==r)return r;if(e&&"object"==typeof e){const t=["key","name","matrixKey","label","id"];for(const n of t)if(Object.prototype.hasOwnProperty.call(e,n)){const t=unwrap(e[n]);if(void 0!==t)return t}if(Object.prototype.hasOwnProperty.call(e,"value")){const t=unwrap(e.value);if(void 0!==t)return t}}if("string"==typeof s&&s.length){const e=unwrap(this.evaluateExpression(s,n));if(void 0!==e)return e}return String(t)}flattenBranchValue(e,t,n=null){if(Array.isArray(e))return this.expandArray(e,t,n);if(e&&"object"==typeof e)return[this.expandObject(e,t,n)];const s=this.expandScalar(e,t);return void 0===s?[]:[s]}applyEachDirective(e,t,n,s=null){const r=this.parseEachDirective(e);if(!r)return{items:[]};const i=this.evaluateExpression(r.collection,n),o=this.normalizeCollection(i),a=[];return o.forEach((e,i)=>{const o={[r.variable]:e,[`${r.variable}Index`]:i},l=this.createChildContext(n,o),c=this.flattenBranchValue(t,l,s);a.push(...c)}),{items:a}}replaceExpressionsInString(e,t,n={}){if("string"!=typeof e)return e;const s=void 0!==n.preserveEmptyLines?n.preserveEmptyLines:this.isMultilineString(e)&&!0===t?.azureCompatible;let r=e.replace(/\$\{\{\s*(.+?)\s*\}\}/g,(e,n)=>{const s=this.evaluateExpression(n,t);if(null==s){if(n.trim().startsWith("parameters.")){return`$(${n.trim().substring(11)})`}return""}if("object"==typeof s)return JSON.stringify(s);if("string"==typeof s){const e=s.toLowerCase();if("__true__"===e)return"True";if("__false__"===e)return"False"}return"boolean"==typeof s?this.returnBoolean(s):String(s)});return s||(r=r.replace(/^[ \t]+$/gm,"")),t?.azureCompatible&&(r=this.addHeredocListSpacing(r)),r}addHeredocListSpacing(e){if(!e||"string"!=typeof e)return e;const t=e.split("\n"),n=[];let s=!1,r="";const isBullet=e=>/^\s*-\s*\[/.test(e.trim());for(let e=0;e<t.length;e+=1){const i=t[e];if(!s){const e=i.match(/<<\s*([A-Za-z0-9_]+)/);e&&(s=!0,r=e[1]),n.push(i);continue}const o=i.trim();if(r&&o===r){s=!1,r="",n.push(i);continue}n.push(i);const a=t[e+1];void 0!==a&&(isBullet(i)&&isBullet(a)&&a.trim().length>0&&n.push(""))}return n.join("\n")}evaluateExpression(e,t){if(null==e)return;const n=String(e).trim();if(0===n.length)return;const s=this.parseExpressionAst(n);if(s)return this.evaluateAst(s,t);const r=this.resolveContextValue(n,t);return void 0!==r?r:this.looksLikeContextPath(n)?void 0:n}evaluateFunction(e,t){const n=String(e||""),s=l[n];return s?s(t):void 0}parseExpressionAst(e){if(this.expressionCache.has(e))return this.expressionCache.get(e);try{const t=this.preprocessExpressionString(e),n=a(t);return this.expressionCache.set(e,n),n}catch(t){return this.expressionCache.set(e,null),null}}preprocessExpressionString(e){return"string"!=typeof e?e:e.replace(/(['"])((?:\\.|(?!\1).)*?)\1/g,(e,t,n)=>{let s="",r=0;for(;r<n.length;)if("\\"===n[r]){let e=0;for(;r<n.length&&"\\"===n[r];)e++,r++;s+="\\".repeat(e%2==1?e+1:e)}else s+=n[r++];return t+s+t})}evaluateAst(e,t){if(e)switch(e.type){case"Literal":return e.value;case"Identifier":return this.resolveIdentifier(e.name,t);case"ThisExpression":return t;case"ArrayExpression":return e.elements.map(e=>this.evaluateAst(e,t));case"ObjectExpression":{const n={};return e.properties.forEach(e=>{const s=e.key,r=this.evaluatePropertyKey(s,e.computed,t);void 0!==r&&(n[r]=this.evaluateAst(e.value,t))}),n}case"UnaryExpression":return this.evaluateUnary(e.operator,this.evaluateAst(e.argument,t));case"BinaryExpression":return this.evaluateBinary(e.operator,this.evaluateAst(e.left,t),this.evaluateAst(e.right,t));case"LogicalExpression":{const n=this.evaluateAst(e.left,t);return"&&"===e.operator?this.toBoolean(n)?this.evaluateAst(e.right,t):n:"||"===e.operator?this.toBoolean(n)?n:this.evaluateAst(e.right,t):"??"===e.operator?null!=n?n:this.evaluateAst(e.right,t):void 0}case"ConditionalExpression":return this.toBoolean(this.evaluateAst(e.test,t))?this.evaluateAst(e.consequent,t):this.evaluateAst(e.alternate,t);case"MemberExpression":{const n=this.evaluateAst(e.object,t);if(null==n)return;const s=this.evaluatePropertyKey(e.property,e.computed,t);if(null==s)return;if(n===t.parameters&&!Object.prototype.hasOwnProperty.call(n,s)){const e=String(s),n=[`Undefined template parameter '${e}'.`];let r=null;if(t.sourceLines){const n=[`parameters.${e}`,e];for(const e of n){for(let n=0;n<t.sourceLines.length;n++)if(t.sourceLines[n].includes(e)){r=n+1;break}if(r)break}}n.push("Tips:"),n.push(`- Ensure '${e}' is declared in the 'parameters' section`);const i=`- Check if the reference should use a loop object instead of parameters (For e.g. {{ each cfg in configurations }}:, properties inside cfg should be referred with cfg.${e})`;n.push(i);const o=n.join("\n"),a=this.formatErrorWithStack(o,t,r);if(t.errors)return void t.errors.push({message:a,line:r});throw new Error(a)}return n[s]}case"CallExpression":{const n=this.resolveCallable(e.callee,t),s=e.arguments.map(e=>this.evaluateAst(e,t));if(n?.builtinName){const e=this.evaluateFunction(n.builtinName,s);if(void 0!==e)return e}return n&&"function"==typeof n.fn?n.fn.apply(void 0!==n.thisArg?n.thisArg:t,s):void 0}default:return}}resolveIdentifier(e,t){if(!e)return;const n=e.toLowerCase();if("true"===n)return!0;if("false"===n)return!1;if("null"===n)return null;if("undefined"!==n){if(t.locals&&Object.prototype.hasOwnProperty.call(t.locals,e))return t.locals[e];if(Object.prototype.hasOwnProperty.call(t.parameters,e))return t.parameters[e];if(Object.prototype.hasOwnProperty.call(t.variables,e))return t.variables[e];switch(e){case"parameters":return t.parameters;case"variables":return t.variables;case"resources":return t.resources;case"locals":return t.locals;default:return}}}resolveCallable(e,t){if(!e)return{};if("Identifier"===e.type){const n=e.name,s=this.resolveIdentifier(n,t);return"function"==typeof s?{fn:s}:{builtinName:n}}if("MemberExpression"===e.type){const n=this.evaluateAst(e.object,t);if(null==n)return{};const s=this.evaluatePropertyKey(e.property,e.computed,t);if(null==s)return{};const r=n[s];return"function"==typeof r?{fn:r,thisArg:n}:{builtinName:s}}const n=this.evaluateAst(e,t);return"function"==typeof n?{fn:n}:{}}evaluateUnary(e,t){switch(e){case"!":return!this.toBoolean(t);case"+":return Number(t);case"-":return-Number(t);default:return}}evaluateBinary(e,t,n){switch(e){case"==":case"===":return 0===this.compareValues(t,n);case"!=":case"!==":return 0!==this.compareValues(t,n);case"<":return this.compareValues(t,n)<0;case"<=":return this.compareValues(t,n)<=0;case">":return this.compareValues(t,n)>0;case">=":return this.compareValues(t,n)>=0;case"+":return"string"==typeof t||"string"==typeof n?`${t??""}${n??""}`:(Number(t)||0)+(Number(n)||0);case"-":return(Number(t)||0)-(Number(n)||0);case"*":return(Number(t)||0)*(Number(n)||0);case"/":return(Number(t)||0)/(Number(n)||0);case"%":return(Number(t)||0)%(Number(n)||0);default:return}}contains(e,t){return"string"==typeof e?"string"==typeof t&&e.includes(t):Array.isArray(e)?e.some(e=>0===this.compareValues(e,t)):!(!e||"object"!=typeof e)&&Object.prototype.hasOwnProperty.call(e,t)}compareValues(e,t){const normalize=e=>{if(null==e)return"";if("string"==typeof e){const t=e.trim();if(0===t.length)return"";const n=t.toLowerCase();return"true"===n||"__true__"===n||"false"!==n&&"__false__"!==n&&(/^-?\d+(?:\.\d+)?$/.test(t)?Number(t):t)}return e},n=normalize(e),s=normalize(t);if(n===s)return 0;if(typeof n==typeof s&&("number"==typeof n||"boolean"==typeof n))return n>s?1:-1;const r=String(n),i=String(s);return r===i?0:r>i?1:-1}resolveContextValue(e,t){const n=this.sanitizePath(e).split(".").filter(e=>e.length>0);if(0===n.length)return;const[s,...r]=n;if("parameters"===s){const e=t.parameters||{};if(0===r.length)return e;const n=r[0];if(!Object.prototype.hasOwnProperty.call(e,n)){const e=[`Undefined template parameter '${n}'.`];let s=null;if(t.sourceLines){const e=[`parameters.${n}`,n];for(const n of e){for(let e=0;e<t.sourceLines.length;e++)if(t.sourceLines[e].includes(n)){s=e+1;break}if(s)break}}e.push("Tips:"),e.push(`- Ensure '${n}' is declared in the 'parameters' section`);const r=`- Check if the reference should use a loop object instead of parameters (For e.g. {{ each cfg in configurations }}:, properties inside cfg should be referred with cfg.${n})`;e.push(r);const i=e.join("\n"),o=this.formatErrorWithStack(i,t,s);if(t.errors)return void t.errors.push({message:o,line:s});throw new Error(o)}return this.walkSegments(e,r)}const walkIfHas=e=>e&&Object.prototype.hasOwnProperty.call(e,s)?this.walkSegments(e[s],r):void 0,i=walkIfHas(t.locals);if(void 0!==i)return i;const o={variables:t.variables,resources:t.resources};if(Object.prototype.hasOwnProperty.call(o,s))return this.walkSegments(o[s],r);const a=walkIfHas(t.parameters);if(void 0!==a)return a;const l=walkIfHas(t.variables);return void 0!==l?l:void 0}walkSegments(e,t){let n=e;for(let e=0;e<t.length;e++){const s=t[e];if(null==n)return;if(e>0&&this.isNonArrayObject(n)&&!(s in n))return"";n=n[s]}return n}sanitizePath(e){return e.replace(/\[(\d+)\]/g,".$1").replace(/\[(?:'|")([^'"]+)(?:'|")\]/g,".$1")}looksLikeContextPath(e){return"string"==typeof e&&/^[a-zA-Z_][\w]*[.\[]/.test(e.trim())}toBoolean(e){switch(typeof e){case"boolean":return e;case"number":return 0!==e;case"string":{const t=e.toLowerCase();return"__true__"===t||"true"===t||"__false__"!==t&&"false"!==t&&0!==t.length&&Boolean(e)}default:return Boolean(e)}}returnBoolean(e){return e?"__TRUE__":"__FALSE__"}createChildContext(e,t){return{parameters:e.parameters,parameterMap:e.parameterMap,variables:e.variables,globalVariables:e.globalVariables,stageVariables:e.stageVariables,jobVariables:e.jobVariables,resources:e.resources,locals:{...e.locals,...t},baseDir:e.baseDir,repoBaseDir:e.repoBaseDir,rootRepoBaseDir:e.rootRepoBaseDir,resourceLocations:e.resourceLocations||{},scriptsWithExpressions:e.scriptsWithExpressions,scriptsWithLastLineExpressions:e.scriptsWithLastLineExpressions,templateQuoteStyles:e.templateQuoteStyles,quoteResult:e.quoteResult,stageIndex:e.stageIndex,jobIndex:e.jobIndex,stepIndex:e.stepIndex,templateStack:e.templateStack||[],rootTemplate:e.rootTemplate,sourceLines:e.sourceLines,sourceText:e.sourceText,errors:e.errors}}createTemplateContext(e,t,n,s={}){const r=s.templateFile||"template";return{parameters:{...t},parameterMap:{...e.parameterMap},variables:{},globalVariables:e.globalVariables,stageVariables:e.stageVariables,jobVariables:e.jobVariables,resources:e.resources,locals:{...e.locals},baseDir:n||e.baseDir,repoBaseDir:void 0!==s.repoBaseDir?s.repoBaseDir:e.repoBaseDir,rootRepoBaseDir:e.rootRepoBaseDir,resourceLocations:e.resourceLocations||{},templateStack:e.templateStack||[],templateQuoteStyles:e.templateQuoteStyles,scriptsWithExpressions:e.scriptsWithExpressions,scriptsWithLastLineExpressions:e.scriptsWithLastLineExpressions,expansionPath:[],stringsWithExpressions:e.stringsWithExpressions,quoteResult:e.quoteResult,stageIndex:e.stageIndex,jobIndex:e.jobIndex,stepIndex:e.stepIndex,rootTemplate:e.rootTemplate,sourceLines:e.sourceLines,sourceText:e.sourceText,errors:e.errors,currentFile:r,fileScopes:{}}}normalizeCollection(e){return Array.isArray(e)?e:e&&"object"==typeof e?Object.entries(e).map(([e,t])=>({key:e,value:t})):[]}createScopedContext(e,t,n){if("stages"===n&&t&&"object"==typeof t&&"stage"in t){const n={...e};if(n.stageVariables={},n.jobVariables={},n.variables={...e.globalVariables},t.variables){const e=this.extractVariablesFromNode(t.variables);Object.assign(n.stageVariables,e),Object.assign(n.variables,e)}return n}if("jobs"===n&&t&&"object"==typeof t&&"job"in t){const n={...e};if(n.jobVariables={},n.variables={...e.globalVariables,...e.stageVariables},t.variables){const e=this.extractVariablesFromNode(t.variables);Object.assign(n.jobVariables,e),Object.assign(n.variables,e)}return n}return e}extractVariablesFromNode(e){const t={};if(!e)return t;if(Array.isArray(e)){for(const n of e)if(this.isNonArrayObject(n)){const e=n.name,s=n.value;e&&void 0!==s&&(t[e]=s)}}else if("object"==typeof e)for(const[n,s]of Object.entries(e))if(this.isNonArrayObject(s)){const e=s.value;void 0!==e&&(t[n]=e)}else t[n]=s;return t}isSingleKeyObject(e){return this.isNonArrayObject(e)&&1===Object.keys(e).length}isEmptyObject(e){return this.isNonArrayObject(e)&&0===Object.keys(e).length}isTemplateReference(e){return this.isNonArrayObject(e)&&"template"in e}isNonArrayObject(e){return e&&"object"==typeof e&&!Array.isArray(e)}expandTemplateReference(e,t){const n=e.template,r="string"==typeof n?this.replaceExpressionsInString(n,t):this.expandScalar(n,t);if(!r||"string"!=typeof r)return[];let o=null;if(t.sourceLines&&Array.isArray(t.sourceLines)){const e="string"==typeof n?n:String(n);for(let n=0;n<t.sourceLines.length;n++){const s=t.sourceLines[n];if(s.includes("template:")&&s.includes(e)){o=n+1;break}}}const a=this.parseRepositoryTemplateReference(r),l=a&&this.isSelfRepositoryAlias(a.repository);let c,p,u=t.repoBaseDir||void 0;if(l){const e=t.rootRepoBaseDir||t.repoBaseDir,n=this.resolveRepoBaseDirectory(e,t);u=n;const s=t.baseDir||n;if(c=this.resolveRepoTemplate(a.templatePath,s,n),!c)throw new Error(this.formatErrorWithStack(`Template file not found for repository '${a.repository}': ${a.templatePath}`,t,o));p=i.dirname(c)}else if(a){const e=this.resolveRepositoryEntry(a.repository,t);if(!e)throw new Error(this.formatErrorWithStack(`Repository resource '${a.repository}' is not defined for template '${r}'.`,t,o));const n=this.resolveRepositoryLocation(e,t);if(!n)throw new Error(this.formatErrorWithStack(`Repository resource '${a.repository}' does not define a local location. Set a 'location' for this resource (for example via the 'azurePipelineStudio.resourceLocations' setting).`,t,o));const s=this.resolveRepoBaseDirectory(n,t);u=s;const l=t.baseDir||s;if(c=this.resolveRepoTemplate(a.templatePath,l,s),!c)throw new Error(this.formatErrorWithStack(`Template file not found for repository '${a.repository}': ${a.templatePath}`,t,o));p=i.dirname(c)}else{const e=t.repoBaseDir||void 0,n=this.resolveRepoTemplate(r,t.baseDir,e);if(n)c=n,p=i.dirname(c),u=u||e;else{const e=t.baseDir||process.cwd();c=i.isAbsolute(r)?r:i.resolve(e,r),p=i.dirname(c)}}if(!s.existsSync(c)){const e=a?`${a.templatePath}@${a.repository}`:r;throw new Error(this.formatErrorWithStack(`Template file not found: ${e}`,t,o))}const f=s.readFileSync(c,"utf8"),d=a?`${a.templatePath}@${a.repository}`:r;let h;try{const e=void 0!==t.skipSyntax&&t.skipSyntax,{yamlDoc:n,jsonDoc:s}=this.parseYamlDocument(f,d,e,t,o);h=s;const r=new Map;if(this.extractQuoteStyles(n.contents,[],r),r.size>0&&(t.templateQuoteStyles.set(c,r),t.quoteResult&&t.quoteResult.quoteStyles))for(const[e,n]of r.entries())t.quoteResult.quoteStyles.has(e)||t.quoteResult.quoteStyles.set(e,n)}catch(e){const n="string"==typeof e?.message?e.message:String(e),s=a?`${a.templatePath}@${a.repository}`:r;if(n.includes(s))throw new Error(this.formatErrorWithStack(n,t,o));throw new Error(this.formatErrorWithStack(`Failed to parse template '${r}': ${n}`,t,o))}const m=this.extractParameters(h),g=this.normalizeTemplateParameters(e.parameters,t),y={...m.parameters,...g},b=a?`${a.templatePath}@${a.repository}`:r;let v;v=o?`${b}:${o} (${c})`:`${b} (${c})`;const x={...t,templateStack:[...t.templateStack||[],v],parameterMap:{...m.parameterMap}};this.validateTemplateParameters(h,g,r,x);const S=this.createTemplateContext(x,y,p,{repoBaseDir:u,templateFile:c});S.sourceLines=f.split("\n");const w=this.expandNode(h,S)||{};this.convertVariablesToArrayFormat(w,S);return this.extractTemplateBody(w)}parseRepositoryTemplateReference(e){if("string"!=typeof e)return;const t=e.lastIndexOf("@");if(t<=0||t===e.length-1)return;const n=e.slice(0,t).trim(),s=e.slice(t+1).trim();return n&&s?{templatePath:n,repository:s}:void 0}isSelfRepositoryAlias(e){return"string"==typeof e&&"self"===e.trim().toLowerCase()}resolveRepositoryEntry(e,t){if(!e||!t)return;let n;if(t.resources){const s=t.resources.repositories;s&&(s[e]?n=s[e]:Array.isArray(s)&&(n=s.find(t=>this.getRepositoryAlias(t)===e)))}if(n&&t.resourceLocations&&t.resourceLocations[e]){n.location||n.path||n.directory||n.localPath||(n={...n,location:t.resourceLocations[e]})}return!n&&t.resourceLocations&&t.resourceLocations[e]&&(n={repository:e,location:t.resourceLocations[e]}),n}resolveRepositoryLocation(e,t){if(!e||"object"!=typeof e)return;const n=[e.location,e.path,e.directory,e.localPath].find(e=>"string"==typeof e&&e.trim().length);if(!n)return;const s=this.replaceExpressionsInString(n,t);if(!s||"string"!=typeof s)return;const r=s.trim();if(!r)return;const i=this.expandUserHome(r);return i&&"object"==typeof e&&(e.__resolvedLocation=i,e.location&&e.location!==n&&e.location!==r?e.localLocation||(e.localLocation=i):e.location=i),i}expandUserHome(e){return"string"!=typeof e?e:e.startsWith("~")?i.join(r.homedir(),e.slice(1)):e}resolveRepoBaseDirectory(e,t){const n=t.baseDir||process.cwd();if(!e)return n;const r=i.isAbsolute(e)?e:i.resolve(n,e);try{const e=s.statSync(r);if(e.isFile())return i.dirname(r);if(e.isDirectory())return r}catch(e){}return r}resolveRepoTemplate(e,t,n){if(!e)return;const r=String(e).replace(/^[\\/]+/,"").split(/[\\/]+/).filter(e=>e?.length),o=[];if(n&&o.push(n),!t||n&&i.normalize(n)===i.normalize(t)||o.push(t),!o.length)return;const a=o.map(e=>r.length?i.resolve(e,...r):i.normalize(e));for(const e of a)try{if(s.statSync(e).isFile())return i.normalize(e)}catch(e){}return a[0]}expandNodePreservingTemplates(e,t){return null===e?e:Array.isArray(e)?this.expandArrayPreservingTemplates(e,t):"object"==typeof e?this.expandObjectPreservingTemplates(e,t):this.expandScalar(e,t)}expandArrayPreservingTemplates(e,t){const n=[];let s=0;for(;s<e.length;){const r=e[s];if(this.isTemplateReference(r)){n.push(r),s++;continue}if(this.isNonArrayObject(r)){const i=this.handleSingleKeyObject(r,e,s,t,n);if(i&&i.handled){s=void 0!==i.nextIndex?i.nextIndex+1:s+1;continue}}const i=this.expandNodePreservingTemplates(r,t);if(null!==i){if(this.isEmptyObject(i)){s++;continue}n.push(i)}s++}return n}expandObjectPreservingTemplates(e,t){if(this.isTemplateReference(e)){const n={template:e.template};return e.parameters&&(n.parameters=this.expandNodePreservingTemplates(e.parameters,t)),n}const n={},s=Object.entries(e);let r=0;for(;r<s.length;){const[e,i]=s[r];if(this.isConditionalDirective(e)){let e=!1,i=r;for(;i<s.length;){const[r,o]=s[i];if(!this.isConditionalDirective(r))break;if(!e&&this.evaluateConditional(r,t)){const s=this.expandNodePreservingTemplates(o,t);this.isNonArrayObject(s)&&Object.assign(n,s),e=!0}if(i++,this.isElseDirective(r))break}r=i;continue}if(this.isInsertDirective(e)){const e=this.expandNodePreservingTemplates(i,t);e&&this.isNonArrayObject(e)&&Object.assign(n,e),r++;continue}n["string"==typeof e?this.replaceExpressionsInString(e,t):e]=this.expandNodePreservingTemplates(i,t),r++}return n}normalizeTemplateParameters(e,t){if(void 0===e)return{};const n=this.expandNodePreservingTemplates(e,t);return n&&this.isNonArrayObject(n)?n:this.normalizeParameterArray(n)}normalizeParameterArray(e){const t={};return e.forEach(e=>{if(e&&"object"==typeof e&&!Array.isArray(e)){if(Object.prototype.hasOwnProperty.call(e,"name")){const n=e.name;if("string"==typeof n&&n.trim().length){const s=e.default;t[n.trim()]=s}return}Object.entries(e).forEach(([e,n])=>{"string"==typeof e&&e.trim().length&&(t[e.trim()]=n)})}}),t}extractTemplateBody(e){if(!e||"object"!=typeof e)return[];if(Array.isArray(e))return e;const t=["stages","jobs","steps","variables","stage","job","deployment","deployments"];for(const n of t)if("parameters"!==n&&Object.prototype.hasOwnProperty.call(e,n)){const t=e[n];if(Array.isArray(t))return t;if(void 0!==t)return[t]}return[]}evaluatePropertyKey(e,t,n){return t?this.evaluateAst(e,n):"Identifier"===e.type?e.name:this.evaluateAst(e,n)}isVariableArray(e){return!(!Array.isArray(e)||0===e.length)&&e.some(e=>this.isNonArrayObject(e)&&("name"in e&&"value"in e||1===Object.keys(e).length&&!("template"in e)))}evaluateConditional(e,t){if(this.isElseDirective(e))return!0;const n=this.isIfDirective(e)?this.parseIfCondition(e):this.parseElseIfCondition(e);return this.toBoolean(this.evaluateExpression(n,t))}isFullExpression(e){if("string"!=typeof e)return!1;const t=e.trim();if(!t.startsWith("${{")||!t.endsWith("}}"))return!1;return!t.slice(3,-2).includes("}}")}stripExpressionDelimiters(e){if("string"!=typeof e)return"";return e.trim().replace(/^\$\{\{/,"").replace(/\}\}$/,"").trim()}isInsertDirective(e){const t=e.trim();return!!this.isFullExpression(t)&&("string"==typeof e&&/^\$\{\{\s*insert\s*\}\}$/.test(t))}isEachDirective(e){return"string"==typeof e&&/^\$\{\{\s*each\s+/.test(e.trim())}isConditionalDirective(e){return this.isIfDirective(e)||this.isElseIfDirective(e)||this.isElseDirective(e)}isIfDirective(e){return"string"==typeof e&&/^\$\{\{\s*if\s+/.test(e.trim())}isElseIfDirective(e){return"string"==typeof e&&/^\$\{\{\s*elseif\s+/.test(e.trim())}isElseDirective(e){return"string"==typeof e&&/^\$\{\{\s*else\s*\}\}$/.test(e.trim())}isParameter(e){return"string"==typeof e&&/^\$\{\{\s*parameters\./.test(e.trim())}isVariable(e){return"string"==typeof e&&/^\$\{\{\s*variables\./.test(e.trim())}hasTrailingSpaces(e){const t=e.split("\n");return t.some((e,n)=>(n<t.length-1||""!==e)&&/[ \t]$/.test(e))}isMultilineString(e){return"string"==typeof e&&e.includes("\n")}isSingleLineFullExpression(e){if("string"!=typeof e)return!1;const t=e.trim();return this.isFullExpression(t)&&!t.includes("\n")}hasTemplateExpr(e){return"string"==typeof e&&e.includes("${{")}hasRuntimeVariable(e){return"string"==typeof e&&/\$\([^)]+\)/.test(e)}isKeyValueLike(e){return"string"==typeof e&&/: /.test(e)}relativePathAfterKey(e,t){if(!Array.isArray(e))return[];const n=e.indexOf(t);return n>=0?e.slice(n+2):e}hasColon(e){return"string"==typeof e&&e.includes(":")}isGlobPattern(e){return"string"==typeof e&&this.globQuotePattern.test(e)}isConditionExpression(e){if("string"!=typeof e)return!1;const t=e.trim();if(!t)return!1;const n=/^[a-zA-Z_][\w\.]*\(.*\)$/.test(t),s=/\b(?:variables|parameters|env|dependencies)\[/.test(t);return n||s}extractSourceParameter(e){const t=e.match(/parameters\.[a-zA-Z_][\w.]*/g);return t&&t.length>0?t[t.length-1]:/^parameters\.[a-zA-Z_][\w.]*$/.test(e)?e:null}isStringNodeValue(e){return void 0!==e?.value&&"string"==typeof e.value}hadMixedExpression(e,t,n){if("string"!=typeof e||!n.stringsWithExpressions)return!1;const s=this.getQuoteStyleUniqueKey(t,e);return n.stringsWithExpressions.has(s)}hasFullParameterExpression(e,t,n){const s=n.quoteResult?.fullParameterExpressions;if("string"!=typeof e||!s)return!1;const r=this.getQuoteStyleUniqueKey(t,e);return s.has(r)}normalizeTrailingNewlines(e,t){return t?/\n[ \t]*\n\s*$/.test(e)?e.replace(/\n+$/,"")+"\n\n":e:/\n\n+$/.test(e)?e.replace(/\n+$/,"")+"\n":e}lastLineHasTemplateExpression(e){if(!e||!this.isMultilineString(e))return!1;const t=e.split("\n");for(let e=t.length-1;e>=0;e--){const n=t[e].trim();if(n)return n.endsWith("}}")}return!1}parseIfCondition(e){if("string"!=typeof e)return"";const t=e.trim().match(/^\$\{\{\s*if\s+(.+?)\s*\}\}$/);return t?t[1]:""}parseElseIfCondition(e){if("string"!=typeof e)return"";const t=e.trim().match(/^\$\{\{\s*elseif\s+(.+?)\s*\}\}$/);return t?t[1]:""}parseEachDirective(e){if("string"!=typeof e)return;const t=e.trim().match(/^\$\{\{\s*each\s+([a-zA-Z_]\w*)\s+in\s+(.+?)\s*\}\}$/);return t?{variable:t[1],collection:t[2]}:void 0}}if(e.exports={AzurePipelineParser},n.c[n.s]===e){const e=process.argv.slice(2);0===e.length&&(console.error("Usage: node parser.js <yaml-file-path>"),process.exit(1));const t=e[0],n=new AzurePipelineParser({printTree:!1});try{const e=n.expandPipelineFromFile(t);process.stdout.write(e)}catch(e){console.error(`Failed to expand pipeline: ${e.message}`),process.exit(1)}}},9243(e,t,n){const s=n(857),r=n(6928);e.exports={pickFirstString:function pickFirstString(...e){for(const t of e)if("string"==typeof t&&t.trim().length)return t},resolveConfiguredPath:function resolveConfiguredPath(e,t,n){if("string"!=typeof e)return;let i=e.trim();if(!i.length)return;const o=s.homedir();return i=i.replace(/^~(?=$|[\/])/,o),i=i.replace(/\$\{workspaceFolder\}/g,t||""),i=i.replace(/\$\{env:([^}]+)\}/g,(e,t)=>process.env[t]||""),i=i.replace(/\$\{([^}]+)\}/g,(e,n)=>"workspaceFolder"===n?t||"":Object.prototype.hasOwnProperty.call(process.env,n)?process.env[n]:e),r.isAbsolute(i)?r.normalize(i):t?r.normalize(r.resolve(t,i)):n?r.normalize(r.resolve(n,i)):r.normalize(r.resolve(process.cwd(),i))},normalizeExtension:function normalizeExtension(e){if("string"!=typeof e)return;const t=e.trim().toLowerCase();return t?t.startsWith(".")?t:`.${t}`:void 0}}}},t={};function __webpack_require__(n){var s=t[n];if(void 0!==s)return s.exports;var r=t[n]={id:n,loaded:!1,exports:{}};return e[n](r,r.exports,__webpack_require__),r.loaded=!0,r.exports}__webpack_require__.c=t,__webpack_require__.nmd=e=>(e.paths=[],e.children||(e.children=[]),e);var n=__webpack_require__(__webpack_require__.s=3307);module.exports=n})();