#!/usr/bin/env node
(()=>{var e=[(e,t,n)=>{e=n.nmd(e);const s=n(1),i=n(2),r=n(3),{pickFirstString:o,resolveConfiguredPath:a,normalizeExtension:l}=n(4),{formatYaml:c}=n(6),{DependencyAnalyzer:p}=n(81);let u;try{u=n(82)}catch(e){u=void 0}const{AzurePipelineParser}=n(83),{NONAME:f}=n(86);function buildFormatOptionsFromCli(e){if(!Array.isArray(e)||0===e.length)return;const t={};return e.forEach(e=>{if("string"!=typeof e)return;const n=e.indexOf("=");if(n<=0||n===e.length-1)return void console.warn(`Ignoring invalid --format entry '${e}'. Expected key=value.`);const s=e.slice(0,n).trim(),i=e.slice(n+1).trim();if(!s.length)return void console.warn(`Ignoring --format entry with empty key: '${e}'.`);const r={indent:[1,8],lineWidth:[0,Number.MAX_SAFE_INTEGER],firstBlockBlankLines:[0,4],blankLinesBetweenSections:[0,4]};["noArrayIndent","forceQuotes","sortKeys","stepSpacing"].includes(s)?"true"===i||"false"===i?t[s]="true"===i:console.warn(`Ignoring --format ${s}: expected boolean 'true' or 'false'.`):r[s]?function tryAssignIntegerOption(e,t,n,s,i){const r=Number.parseInt(n,10);!Number.isFinite(r)||r<s||r>i?console.warn(`Ignoring --format ${t}: expected integer between ${s} and ${i}.`):e[t]=r}(t,s,i,...r[s]):"newline"===s||"newlineFormat"===s?t.newlineFormat=i.replace(/\\r\\n/g,"\r\n").replace(/\\n/g,"\n").replace(/\\r/g,"\r"):console.warn(`Ignoring unsupported --format option '${s}'.`)}),Object.keys(t).length?t:void 0}function formatFilesRecursively(e,t,n){const r=new Set(Array.isArray(t)?t.map(e=>l(e)).filter(Boolean):[]);r.size||(r.add(".yml"),r.add(".yaml"));const o={totalFiles:0,formattedFiles:[],warnings:[],errors:[]};if(!Array.isArray(e)||!e.length)return o;const a=new Set,walk=e=>{if(!e)return;const t=i.resolve(process.cwd(),e);if(a.has(t))return;let p;a.add(t);try{p=s.lstatSync(t)}catch(e){return void o.errors.push({filePath:t,message:`Cannot access: ${e.message}`})}if(!p.isSymbolicLink()){if(p.isDirectory()){let e;try{e=s.readdirSync(t)}catch(e){return void o.errors.push({filePath:t,message:`Cannot read directory: ${e.message}`})}return void e.forEach(e=>{try{walk(i.join(t,e))}catch(n){o.errors.push({filePath:i.join(t,e),message:`Unexpected error: ${n.message}`})}})}if(p.isFile()){const e=l(i.extname(t));e&&r.has(e)&&(e=>{o.totalFiles+=1;try{const t=s.readFileSync(e,"utf8"),i={...n,fileName:e},r=c(t,i);if(r.error)return void o.errors.push({filePath:e,message:r.error});r.text!==t&&(s.writeFileSync(e,r.text,"utf8"),o.formattedFiles.push(e),r.warning&&o.warnings.push({filePath:e,message:r.warning}))}catch(t){o.errors.push({filePath:e,message:t.message})}})(t)}}};return e.forEach(e=>{try{walk(e)}catch(t){o.errors.push({filePath:e,message:`Failed to process target: ${t.message}`})}}),o}e.exports={activate:function activate(e){if(!u)return void console.warn("VS Code API unavailable; activate() skipped (CLI execution detected).");console.log("Azure Pipeline YAML Parser extension is now active!");const t=new AzurePipelineParser,r=new p(t);let l,f,d=!1,h=null;const m="ado-pipeline-expanded",g=new Map,y=new u.EventEmitter;e.subscriptions.push(y),e.subscriptions.push(u.workspace.registerTextDocumentContentProvider(m,{onDidChange:y.event,provideTextDocumentContent:e=>g.get(e.toString())||""}));const getFormatSettings=e=>{const t={noArrayIndent:!0,indent:2,lineWidth:0,forceQuotes:!1,sortKeys:!1,firstBlockBlankLines:2,betweenSectionBlankLines:1,normalizeAzureVariablePaths:!0,newlineFormat:"\n"};if(!u)return t;try{const n=u.workspace.getConfiguration("azurePipelineStudio",e?.uri),s={...t};["noArrayIndent","forceQuotes","sortKeys","stepSpacing","normalizeAzureVariablePaths"].forEach(e=>{const t=n.get(`format.${e}`);"boolean"==typeof t&&(s[e]=t)});const i=n.get("format.indent");Number.isInteger(i)&&i>0&&i<=8&&(s.indent=i);const r=n.get("format.lineWidth");"number"==typeof r&&r>=0&&(s.lineWidth=r);[{key:"firstBlockBlankLines",min:0,max:4},{key:"betweenSectionBlankLines",min:0,max:4}].forEach(({key:e,min:t,max:i})=>{const r=n.get(`format.${e}`);Number.isInteger(r)&&r>=t&&r<=i&&(s[e]=r)});const o=n.get("format.newlineFormat");return"\n"!==o&&"\r\n"!==o||(s.newlineFormat=o),s}catch(e){return console.warn("Failed to read azurePipelineStudio.format settings:",e),t}};let b=!1,v=null,x=!1;const showErrorWebview=(e,t,n="expansion")=>{if(v){try{v.dispose()}catch(e){}v=null}if(!x){const e=u.commands.registerCommand("azurePipelineStudio.openErrorFile",async(e,t)=>{try{const n=await u.workspace.openTextDocument(e),s={preview:!1};if(t&&t>0){const e=new u.Position(t-1,0);s.selection=new u.Range(e,e)}await u.window.showTextDocument(n,s)}catch(t){u.window.showErrorMessage(`Failed to open file: ${e}`)}});t.subscriptions.push(e),x=!0}const s={expansion:"‚ùå Pipeline Expansion Error",formatting:"‚ùå YAML Formatting Error",dependency:"‚ùå Dependency Analysis Error"}[n]||"‚ùå Pipeline Error",i=u.window.createWebviewPanel("azurePipelineError",s,u.ViewColumn.Beside,{enableScripts:!0});v=i,b=!0,i.onDidDispose(()=>{b=!1,v=null});const escapeHtml=e=>String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),makePathsClickable=e=>e.replace(/(\\\\[^\s\n:]+\.(?:ya?ml|js|ts))(?::(\d+))?(?::(\d+))?|([A-Za-z]:\\[^\s\n:]+\.(?:ya?ml|js|ts))(?::(\d+))?(?::(\d+))?|(\/[^\s\n:]+\.(?:ya?ml|js|ts))(?::(\d+))?(?::(\d+))?/g,(e,t,n,s,i,r,o,a,l,c)=>{const p=t||i||a,u=n||r||l;if(p&&p.includes("extension-bundle.js"))return e;if(p){return`<a class="file-link" href="#" onclick="openFile('${p.replace(/\\/g,"\\\\").replace(/'/g,"\\'")}', ${u||"null"}); return false;">${escapeHtml(e)}</a>`}return e});let r=`\n            <!DOCTYPE html>\n            <html>\n            <head>\n                <style>\n                    body {\n                        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;\n                        line-height: 1.6;\n                        color: #e0e0e0;\n                        background-color: #1e1e1e;\n                        padding: 20px;\n                        margin: 0;\n                    }\n                    .error-container {\n                        max-width: 900px;\n                        margin: 0 auto;\n                    }\n                    h1 {\n                        color: #ff6b6b;\n                        margin-top: 0;\n                        font-size: 1.8em;\n                    }\n                    h2 {\n                        color: #ff9f43;\n                        margin-top: 20px;\n                        font-size: 1.3em;\n                        border-bottom: 1px solid #444;\n                        padding-bottom: 8px;\n                    }\n                    .error-details {\n                        background-color: #252526;\n                        border-left: 3px solid #ff6b6b;\n                        padding: 12px;\n                        margin: 12px 0;\n                        border-radius: 4px;\n                        overflow-x: auto;\n                        line-height: 1.8;\n                    }\n                    .error-details code {\n                        font-family: 'Courier New', Courier, monospace;\n                        font-size: 0.95em;\n                        color: #ce9178;\n                        white-space: normal;\n                        display: block;\n                    }\n                    .tip-box {\n                        background-color: #1f3a2c;\n                        border-left: 3px solid #4ec9b0;\n                        padding: 12px;\n                        margin: 12px 0;\n                        border-radius: 4px;\n                    }\n                    .tip-label {\n                        font-weight: bold;\n                        color: #4ec9b0;\n                        margin-bottom: 8px;\n                    }\n                    ul {\n                        margin: 8px 0;\n                        padding-left: 20px;\n                    }\n                    li {\n                        margin: 4px 0;\n                    }\n                    .file-link {\n                        color: #569cd6;\n                        text-decoration: underline;\n                        cursor: pointer;\n                        font-family: inherit;\n                    }\n                    .file-link:hover {\n                        color: #4fc3f7;\n                    }\n                    .stack-trace {\n                        background-color: #252526;\n                        border-left: 3px solid #888;\n                        padding: 12px;\n                        margin: 12px 0;\n                        border-radius: 4px;\n                        overflow-x: auto;\n                        font-family: 'Courier New', Courier, monospace;\n                        font-size: 0.9em;\n                        color: #d4d4d4;\n                        max-height: 400px;\n                        overflow-y: auto;\n                    }\n                    .file-list {\n                        background-color: #252526;\n                        border-left: 3px solid #569cd6;\n                        padding: 12px;\n                        margin: 12px 0;\n                        border-radius: 4px;\n                    }\n                    .hr {\n                        border: none;\n                        border-top: 1px solid #444;\n                        margin: 16px 0;\n                    }\n                </style>\n            </head>\n            <body>\n                <div class="error-container">\n                    <h1>‚ùå Error Expanding Azure Pipeline</h1>\n                    \n                    <h2>Error Details</h2>\n                    <div class="error-details">\n                        <code>${(e=>{const t=escapeHtml(e);return makePathsClickable(t).split("\n").map(e=>e.replace(/^( +)/,e=>"&nbsp;".repeat(e.length))).join("<br>")})(e.message||String(e))}</code>\n                    </div>\n\n                    <div class="hr"></div>\n                    <div class="tip-box">\n                        <div class="tip-label">üí° Tip: Common Issues</div>\n                        <ul>\n                            <li><code>steps:</code> not properly indented under <code>job:</code></li>\n                            <li>Missing or extra spaces in YAML structure</li>\n                            <li>Template expressions that are malformed</li>\n                        </ul>\n                    </div>\n\n                    <h2>Stack Trace</h2>\n                    <div class="stack-trace">\n                        <pre>${makePathsClickable(escapeHtml(e.stack||"No stack trace available"))}</pre>\n                    </div>\n                </div>\n\n                <script>\n                    const vscode = acquireVsCodeApi();\n                    function openFile(filePath, lineNumber) {\n                        vscode.postMessage({\n                            command: 'openFile',\n                            filePath: filePath,\n                            lineNumber: lineNumber\n                        });\n                    }\n                <\/script>\n            </body>\n            </html>\n        `;i.webview.html=r,i.webview.onDidReceiveMessage(e=>{"openFile"===e.command&&u.commands.executeCommand("azurePipelineStudio.openErrorFile",e.filePath,e.lineNumber)})},scheduleRender=(e,t=500)=>{shouldRenderDocument(e)&&(h=e,clearTimeout(f),f=setTimeout(()=>{if(d)return;const e=h;h=null,renderYamlDocument(e,{silent:!0})},t))},renderYamlDocument=async(n,s={})=>{if(!n||b)return;l=n;const r=n.getText();d=!0;try{const e=u.workspace.getConfiguration("azurePipelineStudio",n.uri),o=e.get("expansion.variables",{}),a=e.get("expansion.skipSyntaxCheck",!1),l=buildResourceOverridesForDocument(n),p=s.azureCompatible??!1,f={fileName:n.fileName,azureCompatible:p,skipSyntaxCheck:a,...l&&{resources:l},...Object.keys(o).length&&{variables:o}};console.log("Parser overrides:",JSON.stringify(f,null,2));const d=t.expandPipelineFromString(r,f),h=getFormatSettings(n);h.fileName=n.fileName,h.wasExpanded=!0;const b=c(d,h),v=(e=>{const t=i.basename(e.fileName||"pipeline.yml")||"pipeline.yml",n=encodeURIComponent(e.fileName||t);return u.Uri.from({scheme:m,path:"/"+t,query:`${n}|expanded`})})(n);if(g.set(v.toString(),b.text),y.fire(v),!s.silent){const e=await u.workspace.openTextDocument(v);await u.window.showTextDocument(e,{viewColumn:u.ViewColumn.Beside,preview:!1,preserveFocus:!0})}}catch(t){console.error("Error expanding pipeline:",t),showErrorWebview(t,e)}finally{d=!1,h&&scheduleRender(h,0)}};function buildResourceOverridesForDocument(e){if(!u||!e)return;const t=u.workspace.getConfiguration("azurePipelineStudio",e.uri).get("resourceLocations");if(!Array.isArray(t)||!t.length)return;const n=u.workspace.getWorkspaceFolder(e.uri),s=n?.uri.fsPath,r=e.fileName?i.dirname(e.fileName):void 0,l={};for(const e of t){if(!e||"object"!=typeof e)continue;const t=e.repository?.trim(),n=o(e.path,e.location);if(!t||!n)continue;const i=a(n,s,r);if(!i)continue;const c={location:i},p={};["repository","name","endpoint","ref","type"].forEach(t=>{const n=e[t]?.trim();n&&(p[t]=n)}),Object.keys(p).length&&(c.__match=p),l[t]=c}return Object.keys(l).length?{repositories:l}:void 0}const shouldRenderDocument=e=>{if(!e||!e.fileName)return!1;const t=e.fileName.toLowerCase();return t.endsWith(".yaml")||t.endsWith(".yml")},isRelevantDocument=e=>shouldRenderDocument(e)&&l?.fileName===e.fileName,w=u.commands.registerCommand("azurePipelineStudio.showRenderedYaml",async()=>{const e=u.window.activeTextEditor;e&&shouldRenderDocument(e.document)?await renderYamlDocument(e.document,{azureCompatible:!1}):u.window.showInformationMessage("Open an Azure Pipeline YAML file to view the expanded contents.")});e.subscriptions.push(w);const S=u.commands.registerCommand("azurePipelineStudio.showRenderedYamlAzureCompatible",async()=>{const e=u.window.activeTextEditor;e&&shouldRenderDocument(e.document)?await renderYamlDocument(e.document,{azureCompatible:!0}):u.window.showInformationMessage("Open an Azure Pipeline YAML file to view the expanded contents.")});e.subscriptions.push(S);const k=u.commands.registerCommand("azurePipelineStudio.formatOriginalYaml",async()=>{const t=u.window.activeTextEditor;t&&shouldRenderDocument(t.document)?await(async t=>{if(!t)return;const n=t.getText();let s;try{const i=getFormatSettings(t);if(i.fileName=t.fileName,i.wasExpanded=!1,s=c(n,i),s.error){const t=s.error instanceof Error?s.error:new Error(String(s.error));return void showErrorWebview(t,e,"formatting")}}catch(t){const n=t&&t.message?t.message:"An unexpected error occurred during YAML formatting";return void showErrorWebview(n,e,"formatting")}if(s.text===n)return void(s.warning?u.window.showWarningMessage(s.warning):u.window.showInformationMessage("YAML is already formatted."));const i=t.validateRange(new u.Range(0,0,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER)),r=new u.WorkspaceEdit;r.replace(t.uri,i,s.text),await u.workspace.applyEdit(r)?s.warning?u.window.showWarningMessage(s.warning):u.window.setStatusBarMessage("Applied YAML formatting.",3e3):u.window.showErrorMessage("Failed to apply YAML formatting changes.")})(t.document):u.window.showInformationMessage("Open an Azure Pipeline YAML file before formatting.")});e.subscriptions.push(k);const E=u.commands.registerCommand("azurePipelineStudio.configureResourceLocations",async()=>{try{console.log("[Azure Pipeline Studio] Configure Resource Locations command triggered"),await async function handleConfigureResourceLocationRequest(e){const t=l||(u.window.activeTextEditor&&shouldRenderDocument(u.window.activeTextEditor.document)?u.window.activeTextEditor.document:void 0);if(!t)return void u.window.showInformationMessage("Open an Azure Pipeline YAML file before configuring resource locations.");const n=u.workspace.getConfiguration("azurePipelineStudio",t.uri),s=n.get("resourceLocations"),i=Array.isArray(s)?s.filter(e=>e&&"object"==typeof e):[],getRepositoryAlias=e=>{if(!e||"object"!=typeof e)return;const t=[e.repository,e.alias,e.name];for(const e of t)if("string"==typeof e&&e.trim().length)return e.trim()};let r,a="string"==typeof e&&e.trim().length?e.trim():void 0;if(a)r=i.find(e=>getRepositoryAlias(e)===a);else{const e=i.map(e=>{const t=getRepositoryAlias(e);if(t)return{label:t,description:o(e.location,e.path)||"",entry:e}}).filter(Boolean);e.push({label:"$(plus) Add new repository mapping‚Ä¶",description:"Create a new entry for a repository resource.",newEntry:!0});const t=await u.window.showQuickPick(e,{placeHolder:"Select a repository resource to configure"});if(!t)return;if(t.newEntry){const e=await u.window.showInputBox({prompt:"Repository alias or name",placeHolder:"templatesRepo",ignoreFocusOut:!0});if(!e||!e.trim().length)return;a=e.trim()}else a=t.label,r=t.entry}if(!a)return;r||(r=i.find(e=>getRepositoryAlias(e)===a));const c=r?o(r.location,r.path):void 0,p=await u.window.showQuickPick([{label:"$(folder) Browse for folder",description:"Open a folder picker dialog",method:"browse"},{label:"$(edit) Enter path manually",description:"Type or paste a file path",method:"manual"}],{placeHolder:`Select how to specify location for repository '${a}'`,ignoreFocusOut:!0});if(!p)return;let f;if("browse"===p.method){const e=await u.window.showOpenDialog({canSelectFiles:!1,canSelectFolders:!0,canSelectMany:!1,openLabel:`Select location for '${a}'`,defaultUri:c?u.Uri.file(c):void 0});if(!e||0===e.length)return void u.window.showInformationMessage("Repository location not updated.");f=e[0].fsPath,console.log(`[Azure Pipeline Studio] Selected folder location: ${f}`)}else{if(f=await u.window.showInputBox({prompt:`Local path for repository '${a}'`,placeHolder:"${workspaceFolder}/path/to/templates",value:c||"",ignoreFocusOut:!0}),!f||!f.trim().length)return void u.window.showInformationMessage("Repository location not updated.");console.log(`[Azure Pipeline Studio] Entered manual location: ${f}`)}const d=f.trim(),h=[];let m=!1;i.forEach(e=>{if(getRepositoryAlias(e)===a){const t={...e,repository:a,location:d};delete t.path,h.push(t),m=!0}else h.push({...e})}),m||h.push({repository:a,location:d});u.workspace.getWorkspaceFolder(t.uri);const g=u.ConfigurationTarget.Workspace;try{console.log(`[Azure Pipeline Studio] About to save repository '${a}' location: ${d}`),console.log("[Azure Pipeline Studio] Target:",g),console.log("[Azure Pipeline Studio] Entries to save:",JSON.stringify(h,null,2)),await n.update("resourceLocations",h,g),console.log(`[Azure Pipeline Studio] Successfully saved repository '${a}' location: ${d}`),u.window.showInformationMessage(`Repository '${a}' location saved.`),await renderYamlDocument(t)}catch(e){console.error("[Azure Pipeline Studio] Error saving repository location:",e),u.window.showErrorMessage(`Failed to save repository location: ${e.message}`)}}()}catch(e){console.error("[Azure Pipeline Studio] Error in configure command:",e),u.window.showErrorMessage(`Configuration error: ${e.message}`)}});e.subscriptions.push(E);const A=u.commands.registerCommand("azurePipelineStudio.showDependencies",async()=>{const o=u.window.activeTextEditor;if(o&&shouldRenderDocument(o.document))try{const a=o.document.getText(),c=o.document,p=u.workspace.getConfiguration("azurePipelineStudio",c.uri),f=p.get("expansion.variables",{}),d=p.get("expansion.skipSyntaxCheck",!1),h=buildResourceOverridesForDocument(c),m={fileName:c.fileName,azureCompatible:!1,skipSyntaxCheck:d,...h&&{resources:h},...Object.keys(f).length&&{variables:f}};u.window.setStatusBarMessage("Expanding pipeline templates...",2e3);const g=t.expandPipelineFromString(a,m);let y;u.window.setStatusBarMessage("Analyzing dependencies...",2e3);try{y=r.analyzePipeline(g)}catch(t){return void showErrorWebview(t.message||"An error occurred while analyzing pipeline dependencies",e,"dependency")}const b=u.window.createWebviewPanel("pipelineDependencies","Pipeline Dependencies",u.ViewColumn.Beside,{enableScripts:!0}),v=y.stages.length>0||y.jobs.length>0?r.generateMermaidDiagram(y):"",x=l?.fileName?.split("/").pop()?.replace(".yaml","")||"Pipeline",w=y.stages.length||y.jobs.length||0,S=`<!DOCTYPE html>\n<html lang="en">\n<head>\n    <meta charset="UTF-8">\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n    <title>Pipeline Dependencies</title>\n    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"><\/script>\n    <style>\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n        }\n\n        body {\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n            background: #1e1e1e;\n            min-height: 100vh;\n            padding: 0;\n            margin: 0;\n        }\n\n        .container {\n            max-width: 100%;\n            margin: 0;\n            background: #252526;\n            overflow: hidden;\n        }\n\n        .header {\n            background: linear-gradient(135deg, #1a1a1a 0%, #0d0d0d 100%);\n            color: white;\n            padding: 30px;\n            border-bottom: 4px solid #D13438;\n        }\n\n        .header h1 {\n            font-size: 2em;\n            margin-bottom: 10px;\n            display: flex;\n            align-items: center;\n            gap: 15px;\n        }\n\n        .header-icon {\n            font-size: 1.2em;\n        }\n\n        .header-info {\n            display: flex;\n            gap: 30px;\n            margin-top: 15px;\n            font-size: 0.9em;\n            opacity: 0.9;\n        }\n\n        .header-info-item {\n            display: flex;\n            align-items: center;\n            gap: 8px;\n        }\n\n        .tabs {\n            display: flex;\n            background: #2d2d2d;\n            border-bottom: 2px solid #3e3e42;\n        }\n\n        .tab {\n            padding: 15px 30px;\n            cursor: pointer;\n            transition: all 0.3s;\n            border-bottom: 3px solid transparent;\n            font-weight: 500;\n            color: #cccccc;\n        }\n\n        .tab:hover {\n            background: #3e3e42;\n            color: #ffffff;\n        }\n\n        .tab.active {\n            background: #252526;\n            border-bottom-color: #D13438;\n            color: #ffffff;\n        }\n\n        .content {\n            padding: 20px;\n            min-height: calc(100vh - 200px);\n            background: #252526;\n        }\n\n        .tab-content {\n            display: none;\n        }\n\n        .tab-content.active {\n            display: block;\n            animation: fadeIn 0.3s;\n        }\n\n        @keyframes fadeIn {\n            from { opacity: 0; transform: translateY(10px); }\n            to { opacity: 1; transform: translateY(0); }\n        }\n\n        .diagram-container {\n            background: #1e1e1e;\n            border-radius: 0;\n            padding: 20px;\n            margin-bottom: 0;\n            overflow-x: auto;\n        }\n\n        .mermaid {\n            display: flex;\n            justify-content: center;\n            background: #1e1e1e;\n            border-radius: 0;\n            min-height: 400px;\n            overflow: auto;\n        }\n\n        .legend {\n            display: flex;\n            gap: 20px;\n            padding: 10px 20px;\n            background: #2d2d2d;\n            border-radius: 0;\n            margin-bottom: 10px;\n            flex-wrap: wrap;\n        }\n\n        .legend-item {\n            display: flex;\n            align-items: center;\n            gap: 8px;\n            font-size: 0.9em;\n            color: #cccccc;\n        }\n\n        .legend-color {\n            width: 20px;\n            height: 20px;\n            border-radius: 2px;\n        }\n\n        .stage-list {\n            display: grid;\n            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));\n            gap: 20px;\n            margin-top: 20px;\n        }\n\n        .stage-card {\n            background: #1e1e1e;\n            border-radius: 4px;\n            padding: 20px;\n            border-left: 4px solid #4299e1;\n            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);\n            transition: all 0.3s;\n            cursor: pointer;\n        }\n\n        .stage-card:hover {\n            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);\n            transform: translateY(-2px);\n        }\n\n        .stage-divider {\n            grid-column: 1 / -1;\n            height: 1px;\n            background: linear-gradient(to right, transparent, #3e3e42, transparent);\n            margin: 10px 0;\n        }\n\n        .stage-card h3 {\n            color: #ffffff;\n            margin-bottom: 10px;\n            display: flex;\n            align-items: center;\n            justify-content: space-between;\n        }\n\n        .stage-number {\n            display: inline-block;\n            width: 28px;\n            height: 28px;\n            background: #4299e1;\n            color: white;\n            border-radius: 4px;\n            text-align: center;\n            line-height: 28px;\n            font-size: 0.85em;\n            margin-right: 10px;\n        }\n\n        .stage-deps {\n            margin-top: 15px;\n            padding-top: 15px;\n            border-top: 1px solid #3e3e42;\n        }\n\n        .stage-deps-title {\n            font-size: 0.85em;\n            font-weight: 600;\n            color: #cccccc;\n            margin-bottom: 8px;\n        }\n\n        .dep-badge {\n            display: inline-block;\n            background: #3e3e42;\n            color: #e0e0e0;\n            padding: 4px 12px;\n            border-radius: 4px;\n            font-size: 0.8em;\n            margin-right: 6px;\n            margin-bottom: 6px;\n        }\n\n        .stage-details {\n            display: none;\n            margin-top: 20px;\n            padding-top: 20px;\n            border-top: 2px solid #3e3e42;\n            color: #cccccc;\n        }\n\n        .stage-card.expanded .stage-details {\n            display: block;\n        }\n\n        .expand-icon {\n            transition: transform 0.3s;\n        }\n\n        .stage-card.expanded .expand-icon {\n            transform: rotate(180deg);\n        }\n\n        .search-box {\n            margin-bottom: 20px;\n            position: relative;\n        }\n\n        .search-box input {\n            width: 100%;\n            padding: 12px 40px 12px 16px;\n            border: 2px solid #3e3e42;\n            border-radius: 4px;\n            font-size: 1em;\n            background: #1e1e1e;\n            color: #e0e0e0;\n            transition: border-color 0.3s;\n        }\n\n        .search-box input:focus {\n            outline: none;\n            border-color: #D13438;\n        }\n\n        .critical-path-box {\n            background: #ffeef0;\n            border-left: 4px solid #e53e3e;\n            padding: 20px;\n            border-radius: 4px;\n            margin: 20px 0;\n        }\n\n        .critical-path-box h3 {\n            color: #c53030;\n            margin-bottom: 10px;\n        }\n\n        .critical-path-box p {\n            font-family: 'Courier New', monospace;\n            color: #742a2a;\n            line-height: 1.8;\n            margin-bottom: 15px;\n        }\n\n        .resources-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));\n            gap: 20px;\n        }\n\n        .resource-card {\n            background: #1e1e1e;\n            border-radius: 4px;\n            padding: 20px;\n            border-left: 4px solid #48bb78;\n            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);\n        }\n\n        .resource-card h3 {\n            color: #ffffff;\n            margin-bottom: 15px;\n            display: flex;\n            align-items: center;\n            gap: 10px;\n        }\n\n        .resource-type {\n            display: inline-block;\n            background: #48bb78;\n            color: white;\n            padding: 4px 12px;\n            border-radius: 4px;\n            font-size: 0.75em;\n            font-weight: 600;\n            text-transform: uppercase;\n        }\n\n        .resource-details {\n            font-size: 0.9em;\n            color: #cccccc;\n        }\n\n        .resource-details div {\n            padding: 6px 0;\n            border-bottom: 1px solid #3e3e42;\n        }\n\n        .resource-details div:last-child {\n            border-bottom: none;\n        }\n        \n        .resource-details strong {\n            color: #ffffff;\n        }\n\n        @media (max-width: 768px) {\n            .stage-list {\n                grid-template-columns: 1fr;\n            }\n            .header h1 {\n                font-size: 1.5em;\n            }\n            .tabs {\n                overflow-x: auto;\n            }\n            .tab {\n                padding: 12px 20px;\n                white-space: nowrap;\n            }\n        }\n        \n        h2 {\n            color: #ffffff;\n        }\n        \n        p {\n            color: #cccccc;\n        }\n    </style>\n</head>\n<body>\n    <div class="container">\n        <div class="header">\n            <div style="display: flex; align-items: center; gap: 12px;">\n                <h1 style="margin: 0;">\n                    <span class="header-icon">üîÑ</span>\n                    Pipeline Dependencies\n                </h1>\n                <button onclick="openInBrowser()" style="padding: 8px 16px; background: #0078d4; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; font-weight: 500;">üåê Open in Browser</button>\n            </div>\n            <div class="header-info">\n                <div class="header-info-item">\n                    <span>üìÑ</span>\n                    <span>File: ${x}</span>\n                </div>\n                <div class="header-info-item">\n                    <span>üèóÔ∏è</span>\n                    <span>${w} Stage${1!==w?"s":""}</span>\n                </div>\n            </div>\n        </div>\n\n        <div class="tabs">\n            <div class="tab active" data-tab="diagram" onclick="switchTab('diagram')">üìä Diagram</div>\n            <div class="tab" data-tab="stages" onclick="switchTab('stages')">üéØ Details</div>\n            ${y.resources.length>0?'<div class="tab" data-tab="resources" onclick="switchTab(\'resources\')">üìö Resources</div>':""}\n        </div>\n\n        <div class="content">\n            \x3c!-- Diagram Tab --\x3e\n            <div class="tab-content active" id="diagram">\n                <div class="legend">\n                    <div class="legend-item">\n                        <div class="legend-color" style="background: #D13438;"></div>\n                        <span>üî¥ Critical Path</span>\n                    </div>\n                    <div class="legend-item">\n                        <div class="legend-color" style="background: #1d4ed8;"></div>\n                        <span>Build Stages</span>\n                    </div>\n                    <div class="legend-item">\n                        <div class="legend-color" style="background: #16a34a;"></div>\n                        <span>Release Stages</span>\n                    </div>\n                    <div class="legend-item">\n                        <div class="legend-color" style="background: #ea580c;"></div>\n                        <span>Security/Signing</span>\n                    </div>\n                </div>\n\n                <div class="diagram-container">\n                    <div class="mermaid">\n${v.split("\n").map(e=>"                        "+e).join("\n")}\n                    </div>\n                </div>\n            </div>\n\n            \x3c!-- Details Tab --\x3e\n            <div class="tab-content" id="stages">\n                <div class="stage-list" id="stageList">\n                    \x3c!-- Stages will be populated dynamically --\x3e\n                </div>\n            </div>\n\n            \x3c!-- Resources Tab --\x3e\n            ${y.resources.length>0?`\n            <div class="tab-content" id="resources">\n                <h2 style="margin-bottom: 20px; color: #2d3748;">Pipeline Resources</h2>\n                <div class="resources-grid">\n                    ${y.resources.map(e=>`\n                        <div class="resource-card">\n                            <h3>\n                                <span class="resource-type">${e.type}</span>\n                                ${e.name}\n                            </h3>\n                            <div class="resource-details">\n                                <div><strong>Type:</strong> ${e.type}</div>\n                                ${e.source?"<div><strong>Source:</strong> "+e.source+"</div>":""}\n                            </div>\n                        </div>\n                    `).join("")}\n                </div>\n            </div>\n            `:""}\n        </div>\n    </div>\n\n    <script>\n        const stagesData = ${JSON.stringify(y.stages.map((e,t)=>({...e,number:t+1})))};\n        \n        // Open in browser function\n        window.openInBrowser = function() {\n            const vscode = acquireVsCodeApi();\n            vscode.postMessage({ command: 'openInBrowser' });\n        };\n        \n        // Global tab switching function\n        window.switchTab = function(tabName) {\n            // Hide all tab contents\n            const allContents = document.querySelectorAll('.tab-content');\n            for (let i = 0; i < allContents.length; i++) {\n                allContents[i].classList.remove('active');\n            }\n            \n            // Remove active class from all tabs\n            const allTabs = document.querySelectorAll('.tab');\n            for (let i = 0; i < allTabs.length; i++) {\n                allTabs[i].classList.remove('active');\n            }\n            \n            // Show the selected tab content\n            const selectedContent = document.getElementById(tabName);\n            if (selectedContent) {\n                selectedContent.classList.add('active');\n            }\n            \n            // Mark the clicked tab as active\n            const selectedTab = document.querySelector('.tab[data-tab="' + tabName + '"]');\n            if (selectedTab) {\n                selectedTab.classList.add('active');\n            }\n            \n            // Render stages when Details tab is opened\n            if (tabName === 'stages') {\n                renderStages();\n            }\n        };\n        \n        window.renderStages = function() {\n            const stageList = document.getElementById('stageList');\n            if (!stageList) return;\n            \n            let html = '';\n            for (let i = 0; i < stagesData.length; i++) {\n                const stage = stagesData[i];\n                let depsHtml = '';\n                \n                if (stage.dependsOn && stage.dependsOn.length > 0) {\n                    depsHtml = '<div class="stage-deps"><div class="stage-deps-title">Dependencies:</div>';\n                    for (let j = 0; j < stage.dependsOn.length; j++) {\n                        depsHtml += '<span class="dep-badge">' + stage.dependsOn[j] + '</span>';\n                    }\n                    depsHtml += '</div>';\n                } else {\n                    depsHtml = '<div class="stage-deps"><div class="stage-deps-title">Entry stage (no dependencies)</div></div>';\n                }\n                \n                html += '<div class="stage-card" data-stage="' + stage.name + '">';\n                html += '<h3>';\n                html += '<span>';\n                html += '<span class="stage-number">' + stage.number + '</span>';\n                html += (stage.displayName || stage.name);\n                html += '</span>';\n                html += '<span class="expand-icon">‚ñº</span>';\n                html += '</h3>';\n                html += depsHtml;\n                html += '<div class="stage-details">';\n                html += '<p style="color: #4a5568; margin-bottom: 10px;">';\n                html += (stage.jobs ? 'Jobs: ' + stage.jobs.length : 'Stage');\n                html += '</p>';\n                html += '</div>';\n                html += '</div>';\n                \n                // Add divider between stages\n                if (i < stagesData.length - 1) {\n                    html += '<div class="stage-divider"></div>';\n                }\n            }\n            \n            stageList.innerHTML = html;\n            \n            // Add click handlers to stage cards\n            const stageCards = document.querySelectorAll('.stage-card');\n            for (let i = 0; i < stageCards.length; i++) {\n                stageCards[i].addEventListener('click', function() {\n                    this.classList.toggle('expanded');\n                });\n            }\n        };\n        \n        // Initialize Mermaid\n        mermaid.initialize({ \n            startOnLoad: true,\n            theme: 'dark',\n            flowchart: {\n                useMaxWidth: true,\n                htmlLabels: true,\n                curve: 'basis'\n            }\n        });\n        mermaid.contentLoaded();\n        \n        // Initial render\n        renderStages();\n    <\/script>\n</body>\n</html>`;b.webview.html=S,b.webview.onDidReceiveMessage(async e=>{if("openInBrowser"===e.command)try{const e=n(5),t=i.join(e.tmpdir(),`pipeline-dependencies-${Date.now()}.html`);s.writeFileSync(t,S),await u.env.openExternal(u.Uri.file(t)),u.window.showInformationMessage("Opened dependencies in browser")}catch(e){u.window.showErrorMessage(`Failed to open in browser: ${e.message}`)}},void 0,e.subscriptions),u.window.setStatusBarMessage("Pipeline dependencies analyzed.",3e3)}catch(t){console.error("Error analyzing dependencies:",t),showErrorWebview(t.message||"An unexpected error occurred while analyzing pipeline dependencies",e,"dependency")}else u.window.showInformationMessage("Open an Azure Pipeline YAML file to view dependencies.")});e.subscriptions.push(A),e.subscriptions.push(u.workspace.onDidCloseTextDocument(e=>{e.uri.scheme===m&&g.delete(e.uri.toString())})),e.subscriptions.push(u.workspace.onDidChangeTextDocument(({document:e})=>{isRelevantDocument(e)&&(scheduleRender(e),l&&l.fileName===e.fileName&&renderYamlDocument(e,{silent:!0}))})),e.subscriptions.push(u.workspace.onDidSaveTextDocument(e=>{if(!isRelevantDocument(e))return;u.workspace.getConfiguration("azurePipelineStudio",e.uri).get("refreshOnSave",!0)&&scheduleRender(e,0)}))},deactivate:function deactivate(){},AzurePipelineParser,formatYaml:c,formatFilesRecursively,DependencyAnalyzer:p},n.c[n.s]===e&&function runCli(e){if(void 0!==u)return;const t="Usage: node extension.js <file1> <file2> ...\nOptions:\n  -h, --help                   Show this help message\n  -o, --output <file>          Write output to file (default: in-place, only with single file)\n  -r, --repo <alias=path>      Map repository alias to local path\n  -v, --variables <key=value>  Set compile-time variables (e.g., Build.Reason=Manual)\n  -f, --format-option <key=value>  Set format option (e.g., indent=4)\n  -R, --format-recursive <path>    Format files recursively in directory (when used, all paths are treated as recursive targets)\n  -e, --extension <ext>        File extensions to format (default: .yml, .yaml)\n  -x, --expand-templates       Expand Azure Pipeline template expressions (${{}},$[],$())\n  -a, --azure-compatible       Use Azure-compatible expansion mode (adds blank lines, etc.)\n  -s, --skip-syntax-check      Skip syntax checking during expansion\n  -d, --debug                  Print files being formatted",n=r(e,{string:["output","repo","format-option","format-recursive","extension","variables"],boolean:["help","expand-templates","azure-compatible","skip-syntax-check","debug"],alias:{h:"help",o:"output",r:"repo",f:"format-option",R:"format-recursive",e:"extension",v:"variables",x:"expand-templates",a:"azure-compatible",s:"skip-syntax-check",d:"debug"},default:{extension:[],"expand-templates":!1,"azure-compatible":!1,"skip-syntax-check":!1,debug:!1}});n.help&&(console.log(t),process.exit(0));const toArray=e=>[].concat(e||[]),o=toArray(n.repo),l=toArray(n.variables),p=toArray(n["format-option"]),f=n["format-recursive"],d=toArray(f).filter(e=>"string"==typeof e&&e.trim().length),h=e.includes("-R")||e.includes("--format-recursive")||!0===f,m=toArray(n.extension),g=[],y={},b=[];for(const e of o){const[t,...n]=e.split("="),s=n.join("=").trim();t&&t.trim()&&s?g.push({alias:t.trim(),path:s}):b.push(`Invalid repository mapping "${e}". Expected format "alias=path".`)}for(const e of l){const[t,...n]=e.split("="),s=n.join("=").trim();t&&t.trim()&&void 0!==s?y[t.trim()]=s:b.push(`Invalid variable "${e}". Expected format "key=value".`)}for(const e of p)e.includes("=")||b.push(`Invalid format option "${e}". Expected format "key=value".`);if(b.length)return b.forEach(e=>console.error(e)),console.error(t),void(process.exitCode=1);const v=n._,x=h||d.length?[...d,...v]:[];if(h&&0===x.length)return console.error("Error: --format-recursive requires at least one path."),console.error(t),void(process.exitCode=1);if(x.length){const e=buildFormatOptionsFromCli(p)||{},t=formatFilesRecursively(x,m.length?m:[".yml",".yaml"],e);return t.formattedFiles.forEach(e=>{const t=i.relative(process.cwd(),e)||e;console.log(`Formatted: ${t}`)}),console.log(`Processed ${t.totalFiles} file(s); formatted ${t.formattedFiles.length}.`),t.warnings.forEach(e=>{const t=i.relative(process.cwd(),e.filePath)||e.filePath;console.warn(`[warn] ${t}: ${e.message}`)}),t.errors.forEach(e=>{const t=i.relative(process.cwd(),e.filePath)||e.filePath;console.error(`[error] ${t}: ${e.message}`)}),void(t.errors.length&&(process.exitCode=1))}if(0===v.length)return console.error(t),void(process.exitCode=1);if(n.output&&v.length>1)return console.error("Error: --output option is only supported when formatting a single file."),console.error(t),void(process.exitCode=1);const w=buildFormatOptionsFromCli(p)||{},S=function buildRepositoryOverridesFromCliEntries(e,t){if(!Array.isArray(e)||0===e.length)return;const n={};return e.forEach(e=>{if(!e||"object"!=typeof e)return;const s=e.alias,i=e.path;if("string"!=typeof s||!s.trim().length||"string"!=typeof i||!i.trim().length)return;const r=a(i,t,void 0);r?n[s]={repository:s,location:r}:console.warn(`Skipping repository mapping '${s}': could not resolve path '${i}'.`)}),Object.keys(n).length?n:void 0}(g,process.cwd()),k=Object.keys(y).length>0?y:void 0,E=n["expand-templates"]?new AzurePipelineParser:null;let A=!1;for(const e of v){const t=i.resolve(process.cwd(),e);n.debug&&console.log(`[DEBUG] Formatting: ${t}`);try{const r=s.readFileSync(t,"utf8");let o=r;if(n["expand-templates"]&&E){const s={fileName:t,azureCompatible:n["azure-compatible"]||!1,skipSyntaxCheck:n["skip-syntax-check"]||!1};if(S){const e={};for(const[t,n]of Object.entries(S))e[t]=n.location||n.path;s.resourceLocations=e,n.debug&&console.log("[DEBUG] Resource locations:",JSON.stringify(e,null,2))}k&&(s.variables=k,n.debug&&console.log("[DEBUG] Compile-time variables:",JSON.stringify(k,null,2)));try{expandedYaml=E.expandPipelineFromString(r,s),o=expandedYaml}catch(t){const s="string"==typeof t?.message?t.message:String(t),i=s.match(/Template\s+'([^']+)'\s+potential issues:([\s\S]*)/);if(i){const t=i[1],n=(i[2]||"").trimEnd(),s=`[${e}] Template(${t}) expansion failed. Potential issues:${n?`${n}`:""}`;console.error(s)}else{const t=s.split("\n"),n=t[0],i=t.slice(1).map(e=>"  "+e).join("\n"),r=i?`[${e}] Template expansion failed\n  ${n}\n${i}`:`[${e}] Template expansion failed\n  ${n}`;console.error(r)}n.debug&&console.error("[DEBUG] Full error:",t),A=!0;continue}}const a={...w||{},fileName:t};delete a.expandTemplates,n["expand-templates"]&&(a.wasExpanded=!0,a.azureCompatible=n["azure-compatible"]||!1);const l=c(o,a);if(l.error){const t=l.error.split("\n").map((e,t)=>0===t?e:"  "+e).join("\n");console.error(`[${e}] ${t}`),A=!0;continue}if(l.warning){const t=l.warning.split("\n").map((e,t)=>0===t?e:"  "+e).join("\n");console.warn(`[${e}] ${t}`)}let p=l.text;if(n["expand-templates"]&&n["azure-compatible"]&&(p=E.addHeredocListSpacing(p)),n.output){const e=i.resolve(process.cwd(),n.output);if(s.writeFileSync(e,p,"utf8"),r!==p){const t=n["expand-templates"]?"Expanded":"Formatted";console.log(`${t} pipeline written to ${e}`)}}else n["expand-templates"]?console.log(p):r!==p&&(s.writeFileSync(t,p,"utf8"),console.log(`Formatted ${e} (in-place)`))}catch(t){console.error(`[${e}] ${t.message}`),A=!0}}A&&(process.exitCode=1)}(process.argv.slice(2))},e=>{"use strict";e.exports=require("fs")},e=>{"use strict";e.exports=require("path")},e=>{"use strict";function isNumber(e){return"number"==typeof e||(!!/^0x[0-9a-f]+$/i.test(e)||/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(e[-+]?\d+)?$/.test(e))}function isConstructorOrProto(e,t){return"constructor"===t&&"function"==typeof e[t]||"__proto__"===t}e.exports=function(e,t){t||(t={});var n={bools:{},strings:{},unknownFn:null};"function"==typeof t.unknown&&(n.unknownFn=t.unknown),"boolean"==typeof t.boolean&&t.boolean?n.allBools=!0:[].concat(t.boolean).filter(Boolean).forEach(function(e){n.bools[e]=!0});var s={};function aliasIsBoolean(e){return s[e].some(function(e){return n.bools[e]})}Object.keys(t.alias||{}).forEach(function(e){s[e]=[].concat(t.alias[e]),s[e].forEach(function(t){s[t]=[e].concat(s[e].filter(function(e){return t!==e}))})}),[].concat(t.string).filter(Boolean).forEach(function(e){n.strings[e]=!0,s[e]&&[].concat(s[e]).forEach(function(e){n.strings[e]=!0})});var i=t.default||{},r={_:[]};function setKey(e,t,s){for(var i=e,r=0;r<t.length-1;r++){var o=t[r];if(isConstructorOrProto(i,o))return;void 0===i[o]&&(i[o]={}),i[o]!==Object.prototype&&i[o]!==Number.prototype&&i[o]!==String.prototype||(i[o]={}),i[o]===Array.prototype&&(i[o]=[]),i=i[o]}var a=t[t.length-1];isConstructorOrProto(i,a)||(i!==Object.prototype&&i!==Number.prototype&&i!==String.prototype||(i={}),i===Array.prototype&&(i=[]),void 0===i[a]||n.bools[a]||"boolean"==typeof i[a]?i[a]=s:Array.isArray(i[a])?i[a].push(s):i[a]=[i[a],s])}function setArg(e,t,i){if(!i||!n.unknownFn||function argDefined(e,t){return n.allBools&&/^--[^=]+$/.test(t)||n.strings[e]||n.bools[e]||s[e]}(e,i)||!1!==n.unknownFn(i)){var o=!n.strings[e]&&isNumber(t)?Number(t):t;setKey(r,e.split("."),o),(s[e]||[]).forEach(function(e){setKey(r,e.split("."),o)})}}Object.keys(n.bools).forEach(function(e){setArg(e,void 0!==i[e]&&i[e])});var o=[];-1!==e.indexOf("--")&&(o=e.slice(e.indexOf("--")+1),e=e.slice(0,e.indexOf("--")));for(var a=0;a<e.length;a++){var l,c,p=e[a];if(/^--.+=/.test(p)){var u=p.match(/^--([^=]+)=([\s\S]*)$/);l=u[1];var f=u[2];n.bools[l]&&(f="false"!==f),setArg(l,f,p)}else if(/^--no-.+/.test(p))setArg(l=p.match(/^--no-(.+)/)[1],!1,p);else if(/^--.+/.test(p))l=p.match(/^--(.+)/)[1],void 0===(c=e[a+1])||/^(-|--)[^-]/.test(c)||n.bools[l]||n.allBools||s[l]&&aliasIsBoolean(l)?/^(true|false)$/.test(c)?(setArg(l,"true"===c,p),a+=1):setArg(l,!n.strings[l]||"",p):(setArg(l,c,p),a+=1);else if(/^-[^-]+/.test(p)){for(var d=p.slice(1,-1).split(""),h=!1,m=0;m<d.length;m++)if("-"!==(c=p.slice(m+2))){if(/[A-Za-z]/.test(d[m])&&"="===c[0]){setArg(d[m],c.slice(1),p),h=!0;break}if(/[A-Za-z]/.test(d[m])&&/-?\d+(\.\d*)?(e-?\d+)?$/.test(c)){setArg(d[m],c,p),h=!0;break}if(d[m+1]&&d[m+1].match(/\W/)){setArg(d[m],p.slice(m+2),p),h=!0;break}setArg(d[m],!n.strings[d[m]]||"",p)}else setArg(d[m],c,p);l=p.slice(-1)[0],h||"-"===l||(!e[a+1]||/^(-|--)[^-]/.test(e[a+1])||n.bools[l]||s[l]&&aliasIsBoolean(l)?e[a+1]&&/^(true|false)$/.test(e[a+1])?(setArg(l,"true"===e[a+1],p),a+=1):setArg(l,!n.strings[l]||"",p):(setArg(l,e[a+1],p),a+=1))}else if(n.unknownFn&&!1===n.unknownFn(p)||r._.push(n.strings._||!isNumber(p)?p:Number(p)),t.stopEarly){r._.push.apply(r._,e.slice(a+1));break}}return Object.keys(i).forEach(function(e){(function hasKey(e,t){var n=e;return t.slice(0,-1).forEach(function(e){n=n[e]||{}}),t[t.length-1]in n})(r,e.split("."))||(setKey(r,e.split("."),i[e]),(s[e]||[]).forEach(function(t){setKey(r,t.split("."),i[e])}))}),t["--"]?r["--"]=o.slice():o.forEach(function(e){r._.push(e)}),r}},(e,t,n)=>{const s=n(5),i=n(2);e.exports={pickFirstString:function pickFirstString(...e){for(const t of e)if("string"==typeof t&&t.trim().length)return t},resolveConfiguredPath:function resolveConfiguredPath(e,t,n){if("string"!=typeof e)return;let r=e.trim();if(!r.length)return;const o=s.homedir();return r=r.replace(/^~(?=$|[\/])/,o),r=r.replace(/\$\{workspaceFolder\}/g,t||""),r=r.replace(/\$\{env:([^}]+)\}/g,(e,t)=>process.env[t]||""),r=r.replace(/\$\{([^}]+)\}/g,(e,n)=>"workspaceFolder"===n?t||"":Object.prototype.hasOwnProperty.call(process.env,n)?process.env[n]:e),i.isAbsolute(r)?i.normalize(r):t?i.normalize(i.resolve(t,r)):n?i.normalize(i.resolve(n,r)):i.normalize(i.resolve(process.cwd(),r))},normalizeExtension:function normalizeExtension(e){if("string"!=typeof e)return;const t=e.trim().toLowerCase();return t?t.startsWith(".")?t:`.${t}`:void 0}}},e=>{"use strict";e.exports=require("os")},(e,t,n)=>{const s=n(7);function escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function isConditionalDirective(e,t=null){const n=e.trim().replace(/^-\s+/,"");if(/^\$\{\{\s*(if|elseif|else|each|insert)(\s|\})/i.test(n))return!0;if(t){const e=n.match(/^(__EXPR_PLACEHOLDER_\d+__)/);if(e&&t.has(e[1]))return!0}return!1}function replaceTemplateExpressionsWithPlaceholders(e){if(!e)return{content:e,placeholderMap:new Map,conditionalDirectives:new Set};const t=new Map,n=new Set;let s=0;return{content:e.replace(/(\$\{\{[^}]+\}\}|\$\[[^\]]+\])/g,e=>{const i="__EXPR_PLACEHOLDER_"+s+"__";let r=e;return e.startsWith("${{")&&e.endsWith("}}")&&!/[\r\n\t]/.test(e)&&(r=e.replace(/^\$\{\{\s*/,"${{ ").replace(/\s*\}\}$/," }}")),t.set(i,r),isConditionalDirective(r)&&n.add(i),s++,i}),placeholderMap:t,conditionalDirectives:n}}function restoreTemplateExpressions(e,t){if(!e||!t||0===t.size)return e;let n=e;for(const[e,s]of t)n=n.replace(new RegExp(escapeRegExp(e),"g"),s);return n=n.replace(/\}\}\s+:/g,"}}:"),n}function parseFormatDirectives(e){const t={disabled:!1,options:null},n=e.split(/\r?\n/).slice(0,5);for(const e of n){const n=e.trim();if(isComment(e)&&("# aps-format=false"===n||"# aps-format: false"===n))return t.disabled=!0,t;const s=n.match(/^#\s*aps-format[:\s]+(.+)$/);if(s){const e=s[1].trim();t.options=parseDirectiveOptions(e)}if(hasActualContent(e))break}return t}function parseDirectiveOptions(e){const t={},n=e.split(",");for(const e of n){const[n,s]=e.split("=").map(e=>e.trim());if(n&&void 0!==s)switch(n.toLowerCase()){case"newline":case"newlineformat":t.newlineFormat=s.replace(/\\r\\n/g,"\r\n").replace(/\\n/g,"\n").replace(/\\r/g,"\r");break;case"linewidth":const e=parseInt(s,10);isNaN(e)||(t.lineWidth=e);break;case"indent":const n=parseInt(s,10);!isNaN(n)&&n>0&&n<=8&&(t.indent=n);break;case"noarrayindent":t.noArrayIndent="true"===s.toLowerCase();break;case"forcequotes":t.forceQuotes="true"===s.toLowerCase();break;case"sortkeys":t.sortKeys="true"===s.toLowerCase();break;case"preservecomments":t.preserveComments="true"===s.toLowerCase();break;case"stepspacing":t.stepSpacing="true"===s.toLowerCase();break;case"sectionspacing":t.sectionSpacing="true"===s.toLowerCase();break;case"normalizepaths":t.normalizePaths="true"===s.toLowerCase();break;case"expandtemplates":t.expandTemplates="true"===s.toLowerCase()}}return t}function validateTemplateExpressions(e,t){const n=[];let s=0;for(;s<e.length;){const i=e.indexOf("${{",s);if(-1===i)break;const r=e.indexOf("}}",i+3);if(-1===r){n.push(`line ${t}: Missing closing '}}' for template expression starting at column ${i+1}.`);break}s=r+2}const i=e.matchAll(/\$\{\{([\s\S]*?)\}\}/g);for(const e of i){const s=e[1];let i=0,r=0,o=0,a=!1,l=null;for(let e=0;e<s.length;e++){const c=s[e];if('"'===c||"'"===c){let t=!1;if('"'===c){let n=0,i=e-1;for(;i>=0&&"\\"===s[i];)n++,i--;t=n%2==1}t||(a?c===l&&(a=!1,l=null):(a=!0,l=c))}a||("("===c?i++:")"===c?i--:"["===c?r++:"]"===c?r--:"{"===c?o++:"}"===c&&o--,i<0&&(n.push(`line ${t}: Unbalanced parentheses in template expression - extra closing ')' found.`),i=0),r<0&&(n.push(`line ${t}: Unbalanced brackets in template expression - extra closing ']' found.`),r=0),o<0&&(n.push(`line ${t}: Unbalanced braces in template expression - extra closing '}}' found.`),o=0))}a?n.push(`line ${t}: Unclosed string in template expression - missing closing ${l} quote.`):(i>0&&n.push(`line ${t}: Unbalanced parentheses in template expression - missing ${i} closing ')'.`),r>0&&n.push(`line ${t}: Unbalanced brackets in template expression - missing ${r} closing ']'.`),o>0&&n.push(`line ${t}: Unbalanced braces in template expression - missing ${o} closing '}'.`))}return n}function analyzeTemplateHints(e,t=new Set){if("string"!=typeof e||!e.length)return[];const n=[],s=e.split(/\r?\n/);let i=!1,r=!1,o=-1,a=-1,l=-1;for(let e=0;e<s.length;e++){const c=s[e],p=c.trim();if(p&&!p.startsWith("#")){const t=c.match(/^(\s*)/)[1].length;if(p.startsWith("jobs:")&&(i=!0,l=t,r=!1,o=-1),i){(p.match(/^-\s+job:/)||p.startsWith("job:"))&&(r=!0,a=e+1,o=-1);const s=p.match(/^\$\{\{/)||p.match(/^\$\[/);if(!s&&t<=l&&p.includes(":")&&!p.startsWith("-")&&!p.startsWith("${{")&&!p.startsWith("jobs:")&&(i=!1,r=!1),r&&!s){const s=/^(displayName|dependsOn|condition|workspace|pool|strategy|timeoutInMinutes|cancelTimeoutInMinutes|variables|container|services):/;p.match(s)&&-1===o&&(o=t),p.startsWith("steps:")&&(-1!==o&&t<o&&n.push(`line ${e+1}: 'steps:' is not properly indented under the job.\n    Expected ${o} spaces (same as other job properties like 'displayName' or 'pool'), but found ${t} spaces.\n    The 'steps:' property must be at the same indentation level as other job properties (job starts at line ${a}).`),r=!1);const i=/^-\s+(script|task|bash|pwsh|powershell|checkout|download|publish|template):/;if(p.match(i)){if(-1!==o&&t<o){const s=p.match(i)[1];n.push(`line ${e+1}: Step item '- ${s}:' is not properly indented under the job.\n    Expected ${o} spaces (same as other job properties like 'displayName' or 'pool'), but found ${t} spaces.\n    Step items must be at the same indentation level as other job properties (job starts at line ${a}).`)}r=!1}r&&(p.match(/^-\s+job:/)||p.startsWith("job:")&&-1!==o&&t<=o)&&-1!==o&&(r=!1)}}}if(isStandaloneExpression(c)&&!isMappingKey(c)&&containsConditionalKeyword(c)){const t="- ${{ if ... }}:";n.push(`line ${e+1}: Add ':' after the expression (e.g., '${t}').`)}hasElseIfTypo(c)&&n.push(`line ${e+1}: Use 'elseif' instead of 'else if' in Azure expressions.`);const u=c.match(/\b(eq|ne|contains|startsWith|endsWith)\s*\(([^)]*)\)/i);if(u){const t=u[2],s=t.includes(","),i=t.trim().split(/\s+/);!s&&i.length>=2&&n.push(`line ${e+1}: Add a comma between arguments (e.g., ${u[1]}(a, b)).`)}if(isExpressionWithColon(p)&&!p.startsWith("-")){let i=!1;const r=getIndent(c);for(let t=e-1;t>=0;t--){const e=s[t];if(!isBlank(e)){if(isListItem(e)){r===getIndent(e)&&(i=!0)}break}}if(!i)for(let t=e+1;t<s.length;t++){const e=s[t];if(!isBlank(e)){if(isListItem(e)){r===getIndent(e)&&(i=!0)}break}}if((i||!isConditionalDirective(p,t))&&i){const t="- ${{ if ... }}:";n.push(`line ${e+1}: Prepend '-' for list items using expressions (e.g., '${t}').`)}}const f=validateTemplateExpressions(c,e+1);n.push(...f)}return n}function findNextNonBlankLine(e,t){for(let n=t;n<e.length;n++)if(!isBlank(e[n]))return n;return null}function isMainSectionKey(e){return"steps:"===e||"stages:"===e||"jobs:"===e}function isMappingKey(e){return!(!e||"string"!=typeof e)&&e.trim().endsWith(":")}function isComment(e){if(!e||"string"!=typeof e)return!1;return e.trim().startsWith("#")}function isListItem(e){if(!e||"string"!=typeof e)return!1;const t=e.trim();return/^\s*-\s/.test(t)}function isBlank(e){return!e||"string"!=typeof e||""===e.trim()}function hasActualContent(e){return!isBlank(e)&&!isComment(e)}function isBlankOrCommentLine(e){return isBlank(e)||isComment(e)}function isNonCommentContent(e){return e&&!e.startsWith("#")}function isConditionalListItem(e){return/^-\s+\$\{\{\s*(if|else|elseif|each)\s/.test(e)}function containsTemplateExpression(e){return"string"==typeof e&&e.includes("${{")}function containsConditionalKeyword(e){return/\$\{\{\s*(if|else|elseif|each)\s/.test(e)}function hasElseIfTypo(e){const t=e.trim();return/\belse\s+if\b/i.test(t)}function isStandaloneExpression(e){const t=e.trim();return/^-?\s*\$\{\{[^}]+\}\}\s*$/.test(t)}function isExpressionWithColon(e){return/^\$\{\{[^}]+\}\}\s*:/.test(e)||/^__EXPR_PLACEHOLDER_\d+__\s*:/.test(e)}function startsMultiLineScalarBlock(e){return/:\s*[|>][-+]?\s*$/.test(e)}function getIndent(e){return e.length-e.trimStart().length}function getBooleanOption(e,t,n){return e&&"boolean"==typeof e[t]?e[t]:n}function getClampedIntegerOption(e,t,n,s){return!e||!Number.isInteger(e[t])||e[t]<0?s:Math.min(e[t],n)}function getBetweenSectionBlankLines(e){const t=getClampedIntegerOption(e,"betweenSectionBlankLines",4,null);if(null!==t)return t;const n=getClampedIntegerOption(e,"blankLinesBetweenSections",4,null);return null!==n?n:1}function getNewlineFormat(e){const t=e&&"string"==typeof e.newlineFormat?e.newlineFormat:null;return"\n"===t||"\r\n"===t?t:"\n"}function getLineWidth(e){return e&&"number"==typeof e.lineWidth&&e.lineWidth>=0?0===e.lineWidth?-1:e.lineWidth:-1}function getIndentOption(e){return e&&Number.isInteger(e.indent)&&e.indent>0&&e.indent<=8?e.indent:2}const i=/^\s*-\s+(task|bash|powershell|pwsh|script|sh|checkout|download|downloadBuild|getPackage|publish|reviewApp|template):/;function handleCommentLine(e){const{lineNum:t,inMultiLineBlock:n,pass1:s,currentSection:i,stepSpacingSections:r,lines:o,foundFirstMainSection:a}=e,l=o[t],c=t;if(n)return s.push(l),!0;let p=!0;for(let e=c+1;e<o.length;e++)if(hasActualContent(o[e])){p=!1;break}if(p){let e=!1;for(let t=s.length-1;t>=0;t--)if(hasActualContent(s[t])){e=!0;break}if(e){const e=s.length>0?s[s.length-1]:null;e&&!isBlank(e)&&s.push("")}}else{let e=!1;const n=getIndent(l);for(let s=t-1;s>=0&&s>=t-100;s--){const t=o[s];if(isBlank(t)||isComment(t))continue;const i=getIndent(t);if("steps:"===t.trim()&&i<=n){e=!0;break}if(i<n&&!t.trim().startsWith("-"))break}if(e||"steps"===i||r.includes(i)||a&&0===getIndent(l)){const e=s.length>0?s[s.length-1]:null,t=e?e.trim():"",n="steps:"===t||"jobs:"===t||"stages:"===t;!e||isBlank(e)||n||s.push("")}}return s.push(l),!0}function findPreviousNonBlankLine(e,t){for(let n=t;n>=0;n--)if(!isBlank(e[n]))return n;return null}function handleBlankLine(e){const{pass1:t,inMultiLineBlock:n,currentSection:s,stepSpacingSections:i,listItemSpacingSections:r,prevWasComment:o,lineNum:a,lines:l}=e,c=findNextNonBlankLine(l,a+1);if(null===c)return{continue:!0,prevWasComment:!1};if(!n&&("parameters"===s||"variables"===s))return{continue:!0,prevWasComment:!1};if(n)return t.push(""),{continue:!0,prevWasComment:!1};const p=getIndent(l[c]);let u=!1;const f=findPreviousNonBlankLine(t,t.length-1),d=null!==f?t[f]:null;if(d){const e=getIndent(d),t=d.trim();if(0===e&&isMainSectionKey(t))u=!0;else if(o)u=!0;else if("variables"===s)u=!1;else if("steps"===s||i.includes(s)){const e=isComment(d),t=isListItem(l[c]);u=!(e&&t)}else r.includes(s)&&(0!==p&&2!==p||(u=!0))}if(u&&isComment(l[c])){let e=!1,n=-1;for(let s=t.length-1;s>=0;s--){if(hasActualContent(t[s])){e=!0,n=s;break}if(isBlankOrCommentLine(t[s]))break}if(e){let e=!1;for(let t=c;t<l.length;t++)if(hasActualContent(l[t])){e=!0;break}if(!e){let e=0;for(let s=n+1;s<t.length;s++)isBlank(t[s])&&e++;e>=1&&(u=!1)}}}return u&&t.push(l[a]),{continue:!0,prevWasComment:!1}}function handleStepSpacing(e){const{pass1:t,lastStepInStepsSection:n,inMultiLineBlock:s,variablesIndent:r,startsMultiLineBlock:o,lineIndent:a,lineNum:l,lines:c}=e,p=c[l],u=p.trim();let f=-1;isMainSectionKey(u)?containsTemplateExpression(p)||(f=a):f>=0&&a<=f&&isNonCommentContent(u)&&(isMainSectionKey(u)||(f=-1));const d=isListItem(p),h=isConditionalListItem(p),m=d&&!h&&function isStepOrExpressionListItem(e){return i.test(e)||function isExpressionListItem(e){return/^\s*-\s+\$\{\{.*\}\}:?/.test(e)}(e)}(p),g=h&&n>=0,y=r>=0&&a===r&&d,b=t.length>0?t[t.length-1].trim():"",v=isConditionalListItem(b),x=isMainSectionKey(b);return!((m||g)&&n>=0)||x||v||s&&!o||y||t.length>0&&!isBlank(t[t.length-1])&&t.push(""),{isPipelineItem:m}}function handleSectionSpacing(e){const{pass1:t,options:n,hasParametersAtStart:s,parametersEnded:i,firstNonEmptyLine:r,foundFirstSection:o,foundFirstMainSection:a,lastRootSectionIndex:l,topLevelSections:c,lineNum:p,lines:u}=e,f=u[p],d=f.trim();let h=!1,m=i,g=o,y=a;if(s&&!n.wasExpanded&&(!i&&p>r&&(isComment(f)||isListItem(f)||0!==getIndent(f)||!isMappingKey(f)||(m=!0)),m&&!o&&c.some(e=>d===e))){g=!0,h=!0;for(isMainSectionKey(d.includes(":")?d.substring(0,d.indexOf(":")+1).trim():d)&&(y=!0);t.length>0&&isBlank(t[t.length-1]);)t.pop();for(let e=0;e<n.firstBlockBlankLines;e++)t.push("")}const b=!isComment(f)&&!isListItem(f)&&0===getIndent(f)&&isMappingKey(f);let v=l;if(b&&l>=0&&!h&&!n.wasExpanded){for(;t.length>0&&isBlank(t[t.length-1]);)t.pop();const e=isMainSectionKey(d.includes(":")?d.substring(0,d.indexOf(":")+1).trim():d),i=e&&!y&&s&&m;let r;i&&(y=!0,g=!0),r=i?n.firstBlockBlankLines:e?1:n.betweenSectionBlankLines;for(let e=0;e<r;e++)t.push("")}return b&&(v=t.length),{section2HandledThisLine:h,parametersEnded:m,foundFirstSection:g,foundFirstMainSection:y,lastRootSectionIndex:v}}function updateMultiLineBlockState(e){const{lines:t,lineNum:n,lineIndent:s}=e,i=t[n],r=i.trim(),o=startsMultiLineScalarBlock(i);return o?(e.inMultiLineBlock=!0,e.multiLineBlockIndent=s):e.inMultiLineBlock&&s<=e.multiLineBlockIndent&&""!==r&&(e.inMultiLineBlock=!1,e.multiLineBlockIndent=-1),o}function updateVariablesSection(e){const{lines:t,lineNum:n,lineIndent:s}=e,i=t[n],r=i.trim();"variables:"!==r||containsTemplateExpression(i)?e.variablesIndent>=0&&isNonCommentContent(r)&&(s<e.variablesIndent||s===e.variablesIndent&&isMappingKey(r)&&"variables:"!==r)&&(e.variablesIndent=-1):e.variablesIndent=s}function applyPipelineFormatting(e,t,n){if(!e)return e;const s=e.split(t),i=function initializeFormattingState(e,t){let n=!1,s=-1;for(let t=0;t<e.length;t++){const i=e[t].trim();if(isNonCommentContent(i)){s=t,n="parameters:"===i;break}}return{options:t,lines:e,stepSpacingSections:["steps"],listItemSpacingSections:["stages","jobs"],topLevelSections:["stages:","jobs:","steps:","trigger:","pr:","resources:","pool:","variables:"],hasParametersAtStart:n,firstNonEmptyLine:s,pass1:[],currentSection:null,prevWasComment:!1,lastStepInStepsSection:-1,variablesIndent:-1,inMultiLineBlock:!1,multiLineBlockIndent:-1,foundFirstSection:!1,foundFirstMainSection:!1,parametersEnded:!1,lastRootSectionIndex:-1,lineNum:-1,lineIndent:0,startsMultiLineBlock:!1}}(s,n);for(let e=0;e<s.length;e++){const t=s[e],r=t.trim(),o=getIndent(t);if(i.lineNum=e,i.lineIndent=o,0===o&&isNonCommentContent(r)&&isMappingKey(r)&&!isListItem(t)&&(i.currentSection=r.slice(0,-1)),isBlank(t)){const e=handleBlankLine(i);if(e.continue){i.prevWasComment=e.prevWasComment;continue}}const a=updateMultiLineBlockState(i);if(i.startsMultiLineBlock=a,updateVariablesSection(i),n.stepSpacing&&!n.wasExpanded){handleStepSpacing(i).isPipelineItem?i.lastStepInStepsSection=i.lineNum:isMainSectionKey(r)&&!containsTemplateExpression(t)&&(i.lastStepInStepsSection=-1)}const l=handleSectionSpacing(i);i.parametersEnded=l.parametersEnded,i.foundFirstSection=l.foundFirstSection,i.foundFirstMainSection=l.foundFirstMainSection,i.lastRootSectionIndex=l.lastRootSectionIndex;if(("jobs:"===r||"steps:"===r)&&o>0&&!l.section2HandledThisLine&&!n.wasExpanded&&(0!==i.pass1.length&&isBlank(i.pass1[i.pass1.length-1])||i.pass1.push("")),isComment(t))handleCommentLine(i),i.prevWasComment=!0;else if(i.pass1.push(t),i.prevWasComment=!1,isMappingKey(r))for(;e+1<s.length&&isBlank(s[e+1]);)e++}const r=function compactBlankLines(e,t){const n=[],s=[],i=new Set(["steps","jobs","stages"]),r=new Set(["dependsOn","parameters","variables"]);for(let t=0;t<e.length;t++){const o=e[t],a=getIndent(o);if(!isListItem(o)&&!isBlank(o)&&!isComment(o))for(;s.length&&s[s.length-1].indent>=a;)s.pop();if(!isListItem(o)&&isMappingKey(o)){const e=o.trim().slice(0,-1);(0===a||r.has(e))&&s.push({name:e,indent:a})}if(isBlank(o)){const n=findPreviousNonBlankLine(e,t-1),r=findNextNonBlankLine(e,t+1);if(null!==n&&null!==r){const t=e[n],o=e[r];if(isMappingKey(t))continue;const a=isListItem(t),l=isListItem(o),c=s.length?s[s.length-1].name:null,p=c&&i.has(c);let u=a;if(l&&!p&&!a){const t=getIndent(o);for(let s=n-1;s>=0;s--)if(!isBlank(e[s])){if(isListItem(e[s])){u=!0;break}if(getIndent(e[s])<=t&&isMappingKey(e[s])&&!isListItem(e[s]))break}}if(u&&l&&!p)continue}}n.push(o)}return n}(i.pass1),o=n?.stepSpacing&&!n?.wasExpanded?function insertStepSpacing(e,t=new Set){const n=[],s=[],i=[];let r=!1,o=-1;const a=new Set(["steps","jobs","stages"]);let l=!1,c=-1,p=null,u=!1,f=-1;for(let t=0;t<e.length;t++){const d=e[t],h=getIndent(d),m=d.trim(),g=r;if(0!==h||isBlank(d)||isListItem(d)||!isMappingKey(m)||(p=m.slice(0,-1),"variables"===p||"parameters"===p?(u=!0,f=h):(u=!1,f=-1)),u&&0===h&&!isListItem(d)&&isMappingKey(m)){const e=m.slice(0,-1);"variables"!==e&&"parameters"!==e&&(u=!1,f=-1)}startsMultiLineScalarBlock(d)?(r=!0,o=h):r&&!isBlank(d)&&h<=o&&(r=!1,o=-1);const y=g&&r;if(l&&!isBlank(d)&&(h<c||h===c&&!isListItem(d))&&(l=!1,c=-1),!y&&!isBlank(d)){if(!isListItem(d)&&!isComment(d))for(;i.length&&i[i.length-1].indent>=h&&!i[i.length-1].implicit;)i.pop();if(!isListItem(d)&&!isComment(d)&&isMappingKey(d)){const e=m.slice(0,-1);a.has(e)?i.push({name:e,indent:h}):i.length>0&&!containsTemplateExpression(d)&&!l&&(l=!0,c=h)}}if(!y&&isListItem(d)){const r=h;let o=-1,c=[];for(let n=t+1;n<e.length;n++){if(!isBlank(e[n])){o=n;break}c.push(n)}if(c.length>0&&o>0){const t=e[o];if(getIndent(t)>r&&!isComment(t))for(const e of c)s.push(e)}if(!l&&!u){let o=!1;for(let e=i.length-1;e>=0;e--)if(a.has(i[e].name)){o=!0;break}if(!o&&0===h&&"variables"!==p&&"parameters"!==p){let n=!1;if(containsTemplateExpression(m))n=!0;else for(let s=t+1;s<Math.min(t+10,e.length);s++)if(!isBlank(e[s])){const t=e[s].trim();getIndent(e[s])>h&&t.match(/^-\s+(stage|job|task):/)&&(n=!0);break}n&&(i.some(e=>e.implicit)||i.push({name:"stages",indent:-1,implicit:!0}),o=!0)}if(o){for(let n=t-1;n>=0;n--){const i=e[n];if(!isBlank(i)){if(isComment(i)){let i=!1,r=-1;for(let t=n-1;t>=0;t--){if(!isBlank(e[t])){if(isListItem(e[t])){i=!0;break}break}-1===r&&(r=t)}for(let o=n+1;o<t;o++)isBlank(e[o])&&(i&&o===r||s.push(o));break}break}}let i=null;for(let n=t+1;n<e.length;n++){if(isBlank(e[n]))continue;if(isComment(e[n]))continue;const t=getIndent(e[n]),s=isListItem(e[n]);if(s&&t===r){i=n;break}if(s&&t<r)break;if(t<=r&&!s)break}if(null!==i&&getIndent(e[i])===r){let r=!1,o=!1;for(let n=i-1;n>=0;n--){const a=e[n];if(!isBlank(a)){if(isComment(a)){o=!0;let r=!1,a=-1;for(let s=n-1;s>=t;s--){if(!isBlank(e[s])){if(isListItem(e[s])){r=!0;break}break}-1===a&&(a=s)}for(let t=n+1;t<i;t++)isBlank(e[t])&&(r&&t===a||s.push(t));break}break}r=!0}r||o||n.push(i)}}}}}let d=[...e];for(const e of Array.from(new Set(s)).sort((e,t)=>t-e))d.splice(e,1);const h=n.map(e=>{let t=e;for(const n of s)n<e&&t--;return t});for(const e of Array.from(new Set(h)).sort((e,t)=>t-e))d.splice(e,0,"");return d}(r,n?.conditionalDirectiveExpressions):r;return o.join(t)}e.exports={formatYaml:function formatYaml(e,t={}){const n={text:e,warning:void 0,error:void 0};if(!e)return n;const i=parseFormatDirectives(e),r=new Set(["fileName","baseDir"]),o=t?Object.keys(t).filter(e=>!r.has(e)):[];if(i.disabled&&0===o.length)return n;if(/\n---\n/.test(e)){const n=e.split(/\n---\n/),s=[],i=[],r=[];for(let e=0;e<n.length;e++){const o=n[e];if(!o.trim())continue;const a=formatYaml(o,t);a.error?r.push(`Document ${e+1}: ${a.error}`):(a.warning&&i.push(`Document ${e+1}: ${a.warning}`),s.push(a.text.trim()))}return 0===s.length?{text:e,warning:i.length>0?i.join("\n"):void 0,error:r.length>0?r.join("\n"):"All documents failed to format"}:{text:s.join("\n\n---\n"),warning:i.length>0?i.join("\n"):void 0,error:r.length>0?r.join("\n"):void 0}}const a=analyzeTemplateHints(e),l=a.length?`\n  ${a.join("\n  ")}`:"";if(a.length>0&&!t.expandTemplates){if(a.some(e=>e.includes("Missing closing")||e.includes("Unbalanced parentheses")||e.includes("Unbalanced brackets")||e.includes("Unbalanced braces")||e.includes("Unclosed string")))throw new Error(`Template validation failed:${l}`)}const c=parseFormatDirectives(e);c.options&&(t={...t,...c.options});const p={noArrayIndent:getBooleanOption(t,"noArrayIndent",!0),indent:getIndentOption(t),lineWidth:getLineWidth(t),forceQuotes:getBooleanOption(t,"forceQuotes",!1),sortKeys:getBooleanOption(t,"sortKeys",!1),expandTemplates:getBooleanOption(t,"expandTemplates",!1),newlineFormat:getNewlineFormat(t),fileName:t&&t.fileName?t.fileName:void 0,stepSpacing:getBooleanOption(t,"stepSpacing",!0),firstBlockBlankLines:getClampedIntegerOption(t,"firstBlockBlankLines",4,2),betweenSectionBlankLines:getBetweenSectionBlankLines(t),sectionSpacing:getBooleanOption(t,"sectionSpacing",!1),wasExpanded:getBooleanOption(t,"wasExpanded",!1),azureCompatible:getBooleanOption(t,"azureCompatible",!1)};try{let t=e;const{content:n,placeholderMap:i,conditionalDirectives:r}=p.expandTemplates?{content:t,placeholderMap:new Map,conditionalDirectives:new Set}:replaceTemplateExpressionsWithPlaceholders(t),{content:o,commentMap:a}=function protectEmptyValues(e){if(!e)return e;const t=e.split(/\r?\n/),n=[],s=new Map;let i=0;const r=/^(\s*)([^:]+):\s*$/;for(let e=0;e<t.length;e++){const o=t[e];if(isComment(o)||isListItem(o)){n.push(o);continue}const a=o.match(r);if(!a){n.push(o);continue}const l=a[1],c=a[2];let p=e+1,u=!1;for(;p<t.length;){const e=t[p],n=getIndent(e);if(!isBlankOrCommentLine(e)){u=isListItem(t[p])&&n>=l.length||n>l.length;break}p++}if(!u){const r=[];let o=e+1;for(;o<t.length;){const e=t[o];if(isBlank(e))r.push(e),o++;else{if(!isComment(e))break;if(!(getIndent(e)>=l.length))break;r.push(e),o++}}if(r.length>0){const t=`__COMMENT_${i}__`;s.set(t,r),i++,n.push(`${l}${c}: __EMPTY_VALUE_PLACEHOLDER__${t}`),e=o-1}else n.push(`${l}${c}: __EMPTY_VALUE_PLACEHOLDER__`);continue}n.push(o)}return{content:n.join("\n"),commentMap:s}}(n),c=analyzeTemplateHints(o,r);if(c.length>0){const t=`\n  ${c.join("\n  ")}`,n=p.fileName?`[${p.fileName}] `:"",s=`YAML validation warnings:${t}`.split("\n").map((e,t)=>0===t?e:"  "+e).join("\n");return console.error(`${n}${s}`),{text:e,warning:t,error:void 0}}const u=s.parseDocument(o,{strict:!1,uniqueKeys:!1});if(u.errors&&u.errors.length>0){const t=u.errors.filter(e=>!e.message||!e.message.includes("Invalid escape sequence"));if(t.length>0){const n=t.map(e=>e.message).join(", "),s=p.fileName?`[${p.fileName}] `:"",i=`YAML parsing error: ${n}`.split("\n").map((e,t)=>0===t?e:"  "+e).join("\n");console.error(`${s}${i}`);const r=l;return{text:e,warning:l||void 0,error:n.length>100?n.substring(0,100)+"..."+r:`${n}${r}`}}}u.errors=[],u.warnings=[];let f=u.toString({indent:p.indent,indentSeq:!p.noArrayIndent,lineWidth:-1,doubleQuotedAsJSON:!0,doubleQuotedMinMultiLineLength:1/0,singleQuote:null,blockQuote:!0,defaultStringType:"PLAIN",aliasDuplicateObjects:!1});f=restoreTemplateExpressions(f,i),f=function restoreEmptyValues(e,t){if(!e)return e;if(!t||0===t.size)return e.replace(/:\s*__EMPTY_VALUE_PLACEHOLDER__\s*$/gm,":");const n=e.split(/\r?\n/),s=[];for(const e of n){const n=e.match(/^(\s*)([^:]+):\s*__EMPTY_VALUE_PLACEHOLDER__(__COMMENT_\d+__)\s*$/);if(n){const[,e,i,r]=n,o=t.get(r);s.push(`${e}${i}:`),o?.length&&o.forEach(e=>s.push(e))}else e.match(/:\s*__EMPTY_VALUE_PLACEHOLDER__\s*$/)?s.push(e.replace(/:\s*__EMPTY_VALUE_PLACEHOLDER__\s*$/,":")):s.push(e)}return s.join("\n")}(f,a);const d=p.newlineFormat;let h=f.replace(/\r?\n/g,d);const m=new Set;for(const[e,t]of i)r.has(e)&&m.add(t);return p.conditionalDirectiveExpressions=m,h=applyPipelineFormatting(h,d,p),h=h.split(d).map(e=>e.replace(/[ \t]+$/,"")).join(d),h=p.wasExpanded&&p.azureCompatible?h.replace(new RegExp(`(?:${escapeRegExp(d)})*$`),`${d}${d}${d}`):h.replace(new RegExp(`(?:${escapeRegExp(d)})*$`),d),{text:h,warning:l||void 0,error:void 0}}catch(t){const n=function describeYamlSyntaxError(e,t){if(!e||"object"!=typeof e)return;if("YAMLException"!==e.name&&"YAMLError"!==e.name&&e.name&&"string"==typeof e.name&&!e.name.includes("YAML"))return;const n=("string"==typeof e.reason&&e.reason.trim().length?e.reason.trim():void 0)||("string"==typeof e.message?e.message.trim():void 0);if(n&&n.includes("duplicated mapping key")&&((e.snippet||"").includes("${{")||e.mark&&e.mark.snippet&&e.mark.snippet.includes("${{")))return;const s=e.mark&&"object"==typeof e.mark?e.mark:void 0,i=s&&Number.isInteger(s.line),r=s&&Number.isInteger(s.column),o=i?`line ${s.line+1}`:void 0,a=r?`column ${s.column+1}`:void 0,l=o&&a?`${o}, ${a}`:o||a,c=analyzeTemplateHints(t),p=(n||"").toLowerCase();let u;return n&&(p.includes("implicit map key")||p.includes("mapping values are not allowed")?c.unshift("Likely missing a ':' after an Azure expression used as a key (e.g., '- ${{ if ... }}:')."):(p.includes("bad indentation")||p.includes("incomplete explicit mapping"))&&c.unshift("Check indentation for list items and make sure expression lines start with '-'.")),l&&n?u=`YAML syntax error at ${l}: ${n}`:n?u=`YAML syntax error: ${n}`:l&&(u=`YAML syntax error at ${l}.`),u&&c.length&&(u+=`\n  ${c.join("\n")}`),u}(t,e),s=p.fileName?`[${p.fileName}] `:"";if(n){const t=n.split("\n").map((e,t)=>0===t?e:"  "+e).join("\n");return console.error(`${s}${t}`),{text:e,warning:l||void 0,error:n}}const i=`YAML formatting failed: ${t.message}`.split("\n").map((e,t)=>0===t?e:"  "+e).join("\n");return console.error(`${s}${i}`),{text:e,warning:l||void 0,error:`YAML formatting failed: ${t.message}`}}},escapeRegExp,replaceTemplateExpressionsWithPlaceholders,restoreTemplateExpressions,analyzeTemplateHints,parseFormatDirectives}},(e,t,n)=>{"use strict";var s=n(8),i=n(13),r=n(31),o=n(57),a=n(14),l=n(11),c=n(22),p=n(21),u=n(33),f=n(36),d=n(73),h=n(77),m=n(78),g=n(79),y=n(80),b=n(12);t.Composer=s.Composer,t.Document=i.Document,t.Schema=r.Schema,t.YAMLError=o.YAMLError,t.YAMLParseError=o.YAMLParseError,t.YAMLWarning=o.YAMLWarning,t.Alias=a.Alias,t.isAlias=l.isAlias,t.isCollection=l.isCollection,t.isDocument=l.isDocument,t.isMap=l.isMap,t.isNode=l.isNode,t.isPair=l.isPair,t.isScalar=l.isScalar,t.isSeq=l.isSeq,t.Pair=c.Pair,t.Scalar=p.Scalar,t.YAMLMap=u.YAMLMap,t.YAMLSeq=f.YAMLSeq,t.CST=d,t.Lexer=h.Lexer,t.LineCounter=m.LineCounter,t.Parser=g.Parser,t.parse=y.parse,t.parseAllDocuments=y.parseAllDocuments,t.parseDocument=y.parseDocument,t.stringify=y.stringify,t.visit=b.visit,t.visitAsync=b.visitAsync},(e,t,n)=>{"use strict";var s=n(9),i=n(10),r=n(13),o=n(57),a=n(11),l=n(58),c=n(68);function getErrorPos(e){if("number"==typeof e)return[e,e+1];if(Array.isArray(e))return 2===e.length?e:[e[0],e[1]];const{offset:t,source:n}=e;return[t,t+("string"==typeof n?n.length:1)]}function parsePrelude(e){let t="",n=!1,s=!1;for(let i=0;i<e.length;++i){const r=e[i];switch(r[0]){case"#":t+=(""===t?"":s?"\n\n":"\n")+(r.substring(1)||" "),n=!0,s=!1;break;case"%":"#"!==e[i+1]?.[0]&&(i+=1),n=!1;break;default:n||(s=!0),n=!1}}return{comment:t,afterEmptyLine:s}}t.Composer=class Composer{constructor(e={}){this.doc=null,this.atDirectives=!1,this.prelude=[],this.errors=[],this.warnings=[],this.onError=(e,t,n,s)=>{const i=getErrorPos(e);s?this.warnings.push(new o.YAMLWarning(i,t,n)):this.errors.push(new o.YAMLParseError(i,t,n))},this.directives=new i.Directives({version:e.version||"1.2"}),this.options=e}decorate(e,t){const{comment:n,afterEmptyLine:s}=parsePrelude(this.prelude);if(n){const i=e.contents;if(t)e.comment=e.comment?`${e.comment}\n${n}`:n;else if(s||e.directives.docStart||!i)e.commentBefore=n;else if(a.isCollection(i)&&!i.flow&&i.items.length>0){let e=i.items[0];a.isPair(e)&&(e=e.key);const t=e.commentBefore;e.commentBefore=t?`${n}\n${t}`:n}else{const e=i.commentBefore;i.commentBefore=e?`${n}\n${e}`:n}}t?(Array.prototype.push.apply(e.errors,this.errors),Array.prototype.push.apply(e.warnings,this.warnings)):(e.errors=this.errors,e.warnings=this.warnings),this.prelude=[],this.errors=[],this.warnings=[]}streamInfo(){return{comment:parsePrelude(this.prelude).comment,directives:this.directives,errors:this.errors,warnings:this.warnings}}*compose(e,t=!1,n=-1){for(const t of e)yield*this.next(t);yield*this.end(t,n)}*next(e){switch(s.env.LOG_STREAM&&console.dir(e,{depth:null}),e.type){case"directive":this.directives.add(e.source,(t,n,s)=>{const i=getErrorPos(e);i[0]+=t,this.onError(i,"BAD_DIRECTIVE",n,s)}),this.prelude.push(e.source),this.atDirectives=!0;break;case"document":{const t=l.composeDoc(this.options,this.directives,e,this.onError);this.atDirectives&&!t.directives.docStart&&this.onError(e,"MISSING_CHAR","Missing directives-end/doc-start indicator line"),this.decorate(t,!1),this.doc&&(yield this.doc),this.doc=t,this.atDirectives=!1;break}case"byte-order-mark":case"space":break;case"comment":case"newline":this.prelude.push(e.source);break;case"error":{const t=e.source?`${e.message}: ${JSON.stringify(e.source)}`:e.message,n=new o.YAMLParseError(getErrorPos(e),"UNEXPECTED_TOKEN",t);this.atDirectives||!this.doc?this.errors.push(n):this.doc.errors.push(n);break}case"doc-end":{if(!this.doc){const t="Unexpected doc-end without preceding document";this.errors.push(new o.YAMLParseError(getErrorPos(e),"UNEXPECTED_TOKEN",t));break}this.doc.directives.docEnd=!0;const t=c.resolveEnd(e.end,e.offset+e.source.length,this.doc.options.strict,this.onError);if(this.decorate(this.doc,!0),t.comment){const e=this.doc.comment;this.doc.comment=e?`${e}\n${t.comment}`:t.comment}this.doc.range[2]=t.offset;break}default:this.errors.push(new o.YAMLParseError(getErrorPos(e),"UNEXPECTED_TOKEN",`Unsupported token ${e.type}`))}}*end(e=!1,t=-1){if(this.doc)this.decorate(this.doc,!0),yield this.doc,this.doc=null;else if(e){const e=Object.assign({_directives:this.directives},this.options),n=new r.Document(void 0,e);this.atDirectives&&this.onError(t,"MISSING_CHAR","Missing directives-end indicator line"),n.range=[0,t,t],this.decorate(n,!1),yield n}}}},e=>{"use strict";e.exports=require("process")},(e,t,n)=>{"use strict";var s=n(11),i=n(12);const r={"!":"%21",",":"%2C","[":"%5B","]":"%5D","{":"%7B","}":"%7D"},escapeTagName=e=>e.replace(/[!,[\]{}]/g,e=>r[e]);class Directives{constructor(e,t){this.docStart=null,this.docEnd=!1,this.yaml=Object.assign({},Directives.defaultYaml,e),this.tags=Object.assign({},Directives.defaultTags,t)}clone(){const e=new Directives(this.yaml,this.tags);return e.docStart=this.docStart,e}atDocument(){const e=new Directives(this.yaml,this.tags);switch(this.yaml.version){case"1.1":this.atNextDocument=!0;break;case"1.2":this.atNextDocument=!1,this.yaml={explicit:Directives.defaultYaml.explicit,version:"1.2"},this.tags=Object.assign({},Directives.defaultTags)}return e}add(e,t){this.atNextDocument&&(this.yaml={explicit:Directives.defaultYaml.explicit,version:"1.1"},this.tags=Object.assign({},Directives.defaultTags),this.atNextDocument=!1);const n=e.trim().split(/[ \t]+/),s=n.shift();switch(s){case"%TAG":{if(2!==n.length&&(t(0,"%TAG directive should contain exactly two parts"),n.length<2))return!1;const[e,s]=n;return this.tags[e]=s,!0}case"%YAML":{if(this.yaml.explicit=!0,1!==n.length)return t(0,"%YAML directive should contain exactly one part"),!1;const[e]=n;if("1.1"===e||"1.2"===e)return this.yaml.version=e,!0;return t(6,`Unsupported YAML version ${e}`,/^\d+\.\d+$/.test(e)),!1}default:return t(0,`Unknown directive ${s}`,!0),!1}}tagName(e,t){if("!"===e)return"!";if("!"!==e[0])return t(`Not a valid tag: ${e}`),null;if("<"===e[1]){const n=e.slice(2,-1);return"!"===n||"!!"===n?(t(`Verbatim tags aren't resolved, so ${e} is invalid.`),null):(">"!==e[e.length-1]&&t("Verbatim tags must end with a >"),n)}const[,n,s]=e.match(/^(.*!)([^!]*)$/s);s||t(`The ${e} tag has no suffix`);const i=this.tags[n];if(i)try{return i+decodeURIComponent(s)}catch(e){return t(String(e)),null}return"!"===n?e:(t(`Could not resolve tag: ${e}`),null)}tagString(e){for(const[t,n]of Object.entries(this.tags))if(e.startsWith(n))return t+escapeTagName(e.substring(n.length));return"!"===e[0]?e:`!<${e}>`}toString(e){const t=this.yaml.explicit?[`%YAML ${this.yaml.version||"1.2"}`]:[],n=Object.entries(this.tags);let r;if(e&&n.length>0&&s.isNode(e.contents)){const t={};i.visit(e.contents,(e,n)=>{s.isNode(n)&&n.tag&&(t[n.tag]=!0)}),r=Object.keys(t)}else r=[];for(const[s,i]of n)"!!"===s&&"tag:yaml.org,2002:"===i||e&&!r.some(e=>e.startsWith(i))||t.push(`%TAG ${s} ${i}`);return t.join("\n")}}Directives.defaultYaml={explicit:!1,version:"1.2"},Directives.defaultTags={"!!":"tag:yaml.org,2002:"},t.Directives=Directives},(e,t)=>{"use strict";const n=Symbol.for("yaml.alias"),s=Symbol.for("yaml.document"),i=Symbol.for("yaml.map"),r=Symbol.for("yaml.pair"),o=Symbol.for("yaml.scalar"),a=Symbol.for("yaml.seq"),l=Symbol.for("yaml.node.type"),isScalar=e=>!!e&&"object"==typeof e&&e[l]===o;function isCollection(e){if(e&&"object"==typeof e)switch(e[l]){case i:case a:return!0}return!1}t.ALIAS=n,t.DOC=s,t.MAP=i,t.NODE_TYPE=l,t.PAIR=r,t.SCALAR=o,t.SEQ=a,t.hasAnchor=e=>(isScalar(e)||isCollection(e))&&!!e.anchor,t.isAlias=e=>!!e&&"object"==typeof e&&e[l]===n,t.isCollection=isCollection,t.isDocument=e=>!!e&&"object"==typeof e&&e[l]===s,t.isMap=e=>!!e&&"object"==typeof e&&e[l]===i,t.isNode=function isNode(e){if(e&&"object"==typeof e)switch(e[l]){case n:case i:case o:case a:return!0}return!1},t.isPair=e=>!!e&&"object"==typeof e&&e[l]===r,t.isScalar=isScalar,t.isSeq=e=>!!e&&"object"==typeof e&&e[l]===a},(e,t,n)=>{"use strict";var s=n(11);const i=Symbol("break visit"),r=Symbol("skip children"),o=Symbol("remove node");function visit(e,t){const n=initVisitor(t);if(s.isDocument(e)){visit_(null,e.contents,n,Object.freeze([e]))===o&&(e.contents=null)}else visit_(null,e,n,Object.freeze([]))}function visit_(e,t,n,r){const a=callVisitor(e,t,n,r);if(s.isNode(a)||s.isPair(a))return replaceNode(e,r,a),visit_(e,a,n,r);if("symbol"!=typeof a)if(s.isCollection(t)){r=Object.freeze(r.concat(t));for(let e=0;e<t.items.length;++e){const s=visit_(e,t.items[e],n,r);if("number"==typeof s)e=s-1;else{if(s===i)return i;s===o&&(t.items.splice(e,1),e-=1)}}}else if(s.isPair(t)){r=Object.freeze(r.concat(t));const e=visit_("key",t.key,n,r);if(e===i)return i;e===o&&(t.key=null);const s=visit_("value",t.value,n,r);if(s===i)return i;s===o&&(t.value=null)}return a}async function visitAsync(e,t){const n=initVisitor(t);if(s.isDocument(e)){await visitAsync_(null,e.contents,n,Object.freeze([e]))===o&&(e.contents=null)}else await visitAsync_(null,e,n,Object.freeze([]))}async function visitAsync_(e,t,n,r){const a=await callVisitor(e,t,n,r);if(s.isNode(a)||s.isPair(a))return replaceNode(e,r,a),visitAsync_(e,a,n,r);if("symbol"!=typeof a)if(s.isCollection(t)){r=Object.freeze(r.concat(t));for(let e=0;e<t.items.length;++e){const s=await visitAsync_(e,t.items[e],n,r);if("number"==typeof s)e=s-1;else{if(s===i)return i;s===o&&(t.items.splice(e,1),e-=1)}}}else if(s.isPair(t)){r=Object.freeze(r.concat(t));const e=await visitAsync_("key",t.key,n,r);if(e===i)return i;e===o&&(t.key=null);const s=await visitAsync_("value",t.value,n,r);if(s===i)return i;s===o&&(t.value=null)}return a}function initVisitor(e){return"object"==typeof e&&(e.Collection||e.Node||e.Value)?Object.assign({Alias:e.Node,Map:e.Node,Scalar:e.Node,Seq:e.Node},e.Value&&{Map:e.Value,Scalar:e.Value,Seq:e.Value},e.Collection&&{Map:e.Collection,Seq:e.Collection},e):e}function callVisitor(e,t,n,i){return"function"==typeof n?n(e,t,i):s.isMap(t)?n.Map?.(e,t,i):s.isSeq(t)?n.Seq?.(e,t,i):s.isPair(t)?n.Pair?.(e,t,i):s.isScalar(t)?n.Scalar?.(e,t,i):s.isAlias(t)?n.Alias?.(e,t,i):void 0}function replaceNode(e,t,n){const i=t[t.length-1];if(s.isCollection(i))i.items[e]=n;else if(s.isPair(i))"key"===e?i.key=n:i.value=n;else{if(!s.isDocument(i)){const e=s.isAlias(i)?"alias":"scalar";throw new Error(`Cannot replace node with ${e} parent`)}i.contents=n}}visit.BREAK=i,visit.SKIP=r,visit.REMOVE=o,visitAsync.BREAK=i,visitAsync.SKIP=r,visitAsync.REMOVE=o,t.visit=visit,t.visitAsync=visitAsync},(e,t,n)=>{"use strict";var s=n(14),i=n(19),r=n(11),o=n(22),a=n(18),l=n(31),c=n(56),p=n(15),u=n(17),f=n(20),d=n(10);class Document{constructor(e,t,n){this.commentBefore=null,this.comment=null,this.errors=[],this.warnings=[],Object.defineProperty(this,r.NODE_TYPE,{value:r.DOC});let s=null;"function"==typeof t||Array.isArray(t)?s=t:void 0===n&&t&&(n=t,t=void 0);const i=Object.assign({intAsBigInt:!1,keepSourceTokens:!1,logLevel:"warn",prettyErrors:!0,strict:!0,stringKeys:!1,uniqueKeys:!0,version:"1.2"},n);this.options=i;let{version:o}=i;n?._directives?(this.directives=n._directives.atDocument(),this.directives.yaml.explicit&&(o=this.directives.yaml.version)):this.directives=new d.Directives({version:o}),this.setSchema(o,n),this.contents=void 0===e?null:this.createNode(e,s,n)}clone(){const e=Object.create(Document.prototype,{[r.NODE_TYPE]:{value:r.DOC}});return e.commentBefore=this.commentBefore,e.comment=this.comment,e.errors=this.errors.slice(),e.warnings=this.warnings.slice(),e.options=Object.assign({},this.options),this.directives&&(e.directives=this.directives.clone()),e.schema=this.schema.clone(),e.contents=r.isNode(this.contents)?this.contents.clone(e.schema):this.contents,this.range&&(e.range=this.range.slice()),e}add(e){assertCollection(this.contents)&&this.contents.add(e)}addIn(e,t){assertCollection(this.contents)&&this.contents.addIn(e,t)}createAlias(e,t){if(!e.anchor){const n=p.anchorNames(this);e.anchor=!t||n.has(t)?p.findNewAnchor(t||"a",n):t}return new s.Alias(e.anchor)}createNode(e,t,n){let s;if("function"==typeof t)e=t.call({"":e},"",e),s=t;else if(Array.isArray(t)){const keyToStr=e=>"number"==typeof e||e instanceof String||e instanceof Number,e=t.filter(keyToStr).map(String);e.length>0&&(t=t.concat(e)),s=t}else void 0===n&&t&&(n=t,t=void 0);const{aliasDuplicateObjects:i,anchorPrefix:o,flow:a,keepUndefined:l,onTagObj:c,tag:u}=n??{},{onAnchor:d,setAnchors:h,sourceObjects:m}=p.createNodeAnchors(this,o||"a"),g={aliasDuplicateObjects:i??!0,keepUndefined:l??!1,onAnchor:d,onTagObj:c,replacer:s,schema:this.schema,sourceObjects:m},y=f.createNode(e,u,g);return a&&r.isCollection(y)&&(y.flow=!0),h(),y}createPair(e,t,n={}){const s=this.createNode(e,null,n),i=this.createNode(t,null,n);return new o.Pair(s,i)}delete(e){return!!assertCollection(this.contents)&&this.contents.delete(e)}deleteIn(e){return i.isEmptyPath(e)?null!=this.contents&&(this.contents=null,!0):!!assertCollection(this.contents)&&this.contents.deleteIn(e)}get(e,t){return r.isCollection(this.contents)?this.contents.get(e,t):void 0}getIn(e,t){return i.isEmptyPath(e)?!t&&r.isScalar(this.contents)?this.contents.value:this.contents:r.isCollection(this.contents)?this.contents.getIn(e,t):void 0}has(e){return!!r.isCollection(this.contents)&&this.contents.has(e)}hasIn(e){return i.isEmptyPath(e)?void 0!==this.contents:!!r.isCollection(this.contents)&&this.contents.hasIn(e)}set(e,t){null==this.contents?this.contents=i.collectionFromPath(this.schema,[e],t):assertCollection(this.contents)&&this.contents.set(e,t)}setIn(e,t){i.isEmptyPath(e)?this.contents=t:null==this.contents?this.contents=i.collectionFromPath(this.schema,Array.from(e),t):assertCollection(this.contents)&&this.contents.setIn(e,t)}setSchema(e,t={}){let n;switch("number"==typeof e&&(e=String(e)),e){case"1.1":this.directives?this.directives.yaml.version="1.1":this.directives=new d.Directives({version:"1.1"}),n={resolveKnownTags:!1,schema:"yaml-1.1"};break;case"1.2":case"next":this.directives?this.directives.yaml.version=e:this.directives=new d.Directives({version:e}),n={resolveKnownTags:!0,schema:"core"};break;case null:this.directives&&delete this.directives,n=null;break;default:{const t=JSON.stringify(e);throw new Error(`Expected '1.1', '1.2' or null as first argument, but found: ${t}`)}}if(t.schema instanceof Object)this.schema=t.schema;else{if(!n)throw new Error("With a null YAML version, the { schema: Schema } option is required");this.schema=new l.Schema(Object.assign(n,t))}}toJS({json:e,jsonArg:t,mapAsMap:n,maxAliasCount:s,onAnchor:i,reviver:r}={}){const o={anchors:new Map,doc:this,keep:!e,mapAsMap:!0===n,mapKeyWarned:!1,maxAliasCount:"number"==typeof s?s:100},l=a.toJS(this.contents,t??"",o);if("function"==typeof i)for(const{count:e,res:t}of o.anchors.values())i(t,e);return"function"==typeof r?u.applyReviver(r,{"":l},"",l):l}toJSON(e,t){return this.toJS({json:!0,jsonArg:e,mapAsMap:!1,onAnchor:t})}toString(e={}){if(this.errors.length>0)throw new Error("Document with errors cannot be stringified");if("indent"in e&&(!Number.isInteger(e.indent)||Number(e.indent)<=0)){const t=JSON.stringify(e.indent);throw new Error(`"indent" option must be a positive integer, not ${t}`)}return c.stringifyDocument(this,e)}}function assertCollection(e){if(r.isCollection(e))return!0;throw new Error("Expected a YAML collection as document contents")}t.Document=Document},(e,t,n)=>{"use strict";var s=n(15),i=n(12),r=n(11),o=n(16),a=n(18);class Alias extends o.NodeBase{constructor(e){super(r.ALIAS),this.source=e,Object.defineProperty(this,"tag",{set(){throw new Error("Alias nodes cannot have tags")}})}resolve(e,t){let n,s;t?.aliasResolveCache?n=t.aliasResolveCache:(n=[],i.visit(e,{Node:(e,t)=>{(r.isAlias(t)||r.hasAnchor(t))&&n.push(t)}}),t&&(t.aliasResolveCache=n));for(const e of n){if(e===this)break;e.anchor===this.source&&(s=e)}return s}toJSON(e,t){if(!t)return{source:this.source};const{anchors:n,doc:s,maxAliasCount:i}=t,r=this.resolve(s,t);if(!r){const e=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new ReferenceError(e)}let o=n.get(r);if(o||(a.toJS(r,null,t),o=n.get(r)),void 0===o?.res){throw new ReferenceError("This should not happen: Alias anchor was not resolved?")}if(i>=0&&(o.count+=1,0===o.aliasCount&&(o.aliasCount=getAliasCount(s,r,n)),o.count*o.aliasCount>i)){throw new ReferenceError("Excessive alias count indicates a resource exhaustion attack")}return o.res}toString(e,t,n){const i=`*${this.source}`;if(e){if(s.anchorIsValid(this.source),e.options.verifyAliasOrder&&!e.anchors.has(this.source)){const e=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new Error(e)}if(e.implicitKey)return`${i} `}return i}}function getAliasCount(e,t,n){if(r.isAlias(t)){const s=t.resolve(e),i=n&&s&&n.get(s);return i?i.count*i.aliasCount:0}if(r.isCollection(t)){let s=0;for(const i of t.items){const t=getAliasCount(e,i,n);t>s&&(s=t)}return s}if(r.isPair(t)){const s=getAliasCount(e,t.key,n),i=getAliasCount(e,t.value,n);return Math.max(s,i)}return 1}t.Alias=Alias},(e,t,n)=>{"use strict";var s=n(11),i=n(12);function anchorNames(e){const t=new Set;return i.visit(e,{Value(e,n){n.anchor&&t.add(n.anchor)}}),t}function findNewAnchor(e,t){for(let n=1;;++n){const s=`${e}${n}`;if(!t.has(s))return s}}t.anchorIsValid=function anchorIsValid(e){if(/[\x00-\x19\s,[\]{}]/.test(e)){const t=JSON.stringify(e);throw new Error(`Anchor must not contain whitespace or control characters: ${t}`)}return!0},t.anchorNames=anchorNames,t.createNodeAnchors=function createNodeAnchors(e,t){const n=[],i=new Map;let r=null;return{onAnchor:s=>{n.push(s),r??(r=anchorNames(e));const i=findNewAnchor(t,r);return r.add(i),i},setAnchors:()=>{for(const e of n){const t=i.get(e);if("object"!=typeof t||!t.anchor||!s.isScalar(t.node)&&!s.isCollection(t.node)){const t=new Error("Failed to resolve repeated object (this should not happen)");throw t.source=e,t}t.node.anchor=t.anchor}},sourceObjects:i}},t.findNewAnchor=findNewAnchor},(e,t,n)=>{"use strict";var s=n(17),i=n(11),r=n(18);t.NodeBase=class NodeBase{constructor(e){Object.defineProperty(this,i.NODE_TYPE,{value:e})}clone(){const e=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return this.range&&(e.range=this.range.slice()),e}toJS(e,{mapAsMap:t,maxAliasCount:n,onAnchor:o,reviver:a}={}){if(!i.isDocument(e))throw new TypeError("A document argument is required");const l={anchors:new Map,doc:e,keep:!0,mapAsMap:!0===t,mapKeyWarned:!1,maxAliasCount:"number"==typeof n?n:100},c=r.toJS(this,"",l);if("function"==typeof o)for(const{count:e,res:t}of l.anchors.values())o(t,e);return"function"==typeof a?s.applyReviver(a,{"":c},"",c):c}}},(e,t)=>{"use strict";t.applyReviver=function applyReviver(e,t,n,s){if(s&&"object"==typeof s)if(Array.isArray(s))for(let t=0,n=s.length;t<n;++t){const n=s[t],i=applyReviver(e,s,String(t),n);void 0===i?delete s[t]:i!==n&&(s[t]=i)}else if(s instanceof Map)for(const t of Array.from(s.keys())){const n=s.get(t),i=applyReviver(e,s,t,n);void 0===i?s.delete(t):i!==n&&s.set(t,i)}else if(s instanceof Set)for(const t of Array.from(s)){const n=applyReviver(e,s,t,t);void 0===n?s.delete(t):n!==t&&(s.delete(t),s.add(n))}else for(const[t,n]of Object.entries(s)){const i=applyReviver(e,s,t,n);void 0===i?delete s[t]:i!==n&&(s[t]=i)}return e.call(t,n,s)}},(e,t,n)=>{"use strict";var s=n(11);t.toJS=function toJS(e,t,n){if(Array.isArray(e))return e.map((e,t)=>toJS(e,String(t),n));if(e&&"function"==typeof e.toJSON){if(!n||!s.hasAnchor(e))return e.toJSON(t,n);const i={aliasCount:0,count:1,res:void 0};n.anchors.set(e,i),n.onCreate=e=>{i.res=e,delete n.onCreate};const r=e.toJSON(t,n);return n.onCreate&&n.onCreate(r),r}return"bigint"!=typeof e||n?.keep?e:Number(e)}},(e,t,n)=>{"use strict";var s=n(20),i=n(11),r=n(16);function collectionFromPath(e,t,n){let i=n;for(let e=t.length-1;e>=0;--e){const n=t[e];if("number"==typeof n&&Number.isInteger(n)&&n>=0){const e=[];e[n]=i,i=e}else i=new Map([[n,i]])}return s.createNode(i,void 0,{aliasDuplicateObjects:!1,keepUndefined:!1,onAnchor:()=>{throw new Error("This should not happen, please report a bug.")},schema:e,sourceObjects:new Map})}const isEmptyPath=e=>null==e||"object"==typeof e&&!!e[Symbol.iterator]().next().done;class Collection extends r.NodeBase{constructor(e,t){super(e),Object.defineProperty(this,"schema",{value:t,configurable:!0,enumerable:!1,writable:!0})}clone(e){const t=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return e&&(t.schema=e),t.items=t.items.map(t=>i.isNode(t)||i.isPair(t)?t.clone(e):t),this.range&&(t.range=this.range.slice()),t}addIn(e,t){if(isEmptyPath(e))this.add(t);else{const[n,...s]=e,r=this.get(n,!0);if(i.isCollection(r))r.addIn(s,t);else{if(void 0!==r||!this.schema)throw new Error(`Expected YAML collection at ${n}. Remaining path: ${s}`);this.set(n,collectionFromPath(this.schema,s,t))}}}deleteIn(e){const[t,...n]=e;if(0===n.length)return this.delete(t);const s=this.get(t,!0);if(i.isCollection(s))return s.deleteIn(n);throw new Error(`Expected YAML collection at ${t}. Remaining path: ${n}`)}getIn(e,t){const[n,...s]=e,r=this.get(n,!0);return 0===s.length?!t&&i.isScalar(r)?r.value:r:i.isCollection(r)?r.getIn(s,t):void 0}hasAllNullValues(e){return this.items.every(t=>{if(!i.isPair(t))return!1;const n=t.value;return null==n||e&&i.isScalar(n)&&null==n.value&&!n.commentBefore&&!n.comment&&!n.tag})}hasIn(e){const[t,...n]=e;if(0===n.length)return this.has(t);const s=this.get(t,!0);return!!i.isCollection(s)&&s.hasIn(n)}setIn(e,t){const[n,...s]=e;if(0===s.length)this.set(n,t);else{const e=this.get(n,!0);if(i.isCollection(e))e.setIn(s,t);else{if(void 0!==e||!this.schema)throw new Error(`Expected YAML collection at ${n}. Remaining path: ${s}`);this.set(n,collectionFromPath(this.schema,s,t))}}}}t.Collection=Collection,t.collectionFromPath=collectionFromPath,t.isEmptyPath=isEmptyPath},(e,t,n)=>{"use strict";var s=n(14),i=n(11),r=n(21);t.createNode=function createNode(e,t,n){if(i.isDocument(e)&&(e=e.contents),i.isNode(e))return e;if(i.isPair(e)){const t=n.schema[i.MAP].createNode?.(n.schema,null,n);return t.items.push(e),t}(e instanceof String||e instanceof Number||e instanceof Boolean||"undefined"!=typeof BigInt&&e instanceof BigInt)&&(e=e.valueOf());const{aliasDuplicateObjects:o,onAnchor:a,onTagObj:l,schema:c,sourceObjects:p}=n;let u;if(o&&e&&"object"==typeof e){if(u=p.get(e),u)return u.anchor??(u.anchor=a(e)),new s.Alias(u.anchor);u={anchor:null,node:null},p.set(e,u)}t?.startsWith("!!")&&(t="tag:yaml.org,2002:"+t.slice(2));let f=function findTagObject(e,t,n){if(t){const e=n.filter(e=>e.tag===t),s=e.find(e=>!e.format)??e[0];if(!s)throw new Error(`Tag ${t} not found`);return s}return n.find(t=>t.identify?.(e)&&!t.format)}(e,t,c.tags);if(!f){if(e&&"function"==typeof e.toJSON&&(e=e.toJSON()),!e||"object"!=typeof e){const t=new r.Scalar(e);return u&&(u.node=t),t}f=e instanceof Map?c[i.MAP]:Symbol.iterator in Object(e)?c[i.SEQ]:c[i.MAP]}l&&(l(f),delete n.onTagObj);const d=f?.createNode?f.createNode(n.schema,e,n):"function"==typeof f?.nodeClass?.from?f.nodeClass.from(n.schema,e,n):new r.Scalar(e);return t?d.tag=t:f.default||(d.tag=f.tag),u&&(u.node=d),d}},(e,t,n)=>{"use strict";var s=n(11),i=n(16),r=n(18);class Scalar extends i.NodeBase{constructor(e){super(s.SCALAR),this.value=e}toJSON(e,t){return t?.keep?this.value:r.toJS(this.value,e,t)}toString(){return String(this.value)}}Scalar.BLOCK_FOLDED="BLOCK_FOLDED",Scalar.BLOCK_LITERAL="BLOCK_LITERAL",Scalar.PLAIN="PLAIN",Scalar.QUOTE_DOUBLE="QUOTE_DOUBLE",Scalar.QUOTE_SINGLE="QUOTE_SINGLE",t.Scalar=Scalar,t.isScalarValue=e=>!e||"function"!=typeof e&&"object"!=typeof e},(e,t,n)=>{"use strict";var s=n(20),i=n(23),r=n(28),o=n(11);class Pair{constructor(e,t=null){Object.defineProperty(this,o.NODE_TYPE,{value:o.PAIR}),this.key=e,this.value=t}clone(e){let{key:t,value:n}=this;return o.isNode(t)&&(t=t.clone(e)),o.isNode(n)&&(n=n.clone(e)),new Pair(t,n)}toJSON(e,t){const n=t?.mapAsMap?new Map:{};return r.addPairToJSMap(t,n,this)}toString(e,t,n){return e?.doc?i.stringifyPair(this,e,t,n):JSON.stringify(this)}}t.Pair=Pair,t.createPair=function createPair(e,t,n){const i=s.createNode(e,void 0,n),r=s.createNode(t,void 0,n);return new Pair(i,r)}},(e,t,n)=>{"use strict";var s=n(11),i=n(21),r=n(24),o=n(25);t.stringifyPair=function stringifyPair({key:e,value:t},n,a,l){const{allNullValues:c,doc:p,indent:u,indentStep:f,options:{commentString:d,indentSeq:h,simpleKeys:m}}=n;let g=s.isNode(e)&&e.comment||null;if(m){if(g)throw new Error("With simple keys, key nodes cannot have comments");if(s.isCollection(e)||!s.isNode(e)&&"object"==typeof e){throw new Error("With simple keys, collection cannot be used as a key value")}}let y=!m&&(!e||g&&null==t&&!n.inFlow||s.isCollection(e)||(s.isScalar(e)?e.type===i.Scalar.BLOCK_FOLDED||e.type===i.Scalar.BLOCK_LITERAL:"object"==typeof e));n=Object.assign({},n,{allNullValues:!1,implicitKey:!y&&(m||!c),indent:u+f});let b,v,x,w=!1,S=!1,k=r.stringify(e,n,()=>w=!0,()=>S=!0);if(!y&&!n.inFlow&&k.length>1024){if(m)throw new Error("With simple keys, single line scalar must not span more than 1024 characters");y=!0}if(n.inFlow){if(c||null==t)return w&&a&&a(),""===k?"?":y?`? ${k}`:k}else if(c&&!m||null==t&&y)return k=`? ${k}`,g&&!w?k+=o.lineComment(k,n.indent,d(g)):S&&l&&l(),k;w&&(g=null),y?(g&&(k+=o.lineComment(k,n.indent,d(g))),k=`? ${k}\n${u}:`):(k=`${k}:`,g&&(k+=o.lineComment(k,n.indent,d(g)))),s.isNode(t)?(b=!!t.spaceBefore,v=t.commentBefore,x=t.comment):(b=!1,v=null,x=null,t&&"object"==typeof t&&(t=p.createNode(t))),n.implicitKey=!1,y||g||!s.isScalar(t)||(n.indentAtStart=k.length+1),S=!1,h||!(f.length>=2)||n.inFlow||y||!s.isSeq(t)||t.flow||t.tag||t.anchor||(n.indent=n.indent.substring(2));let E=!1;const A=r.stringify(t,n,()=>E=!0,()=>S=!0);let C=" ";if(g||b||v){if(C=b?"\n":"",v){const e=d(v);C+=`\n${o.indentComment(e,n.indent)}`}""!==A||n.inFlow?C+=`\n${n.indent}`:"\n"===C&&x&&(C="\n\n")}else if(!y&&s.isCollection(t)){const e=A[0],s=A.indexOf("\n"),i=-1!==s,r=n.inFlow??t.flow??0===t.items.length;if(i||!r){let t=!1;if(i&&("&"===e||"!"===e)){let n=A.indexOf(" ");"&"===e&&-1!==n&&n<s&&"!"===A[n+1]&&(n=A.indexOf(" ",n+1)),(-1===n||s<n)&&(t=!0)}t||(C=`\n${n.indent}`)}}else""!==A&&"\n"!==A[0]||(C="");return k+=C+A,n.inFlow?E&&a&&a():x&&!E?k+=o.lineComment(k,n.indent,d(x)):S&&l&&l(),k}},(e,t,n)=>{"use strict";var s=n(15),i=n(11),r=n(25),o=n(26);t.createStringifyContext=function createStringifyContext(e,t){const n=Object.assign({blockQuote:!0,commentString:r.stringifyComment,defaultKeyType:null,defaultStringType:"PLAIN",directives:null,doubleQuotedAsJSON:!1,doubleQuotedMinMultiLineLength:40,falseStr:"false",flowCollectionPadding:!0,indentSeq:!0,lineWidth:80,minContentWidth:20,nullStr:"null",simpleKeys:!1,singleQuote:null,trueStr:"true",verifyAliasOrder:!0},e.schema.toStringOptions,t);let s;switch(n.collectionStyle){case"block":s=!1;break;case"flow":s=!0;break;default:s=null}return{anchors:new Set,doc:e,flowCollectionPadding:n.flowCollectionPadding?" ":"",indent:"",indentStep:"number"==typeof n.indent?" ".repeat(n.indent):"  ",inFlow:s,options:n}},t.stringify=function stringify(e,t,n,r){if(i.isPair(e))return e.toString(t,n,r);if(i.isAlias(e)){if(t.doc.directives)return e.toString(t);if(t.resolvedAliases?.has(e))throw new TypeError("Cannot stringify circular structure without alias nodes");t.resolvedAliases?t.resolvedAliases.add(e):t.resolvedAliases=new Set([e]),e=e.resolve(t.doc)}let a;const l=i.isNode(e)?e:t.doc.createNode(e,{onTagObj:e=>a=e});a??(a=function getTagObject(e,t){if(t.tag){const n=e.filter(e=>e.tag===t.tag);if(n.length>0)return n.find(e=>e.format===t.format)??n[0]}let n,s;if(i.isScalar(t)){s=t.value;let i=e.filter(e=>e.identify?.(s));if(i.length>1){const e=i.filter(e=>e.test);e.length>0&&(i=e)}n=i.find(e=>e.format===t.format)??i.find(e=>!e.format)}else s=t,n=e.find(e=>e.nodeClass&&s instanceof e.nodeClass);if(!n)throw new Error(`Tag not resolved for ${s?.constructor?.name??(null===s?"null":typeof s)} value`);return n}(t.doc.schema.tags,l));const c=function stringifyProps(e,t,{anchors:n,doc:r}){if(!r.directives)return"";const o=[],a=(i.isScalar(e)||i.isCollection(e))&&e.anchor;a&&s.anchorIsValid(a)&&(n.add(a),o.push(`&${a}`));const l=e.tag??(t.default?null:t.tag);return l&&o.push(r.directives.tagString(l)),o.join(" ")}(l,a,t);c.length>0&&(t.indentAtStart=(t.indentAtStart??0)+c.length+1);const p="function"==typeof a.stringify?a.stringify(l,t,n,r):i.isScalar(l)?o.stringifyString(l,t,n,r):l.toString(t,n,r);return c?i.isScalar(l)||"{"===p[0]||"["===p[0]?`${c} ${p}`:`${c}\n${t.indent}${p}`:p}},(e,t)=>{"use strict";function indentComment(e,t){return/^\n+$/.test(e)?e.substring(1):t?e.replace(/^(?! *$)/gm,t):e}t.indentComment=indentComment,t.lineComment=(e,t,n)=>e.endsWith("\n")?indentComment(n,t):n.includes("\n")?"\n"+indentComment(n,t):(e.endsWith(" ")?"":" ")+n,t.stringifyComment=e=>e.replace(/^(?!$)(?: $)?/gm,"#")},(e,t,n)=>{"use strict";var s=n(21),i=n(27);const getFoldOptions=(e,t)=>({indentAtStart:t?e.indent.length:e.indentAtStart,lineWidth:e.options.lineWidth,minContentWidth:e.options.minContentWidth}),containsDocumentMarker=e=>/^(%|---|\.\.\.)/m.test(e);function doubleQuotedString(e,t){const n=JSON.stringify(e);if(t.options.doubleQuotedAsJSON)return n;const{implicitKey:s}=t,r=t.options.doubleQuotedMinMultiLineLength,o=t.indent||(containsDocumentMarker(e)?"  ":"");let a="",l=0;for(let e=0,t=n[e];t;t=n[++e])if(" "===t&&"\\"===n[e+1]&&"n"===n[e+2]&&(a+=n.slice(l,e)+"\\ ",e+=1,l=e,t="\\"),"\\"===t)switch(n[e+1]){case"u":{a+=n.slice(l,e);const t=n.substr(e+2,4);switch(t){case"0000":a+="\\0";break;case"0007":a+="\\a";break;case"000b":a+="\\v";break;case"001b":a+="\\e";break;case"0085":a+="\\N";break;case"00a0":a+="\\_";break;case"2028":a+="\\L";break;case"2029":a+="\\P";break;default:"00"===t.substr(0,2)?a+="\\x"+t.substr(2):a+=n.substr(e,6)}e+=5,l=e+1}break;case"n":if(s||'"'===n[e+2]||n.length<r)e+=1;else{for(a+=n.slice(l,e)+"\n\n";"\\"===n[e+2]&&"n"===n[e+3]&&'"'!==n[e+4];)a+="\n",e+=2;a+=o," "===n[e+2]&&(a+="\\"),e+=1,l=e+1}break;default:e+=1}return a=l?a+n.slice(l):n,s?a:i.foldFlowLines(a,o,i.FOLD_QUOTED,getFoldOptions(t,!1))}function singleQuotedString(e,t){if(!1===t.options.singleQuote||t.implicitKey&&e.includes("\n")||/[ \t]\n|\n[ \t]/.test(e))return doubleQuotedString(e,t);const n=t.indent||(containsDocumentMarker(e)?"  ":""),s="'"+e.replace(/'/g,"''").replace(/\n+/g,`$&\n${n}`)+"'";return t.implicitKey?s:i.foldFlowLines(s,n,i.FOLD_FLOW,getFoldOptions(t,!1))}function quotedString(e,t){const{singleQuote:n}=t.options;let s;if(!1===n)s=doubleQuotedString;else{const t=e.includes('"'),i=e.includes("'");s=t&&!i?singleQuotedString:i&&!t?doubleQuotedString:n?singleQuotedString:doubleQuotedString}return s(e,t)}let r;try{r=new RegExp("(^|(?<!\n))\n+(?!\n|$)","g")}catch{r=/\n+(?!\n|$)/g}function blockString({comment:e,type:t,value:n},o,a,l){const{blockQuote:c,commentString:p,lineWidth:u}=o.options;if(!c||/\n[\t ]+$/.test(n))return quotedString(n,o);const f=o.indent||(o.forceBlockIndent||containsDocumentMarker(n)?"  ":""),d="literal"===c||"folded"!==c&&t!==s.Scalar.BLOCK_FOLDED&&(t===s.Scalar.BLOCK_LITERAL||!function lineLengthOverLimit(e,t,n){if(!t||t<0)return!1;const s=t-n,i=e.length;if(i<=s)return!1;for(let t=0,n=0;t<i;++t)if("\n"===e[t]){if(t-n>s)return!0;if(n=t+1,i-n<=s)return!1}return!0}(n,u,f.length));if(!n)return d?"|\n":">\n";let h,m;for(m=n.length;m>0;--m){const e=n[m-1];if("\n"!==e&&"\t"!==e&&" "!==e)break}let g=n.substring(m);const y=g.indexOf("\n");-1===y?h="-":n===g||y!==g.length-1?(h="+",l&&l()):h="",g&&(n=n.slice(0,-g.length),"\n"===g[g.length-1]&&(g=g.slice(0,-1)),g=g.replace(r,`$&${f}`));let b,v=!1,x=-1;for(b=0;b<n.length;++b){const e=n[b];if(" "===e)v=!0;else{if("\n"!==e)break;x=b}}let w=n.substring(0,x<b?x+1:b);w&&(n=n.substring(w.length),w=w.replace(/\n+/g,`$&${f}`));let S=(v?f?"2":"1":"")+h;if(e&&(S+=" "+p(e.replace(/ ?[\r\n]+/g," ")),a&&a()),!d){const e=n.replace(/\n+/g,"\n$&").replace(/(?:^|\n)([\t ].*)(?:([\n\t ]*)\n(?![\n\t ]))?/g,"$1$2").replace(/\n+/g,`$&${f}`);let r=!1;const a=getFoldOptions(o,!0);"folded"!==c&&t!==s.Scalar.BLOCK_FOLDED&&(a.onOverflow=()=>{r=!0});const l=i.foldFlowLines(`${w}${e}${g}`,f,i.FOLD_BLOCK,a);if(!r)return`>${S}\n${f}${l}`}return`|${S}\n${f}${w}${n=n.replace(/\n+/g,`$&${f}`)}${g}`}t.stringifyString=function stringifyString(e,t,n,r){const{implicitKey:o,inFlow:a}=t,l="string"==typeof e.value?e:Object.assign({},e,{value:String(e.value)});let{type:c}=e;c!==s.Scalar.QUOTE_DOUBLE&&/[\x00-\x08\x0b-\x1f\x7f-\x9f\u{D800}-\u{DFFF}]/u.test(l.value)&&(c=s.Scalar.QUOTE_DOUBLE);const _stringify=e=>{switch(e){case s.Scalar.BLOCK_FOLDED:case s.Scalar.BLOCK_LITERAL:return o||a?quotedString(l.value,t):blockString(l,t,n,r);case s.Scalar.QUOTE_DOUBLE:return doubleQuotedString(l.value,t);case s.Scalar.QUOTE_SINGLE:return singleQuotedString(l.value,t);case s.Scalar.PLAIN:return function plainString(e,t,n,r){const{type:o,value:a}=e,{actualString:l,implicitKey:c,indent:p,indentStep:u,inFlow:f}=t;if(c&&a.includes("\n")||f&&/[[\]{},]/.test(a))return quotedString(a,t);if(/^[\n\t ,[\]{}#&*!|>'"%@`]|^[?-]$|^[?-][ \t]|[\n:][ \t]|[ \t]\n|[\n\t ]#|[\n\t :]$/.test(a))return c||f||!a.includes("\n")?quotedString(a,t):blockString(e,t,n,r);if(!c&&!f&&o!==s.Scalar.PLAIN&&a.includes("\n"))return blockString(e,t,n,r);if(containsDocumentMarker(a)){if(""===p)return t.forceBlockIndent=!0,blockString(e,t,n,r);if(c&&p===u)return quotedString(a,t)}const d=a.replace(/\n+/g,`$&\n${p}`);if(l){const test=e=>e.default&&"tag:yaml.org,2002:str"!==e.tag&&e.test?.test(d),{compat:e,tags:n}=t.doc.schema;if(n.some(test)||e?.some(test))return quotedString(a,t)}return c?d:i.foldFlowLines(d,p,i.FOLD_FLOW,getFoldOptions(t,!1))}(l,t,n,r);default:return null}};let p=_stringify(c);if(null===p){const{defaultKeyType:e,defaultStringType:n}=t.options,s=o&&e||n;if(p=_stringify(s),null===p)throw new Error(`Unsupported default string type ${s}`)}return p}},(e,t)=>{"use strict";const n="block",s="quoted";function consumeMoreIndentedLines(e,t,n){let s=t,i=t+1,r=e[i];for(;" "===r||"\t"===r;)if(t<i+n)r=e[++t];else{do{r=e[++t]}while(r&&"\n"!==r);s=t,i=t+1,r=e[i]}return s}t.FOLD_BLOCK=n,t.FOLD_FLOW="flow",t.FOLD_QUOTED=s,t.foldFlowLines=function foldFlowLines(e,t,i="flow",{indentAtStart:r,lineWidth:o=80,minContentWidth:a=20,onFold:l,onOverflow:c}={}){if(!o||o<0)return e;o<a&&(a=0);const p=Math.max(1+a,1+o-t.length);if(e.length<=p)return e;const u=[],f={};let d,h,m=o-t.length;"number"==typeof r&&(r>o-Math.max(2,a)?u.push(0):m=o-r);let g=!1,y=-1,b=-1,v=-1;i===n&&(y=consumeMoreIndentedLines(e,y,t.length),-1!==y&&(m=y+p));for(let r;r=e[y+=1];){if(i===s&&"\\"===r){switch(b=y,e[y+1]){case"x":y+=3;break;case"u":y+=5;break;case"U":y+=9;break;default:y+=1}v=y}if("\n"===r)i===n&&(y=consumeMoreIndentedLines(e,y,t.length)),m=y+t.length+p,d=void 0;else{if(" "===r&&h&&" "!==h&&"\n"!==h&&"\t"!==h){const t=e[y+1];t&&" "!==t&&"\n"!==t&&"\t"!==t&&(d=y)}if(y>=m)if(d)u.push(d),m=d+p,d=void 0;else if(i===s){for(;" "===h||"\t"===h;)h=r,r=e[y+=1],g=!0;const t=y>v+1?y-2:b-1;if(f[t])return e;u.push(t),f[t]=!0,m=t+p,d=void 0}else g=!0}h=r}if(g&&c&&c(),0===u.length)return e;l&&l();let x=e.slice(0,u[0]);for(let n=0;n<u.length;++n){const r=u[n],o=u[n+1]||e.length;0===r?x=`\n${t}${e.slice(0,o)}`:(i===s&&f[r]&&(x+=`${e[r]}\\`),x+=`\n${t}${e.slice(r+1,o)}`)}return x}},(e,t,n)=>{"use strict";var s=n(29),i=n(30),r=n(24),o=n(11),a=n(18);t.addPairToJSMap=function addPairToJSMap(e,t,{key:n,value:l}){if(o.isNode(n)&&n.addToJSMap)n.addToJSMap(e,t,l);else if(i.isMergeKey(e,n))i.addMergeToJSMap(e,t,l);else{const i=a.toJS(n,"",e);if(t instanceof Map)t.set(i,a.toJS(l,i,e));else if(t instanceof Set)t.add(i);else{const c=function stringifyKey(e,t,n){if(null===t)return"";if("object"!=typeof t)return String(t);if(o.isNode(e)&&n?.doc){const t=r.createStringifyContext(n.doc,{});t.anchors=new Set;for(const e of n.anchors.keys())t.anchors.add(e.anchor);t.inFlow=!0,t.inStringifyKey=!0;const i=e.toString(t);if(!n.mapKeyWarned){let e=JSON.stringify(i);e.length>40&&(e=e.substring(0,36)+'..."'),s.warn(n.doc.options.logLevel,`Keys with collection values will be stringified due to JS Object restrictions: ${e}. Set mapAsMap: true to use object keys.`),n.mapKeyWarned=!0}return i}return JSON.stringify(t)}(n,i,e),p=a.toJS(l,c,e);c in t?Object.defineProperty(t,c,{value:p,writable:!0,enumerable:!0,configurable:!0}):t[c]=p}}return t}},(e,t,n)=>{"use strict";var s=n(9);t.debug=function debug(e,...t){"debug"===e&&console.log(...t)},t.warn=function warn(e,t){"debug"!==e&&"warn"!==e||("function"==typeof s.emitWarning?s.emitWarning(t):console.warn(t))}},(e,t,n)=>{"use strict";var s=n(11),i=n(21);const r="<<",o={identify:e=>e===r||"symbol"==typeof e&&e.description===r,default:"key",tag:"tag:yaml.org,2002:merge",test:/^<<$/,resolve:()=>Object.assign(new i.Scalar(Symbol(r)),{addToJSMap:addMergeToJSMap}),stringify:()=>r};function addMergeToJSMap(e,t,n){if(n=e&&s.isAlias(n)?n.resolve(e.doc):n,s.isSeq(n))for(const s of n.items)mergeValue(e,t,s);else if(Array.isArray(n))for(const s of n)mergeValue(e,t,s);else mergeValue(e,t,n)}function mergeValue(e,t,n){const i=e&&s.isAlias(n)?n.resolve(e.doc):n;if(!s.isMap(i))throw new Error("Merge sources must be maps or map aliases");const r=i.toJSON(null,e,Map);for(const[e,n]of r)t instanceof Map?t.has(e)||t.set(e,n):t instanceof Set?t.add(e):Object.prototype.hasOwnProperty.call(t,e)||Object.defineProperty(t,e,{value:n,writable:!0,enumerable:!0,configurable:!0});return t}t.addMergeToJSMap=addMergeToJSMap,t.isMergeKey=(e,t)=>(o.identify(t)||s.isScalar(t)&&(!t.type||t.type===i.Scalar.PLAIN)&&o.identify(t.value))&&e?.doc.schema.tags.some(e=>e.tag===o.tag&&e.default),t.merge=o},(e,t,n)=>{"use strict";var s=n(11),i=n(32),r=n(35),o=n(37),a=n(38);const sortMapEntriesByKey=(e,t)=>e.key<t.key?-1:e.key>t.key?1:0;class Schema{constructor({compat:e,customTags:t,merge:n,resolveKnownTags:l,schema:c,sortMapEntries:p,toStringDefaults:u}){this.compat=Array.isArray(e)?a.getTags(e,"compat"):e?a.getTags(null,e):null,this.name="string"==typeof c&&c||"core",this.knownTags=l?a.coreKnownTags:{},this.tags=a.getTags(t,this.name,n),this.toStringOptions=u??null,Object.defineProperty(this,s.MAP,{value:i.map}),Object.defineProperty(this,s.SCALAR,{value:o.string}),Object.defineProperty(this,s.SEQ,{value:r.seq}),this.sortMapEntries="function"==typeof p?p:!0===p?sortMapEntriesByKey:null}clone(){const e=Object.create(Schema.prototype,Object.getOwnPropertyDescriptors(this));return e.tags=this.tags.slice(),e}}t.Schema=Schema},(e,t,n)=>{"use strict";var s=n(11),i=n(33);const r={collection:"map",default:!0,nodeClass:i.YAMLMap,tag:"tag:yaml.org,2002:map",resolve:(e,t)=>(s.isMap(e)||t("Expected a mapping for this tag"),e),createNode:(e,t,n)=>i.YAMLMap.from(e,t,n)};t.map=r},(e,t,n)=>{"use strict";var s=n(34),i=n(28),r=n(19),o=n(11),a=n(22),l=n(21);function findPair(e,t){const n=o.isScalar(t)?t.value:t;for(const s of e)if(o.isPair(s)){if(s.key===t||s.key===n)return s;if(o.isScalar(s.key)&&s.key.value===n)return s}}class YAMLMap extends r.Collection{static get tagName(){return"tag:yaml.org,2002:map"}constructor(e){super(o.MAP,e),this.items=[]}static from(e,t,n){const{keepUndefined:s,replacer:i}=n,r=new this(e),add=(e,o)=>{if("function"==typeof i)o=i.call(t,e,o);else if(Array.isArray(i)&&!i.includes(e))return;(void 0!==o||s)&&r.items.push(a.createPair(e,o,n))};if(t instanceof Map)for(const[e,n]of t)add(e,n);else if(t&&"object"==typeof t)for(const e of Object.keys(t))add(e,t[e]);return"function"==typeof e.sortMapEntries&&r.items.sort(e.sortMapEntries),r}add(e,t){let n;n=o.isPair(e)?e:e&&"object"==typeof e&&"key"in e?new a.Pair(e.key,e.value):new a.Pair(e,e?.value);const s=findPair(this.items,n.key),i=this.schema?.sortMapEntries;if(s){if(!t)throw new Error(`Key ${n.key} already set`);o.isScalar(s.value)&&l.isScalarValue(n.value)?s.value.value=n.value:s.value=n.value}else if(i){const e=this.items.findIndex(e=>i(n,e)<0);-1===e?this.items.push(n):this.items.splice(e,0,n)}else this.items.push(n)}delete(e){const t=findPair(this.items,e);if(!t)return!1;return this.items.splice(this.items.indexOf(t),1).length>0}get(e,t){const n=findPair(this.items,e),s=n?.value;return(!t&&o.isScalar(s)?s.value:s)??void 0}has(e){return!!findPair(this.items,e)}set(e,t){this.add(new a.Pair(e,t),!0)}toJSON(e,t,n){const s=n?new n:t?.mapAsMap?new Map:{};t?.onCreate&&t.onCreate(s);for(const e of this.items)i.addPairToJSMap(t,s,e);return s}toString(e,t,n){if(!e)return JSON.stringify(this);for(const e of this.items)if(!o.isPair(e))throw new Error(`Map items must all be pairs; found ${JSON.stringify(e)} instead`);return!e.allNullValues&&this.hasAllNullValues(!1)&&(e=Object.assign({},e,{allNullValues:!0})),s.stringifyCollection(this,e,{blockItemPrefix:"",flowChars:{start:"{",end:"}"},itemIndent:e.indent||"",onChompKeep:n,onComment:t})}}t.YAMLMap=YAMLMap,t.findPair=findPair},(e,t,n)=>{"use strict";var s=n(11),i=n(24),r=n(25);function stringifyBlockCollection({comment:e,items:t},n,{blockItemPrefix:o,flowChars:a,itemIndent:l,onChompKeep:c,onComment:p}){const{indent:u,options:{commentString:f}}=n,d=Object.assign({},n,{indent:l,type:null});let h=!1;const m=[];for(let e=0;e<t.length;++e){const a=t[e];let c=null;if(s.isNode(a))!h&&a.spaceBefore&&m.push(""),addCommentBefore(n,m,a.commentBefore,h),a.comment&&(c=a.comment);else if(s.isPair(a)){const e=s.isNode(a.key)?a.key:null;e&&(!h&&e.spaceBefore&&m.push(""),addCommentBefore(n,m,e.commentBefore,h))}h=!1;let p=i.stringify(a,d,()=>c=null,()=>h=!0);c&&(p+=r.lineComment(p,l,f(c))),h&&c&&(h=!1),m.push(o+p)}let g;if(0===m.length)g=a.start+a.end;else{g=m[0];for(let e=1;e<m.length;++e){const t=m[e];g+=t?`\n${u}${t}`:"\n"}}return e?(g+="\n"+r.indentComment(f(e),u),p&&p()):h&&c&&c(),g}function stringifyFlowCollection({items:e},t,{flowChars:n,itemIndent:o}){const{indent:a,indentStep:l,flowCollectionPadding:c,options:{commentString:p}}=t;o+=l;const u=Object.assign({},t,{indent:o,inFlow:!0,type:null});let f=!1,d=0;const h=[];for(let n=0;n<e.length;++n){const a=e[n];let l=null;if(s.isNode(a))a.spaceBefore&&h.push(""),addCommentBefore(t,h,a.commentBefore,!1),a.comment&&(l=a.comment);else if(s.isPair(a)){const e=s.isNode(a.key)?a.key:null;e&&(e.spaceBefore&&h.push(""),addCommentBefore(t,h,e.commentBefore,!1),e.comment&&(f=!0));const n=s.isNode(a.value)?a.value:null;n?(n.comment&&(l=n.comment),n.commentBefore&&(f=!0)):null==a.value&&e?.comment&&(l=e.comment)}l&&(f=!0);let c=i.stringify(a,u,()=>l=null);n<e.length-1&&(c+=","),l&&(c+=r.lineComment(c,o,p(l))),!f&&(h.length>d||c.includes("\n"))&&(f=!0),h.push(c),d=h.length}const{start:m,end:g}=n;if(0===h.length)return m+g;if(!f){const e=h.reduce((e,t)=>e+t.length+2,2);f=t.options.lineWidth>0&&e>t.options.lineWidth}if(f){let e=m;for(const t of h)e+=t?`\n${l}${a}${t}`:"\n";return`${e}\n${a}${g}`}return`${m}${c}${h.join(" ")}${c}${g}`}function addCommentBefore({indent:e,options:{commentString:t}},n,s,i){if(s&&i&&(s=s.replace(/^\n+/,"")),s){const i=r.indentComment(t(s),e);n.push(i.trimStart())}}t.stringifyCollection=function stringifyCollection(e,t,n){return(t.inFlow??e.flow?stringifyFlowCollection:stringifyBlockCollection)(e,t,n)}},(e,t,n)=>{"use strict";var s=n(11),i=n(36);const r={collection:"seq",default:!0,nodeClass:i.YAMLSeq,tag:"tag:yaml.org,2002:seq",resolve:(e,t)=>(s.isSeq(e)||t("Expected a sequence for this tag"),e),createNode:(e,t,n)=>i.YAMLSeq.from(e,t,n)};t.seq=r},(e,t,n)=>{"use strict";var s=n(20),i=n(34),r=n(19),o=n(11),a=n(21),l=n(18);class YAMLSeq extends r.Collection{static get tagName(){return"tag:yaml.org,2002:seq"}constructor(e){super(o.SEQ,e),this.items=[]}add(e){this.items.push(e)}delete(e){const t=asItemIndex(e);if("number"!=typeof t)return!1;return this.items.splice(t,1).length>0}get(e,t){const n=asItemIndex(e);if("number"!=typeof n)return;const s=this.items[n];return!t&&o.isScalar(s)?s.value:s}has(e){const t=asItemIndex(e);return"number"==typeof t&&t<this.items.length}set(e,t){const n=asItemIndex(e);if("number"!=typeof n)throw new Error(`Expected a valid index, not ${e}.`);const s=this.items[n];o.isScalar(s)&&a.isScalarValue(t)?s.value=t:this.items[n]=t}toJSON(e,t){const n=[];t?.onCreate&&t.onCreate(n);let s=0;for(const e of this.items)n.push(l.toJS(e,String(s++),t));return n}toString(e,t,n){return e?i.stringifyCollection(this,e,{blockItemPrefix:"- ",flowChars:{start:"[",end:"]"},itemIndent:(e.indent||"")+"  ",onChompKeep:n,onComment:t}):JSON.stringify(this)}static from(e,t,n){const{replacer:i}=n,r=new this(e);if(t&&Symbol.iterator in Object(t)){let e=0;for(let o of t){if("function"==typeof i){const n=t instanceof Set?o:String(e++);o=i.call(t,n,o)}r.items.push(s.createNode(o,void 0,n))}}return r}}function asItemIndex(e){let t=o.isScalar(e)?e.value:e;return t&&"string"==typeof t&&(t=Number(t)),"number"==typeof t&&Number.isInteger(t)&&t>=0?t:null}t.YAMLSeq=YAMLSeq},(e,t,n)=>{"use strict";var s=n(26);const i={identify:e=>"string"==typeof e,default:!0,tag:"tag:yaml.org,2002:str",resolve:e=>e,stringify:(e,t,n,i)=>(t=Object.assign({actualString:!0},t),s.stringifyString(e,t,n,i))};t.string=i},(e,t,n)=>{"use strict";var s=n(32),i=n(39),r=n(35),o=n(37),a=n(40),l=n(41),c=n(43),p=n(44),u=n(45),f=n(46),d=n(30),h=n(48),m=n(49),g=n(50),y=n(54),b=n(55);const v=new Map([["core",p.schema],["failsafe",[s.map,r.seq,o.string]],["json",u.schema],["yaml11",g.schema],["yaml-1.1",g.schema]]),x={binary:f.binary,bool:a.boolTag,float:l.float,floatExp:l.floatExp,floatNaN:l.floatNaN,floatTime:b.floatTime,int:c.int,intHex:c.intHex,intOct:c.intOct,intTime:b.intTime,map:s.map,merge:d.merge,null:i.nullTag,omap:h.omap,pairs:m.pairs,seq:r.seq,set:y.set,timestamp:b.timestamp},w={"tag:yaml.org,2002:binary":f.binary,"tag:yaml.org,2002:merge":d.merge,"tag:yaml.org,2002:omap":h.omap,"tag:yaml.org,2002:pairs":m.pairs,"tag:yaml.org,2002:set":y.set,"tag:yaml.org,2002:timestamp":b.timestamp};t.coreKnownTags=w,t.getTags=function getTags(e,t,n){const s=v.get(t);if(s&&!e)return n&&!s.includes(d.merge)?s.concat(d.merge):s.slice();let i=s;if(!i){if(!Array.isArray(e)){const e=Array.from(v.keys()).filter(e=>"yaml11"!==e).map(e=>JSON.stringify(e)).join(", ");throw new Error(`Unknown schema "${t}"; use one of ${e} or define customTags array`)}i=[]}if(Array.isArray(e))for(const t of e)i=i.concat(t);else"function"==typeof e&&(i=e(i.slice()));return n&&(i=i.concat(d.merge)),i.reduce((e,t)=>{const n="string"==typeof t?x[t]:t;if(!n){const e=JSON.stringify(t),n=Object.keys(x).map(e=>JSON.stringify(e)).join(", ");throw new Error(`Unknown custom tag ${e}; use one of ${n}`)}return e.includes(n)||e.push(n),e},[])}},(e,t,n)=>{"use strict";var s=n(21);const i={identify:e=>null==e,createNode:()=>new s.Scalar(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^(?:~|[Nn]ull|NULL)?$/,resolve:()=>new s.Scalar(null),stringify:({source:e},t)=>"string"==typeof e&&i.test.test(e)?e:t.options.nullStr};t.nullTag=i},(e,t,n)=>{"use strict";var s=n(21);const i={identify:e=>"boolean"==typeof e,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:[Tt]rue|TRUE|[Ff]alse|FALSE)$/,resolve:e=>new s.Scalar("t"===e[0]||"T"===e[0]),stringify({source:e,value:t},n){if(e&&i.test.test(e)){if(t===("t"===e[0]||"T"===e[0]))return e}return t?n.options.trueStr:n.options.falseStr}};t.boolTag=i},(e,t,n)=>{"use strict";var s=n(21),i=n(42);const r={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:e=>"nan"===e.slice(-3).toLowerCase()?NaN:"-"===e[0]?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:i.stringifyNumber},o={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:\.[0-9]+|[0-9]+(?:\.[0-9]*)?)[eE][-+]?[0-9]+$/,resolve:e=>parseFloat(e),stringify(e){const t=Number(e.value);return isFinite(t)?t.toExponential():i.stringifyNumber(e)}},a={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:\.[0-9]+|[0-9]+\.[0-9]*)$/,resolve(e){const t=new s.Scalar(parseFloat(e)),n=e.indexOf(".");return-1!==n&&"0"===e[e.length-1]&&(t.minFractionDigits=e.length-n-1),t},stringify:i.stringifyNumber};t.float=a,t.floatExp=o,t.floatNaN=r},(e,t)=>{"use strict";t.stringifyNumber=function stringifyNumber({format:e,minFractionDigits:t,tag:n,value:s}){if("bigint"==typeof s)return String(s);const i="number"==typeof s?s:Number(s);if(!isFinite(i))return isNaN(i)?".nan":i<0?"-.inf":".inf";let r=Object.is(s,-0)?"-0":JSON.stringify(s);if(!e&&t&&(!n||"tag:yaml.org,2002:float"===n)&&/^\d/.test(r)){let e=r.indexOf(".");e<0&&(e=r.length,r+=".");let n=t-(r.length-e-1);for(;n-- >0;)r+="0"}return r}},(e,t,n)=>{"use strict";var s=n(42);const intIdentify=e=>"bigint"==typeof e||Number.isInteger(e),intResolve=(e,t,n,{intAsBigInt:s})=>s?BigInt(e):parseInt(e.substring(t),n);function intStringify(e,t,n){const{value:i}=e;return intIdentify(i)&&i>=0?n+i.toString(t):s.stringifyNumber(e)}const i={identify:e=>intIdentify(e)&&e>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^0o[0-7]+$/,resolve:(e,t,n)=>intResolve(e,2,8,n),stringify:e=>intStringify(e,8,"0o")},r={identify:intIdentify,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9]+$/,resolve:(e,t,n)=>intResolve(e,0,10,n),stringify:s.stringifyNumber},o={identify:e=>intIdentify(e)&&e>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^0x[0-9a-fA-F]+$/,resolve:(e,t,n)=>intResolve(e,2,16,n),stringify:e=>intStringify(e,16,"0x")};t.int=r,t.intHex=o,t.intOct=i},(e,t,n)=>{"use strict";var s=n(32),i=n(39),r=n(35),o=n(37),a=n(40),l=n(41),c=n(43);const p=[s.map,r.seq,o.string,i.nullTag,a.boolTag,c.intOct,c.int,c.intHex,l.floatNaN,l.floatExp,l.float];t.schema=p},(e,t,n)=>{"use strict";var s=n(21),i=n(32),r=n(35);function intIdentify(e){return"bigint"==typeof e||Number.isInteger(e)}const stringifyJSON=({value:e})=>JSON.stringify(e),o=[{identify:e=>"string"==typeof e,default:!0,tag:"tag:yaml.org,2002:str",resolve:e=>e,stringify:stringifyJSON},{identify:e=>null==e,createNode:()=>new s.Scalar(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^null$/,resolve:()=>null,stringify:stringifyJSON},{identify:e=>"boolean"==typeof e,default:!0,tag:"tag:yaml.org,2002:bool",test:/^true$|^false$/,resolve:e=>"true"===e,stringify:stringifyJSON},{identify:intIdentify,default:!0,tag:"tag:yaml.org,2002:int",test:/^-?(?:0|[1-9][0-9]*)$/,resolve:(e,t,{intAsBigInt:n})=>n?BigInt(e):parseInt(e,10),stringify:({value:e})=>intIdentify(e)?e.toString():JSON.stringify(e)},{identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",test:/^-?(?:0|[1-9][0-9]*)(?:\.[0-9]*)?(?:[eE][-+]?[0-9]+)?$/,resolve:e=>parseFloat(e),stringify:stringifyJSON}],a={default:!0,tag:"",test:/^/,resolve:(e,t)=>(t(`Unresolved plain scalar ${JSON.stringify(e)}`),e)},l=[i.map,r.seq].concat(o,a);t.schema=l},(e,t,n)=>{"use strict";var s=n(47),i=n(21),r=n(26);const o={identify:e=>e instanceof Uint8Array,default:!1,tag:"tag:yaml.org,2002:binary",resolve(e,t){if("function"==typeof s.Buffer)return s.Buffer.from(e,"base64");if("function"==typeof atob){const t=atob(e.replace(/[\n\r]/g,"")),n=new Uint8Array(t.length);for(let e=0;e<t.length;++e)n[e]=t.charCodeAt(e);return n}return t("This environment does not support reading binary tags; either Buffer or atob is required"),e},stringify({comment:e,type:t,value:n},o,a,l){if(!n)return"";const c=n;let p;if("function"==typeof s.Buffer)p=c instanceof s.Buffer?c.toString("base64"):s.Buffer.from(c.buffer).toString("base64");else{if("function"!=typeof btoa)throw new Error("This environment does not support writing binary tags; either Buffer or btoa is required");{let e="";for(let t=0;t<c.length;++t)e+=String.fromCharCode(c[t]);p=btoa(e)}}if(t??(t=i.Scalar.BLOCK_LITERAL),t!==i.Scalar.QUOTE_DOUBLE){const e=Math.max(o.options.lineWidth-o.indent.length,o.options.minContentWidth),n=Math.ceil(p.length/e),s=new Array(n);for(let t=0,i=0;t<n;++t,i+=e)s[t]=p.substr(i,e);p=s.join(t===i.Scalar.BLOCK_LITERAL?"\n":" ")}return r.stringifyString({comment:e,type:t,value:p},o,a,l)}};t.binary=o},e=>{"use strict";e.exports=require("buffer")},(e,t,n)=>{"use strict";var s=n(11),i=n(18),r=n(33),o=n(36),a=n(49);class YAMLOMap extends o.YAMLSeq{constructor(){super(),this.add=r.YAMLMap.prototype.add.bind(this),this.delete=r.YAMLMap.prototype.delete.bind(this),this.get=r.YAMLMap.prototype.get.bind(this),this.has=r.YAMLMap.prototype.has.bind(this),this.set=r.YAMLMap.prototype.set.bind(this),this.tag=YAMLOMap.tag}toJSON(e,t){if(!t)return super.toJSON(e);const n=new Map;t?.onCreate&&t.onCreate(n);for(const e of this.items){let r,o;if(s.isPair(e)?(r=i.toJS(e.key,"",t),o=i.toJS(e.value,r,t)):r=i.toJS(e,"",t),n.has(r))throw new Error("Ordered maps must not include duplicate keys");n.set(r,o)}return n}static from(e,t,n){const s=a.createPairs(e,t,n),i=new this;return i.items=s.items,i}}YAMLOMap.tag="tag:yaml.org,2002:omap";const l={collection:"seq",identify:e=>e instanceof Map,nodeClass:YAMLOMap,default:!1,tag:"tag:yaml.org,2002:omap",resolve(e,t){const n=a.resolvePairs(e,t),i=[];for(const{key:e}of n.items)s.isScalar(e)&&(i.includes(e.value)?t(`Ordered maps must not include duplicate keys: ${e.value}`):i.push(e.value));return Object.assign(new YAMLOMap,n)},createNode:(e,t,n)=>YAMLOMap.from(e,t,n)};t.YAMLOMap=YAMLOMap,t.omap=l},(e,t,n)=>{"use strict";var s=n(11),i=n(22),r=n(21),o=n(36);function resolvePairs(e,t){if(s.isSeq(e))for(let n=0;n<e.items.length;++n){let o=e.items[n];if(!s.isPair(o)){if(s.isMap(o)){o.items.length>1&&t("Each pair must have its own sequence indicator");const e=o.items[0]||new i.Pair(new r.Scalar(null));if(o.commentBefore&&(e.key.commentBefore=e.key.commentBefore?`${o.commentBefore}\n${e.key.commentBefore}`:o.commentBefore),o.comment){const t=e.value??e.key;t.comment=t.comment?`${o.comment}\n${t.comment}`:o.comment}o=e}e.items[n]=s.isPair(o)?o:new i.Pair(o)}}else t("Expected a sequence for this tag");return e}function createPairs(e,t,n){const{replacer:s}=n,r=new o.YAMLSeq(e);r.tag="tag:yaml.org,2002:pairs";let a=0;if(t&&Symbol.iterator in Object(t))for(let e of t){let o,l;if("function"==typeof s&&(e=s.call(t,String(a++),e)),Array.isArray(e)){if(2!==e.length)throw new TypeError(`Expected [key, value] tuple: ${e}`);o=e[0],l=e[1]}else if(e&&e instanceof Object){const t=Object.keys(e);if(1!==t.length)throw new TypeError(`Expected tuple with one key, not ${t.length} keys`);o=t[0],l=e[o]}else o=e;r.items.push(i.createPair(o,l,n))}return r}const a={collection:"seq",default:!1,tag:"tag:yaml.org,2002:pairs",resolve:resolvePairs,createNode:createPairs};t.createPairs=createPairs,t.pairs=a,t.resolvePairs=resolvePairs},(e,t,n)=>{"use strict";var s=n(32),i=n(39),r=n(35),o=n(37),a=n(46),l=n(51),c=n(52),p=n(53),u=n(30),f=n(48),d=n(49),h=n(54),m=n(55);const g=[s.map,r.seq,o.string,i.nullTag,l.trueTag,l.falseTag,p.intBin,p.intOct,p.int,p.intHex,c.floatNaN,c.floatExp,c.float,a.binary,u.merge,f.omap,d.pairs,h.set,m.intTime,m.floatTime,m.timestamp];t.schema=g},(e,t,n)=>{"use strict";var s=n(21);function boolStringify({value:e,source:t},n){return t&&(e?i:r).test.test(t)?t:e?n.options.trueStr:n.options.falseStr}const i={identify:e=>!0===e,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:Y|y|[Yy]es|YES|[Tt]rue|TRUE|[Oo]n|ON)$/,resolve:()=>new s.Scalar(!0),stringify:boolStringify},r={identify:e=>!1===e,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:N|n|[Nn]o|NO|[Ff]alse|FALSE|[Oo]ff|OFF)$/,resolve:()=>new s.Scalar(!1),stringify:boolStringify};t.falseTag=r,t.trueTag=i},(e,t,n)=>{"use strict";var s=n(21),i=n(42);const r={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:e=>"nan"===e.slice(-3).toLowerCase()?NaN:"-"===e[0]?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:i.stringifyNumber},o={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:[0-9][0-9_]*)?(?:\.[0-9_]*)?[eE][-+]?[0-9]+$/,resolve:e=>parseFloat(e.replace(/_/g,"")),stringify(e){const t=Number(e.value);return isFinite(t)?t.toExponential():i.stringifyNumber(e)}},a={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:[0-9][0-9_]*)?\.[0-9_]*$/,resolve(e){const t=new s.Scalar(parseFloat(e.replace(/_/g,""))),n=e.indexOf(".");if(-1!==n){const s=e.substring(n+1).replace(/_/g,"");"0"===s[s.length-1]&&(t.minFractionDigits=s.length)}return t},stringify:i.stringifyNumber};t.float=a,t.floatExp=o,t.floatNaN=r},(e,t,n)=>{"use strict";var s=n(42);const intIdentify=e=>"bigint"==typeof e||Number.isInteger(e);function intResolve(e,t,n,{intAsBigInt:s}){const i=e[0];if("-"!==i&&"+"!==i||(t+=1),e=e.substring(t).replace(/_/g,""),s){switch(n){case 2:e=`0b${e}`;break;case 8:e=`0o${e}`;break;case 16:e=`0x${e}`}const t=BigInt(e);return"-"===i?BigInt(-1)*t:t}const r=parseInt(e,n);return"-"===i?-1*r:r}function intStringify(e,t,n){const{value:i}=e;if(intIdentify(i)){const e=i.toString(t);return i<0?"-"+n+e.substr(1):n+e}return s.stringifyNumber(e)}const i={identify:intIdentify,default:!0,tag:"tag:yaml.org,2002:int",format:"BIN",test:/^[-+]?0b[0-1_]+$/,resolve:(e,t,n)=>intResolve(e,2,2,n),stringify:e=>intStringify(e,2,"0b")},r={identify:intIdentify,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^[-+]?0[0-7_]+$/,resolve:(e,t,n)=>intResolve(e,1,8,n),stringify:e=>intStringify(e,8,"0")},o={identify:intIdentify,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9][0-9_]*$/,resolve:(e,t,n)=>intResolve(e,0,10,n),stringify:s.stringifyNumber},a={identify:intIdentify,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^[-+]?0x[0-9a-fA-F_]+$/,resolve:(e,t,n)=>intResolve(e,2,16,n),stringify:e=>intStringify(e,16,"0x")};t.int=o,t.intBin=i,t.intHex=a,t.intOct=r},(e,t,n)=>{"use strict";var s=n(11),i=n(22),r=n(33);class YAMLSet extends r.YAMLMap{constructor(e){super(e),this.tag=YAMLSet.tag}add(e){let t;t=s.isPair(e)?e:e&&"object"==typeof e&&"key"in e&&"value"in e&&null===e.value?new i.Pair(e.key,null):new i.Pair(e,null);r.findPair(this.items,t.key)||this.items.push(t)}get(e,t){const n=r.findPair(this.items,e);return!t&&s.isPair(n)?s.isScalar(n.key)?n.key.value:n.key:n}set(e,t){if("boolean"!=typeof t)throw new Error("Expected boolean value for set(key, value) in a YAML set, not "+typeof t);const n=r.findPair(this.items,e);n&&!t?this.items.splice(this.items.indexOf(n),1):!n&&t&&this.items.push(new i.Pair(e))}toJSON(e,t){return super.toJSON(e,t,Set)}toString(e,t,n){if(!e)return JSON.stringify(this);if(this.hasAllNullValues(!0))return super.toString(Object.assign({},e,{allNullValues:!0}),t,n);throw new Error("Set items must all have null values")}static from(e,t,n){const{replacer:s}=n,r=new this(e);if(t&&Symbol.iterator in Object(t))for(let e of t)"function"==typeof s&&(e=s.call(t,e,e)),r.items.push(i.createPair(e,null,n));return r}}YAMLSet.tag="tag:yaml.org,2002:set";const o={collection:"map",identify:e=>e instanceof Set,nodeClass:YAMLSet,default:!1,tag:"tag:yaml.org,2002:set",createNode:(e,t,n)=>YAMLSet.from(e,t,n),resolve(e,t){if(s.isMap(e)){if(e.hasAllNullValues(!0))return Object.assign(new YAMLSet,e);t("Set items must all have null values")}else t("Expected a mapping for this tag");return e}};t.YAMLSet=YAMLSet,t.set=o},(e,t,n)=>{"use strict";var s=n(42);function parseSexagesimal(e,t){const n=e[0],s="-"===n||"+"===n?e.substring(1):e,num=e=>t?BigInt(e):Number(e),i=s.replace(/_/g,"").split(":").reduce((e,t)=>e*num(60)+num(t),num(0));return"-"===n?num(-1)*i:i}function stringifySexagesimal(e){let{value:t}=e,num=e=>e;if("bigint"==typeof t)num=e=>BigInt(e);else if(isNaN(t)||!isFinite(t))return s.stringifyNumber(e);let n="";t<0&&(n="-",t*=num(-1));const i=num(60),r=[t%i];return t<60?r.unshift(0):(t=(t-r[0])/i,r.unshift(t%i),t>=60&&(t=(t-r[0])/i,r.unshift(t))),n+r.map(e=>String(e).padStart(2,"0")).join(":").replace(/000000\d*$/,"")}const i={identify:e=>"bigint"==typeof e||Number.isInteger(e),default:!0,tag:"tag:yaml.org,2002:int",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+$/,resolve:(e,t,{intAsBigInt:n})=>parseSexagesimal(e,n),stringify:stringifySexagesimal},r={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\.[0-9_]*$/,resolve:e=>parseSexagesimal(e,!1),stringify:stringifySexagesimal},o={identify:e=>e instanceof Date,default:!0,tag:"tag:yaml.org,2002:timestamp",test:RegExp("^([0-9]{4})-([0-9]{1,2})-([0-9]{1,2})(?:(?:t|T|[ \\t]+)([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2}(\\.[0-9]+)?)(?:[ \\t]*(Z|[-+][012]?[0-9](?::[0-9]{2})?))?)?$"),resolve(e){const t=e.match(o.test);if(!t)throw new Error("!!timestamp expects a date, starting with yyyy-mm-dd");const[,n,s,i,r,a,l]=t.map(Number),c=t[7]?Number((t[7]+"00").substr(1,3)):0;let p=Date.UTC(n,s-1,i,r||0,a||0,l||0,c);const u=t[8];if(u&&"Z"!==u){let e=parseSexagesimal(u,!1);Math.abs(e)<30&&(e*=60),p-=6e4*e}return new Date(p)},stringify:({value:e})=>e?.toISOString().replace(/(T00:00:00)?\.000Z$/,"")??""};t.floatTime=r,t.intTime=i,t.timestamp=o},(e,t,n)=>{"use strict";var s=n(11),i=n(24),r=n(25);t.stringifyDocument=function stringifyDocument(e,t){const n=[];let o=!0===t.directives;if(!1!==t.directives&&e.directives){const t=e.directives.toString(e);t?(n.push(t),o=!0):e.directives.docStart&&(o=!0)}o&&n.push("---");const a=i.createStringifyContext(e,t),{commentString:l}=a.options;if(e.commentBefore){1!==n.length&&n.unshift("");const t=l(e.commentBefore);n.unshift(r.indentComment(t,""))}let c=!1,p=null;if(e.contents){if(s.isNode(e.contents)){if(e.contents.spaceBefore&&o&&n.push(""),e.contents.commentBefore){const t=l(e.contents.commentBefore);n.push(r.indentComment(t,""))}a.forceBlockIndent=!!e.comment,p=e.contents.comment}const t=p?void 0:()=>c=!0;let u=i.stringify(e.contents,a,()=>p=null,t);p&&(u+=r.lineComment(u,"",l(p))),"|"!==u[0]&&">"!==u[0]||"---"!==n[n.length-1]?n.push(u):n[n.length-1]=`--- ${u}`}else n.push(i.stringify(e.contents,a));if(e.directives?.docEnd)if(e.comment){const t=l(e.comment);t.includes("\n")?(n.push("..."),n.push(r.indentComment(t,""))):n.push(`... ${t}`)}else n.push("...");else{let t=e.comment;t&&c&&(t=t.replace(/^\n+/,"")),t&&(c&&!p||""===n[n.length-1]||n.push(""),n.push(r.indentComment(l(t),"")))}return n.join("\n")+"\n"}},(e,t)=>{"use strict";class YAMLError extends Error{constructor(e,t,n,s){super(),this.name=e,this.code=n,this.message=s,this.pos=t}}t.YAMLError=YAMLError,t.YAMLParseError=class YAMLParseError extends YAMLError{constructor(e,t,n){super("YAMLParseError",e,t,n)}},t.YAMLWarning=class YAMLWarning extends YAMLError{constructor(e,t,n){super("YAMLWarning",e,t,n)}},t.prettifyError=(e,t)=>n=>{if(-1===n.pos[0])return;n.linePos=n.pos.map(e=>t.linePos(e));const{line:s,col:i}=n.linePos[0];n.message+=` at line ${s}, column ${i}`;let r=i-1,o=e.substring(t.lineStarts[s-1],t.lineStarts[s]).replace(/[\n\r]+$/,"");if(r>=60&&o.length>80){const e=Math.min(r-39,o.length-79);o="‚Ä¶"+o.substring(e),r-=e-1}if(o.length>80&&(o=o.substring(0,79)+"‚Ä¶"),s>1&&/^ *$/.test(o.substring(0,r))){let n=e.substring(t.lineStarts[s-2],t.lineStarts[s-1]);n.length>80&&(n=n.substring(0,79)+"‚Ä¶\n"),o=n+o}if(/[^ ]/.test(o)){let e=1;const t=n.linePos[1];t?.line===s&&t.col>i&&(e=Math.max(1,Math.min(t.col-i,80-r)));const a=" ".repeat(r)+"^".repeat(e);n.message+=`:\n\n${o}\n${a}\n`}}},(e,t,n)=>{"use strict";var s=n(13),i=n(59),r=n(68),o=n(62);t.composeDoc=function composeDoc(e,t,{offset:n,start:a,value:l,end:c},p){const u=Object.assign({_directives:t},e),f=new s.Document(void 0,u),d={atKey:!1,atRoot:!0,directives:f.directives,options:f.options,schema:f.schema},h=o.resolveProps(a,{indicator:"doc-start",next:l??c?.[0],offset:n,onError:p,parentIndent:0,startOnNewline:!0});h.found&&(f.directives.docStart=!0,!l||"block-map"!==l.type&&"block-seq"!==l.type||h.hasNewline||p(h.end,"MISSING_CHAR","Block collection cannot start on same line with directives-end marker")),f.contents=l?i.composeNode(d,l,h,p):i.composeEmptyNode(d,h.end,a,null,h,p);const m=f.contents.range[2],g=r.resolveEnd(c,m,!1,p);return g.comment&&(f.comment=g.comment),f.range=[n,m,g.offset],f}},(e,t,n)=>{"use strict";var s=n(14),i=n(11),r=n(60),o=n(69),a=n(68),l=n(72);const c={composeNode,composeEmptyNode};function composeNode(e,t,n,l){const p=e.atKey,{spaceBefore:u,comment:f,anchor:d,tag:h}=n;let m,g=!0;switch(t.type){case"alias":m=function composeAlias({options:e},{offset:t,source:n,end:i},r){const o=new s.Alias(n.substring(1));""===o.source&&r(t,"BAD_ALIAS","Alias cannot be an empty string");o.source.endsWith(":")&&r(t+n.length-1,"BAD_ALIAS","Alias ending in : is ambiguous",!0);const l=t+n.length,c=a.resolveEnd(i,l,e.strict,r);o.range=[t,l,c.offset],c.comment&&(o.comment=c.comment);return o}(e,t,l),(d||h)&&l(t,"ALIAS_PROPS","An alias node must not specify any properties");break;case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"block-scalar":m=o.composeScalar(e,t,h,l),d&&(m.anchor=d.source.substring(1));break;case"block-map":case"block-seq":case"flow-collection":m=r.composeCollection(c,e,t,n,l),d&&(m.anchor=d.source.substring(1));break;default:l(t,"UNEXPECTED_TOKEN","error"===t.type?t.message:`Unsupported token (type: ${t.type})`),m=composeEmptyNode(e,t.offset,void 0,null,n,l),g=!1}if(d&&""===m.anchor&&l(d,"BAD_ALIAS","Anchor cannot be an empty string"),p&&e.options.stringKeys&&(!i.isScalar(m)||"string"!=typeof m.value||m.tag&&"tag:yaml.org,2002:str"!==m.tag)){l(h??t,"NON_STRING_KEY","With stringKeys, all keys must be strings")}return u&&(m.spaceBefore=!0),f&&("scalar"===t.type&&""===t.source?m.comment=f:m.commentBefore=f),e.options.keepSourceTokens&&g&&(m.srcToken=t),m}function composeEmptyNode(e,t,n,s,{spaceBefore:i,comment:r,anchor:a,tag:c,end:p},u){const f={type:"scalar",offset:l.emptyScalarPosition(t,n,s),indent:-1,source:""},d=o.composeScalar(e,f,c,u);return a&&(d.anchor=a.source.substring(1),""===d.anchor&&u(a,"BAD_ALIAS","Anchor cannot be an empty string")),i&&(d.spaceBefore=!0),r&&(d.comment=r,d.range[2]=p),d}t.composeEmptyNode=composeEmptyNode,t.composeNode=composeNode},(e,t,n)=>{"use strict";var s=n(11),i=n(21),r=n(33),o=n(36),a=n(61),l=n(66),c=n(67);function resolveCollection(e,t,n,s,i,r){const o="block-map"===n.type?a.resolveBlockMap(e,t,n,s,r):"block-seq"===n.type?l.resolveBlockSeq(e,t,n,s,r):c.resolveFlowCollection(e,t,n,s,r),p=o.constructor;return"!"===i||i===p.tagName?(o.tag=p.tagName,o):(i&&(o.tag=i),o)}t.composeCollection=function composeCollection(e,t,n,a,l){const c=a.tag,p=c?t.directives.tagName(c.source,e=>l(c,"TAG_RESOLVE_FAILED",e)):null;if("block-seq"===n.type){const{anchor:e,newlineAfterProp:t}=a,n=e&&c?e.offset>c.offset?e:c:e??c;if(n&&(!t||t.offset<n.offset)){l(n,"MISSING_CHAR","Missing newline after block sequence props")}}const u="block-map"===n.type?"map":"block-seq"===n.type?"seq":"{"===n.start.source?"map":"seq";if(!c||!p||"!"===p||p===r.YAMLMap.tagName&&"map"===u||p===o.YAMLSeq.tagName&&"seq"===u)return resolveCollection(e,t,n,l,p);let f=t.schema.tags.find(e=>e.tag===p&&e.collection===u);if(!f){const s=t.schema.knownTags[p];if(s?.collection!==u)return s?l(c,"BAD_COLLECTION_TYPE",`${s.tag} used for ${u} collection, but expects ${s.collection??"scalar"}`,!0):l(c,"TAG_RESOLVE_FAILED",`Unresolved tag: ${p}`,!0),resolveCollection(e,t,n,l,p);t.schema.tags.push(Object.assign({},s,{default:!1})),f=s}const d=resolveCollection(e,t,n,l,p,f),h=f.resolve?.(d,e=>l(c,"TAG_RESOLVE_FAILED",e),t.options)??d,m=s.isNode(h)?h:new i.Scalar(h);return m.range=d.range,m.tag=p,f?.format&&(m.format=f.format),m}},(e,t,n)=>{"use strict";var s=n(22),i=n(33),r=n(62),o=n(63),a=n(64),l=n(65);const c="All mapping items must start at the same column";t.resolveBlockMap=function resolveBlockMap({composeNode:e,composeEmptyNode:t},n,p,u,f){const d=new(f?.nodeClass??i.YAMLMap)(n.schema);n.atRoot&&(n.atRoot=!1);let h=p.offset,m=null;for(const i of p.items){const{start:f,key:g,sep:y,value:b}=i,v=r.resolveProps(f,{indicator:"explicit-key-ind",next:g??y?.[0],offset:h,onError:u,parentIndent:p.indent,startOnNewline:!0}),x=!v.found;if(x){if(g&&("block-seq"===g.type?u(h,"BLOCK_AS_IMPLICIT_KEY","A block sequence may not be used as an implicit map key"):"indent"in g&&g.indent!==p.indent&&u(h,"BAD_INDENT",c)),!v.anchor&&!v.tag&&!y){m=v.end,v.comment&&(d.comment?d.comment+="\n"+v.comment:d.comment=v.comment);continue}(v.newlineAfterProp||o.containsNewline(g))&&u(g??f[f.length-1],"MULTILINE_IMPLICIT_KEY","Implicit keys need to be on a single line")}else v.found?.indent!==p.indent&&u(h,"BAD_INDENT",c);n.atKey=!0;const w=v.end,S=g?e(n,g,v,u):t(n,w,f,null,v,u);n.schema.compat&&a.flowIndentCheck(p.indent,g,u),n.atKey=!1,l.mapIncludes(n,d.items,S)&&u(w,"DUPLICATE_KEY","Map keys must be unique");const k=r.resolveProps(y??[],{indicator:"map-value-ind",next:b,offset:S.range[2],onError:u,parentIndent:p.indent,startOnNewline:!g||"block-scalar"===g.type});if(h=k.end,k.found){x&&("block-map"!==b?.type||k.hasNewline||u(h,"BLOCK_AS_IMPLICIT_KEY","Nested mappings are not allowed in compact mappings"),n.options.strict&&v.start<k.found.offset-1024&&u(S.range,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit block mapping key"));const r=b?e(n,b,k,u):t(n,h,y,null,k,u);n.schema.compat&&a.flowIndentCheck(p.indent,b,u),h=r.range[2];const o=new s.Pair(S,r);n.options.keepSourceTokens&&(o.srcToken=i),d.items.push(o)}else{x&&u(S.range,"MISSING_CHAR","Implicit map keys need to be followed by map values"),k.comment&&(S.comment?S.comment+="\n"+k.comment:S.comment=k.comment);const e=new s.Pair(S);n.options.keepSourceTokens&&(e.srcToken=i),d.items.push(e)}}return m&&m<h&&u(m,"IMPOSSIBLE","Map comment with trailing content"),d.range=[p.offset,h,m??h],d}},(e,t)=>{"use strict";t.resolveProps=function resolveProps(e,{flow:t,indicator:n,next:s,offset:i,onError:r,parentIndent:o,startOnNewline:a}){let l=!1,c=a,p=a,u="",f="",d=!1,h=!1,m=null,g=null,y=null,b=null,v=null,x=null,w=null;for(const i of e)switch(h&&("space"!==i.type&&"newline"!==i.type&&"comma"!==i.type&&r(i.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),h=!1),m&&(c&&"comment"!==i.type&&"newline"!==i.type&&r(m,"TAB_AS_INDENT","Tabs are not allowed as indentation"),m=null),i.type){case"space":t||"doc-start"===n&&"flow-collection"===s?.type||!i.source.includes("\t")||(m=i),p=!0;break;case"comment":{p||r(i,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");const e=i.source.substring(1)||" ";u?u+=f+e:u=e,f="",c=!1;break}case"newline":c?u?u+=i.source:x&&"seq-item-ind"===n||(l=!0):f+=i.source,c=!0,d=!0,(g||y)&&(b=i),p=!0;break;case"anchor":g&&r(i,"MULTIPLE_ANCHORS","A node can have at most one anchor"),i.source.endsWith(":")&&r(i.offset+i.source.length-1,"BAD_ALIAS","Anchor ending in : is ambiguous",!0),g=i,w??(w=i.offset),c=!1,p=!1,h=!0;break;case"tag":y&&r(i,"MULTIPLE_TAGS","A node can have at most one tag"),y=i,w??(w=i.offset),c=!1,p=!1,h=!0;break;case n:(g||y)&&r(i,"BAD_PROP_ORDER",`Anchors and tags must be after the ${i.source} indicator`),x&&r(i,"UNEXPECTED_TOKEN",`Unexpected ${i.source} in ${t??"collection"}`),x=i,c="seq-item-ind"===n||"explicit-key-ind"===n,p=!1;break;case"comma":if(t){v&&r(i,"UNEXPECTED_TOKEN",`Unexpected , in ${t}`),v=i,c=!1,p=!1;break}default:r(i,"UNEXPECTED_TOKEN",`Unexpected ${i.type} token`),c=!1,p=!1}const S=e[e.length-1],k=S?S.offset+S.source.length:i;return h&&s&&"space"!==s.type&&"newline"!==s.type&&"comma"!==s.type&&("scalar"!==s.type||""!==s.source)&&r(s.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),m&&(c&&m.indent<=o||"block-map"===s?.type||"block-seq"===s?.type)&&r(m,"TAB_AS_INDENT","Tabs are not allowed as indentation"),{comma:v,found:x,spaceBefore:l,comment:u,hasNewline:d,anchor:g,tag:y,newlineAfterProp:b,end:k,start:w??k}}},(e,t)=>{"use strict";t.containsNewline=function containsNewline(e){if(!e)return null;switch(e.type){case"alias":case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":if(e.source.includes("\n"))return!0;if(e.end)for(const t of e.end)if("newline"===t.type)return!0;return!1;case"flow-collection":for(const t of e.items){for(const e of t.start)if("newline"===e.type)return!0;if(t.sep)for(const e of t.sep)if("newline"===e.type)return!0;if(containsNewline(t.key)||containsNewline(t.value))return!0}return!1;default:return!0}}},(e,t,n)=>{"use strict";var s=n(63);t.flowIndentCheck=function flowIndentCheck(e,t,n){if("flow-collection"===t?.type){const i=t.end[0];if(i.indent===e&&("]"===i.source||"}"===i.source)&&s.containsNewline(t)){n(i,"BAD_INDENT","Flow end indicator should be more indented than parent",!0)}}}},(e,t,n)=>{"use strict";var s=n(11);t.mapIncludes=function mapIncludes(e,t,n){const{uniqueKeys:i}=e.options;if(!1===i)return!1;const r="function"==typeof i?i:(e,t)=>e===t||s.isScalar(e)&&s.isScalar(t)&&e.value===t.value;return t.some(e=>r(e.key,n))}},(e,t,n)=>{"use strict";var s=n(36),i=n(62),r=n(64);t.resolveBlockSeq=function resolveBlockSeq({composeNode:e,composeEmptyNode:t},n,o,a,l){const c=new(l?.nodeClass??s.YAMLSeq)(n.schema);n.atRoot&&(n.atRoot=!1),n.atKey&&(n.atKey=!1);let p=o.offset,u=null;for(const{start:s,value:l}of o.items){const f=i.resolveProps(s,{indicator:"seq-item-ind",next:l,offset:p,onError:a,parentIndent:o.indent,startOnNewline:!0});if(!f.found){if(!(f.anchor||f.tag||l)){u=f.end,f.comment&&(c.comment=f.comment);continue}"block-seq"===l?.type?a(f.end,"BAD_INDENT","All sequence items must start at the same column"):a(p,"MISSING_CHAR","Sequence item without - indicator")}const d=l?e(n,l,f,a):t(n,f.end,s,null,f,a);n.schema.compat&&r.flowIndentCheck(o.indent,l,a),p=d.range[2],c.items.push(d)}return c.range=[o.offset,p,u??p],c}},(e,t,n)=>{"use strict";var s=n(11),i=n(22),r=n(33),o=n(36),a=n(68),l=n(62),c=n(63),p=n(65);const u="Block collections are not allowed within flow collections",isBlock=e=>e&&("block-map"===e.type||"block-seq"===e.type);t.resolveFlowCollection=function resolveFlowCollection({composeNode:e,composeEmptyNode:t},n,f,d,h){const m="{"===f.start.source,g=m?"flow map":"flow sequence",y=new(h?.nodeClass??(m?r.YAMLMap:o.YAMLSeq))(n.schema);y.flow=!0;const b=n.atRoot;b&&(n.atRoot=!1),n.atKey&&(n.atKey=!1);let v=f.offset+f.start.source.length;for(let o=0;o<f.items.length;++o){const a=f.items[o],{start:h,key:b,sep:x,value:w}=a,S=l.resolveProps(h,{flow:g,indicator:"explicit-key-ind",next:b??x?.[0],offset:v,onError:d,parentIndent:f.indent,startOnNewline:!1});if(!S.found){if(!(S.anchor||S.tag||x||w)){0===o&&S.comma?d(S.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${g}`):o<f.items.length-1&&d(S.start,"UNEXPECTED_TOKEN",`Unexpected empty item in ${g}`),S.comment&&(y.comment?y.comment+="\n"+S.comment:y.comment=S.comment),v=S.end;continue}!m&&n.options.strict&&c.containsNewline(b)&&d(b,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line")}if(0===o)S.comma&&d(S.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${g}`);else if(S.comma||d(S.start,"MISSING_CHAR",`Missing , between ${g} items`),S.comment){let e="";e:for(const t of h)switch(t.type){case"comma":case"space":break;case"comment":e=t.source.substring(1);break e;default:break e}if(e){let t=y.items[y.items.length-1];s.isPair(t)&&(t=t.value??t.key),t.comment?t.comment+="\n"+e:t.comment=e,S.comment=S.comment.substring(e.length+1)}}if(m||x||S.found){n.atKey=!0;const s=S.end,o=b?e(n,b,S,d):t(n,s,h,null,S,d);isBlock(b)&&d(o.range,"BLOCK_IN_FLOW",u),n.atKey=!1;const c=l.resolveProps(x??[],{flow:g,indicator:"map-value-ind",next:w,offset:o.range[2],onError:d,parentIndent:f.indent,startOnNewline:!1});if(c.found){if(!m&&!S.found&&n.options.strict){if(x)for(const e of x){if(e===c.found)break;if("newline"===e.type){d(e,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line");break}}S.start<c.found.offset-1024&&d(c.found,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit flow sequence key")}}else w&&("source"in w&&":"===w.source?.[0]?d(w,"MISSING_CHAR",`Missing space after : in ${g}`):d(c.start,"MISSING_CHAR",`Missing , or : between ${g} items`));const k=w?e(n,w,c,d):c.found?t(n,c.end,x,null,c,d):null;k?isBlock(w)&&d(k.range,"BLOCK_IN_FLOW",u):c.comment&&(o.comment?o.comment+="\n"+c.comment:o.comment=c.comment);const E=new i.Pair(o,k);if(n.options.keepSourceTokens&&(E.srcToken=a),m){const e=y;p.mapIncludes(n,e.items,o)&&d(s,"DUPLICATE_KEY","Map keys must be unique"),e.items.push(E)}else{const e=new r.YAMLMap(n.schema);e.flow=!0,e.items.push(E);const t=(k??o).range;e.range=[o.range[0],t[1],t[2]],y.items.push(e)}v=k?k.range[2]:c.end}else{const s=w?e(n,w,S,d):t(n,S.end,x,null,S,d);y.items.push(s),v=s.range[2],isBlock(w)&&d(s.range,"BLOCK_IN_FLOW",u)}}const x=m?"}":"]",[w,...S]=f.end;let k=v;if(w?.source===x)k=w.offset+w.source.length;else{const e=g[0].toUpperCase()+g.substring(1);d(v,b?"MISSING_CHAR":"BAD_INDENT",b?`${e} must end with a ${x}`:`${e} in block collection must be sufficiently indented and end with a ${x}`),w&&1!==w.source.length&&S.unshift(w)}if(S.length>0){const e=a.resolveEnd(S,k,n.options.strict,d);e.comment&&(y.comment?y.comment+="\n"+e.comment:y.comment=e.comment),y.range=[f.offset,k,e.offset]}else y.range=[f.offset,k,k];return y}},(e,t)=>{"use strict";t.resolveEnd=function resolveEnd(e,t,n,s){let i="";if(e){let r=!1,o="";for(const a of e){const{source:e,type:l}=a;switch(l){case"space":r=!0;break;case"comment":{n&&!r&&s(a,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");const t=e.substring(1)||" ";i?i+=o+t:i=t,o="";break}case"newline":i&&(o+=e),r=!0;break;default:s(a,"UNEXPECTED_TOKEN",`Unexpected ${l} at node end`)}t+=e.length}}return{comment:i,offset:t}}},(e,t,n)=>{"use strict";var s=n(11),i=n(21),r=n(70),o=n(71);t.composeScalar=function composeScalar(e,t,n,a){const{value:l,type:c,comment:p,range:u}="block-scalar"===t.type?r.resolveBlockScalar(e,t,a):o.resolveFlowScalar(t,e.options.strict,a),f=n?e.directives.tagName(n.source,e=>a(n,"TAG_RESOLVE_FAILED",e)):null;let d,h;d=e.options.stringKeys&&e.atKey?e.schema[s.SCALAR]:f?function findScalarTagByName(e,t,n,i,r){if("!"===n)return e[s.SCALAR];const o=[];for(const t of e.tags)if(!t.collection&&t.tag===n){if(!t.default||!t.test)return t;o.push(t)}for(const e of o)if(e.test?.test(t))return e;const a=e.knownTags[n];if(a&&!a.collection)return e.tags.push(Object.assign({},a,{default:!1,test:void 0})),a;return r(i,"TAG_RESOLVE_FAILED",`Unresolved tag: ${n}`,"tag:yaml.org,2002:str"!==n),e[s.SCALAR]}(e.schema,l,f,n,a):"scalar"===t.type?function findScalarTagByTest({atKey:e,directives:t,schema:n},i,r,o){const a=n.tags.find(t=>(!0===t.default||e&&"key"===t.default)&&t.test?.test(i))||n[s.SCALAR];if(n.compat){const e=n.compat.find(e=>e.default&&e.test?.test(i))??n[s.SCALAR];if(a.tag!==e.tag){o(r,"TAG_RESOLVE_FAILED",`Value may be parsed as either ${t.tagString(a.tag)} or ${t.tagString(e.tag)}`,!0)}}return a}(e,l,t,a):e.schema[s.SCALAR];try{const r=d.resolve(l,e=>a(n??t,"TAG_RESOLVE_FAILED",e),e.options);h=s.isScalar(r)?r:new i.Scalar(r)}catch(e){const s=e instanceof Error?e.message:String(e);a(n??t,"TAG_RESOLVE_FAILED",s),h=new i.Scalar(l)}return h.range=u,h.source=l,c&&(h.type=c),f&&(h.tag=f),d.format&&(h.format=d.format),p&&(h.comment=p),h}},(e,t,n)=>{"use strict";var s=n(21);t.resolveBlockScalar=function resolveBlockScalar(e,t,n){const i=t.offset,r=function parseBlockScalarHeader({offset:e,props:t},n,s){if("block-scalar-header"!==t[0].type)return s(t[0],"IMPOSSIBLE","Block scalar header not found"),null;const{source:i}=t[0],r=i[0];let o=0,a="",l=-1;for(let t=1;t<i.length;++t){const n=i[t];if(a||"-"!==n&&"+"!==n){const s=Number(n);!o&&s?o=s:-1===l&&(l=e+t)}else a=n}-1!==l&&s(l,"UNEXPECTED_TOKEN",`Block scalar header includes extra characters: ${i}`);let c=!1,p="",u=i.length;for(let e=1;e<t.length;++e){const i=t[e];switch(i.type){case"space":c=!0;case"newline":u+=i.source.length;break;case"comment":if(n&&!c){s(i,"MISSING_CHAR","Comments must be separated from other tokens by white space characters")}u+=i.source.length,p=i.source.substring(1);break;case"error":s(i,"UNEXPECTED_TOKEN",i.message),u+=i.source.length;break;default:{s(i,"UNEXPECTED_TOKEN",`Unexpected token in block scalar header: ${i.type}`);const e=i.source;e&&"string"==typeof e&&(u+=e.length)}}}return{mode:r,indent:o,chomp:a,comment:p,length:u}}(t,e.options.strict,n);if(!r)return{value:"",type:null,comment:"",range:[i,i,i]};const o=">"===r.mode?s.Scalar.BLOCK_FOLDED:s.Scalar.BLOCK_LITERAL,a=t.source?function splitLines(e){const t=e.split(/\n( *)/),n=t[0],s=n.match(/^( *)/),i=[s?.[1]?[s[1],n.slice(s[1].length)]:["",n]];for(let e=1;e<t.length;e+=2)i.push([t[e],t[e+1]]);return i}(t.source):[];let l=a.length;for(let e=a.length-1;e>=0;--e){const t=a[e][1];if(""!==t&&"\r"!==t)break;l=e}if(0===l){const e="+"===r.chomp&&a.length>0?"\n".repeat(Math.max(1,a.length-1)):"";let n=i+r.length;return t.source&&(n+=t.source.length),{value:e,type:o,comment:r.comment,range:[i,n,n]}}let c=t.indent+r.indent,p=t.offset+r.length,u=0;for(let t=0;t<l;++t){const[s,i]=a[t];if(""!==i&&"\r"!==i){if(s.length<c){const e="Block scalars with more-indented leading empty lines must use an explicit indentation indicator";n(p+s.length,"MISSING_CHAR",e)}if(0===r.indent&&(c=s.length),u=t,0===c&&!e.atRoot){n(p,"BAD_INDENT","Block scalar values in collections must be indented")}break}0===r.indent&&s.length>c&&(c=s.length),p+=s.length+i.length+1}for(let e=a.length-1;e>=l;--e)a[e][0].length>c&&(l=e+1);let f="",d="",h=!1;for(let e=0;e<u;++e)f+=a[e][0].slice(c)+"\n";for(let e=u;e<l;++e){let[t,i]=a[e];p+=t.length+i.length+1;const l="\r"===i[i.length-1];if(l&&(i=i.slice(0,-1)),i&&t.length<c){const e=`Block scalar lines must not be less indented than their ${r.indent?"explicit indentation indicator":"first line"}`;n(p-i.length-(l?2:1),"BAD_INDENT",e),t=""}o===s.Scalar.BLOCK_LITERAL?(f+=d+t.slice(c)+i,d="\n"):t.length>c||"\t"===i[0]?(" "===d?d="\n":h||"\n"!==d||(d="\n\n"),f+=d+t.slice(c)+i,d="\n",h=!0):""===i?"\n"===d?f+="\n":d="\n":(f+=d+i,d=" ",h=!1)}switch(r.chomp){case"-":break;case"+":for(let e=l;e<a.length;++e)f+="\n"+a[e][0].slice(c);"\n"!==f[f.length-1]&&(f+="\n");break;default:f+="\n"}const m=i+r.length+t.source.length;return{value:f,type:o,comment:r.comment,range:[i,m,m]}}},(e,t,n)=>{"use strict";var s=n(21),i=n(68);function foldLines(e){let t,n;try{t=new RegExp("(.*?)(?<![ \t])[ \t]*\r?\n","sy"),n=new RegExp("[ \t]*(.*?)(?:(?<![ \t])[ \t]*)?\r?\n","sy")}catch{t=/(.*?)[ \t]*\r?\n/sy,n=/[ \t]*(.*?)[ \t]*\r?\n/sy}let s=t.exec(e);if(!s)return e;let i=s[1],r=" ",o=t.lastIndex;for(n.lastIndex=o;s=n.exec(e);)""===s[1]?"\n"===r?i+=r:r="\n":(i+=r+s[1],r=" "),o=n.lastIndex;const a=/[ \t]*(.*)/sy;return a.lastIndex=o,s=a.exec(e),i+r+(s?.[1]??"")}function foldNewline(e,t){let n="",s=e[t+1];for(;!(" "!==s&&"\t"!==s&&"\n"!==s&&"\r"!==s||"\r"===s&&"\n"!==e[t+2]);)"\n"===s&&(n+="\n"),s=e[(t+=1)+1];return n||(n=" "),{fold:n,offset:t}}const r={0:"\0",a:"",b:"\b",e:"",f:"\f",n:"\n",r:"\r",t:"\t",v:"\v",N:"¬Ö",_:"¬†",L:"\u2028",P:"\u2029"," ":" ",'"':'"',"/":"/","\\":"\\","\t":"\t"};function parseCharCode(e,t,n,s){const i=e.substr(t,n),r=i.length===n&&/^[0-9a-fA-F]+$/.test(i)?parseInt(i,16):NaN;if(isNaN(r)){const i=e.substr(t-2,n+2);return s(t-2,"BAD_DQ_ESCAPE",`Invalid escape sequence ${i}`),i}return String.fromCodePoint(r)}t.resolveFlowScalar=function resolveFlowScalar(e,t,n){const{offset:o,type:a,source:l,end:c}=e;let p,u;const _onError=(e,t,s)=>n(o+e,t,s);switch(a){case"scalar":p=s.Scalar.PLAIN,u=function plainValue(e,t){let n="";switch(e[0]){case"\t":n="a tab character";break;case",":n="flow indicator character ,";break;case"%":n="directive indicator character %";break;case"|":case">":n=`block scalar indicator ${e[0]}`;break;case"@":case"`":n=`reserved character ${e[0]}`}n&&t(0,"BAD_SCALAR_START",`Plain value cannot start with ${n}`);return foldLines(e)}(l,_onError);break;case"single-quoted-scalar":p=s.Scalar.QUOTE_SINGLE,u=function singleQuotedValue(e,t){"'"===e[e.length-1]&&1!==e.length||t(e.length,"MISSING_CHAR","Missing closing 'quote");return foldLines(e.slice(1,-1)).replace(/''/g,"'")}(l,_onError);break;case"double-quoted-scalar":p=s.Scalar.QUOTE_DOUBLE,u=function doubleQuotedValue(e,t){let n="";for(let s=1;s<e.length-1;++s){const i=e[s];if("\r"!==i||"\n"!==e[s+1])if("\n"===i){const{fold:t,offset:i}=foldNewline(e,s);n+=t,s=i}else if("\\"===i){let i=e[++s];const o=r[i];if(o)n+=o;else if("\n"===i)for(i=e[s+1];" "===i||"\t"===i;)i=e[1+ ++s];else if("\r"===i&&"\n"===e[s+1])for(i=e[1+ ++s];" "===i||"\t"===i;)i=e[1+ ++s];else if("x"===i||"u"===i||"U"===i){const r={x:2,u:4,U:8}[i];n+=parseCharCode(e,s+1,r,t),s+=r}else{const i=e.substr(s-1,2);t(s-1,"BAD_DQ_ESCAPE",`Invalid escape sequence ${i}`),n+=i}}else if(" "===i||"\t"===i){const t=s;let r=e[s+1];for(;" "===r||"\t"===r;)r=e[1+ ++s];"\n"===r||"\r"===r&&"\n"===e[s+2]||(n+=s>t?e.slice(t,s+1):i)}else n+=i}'"'===e[e.length-1]&&1!==e.length||t(e.length,"MISSING_CHAR",'Missing closing "quote');return n}(l,_onError);break;default:return n(e,"UNEXPECTED_TOKEN",`Expected a flow scalar value, but found: ${a}`),{value:"",type:null,comment:"",range:[o,o+l.length,o+l.length]}}const f=o+l.length,d=i.resolveEnd(c,f,t,n);return{value:u,type:p,comment:d.comment,range:[o,f,d.offset]}}},(e,t)=>{"use strict";t.emptyScalarPosition=function emptyScalarPosition(e,t,n){if(t){n??(n=t.length);for(let s=n-1;s>=0;--s){let n=t[s];switch(n.type){case"space":case"comment":case"newline":e-=n.source.length;continue}for(n=t[++s];"space"===n?.type;)e+=n.source.length,n=t[++s];break}}return e}},(e,t,n)=>{"use strict";var s=n(74),i=n(75),r=n(76);t.createScalarToken=s.createScalarToken,t.resolveAsScalar=s.resolveAsScalar,t.setScalarValue=s.setScalarValue,t.stringify=i.stringify,t.visit=r.visit,t.BOM="\ufeff",t.DOCUMENT="",t.FLOW_END="",t.SCALAR="",t.isCollection=e=>!!e&&"items"in e,t.isScalar=e=>!!e&&("scalar"===e.type||"single-quoted-scalar"===e.type||"double-quoted-scalar"===e.type||"block-scalar"===e.type),t.prettyToken=function prettyToken(e){switch(e){case"\ufeff":return"<BOM>";case"":return"<DOC>";case"":return"<FLOW_END>";case"":return"<SCALAR>";default:return JSON.stringify(e)}},t.tokenType=function tokenType(e){switch(e){case"\ufeff":return"byte-order-mark";case"":return"doc-mode";case"":return"flow-error-end";case"":return"scalar";case"---":return"doc-start";case"...":return"doc-end";case"":case"\n":case"\r\n":return"newline";case"-":return"seq-item-ind";case"?":return"explicit-key-ind";case":":return"map-value-ind";case"{":return"flow-map-start";case"}":return"flow-map-end";case"[":return"flow-seq-start";case"]":return"flow-seq-end";case",":return"comma"}switch(e[0]){case" ":case"\t":return"space";case"#":return"comment";case"%":return"directive-line";case"*":return"alias";case"&":return"anchor";case"!":return"tag";case"'":return"single-quoted-scalar";case'"':return"double-quoted-scalar";case"|":case">":return"block-scalar-header"}return null}},(e,t,n)=>{"use strict";var s=n(70),i=n(71),r=n(57),o=n(26);function addEndtoBlockProps(e,t){if(t)for(const n of t)switch(n.type){case"space":case"comment":e.push(n);break;case"newline":return e.push(n),!0}return!1}function setFlowScalarValue(e,t,n){switch(e.type){case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":e.type=n,e.source=t;break;case"block-scalar":{const s=e.props.slice(1);let i=t.length;"block-scalar-header"===e.props[0].type&&(i-=e.props[0].source.length);for(const e of s)e.offset+=i;delete e.props,Object.assign(e,{type:n,source:t,end:s});break}case"block-map":case"block-seq":{const s={type:"newline",offset:e.offset+t.length,indent:e.indent,source:"\n"};delete e.items,Object.assign(e,{type:n,source:t,end:[s]});break}default:{const s="indent"in e?e.indent:-1,i="end"in e&&Array.isArray(e.end)?e.end.filter(e=>"space"===e.type||"comment"===e.type||"newline"===e.type):[];for(const t of Object.keys(e))"type"!==t&&"offset"!==t&&delete e[t];Object.assign(e,{type:n,indent:s,source:t,end:i})}}}t.createScalarToken=function createScalarToken(e,t){const{implicitKey:n=!1,indent:s,inFlow:i=!1,offset:r=-1,type:a="PLAIN"}=t,l=o.stringifyString({type:a,value:e},{implicitKey:n,indent:s>0?" ".repeat(s):"",inFlow:i,options:{blockQuote:!0,lineWidth:-1}}),c=t.end??[{type:"newline",offset:-1,indent:s,source:"\n"}];switch(l[0]){case"|":case">":{const e=l.indexOf("\n"),t=l.substring(0,e),n=l.substring(e+1)+"\n",i=[{type:"block-scalar-header",offset:r,indent:s,source:t}];return addEndtoBlockProps(i,c)||i.push({type:"newline",offset:-1,indent:s,source:"\n"}),{type:"block-scalar",offset:r,indent:s,props:i,source:n}}case'"':return{type:"double-quoted-scalar",offset:r,indent:s,source:l,end:c};case"'":return{type:"single-quoted-scalar",offset:r,indent:s,source:l,end:c};default:return{type:"scalar",offset:r,indent:s,source:l,end:c}}},t.resolveAsScalar=function resolveAsScalar(e,t=!0,n){if(e){const _onError=(e,t,s)=>{const i="number"==typeof e?e:Array.isArray(e)?e[0]:e.offset;if(!n)throw new r.YAMLParseError([i,i+1],t,s);n(i,t,s)};switch(e.type){case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return i.resolveFlowScalar(e,t,_onError);case"block-scalar":return s.resolveBlockScalar({options:{strict:t}},e,_onError)}}return null},t.setScalarValue=function setScalarValue(e,t,n={}){let{afterKey:s=!1,implicitKey:i=!1,inFlow:r=!1,type:a}=n,l="indent"in e?e.indent:null;if(s&&"number"==typeof l&&(l+=2),!a)switch(e.type){case"single-quoted-scalar":a="QUOTE_SINGLE";break;case"double-quoted-scalar":a="QUOTE_DOUBLE";break;case"block-scalar":{const t=e.props[0];if("block-scalar-header"!==t.type)throw new Error("Invalid block scalar header");a=">"===t.source[0]?"BLOCK_FOLDED":"BLOCK_LITERAL";break}default:a="PLAIN"}const c=o.stringifyString({type:a,value:t},{implicitKey:i||null===l,indent:null!==l&&l>0?" ".repeat(l):"",inFlow:r,options:{blockQuote:!0,lineWidth:-1}});switch(c[0]){case"|":case">":!function setBlockScalarValue(e,t){const n=t.indexOf("\n"),s=t.substring(0,n),i=t.substring(n+1)+"\n";if("block-scalar"===e.type){const t=e.props[0];if("block-scalar-header"!==t.type)throw new Error("Invalid block scalar header");t.source=s,e.source=i}else{const{offset:t}=e,n="indent"in e?e.indent:-1,r=[{type:"block-scalar-header",offset:t,indent:n,source:s}];addEndtoBlockProps(r,"end"in e?e.end:void 0)||r.push({type:"newline",offset:-1,indent:n,source:"\n"});for(const t of Object.keys(e))"type"!==t&&"offset"!==t&&delete e[t];Object.assign(e,{type:"block-scalar",indent:n,props:r,source:i})}}(e,c);break;case'"':setFlowScalarValue(e,c,"double-quoted-scalar");break;case"'":setFlowScalarValue(e,c,"single-quoted-scalar");break;default:setFlowScalarValue(e,c,"scalar")}}},(e,t)=>{"use strict";function stringifyToken(e){switch(e.type){case"block-scalar":{let t="";for(const n of e.props)t+=stringifyToken(n);return t+e.source}case"block-map":case"block-seq":{let t="";for(const n of e.items)t+=stringifyItem(n);return t}case"flow-collection":{let t=e.start.source;for(const n of e.items)t+=stringifyItem(n);for(const n of e.end)t+=n.source;return t}case"document":{let t=stringifyItem(e);if(e.end)for(const n of e.end)t+=n.source;return t}default:{let t=e.source;if("end"in e&&e.end)for(const n of e.end)t+=n.source;return t}}}function stringifyItem({start:e,key:t,sep:n,value:s}){let i="";for(const t of e)i+=t.source;if(t&&(i+=stringifyToken(t)),n)for(const e of n)i+=e.source;return s&&(i+=stringifyToken(s)),i}t.stringify=e=>"type"in e?stringifyToken(e):stringifyItem(e)},(e,t)=>{"use strict";const n=Symbol("break visit"),s=Symbol("skip children"),i=Symbol("remove item");function visit(e,t){"type"in e&&"document"===e.type&&(e={start:e.start,value:e.value}),_visit(Object.freeze([]),e,t)}function _visit(e,t,s){let r=s(t,e);if("symbol"==typeof r)return r;for(const o of["key","value"]){const a=t[o];if(a&&"items"in a){for(let t=0;t<a.items.length;++t){const r=_visit(Object.freeze(e.concat([[o,t]])),a.items[t],s);if("number"==typeof r)t=r-1;else{if(r===n)return n;r===i&&(a.items.splice(t,1),t-=1)}}"function"==typeof r&&"key"===o&&(r=r(t,e))}}return"function"==typeof r?r(t,e):r}visit.BREAK=n,visit.SKIP=s,visit.REMOVE=i,visit.itemAtPath=(e,t)=>{let n=e;for(const[e,s]of t){const t=n?.[e];if(!t||!("items"in t))return;n=t.items[s]}return n},visit.parentCollection=(e,t)=>{const n=visit.itemAtPath(e,t.slice(0,-1)),s=t[t.length-1][0],i=n?.[s];if(i&&"items"in i)return i;throw new Error("Parent collection not found")},t.visit=visit},(e,t,n)=>{"use strict";var s=n(73);function isEmpty(e){switch(e){case void 0:case" ":case"\n":case"\r":case"\t":return!0;default:return!1}}const i=new Set("0123456789ABCDEFabcdef"),r=new Set("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-#;/?:@&=+$_.!~*'()"),o=new Set(",[]{}"),a=new Set(" ,[]{}\n\r\t"),isNotAnchorChar=e=>!e||a.has(e);t.Lexer=class Lexer{constructor(){this.atEnd=!1,this.blockScalarIndent=-1,this.blockScalarKeep=!1,this.buffer="",this.flowKey=!1,this.flowLevel=0,this.indentNext=0,this.indentValue=0,this.lineEndPos=null,this.next=null,this.pos=0}*lex(e,t=!1){if(e){if("string"!=typeof e)throw TypeError("source is not a string");this.buffer=this.buffer?this.buffer+e:e,this.lineEndPos=null}this.atEnd=!t;let n=this.next??"stream";for(;n&&(t||this.hasChars(1));)n=yield*this.parseNext(n)}atLineEnd(){let e=this.pos,t=this.buffer[e];for(;" "===t||"\t"===t;)t=this.buffer[++e];return!t||"#"===t||"\n"===t||"\r"===t&&"\n"===this.buffer[e+1]}charAt(e){return this.buffer[this.pos+e]}continueScalar(e){let t=this.buffer[e];if(this.indentNext>0){let n=0;for(;" "===t;)t=this.buffer[++n+e];if("\r"===t){const t=this.buffer[n+e+1];if("\n"===t||!t&&!this.atEnd)return e+n+1}return"\n"===t||n>=this.indentNext||!t&&!this.atEnd?e+n:-1}if("-"===t||"."===t){const t=this.buffer.substr(e,3);if(("---"===t||"..."===t)&&isEmpty(this.buffer[e+3]))return-1}return e}getLine(){let e=this.lineEndPos;return("number"!=typeof e||-1!==e&&e<this.pos)&&(e=this.buffer.indexOf("\n",this.pos),this.lineEndPos=e),-1===e?this.atEnd?this.buffer.substring(this.pos):null:("\r"===this.buffer[e-1]&&(e-=1),this.buffer.substring(this.pos,e))}hasChars(e){return this.pos+e<=this.buffer.length}setNext(e){return this.buffer=this.buffer.substring(this.pos),this.pos=0,this.lineEndPos=null,this.next=e,null}peek(e){return this.buffer.substr(this.pos,e)}*parseNext(e){switch(e){case"stream":return yield*this.parseStream();case"line-start":return yield*this.parseLineStart();case"block-start":return yield*this.parseBlockStart();case"doc":return yield*this.parseDocument();case"flow":return yield*this.parseFlowCollection();case"quoted-scalar":return yield*this.parseQuotedScalar();case"block-scalar":return yield*this.parseBlockScalar();case"plain-scalar":return yield*this.parsePlainScalar()}}*parseStream(){let e=this.getLine();if(null===e)return this.setNext("stream");if(e[0]===s.BOM&&(yield*this.pushCount(1),e=e.substring(1)),"%"===e[0]){let t=e.length,n=e.indexOf("#");for(;-1!==n;){const s=e[n-1];if(" "===s||"\t"===s){t=n-1;break}n=e.indexOf("#",n+1)}for(;;){const n=e[t-1];if(" "!==n&&"\t"!==n)break;t-=1}const s=(yield*this.pushCount(t))+(yield*this.pushSpaces(!0));return yield*this.pushCount(e.length-s),this.pushNewline(),"stream"}if(this.atLineEnd()){const t=yield*this.pushSpaces(!0);return yield*this.pushCount(e.length-t),yield*this.pushNewline(),"stream"}return yield s.DOCUMENT,yield*this.parseLineStart()}*parseLineStart(){const e=this.charAt(0);if(!e&&!this.atEnd)return this.setNext("line-start");if("-"===e||"."===e){if(!this.atEnd&&!this.hasChars(4))return this.setNext("line-start");const e=this.peek(3);if(("---"===e||"..."===e)&&isEmpty(this.charAt(3)))return yield*this.pushCount(3),this.indentValue=0,this.indentNext=0,"---"===e?"doc":"stream"}return this.indentValue=yield*this.pushSpaces(!1),this.indentNext>this.indentValue&&!isEmpty(this.charAt(1))&&(this.indentNext=this.indentValue),yield*this.parseBlockStart()}*parseBlockStart(){const[e,t]=this.peek(2);if(!t&&!this.atEnd)return this.setNext("block-start");if(("-"===e||"?"===e||":"===e)&&isEmpty(t)){const e=(yield*this.pushCount(1))+(yield*this.pushSpaces(!0));return this.indentNext=this.indentValue+1,this.indentValue+=e,yield*this.parseBlockStart()}return"doc"}*parseDocument(){yield*this.pushSpaces(!0);const e=this.getLine();if(null===e)return this.setNext("doc");let t=yield*this.pushIndicators();switch(e[t]){case"#":yield*this.pushCount(e.length-t);case void 0:return yield*this.pushNewline(),yield*this.parseLineStart();case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel=1,"flow";case"}":case"]":return yield*this.pushCount(1),"doc";case"*":return yield*this.pushUntil(isNotAnchorChar),"doc";case'"':case"'":return yield*this.parseQuotedScalar();case"|":case">":return t+=(yield*this.parseBlockScalarHeader()),t+=(yield*this.pushSpaces(!0)),yield*this.pushCount(e.length-t),yield*this.pushNewline(),yield*this.parseBlockScalar();default:return yield*this.parsePlainScalar()}}*parseFlowCollection(){let e,t,n=-1;do{e=yield*this.pushNewline(),e>0?(t=yield*this.pushSpaces(!1),this.indentValue=n=t):t=0,t+=(yield*this.pushSpaces(!0))}while(e+t>0);const i=this.getLine();if(null===i)return this.setNext("flow");if(-1!==n&&n<this.indentNext&&"#"!==i[0]||0===n&&(i.startsWith("---")||i.startsWith("..."))&&isEmpty(i[3])){if(!(n===this.indentNext-1&&1===this.flowLevel&&("]"===i[0]||"}"===i[0])))return this.flowLevel=0,yield s.FLOW_END,yield*this.parseLineStart()}let r=0;for(;","===i[r];)r+=(yield*this.pushCount(1)),r+=(yield*this.pushSpaces(!0)),this.flowKey=!1;switch(r+=(yield*this.pushIndicators()),i[r]){case void 0:return"flow";case"#":return yield*this.pushCount(i.length-r),"flow";case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel+=1,"flow";case"}":case"]":return yield*this.pushCount(1),this.flowKey=!0,this.flowLevel-=1,this.flowLevel?"flow":"doc";case"*":return yield*this.pushUntil(isNotAnchorChar),"flow";case'"':case"'":return this.flowKey=!0,yield*this.parseQuotedScalar();case":":{const e=this.charAt(1);if(this.flowKey||isEmpty(e)||","===e)return this.flowKey=!1,yield*this.pushCount(1),yield*this.pushSpaces(!0),"flow"}default:return this.flowKey=!1,yield*this.parsePlainScalar()}}*parseQuotedScalar(){const e=this.charAt(0);let t=this.buffer.indexOf(e,this.pos+1);if("'"===e)for(;-1!==t&&"'"===this.buffer[t+1];)t=this.buffer.indexOf("'",t+2);else for(;-1!==t;){let e=0;for(;"\\"===this.buffer[t-1-e];)e+=1;if(e%2==0)break;t=this.buffer.indexOf('"',t+1)}const n=this.buffer.substring(0,t);let s=n.indexOf("\n",this.pos);if(-1!==s){for(;-1!==s;){const e=this.continueScalar(s+1);if(-1===e)break;s=n.indexOf("\n",e)}-1!==s&&(t=s-("\r"===n[s-1]?2:1))}if(-1===t){if(!this.atEnd)return this.setNext("quoted-scalar");t=this.buffer.length}return yield*this.pushToIndex(t+1,!1),this.flowLevel?"flow":"doc"}*parseBlockScalarHeader(){this.blockScalarIndent=-1,this.blockScalarKeep=!1;let e=this.pos;for(;;){const t=this.buffer[++e];if("+"===t)this.blockScalarKeep=!0;else if(t>"0"&&t<="9")this.blockScalarIndent=Number(t)-1;else if("-"!==t)break}return yield*this.pushUntil(e=>isEmpty(e)||"#"===e)}*parseBlockScalar(){let e,t=this.pos-1,n=0;e:for(let s=this.pos;e=this.buffer[s];++s)switch(e){case" ":n+=1;break;case"\n":t=s,n=0;break;case"\r":{const e=this.buffer[s+1];if(!e&&!this.atEnd)return this.setNext("block-scalar");if("\n"===e)break}default:break e}if(!e&&!this.atEnd)return this.setNext("block-scalar");if(n>=this.indentNext){-1===this.blockScalarIndent?this.indentNext=n:this.indentNext=this.blockScalarIndent+(0===this.indentNext?1:this.indentNext);do{const e=this.continueScalar(t+1);if(-1===e)break;t=this.buffer.indexOf("\n",e)}while(-1!==t);if(-1===t){if(!this.atEnd)return this.setNext("block-scalar");t=this.buffer.length}}let i=t+1;for(e=this.buffer[i];" "===e;)e=this.buffer[++i];if("\t"===e){for(;"\t"===e||" "===e||"\r"===e||"\n"===e;)e=this.buffer[++i];t=i-1}else if(!this.blockScalarKeep)for(;;){let e=t-1,s=this.buffer[e];"\r"===s&&(s=this.buffer[--e]);const i=e;for(;" "===s;)s=this.buffer[--e];if(!("\n"===s&&e>=this.pos&&e+1+n>i))break;t=e}return yield s.SCALAR,yield*this.pushToIndex(t+1,!0),yield*this.parseLineStart()}*parsePlainScalar(){const e=this.flowLevel>0;let t,n=this.pos-1,i=this.pos-1;for(;t=this.buffer[++i];)if(":"===t){const t=this.buffer[i+1];if(isEmpty(t)||e&&o.has(t))break;n=i}else if(isEmpty(t)){let s=this.buffer[i+1];if("\r"===t&&("\n"===s?(i+=1,t="\n",s=this.buffer[i+1]):n=i),"#"===s||e&&o.has(s))break;if("\n"===t){const e=this.continueScalar(i+1);if(-1===e)break;i=Math.max(i,e-2)}}else{if(e&&o.has(t))break;n=i}return t||this.atEnd?(yield s.SCALAR,yield*this.pushToIndex(n+1,!0),e?"flow":"doc"):this.setNext("plain-scalar")}*pushCount(e){return e>0?(yield this.buffer.substr(this.pos,e),this.pos+=e,e):0}*pushToIndex(e,t){const n=this.buffer.slice(this.pos,e);return n?(yield n,this.pos+=n.length,n.length):(t&&(yield""),0)}*pushIndicators(){switch(this.charAt(0)){case"!":return(yield*this.pushTag())+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"&":return(yield*this.pushUntil(isNotAnchorChar))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"-":case"?":case":":{const e=this.flowLevel>0,t=this.charAt(1);if(isEmpty(t)||e&&o.has(t))return e?this.flowKey&&(this.flowKey=!1):this.indentNext=this.indentValue+1,(yield*this.pushCount(1))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators())}}return 0}*pushTag(){if("<"===this.charAt(1)){let e=this.pos+2,t=this.buffer[e];for(;!isEmpty(t)&&">"!==t;)t=this.buffer[++e];return yield*this.pushToIndex(">"===t?e+1:e,!1)}{let e=this.pos+1,t=this.buffer[e];for(;t;)if(r.has(t))t=this.buffer[++e];else{if("%"!==t||!i.has(this.buffer[e+1])||!i.has(this.buffer[e+2]))break;t=this.buffer[e+=3]}return yield*this.pushToIndex(e,!1)}}*pushNewline(){const e=this.buffer[this.pos];return"\n"===e?yield*this.pushCount(1):"\r"===e&&"\n"===this.charAt(1)?yield*this.pushCount(2):0}*pushSpaces(e){let t,n=this.pos-1;do{t=this.buffer[++n]}while(" "===t||e&&"\t"===t);const s=n-this.pos;return s>0&&(yield this.buffer.substr(this.pos,s),this.pos=n),s}*pushUntil(e){let t=this.pos,n=this.buffer[t];for(;!e(n);)n=this.buffer[++t];return yield*this.pushToIndex(t,!1)}}},(e,t)=>{"use strict";t.LineCounter=class LineCounter{constructor(){this.lineStarts=[],this.addNewLine=e=>this.lineStarts.push(e),this.linePos=e=>{let t=0,n=this.lineStarts.length;for(;t<n;){const s=t+n>>1;this.lineStarts[s]<e?t=s+1:n=s}if(this.lineStarts[t]===e)return{line:t+1,col:1};if(0===t)return{line:0,col:e};return{line:t,col:e-this.lineStarts[t-1]+1}}}}},(e,t,n)=>{"use strict";var s=n(9),i=n(73),r=n(77);function includesToken(e,t){for(let n=0;n<e.length;++n)if(e[n].type===t)return!0;return!1}function findNonEmptyIndex(e){for(let t=0;t<e.length;++t)switch(e[t].type){case"space":case"comment":case"newline":break;default:return t}return-1}function isFlowToken(e){switch(e?.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"flow-collection":return!0;default:return!1}}function getPrevProps(e){switch(e.type){case"document":return e.start;case"block-map":{const t=e.items[e.items.length-1];return t.sep??t.start}case"block-seq":return e.items[e.items.length-1].start;default:return[]}}function getFirstKeyStartProps(e){if(0===e.length)return[];let t=e.length;e:for(;--t>=0;)switch(e[t].type){case"doc-start":case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":case"newline":break e}for(;"space"===e[++t]?.type;);return e.splice(t,e.length)}function fixFlowSeqItems(e){if("flow-seq-start"===e.start.type)for(const t of e.items)!t.sep||t.value||includesToken(t.start,"explicit-key-ind")||includesToken(t.sep,"map-value-ind")||(t.key&&(t.value=t.key),delete t.key,isFlowToken(t.value)?t.value.end?Array.prototype.push.apply(t.value.end,t.sep):t.value.end=t.sep:Array.prototype.push.apply(t.start,t.sep),delete t.sep)}t.Parser=class Parser{constructor(e){this.atNewLine=!0,this.atScalar=!1,this.indent=0,this.offset=0,this.onKeyLine=!1,this.stack=[],this.source="",this.type="",this.lexer=new r.Lexer,this.onNewLine=e}*parse(e,t=!1){this.onNewLine&&0===this.offset&&this.onNewLine(0);for(const n of this.lexer.lex(e,t))yield*this.next(n);t||(yield*this.end())}*next(e){if(this.source=e,s.env.LOG_TOKENS&&console.log("|",i.prettyToken(e)),this.atScalar)return this.atScalar=!1,yield*this.step(),void(this.offset+=e.length);const t=i.tokenType(e);if(t)if("scalar"===t)this.atNewLine=!1,this.atScalar=!0,this.type="scalar";else{switch(this.type=t,yield*this.step(),t){case"newline":this.atNewLine=!0,this.indent=0,this.onNewLine&&this.onNewLine(this.offset+e.length);break;case"space":this.atNewLine&&" "===e[0]&&(this.indent+=e.length);break;case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":this.atNewLine&&(this.indent+=e.length);break;case"doc-mode":case"flow-error-end":return;default:this.atNewLine=!1}this.offset+=e.length}else{const t=`Not a YAML token: ${e}`;yield*this.pop({type:"error",offset:this.offset,message:t,source:e}),this.offset+=e.length}}*end(){for(;this.stack.length>0;)yield*this.pop()}get sourceToken(){return{type:this.type,offset:this.offset,indent:this.indent,source:this.source}}*step(){const e=this.peek(1);if("doc-end"!==this.type||"doc-end"===e?.type){if(!e)return yield*this.stream();switch(e.type){case"document":return yield*this.document(e);case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return yield*this.scalar(e);case"block-scalar":return yield*this.blockScalar(e);case"block-map":return yield*this.blockMap(e);case"block-seq":return yield*this.blockSequence(e);case"flow-collection":return yield*this.flowCollection(e);case"doc-end":return yield*this.documentEnd(e)}yield*this.pop()}else{for(;this.stack.length>0;)yield*this.pop();this.stack.push({type:"doc-end",offset:this.offset,source:this.source})}}peek(e){return this.stack[this.stack.length-e]}*pop(e){const t=e??this.stack.pop();if(t)if(0===this.stack.length)yield t;else{const e=this.peek(1);switch("block-scalar"===t.type?t.indent="indent"in e?e.indent:0:"flow-collection"===t.type&&"document"===e.type&&(t.indent=0),"flow-collection"===t.type&&fixFlowSeqItems(t),e.type){case"document":e.value=t;break;case"block-scalar":e.props.push(t);break;case"block-map":{const n=e.items[e.items.length-1];if(n.value)return e.items.push({start:[],key:t,sep:[]}),void(this.onKeyLine=!0);if(!n.sep)return Object.assign(n,{key:t,sep:[]}),void(this.onKeyLine=!n.explicitKey);n.value=t;break}case"block-seq":{const n=e.items[e.items.length-1];n.value?e.items.push({start:[],value:t}):n.value=t;break}case"flow-collection":{const n=e.items[e.items.length-1];return void(!n||n.value?e.items.push({start:[],key:t,sep:[]}):n.sep?n.value=t:Object.assign(n,{key:t,sep:[]}))}default:yield*this.pop(),yield*this.pop(t)}if(!("document"!==e.type&&"block-map"!==e.type&&"block-seq"!==e.type||"block-map"!==t.type&&"block-seq"!==t.type)){const n=t.items[t.items.length-1];n&&!n.sep&&!n.value&&n.start.length>0&&-1===findNonEmptyIndex(n.start)&&(0===t.indent||n.start.every(e=>"comment"!==e.type||e.indent<t.indent))&&("document"===e.type?e.end=n.start:e.items.push({start:n.start}),t.items.splice(-1,1))}}else{const e="Tried to pop an empty stack";yield{type:"error",offset:this.offset,source:"",message:e}}}*stream(){switch(this.type){case"directive-line":return void(yield{type:"directive",offset:this.offset,source:this.source});case"byte-order-mark":case"space":case"comment":case"newline":return void(yield this.sourceToken);case"doc-mode":case"doc-start":{const e={type:"document",offset:this.offset,start:[]};return"doc-start"===this.type&&e.start.push(this.sourceToken),void this.stack.push(e)}}yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML stream`,source:this.source}}*document(e){if(e.value)return yield*this.lineEnd(e);switch(this.type){case"doc-start":return void(-1!==findNonEmptyIndex(e.start)?(yield*this.pop(),yield*this.step()):e.start.push(this.sourceToken));case"anchor":case"tag":case"space":case"comment":case"newline":return void e.start.push(this.sourceToken)}const t=this.startBlockValue(e);t?this.stack.push(t):yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML document`,source:this.source}}*scalar(e){if("map-value-ind"===this.type){const t=getFirstKeyStartProps(getPrevProps(this.peek(2)));let n;e.end?(n=e.end,n.push(this.sourceToken),delete e.end):n=[this.sourceToken];const s={type:"block-map",offset:e.offset,indent:e.indent,items:[{start:t,key:e,sep:n}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=s}else yield*this.lineEnd(e)}*blockScalar(e){switch(this.type){case"space":case"comment":case"newline":return void e.props.push(this.sourceToken);case"scalar":if(e.source=this.source,this.atNewLine=!0,this.indent=0,this.onNewLine){let e=this.source.indexOf("\n")+1;for(;0!==e;)this.onNewLine(this.offset+e),e=this.source.indexOf("\n",e)+1}yield*this.pop();break;default:yield*this.pop(),yield*this.step()}}*blockMap(e){const t=e.items[e.items.length-1];switch(this.type){case"newline":if(this.onKeyLine=!1,t.value){const n="end"in t.value?t.value.end:void 0,s=Array.isArray(n)?n[n.length-1]:void 0;"comment"===s?.type?n?.push(this.sourceToken):e.items.push({start:[this.sourceToken]})}else t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"space":case"comment":if(t.value)e.items.push({start:[this.sourceToken]});else if(t.sep)t.sep.push(this.sourceToken);else{if(this.atIndentedComment(t.start,e.indent)){const n=e.items[e.items.length-2],s=n?.value?.end;if(Array.isArray(s))return Array.prototype.push.apply(s,t.start),s.push(this.sourceToken),void e.items.pop()}t.start.push(this.sourceToken)}return}if(this.indent>=e.indent){const n=!this.onKeyLine&&this.indent===e.indent,s=n&&(t.sep||t.explicitKey)&&"seq-item-ind"!==this.type;let i=[];if(s&&t.sep&&!t.value){const n=[];for(let s=0;s<t.sep.length;++s){const i=t.sep[s];switch(i.type){case"newline":n.push(s);break;case"space":break;case"comment":i.indent>e.indent&&(n.length=0);break;default:n.length=0}}n.length>=2&&(i=t.sep.splice(n[1]))}switch(this.type){case"anchor":case"tag":return void(s||t.value?(i.push(this.sourceToken),e.items.push({start:i}),this.onKeyLine=!0):t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken));case"explicit-key-ind":return t.sep||t.explicitKey?s||t.value?(i.push(this.sourceToken),e.items.push({start:i,explicitKey:!0})):this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken],explicitKey:!0}]}):(t.start.push(this.sourceToken),t.explicitKey=!0),void(this.onKeyLine=!0);case"map-value-ind":if(t.explicitKey)if(t.sep)if(t.value)e.items.push({start:[],key:null,sep:[this.sourceToken]});else if(includesToken(t.sep,"map-value-ind"))this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:i,key:null,sep:[this.sourceToken]}]});else if(isFlowToken(t.key)&&!includesToken(t.sep,"newline")){const e=getFirstKeyStartProps(t.start),n=t.key,s=t.sep;s.push(this.sourceToken),delete t.key,delete t.sep,this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:e,key:n,sep:s}]})}else i.length>0?t.sep=t.sep.concat(i,this.sourceToken):t.sep.push(this.sourceToken);else if(includesToken(t.start,"newline"))Object.assign(t,{key:null,sep:[this.sourceToken]});else{const e=getFirstKeyStartProps(t.start);this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:e,key:null,sep:[this.sourceToken]}]})}else t.sep?t.value||s?e.items.push({start:i,key:null,sep:[this.sourceToken]}):includesToken(t.sep,"map-value-ind")?this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[],key:null,sep:[this.sourceToken]}]}):t.sep.push(this.sourceToken):Object.assign(t,{key:null,sep:[this.sourceToken]});return void(this.onKeyLine=!0);case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{const n=this.flowScalar(this.type);return void(s||t.value?(e.items.push({start:i,key:n,sep:[]}),this.onKeyLine=!0):t.sep?this.stack.push(n):(Object.assign(t,{key:n,sep:[]}),this.onKeyLine=!0))}default:{const s=this.startBlockValue(e);if(s){if("block-seq"===s.type){if(!t.explicitKey&&t.sep&&!includesToken(t.sep,"newline"))return void(yield*this.pop({type:"error",offset:this.offset,message:"Unexpected block-seq-ind on same line with key",source:this.source}))}else n&&e.items.push({start:i});return void this.stack.push(s)}}}}yield*this.pop(),yield*this.step()}*blockSequence(e){const t=e.items[e.items.length-1];switch(this.type){case"newline":if(t.value){const n="end"in t.value?t.value.end:void 0,s=Array.isArray(n)?n[n.length-1]:void 0;"comment"===s?.type?n?.push(this.sourceToken):e.items.push({start:[this.sourceToken]})}else t.start.push(this.sourceToken);return;case"space":case"comment":if(t.value)e.items.push({start:[this.sourceToken]});else{if(this.atIndentedComment(t.start,e.indent)){const n=e.items[e.items.length-2],s=n?.value?.end;if(Array.isArray(s))return Array.prototype.push.apply(s,t.start),s.push(this.sourceToken),void e.items.pop()}t.start.push(this.sourceToken)}return;case"anchor":case"tag":if(t.value||this.indent<=e.indent)break;return void t.start.push(this.sourceToken);case"seq-item-ind":if(this.indent!==e.indent)break;return void(t.value||includesToken(t.start,"seq-item-ind")?e.items.push({start:[this.sourceToken]}):t.start.push(this.sourceToken))}if(this.indent>e.indent){const t=this.startBlockValue(e);if(t)return void this.stack.push(t)}yield*this.pop(),yield*this.step()}*flowCollection(e){const t=e.items[e.items.length-1];if("flow-error-end"===this.type){let e;do{yield*this.pop(),e=this.peek(1)}while("flow-collection"===e?.type)}else if(0===e.end.length){switch(this.type){case"comma":case"explicit-key-ind":return void(!t||t.sep?e.items.push({start:[this.sourceToken]}):t.start.push(this.sourceToken));case"map-value-ind":return void(!t||t.value?e.items.push({start:[],key:null,sep:[this.sourceToken]}):t.sep?t.sep.push(this.sourceToken):Object.assign(t,{key:null,sep:[this.sourceToken]}));case"space":case"comment":case"newline":case"anchor":case"tag":return void(!t||t.value?e.items.push({start:[this.sourceToken]}):t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken));case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{const n=this.flowScalar(this.type);return void(!t||t.value?e.items.push({start:[],key:n,sep:[]}):t.sep?this.stack.push(n):Object.assign(t,{key:n,sep:[]}))}case"flow-map-end":case"flow-seq-end":return void e.end.push(this.sourceToken)}const n=this.startBlockValue(e);n?this.stack.push(n):(yield*this.pop(),yield*this.step())}else{const t=this.peek(2);if("block-map"===t.type&&("map-value-ind"===this.type&&t.indent===e.indent||"newline"===this.type&&!t.items[t.items.length-1].sep))yield*this.pop(),yield*this.step();else if("map-value-ind"===this.type&&"flow-collection"!==t.type){const n=getFirstKeyStartProps(getPrevProps(t));fixFlowSeqItems(e);const s=e.end.splice(1,e.end.length);s.push(this.sourceToken);const i={type:"block-map",offset:e.offset,indent:e.indent,items:[{start:n,key:e,sep:s}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=i}else yield*this.lineEnd(e)}}flowScalar(e){if(this.onNewLine){let e=this.source.indexOf("\n")+1;for(;0!==e;)this.onNewLine(this.offset+e),e=this.source.indexOf("\n",e)+1}return{type:e,offset:this.offset,indent:this.indent,source:this.source}}startBlockValue(e){switch(this.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return this.flowScalar(this.type);case"block-scalar-header":return{type:"block-scalar",offset:this.offset,indent:this.indent,props:[this.sourceToken],source:""};case"flow-map-start":case"flow-seq-start":return{type:"flow-collection",offset:this.offset,indent:this.indent,start:this.sourceToken,items:[],end:[]};case"seq-item-ind":return{type:"block-seq",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken]}]};case"explicit-key-ind":{this.onKeyLine=!0;const t=getFirstKeyStartProps(getPrevProps(e));return t.push(this.sourceToken),{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:t,explicitKey:!0}]}}case"map-value-ind":{this.onKeyLine=!0;const t=getFirstKeyStartProps(getPrevProps(e));return{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:t,key:null,sep:[this.sourceToken]}]}}}return null}atIndentedComment(e,t){return"comment"===this.type&&(!(this.indent<=t)&&e.every(e=>"newline"===e.type||"space"===e.type))}*documentEnd(e){"doc-mode"!==this.type&&(e.end?e.end.push(this.sourceToken):e.end=[this.sourceToken],"newline"===this.type&&(yield*this.pop()))}*lineEnd(e){switch(this.type){case"comma":case"doc-start":case"doc-end":case"flow-seq-end":case"flow-map-end":case"map-value-ind":yield*this.pop(),yield*this.step();break;case"newline":this.onKeyLine=!1;default:e.end?e.end.push(this.sourceToken):e.end=[this.sourceToken],"newline"===this.type&&(yield*this.pop())}}}},(e,t,n)=>{"use strict";var s=n(8),i=n(13),r=n(57),o=n(29),a=n(11),l=n(78),c=n(79);function parseOptions(e){const t=!1!==e.prettyErrors;return{lineCounter:e.lineCounter||t&&new l.LineCounter||null,prettyErrors:t}}function parseDocument(e,t={}){const{lineCounter:n,prettyErrors:i}=parseOptions(t),o=new c.Parser(n?.addNewLine),a=new s.Composer(t);let l=null;for(const t of a.compose(o.parse(e),!0,e.length))if(l){if("silent"!==l.options.logLevel){l.errors.push(new r.YAMLParseError(t.range.slice(0,2),"MULTIPLE_DOCS","Source contains multiple documents; please use YAML.parseAllDocuments()"));break}}else l=t;return i&&n&&(l.errors.forEach(r.prettifyError(e,n)),l.warnings.forEach(r.prettifyError(e,n))),l}t.parse=function parse(e,t,n){let s;"function"==typeof t?s=t:void 0===n&&t&&"object"==typeof t&&(n=t);const i=parseDocument(e,n);if(!i)return null;if(i.warnings.forEach(e=>o.warn(i.options.logLevel,e)),i.errors.length>0){if("silent"!==i.options.logLevel)throw i.errors[0];i.errors=[]}return i.toJS(Object.assign({reviver:s},n))},t.parseAllDocuments=function parseAllDocuments(e,t={}){const{lineCounter:n,prettyErrors:i}=parseOptions(t),o=new c.Parser(n?.addNewLine),a=new s.Composer(t),l=Array.from(a.compose(o.parse(e)));if(i&&n)for(const t of l)t.errors.forEach(r.prettifyError(e,n)),t.warnings.forEach(r.prettifyError(e,n));return l.length>0?l:Object.assign([],{empty:!0},a.streamInfo())},t.parseDocument=parseDocument,t.stringify=function stringify(e,t,n){let s=null;if("function"==typeof t||Array.isArray(t)?s=t:void 0===n&&t&&(n=t),"string"==typeof n&&(n=n.length),"number"==typeof n){const e=Math.round(n);n=e<1?void 0:e>8?{indent:8}:{indent:e}}if(void 0===e){const{keepUndefined:e}=n??t??{};if(!e)return}return a.isDocument(e)&&!s?e.toString(n):new i.Document(e,s,n).toString(n)}},(e,t,n)=>{n(7);e.exports={DependencyAnalyzer:class DependencyAnalyzer{constructor(e){this._parser=e}analyzeDependencies(e,t,n={}){return this.analyzePipeline(t,n)}analyzePipeline(e,t={}){try{const{yamlDoc:t,jsonDoc:n}=this._parser.parseYamlDocument(e,void 0,!1),s={stages:[],jobs:[],templates:[],resources:[],dependencyGraph:[]};return this._extractStages(n,s),this._extractJobs(n,s),this._extractTemplates(n,s),this._extractResources(n,s),s}catch(e){return console.error("Failed to analyze pipeline dependencies:",e),{error:e.message,stages:[],jobs:[],templates:[],resources:[],dependencyGraph:[]}}}_extractStages(e,t){e.stages&&Array.isArray(e.stages)&&e.stages.forEach((e,n)=>{const s={name:e.stage||`Stage_${n}`,displayName:e.displayName||e.stage||`Stage ${n+1}`,dependsOn:[]};e.dependsOn&&(s.dependsOn=Array.isArray(e.dependsOn)?e.dependsOn:[e.dependsOn]),e.jobs&&Array.isArray(e.jobs)&&(s.jobs=e.jobs.map((e,t)=>e.job||e.deployment||e.template||`Job_${t}`)),t.stages.push(s),s.dependsOn.length>0&&s.dependsOn.forEach(e=>{t.dependencyGraph.push({type:"stage",from:s.name,to:e})})})}_extractJobs(e,t){let n=[];e.jobs&&Array.isArray(e.jobs)?n=e.jobs:e.stages&&Array.isArray(e.stages)&&e.stages.forEach(e=>{e.jobs&&Array.isArray(e.jobs)&&n.push(...e.jobs.map(t=>({...t,_stage:e.stage})))}),n.forEach((e,n)=>{const s={name:e.job||e.deployment||`Job_${n}`,displayName:e.displayName||e.job||e.deployment||`Job ${n+1}`,dependsOn:[],stage:e._stage};e.dependsOn&&(s.dependsOn=Array.isArray(e.dependsOn)?e.dependsOn:[e.dependsOn]),e.steps&&Array.isArray(e.steps)&&(s.stepCount=e.steps.length),t.jobs.push(s),s.dependsOn.length>0&&s.dependsOn.forEach(e=>{t.dependencyGraph.push({type:"job",from:s.name,to:e,stage:s.stage})})})}_extractTemplates(e,t){this._findTemplateReferences(e,t,[])}_findTemplateReferences(e,t,n){if("object"==typeof e&&null!==e){if(e.template&&"string"==typeof e.template){const s={path:e.template,parameters:e.parameters||{},usedIn:n.length>0?n.join(" > "):"root"};t.templates.push(s)}Array.isArray(e)?e.forEach((e,s)=>{this._findTemplateReferences(e,t,[...n,`[${s}]`])}):Object.keys(e).forEach(s=>{"template"!==s&&"object"==typeof e[s]&&this._findTemplateReferences(e[s],t,[...n,s])})}}_extractResources(e,t){e.resources&&(e.resources.repositories&&Array.isArray(e.resources.repositories)&&e.resources.repositories.forEach(e=>{t.resources.push({type:"repository",name:e.repository||"unknown",repoType:e.type||"unknown",endpoint:e.endpoint})}),e.resources.pipelines&&Array.isArray(e.resources.pipelines)&&e.resources.pipelines.forEach(e=>{t.resources.push({type:"pipeline",name:e.pipeline||"unknown",source:e.source})}),e.resources.containers&&Array.isArray(e.resources.containers)&&e.resources.containers.forEach(e=>{t.resources.push({type:"container",name:e.container||"unknown",image:e.image})}))}generateMermaidDiagram(e){const t=["graph LR"],n=this._calculateCriticalPath(e),s=new Set(n),i=new Map;for(let e=0;e<n.length-1;e++){const t=`${n[e]}->${n[e+1]}`;i.set(t,!0)}const r={configure:"‚öôÔ∏è",lint:"‚ú®",build:"üî®",test:"üß™",security:"üîí",signing:"üîê",package:"üì¶",release:"üöÄ",scan:"üìã",artifact:"üì¶",unit:"üß™",system:"üß™"},getStageType=e=>{const t=e.toLowerCase();return t.includes("configure")?"configure":t.includes("lint")?"lint":t.includes("build")?"build":t.includes("test")||t.includes("unit")?"test":t.includes("artifact")||t.includes("scan")?"artifactScan":t.includes("sign")?"signing":t.includes("package")||t.includes("publish")?"package":t.includes("release")?"release":"build"},getEmoji=e=>{const t=getStageType(e);return r[t]||"üîß"},o=[];let a=0;return e.stages.length>0&&(e.stages.forEach(e=>{const n=`stage_${this._sanitizeId(e.name)}`,i=getEmoji(e.displayName),r=s.has(e.name)?"stageCritical":getStageType(e.displayName),o=e.displayName||e.name;t.push(`    ${n}["${i} ${o}"]:::${r}`)}),e.dependencyGraph.filter(e=>"stage"===e.type).forEach(e=>{const n=`stage_${this._sanitizeId(e.from)}`,s=`stage_${this._sanitizeId(e.to)}`,r=`${e.from}->${e.to}`,l=i.has(r),c=l?"==>":"--\x3e";t.push(`    ${s} ${c} ${n}`),l&&o.push(a),a++})),e.jobs.length>0&&0===e.stages.length&&(e.jobs.forEach(e=>{const n=`job_${this._sanitizeId(e.name)}`,i=getEmoji(e.displayName),r=s.has(e.name)?"jobCritical":getStageType(e.displayName),o=e.displayName||e.name;t.push(`    ${n}["${i} ${o}"]:::${r}`)}),e.dependencyGraph.filter(e=>"job"===e.type).forEach(e=>{const n=`job_${this._sanitizeId(e.from)}`,s=`job_${this._sanitizeId(e.to)}`,r=`${e.from}->${e.to}`,l=i.has(r),c=l?"==>":"--\x3e";t.push(`    ${s} ${c} ${n}`),l&&o.push(a),a++})),t.push("    classDef configure fill:#e0f2fe,stroke:#0369a1,stroke-width:3px,color:#0c4a6e"),t.push("    classDef lint fill:#dbeafe,stroke:#2563eb,stroke-width:2px,color:#1e3a8a"),t.push("    classDef build fill:#bfdbfe,stroke:#1d4ed8,stroke-width:3px,color:#1e3a8a"),t.push("    classDef test fill:#dbeafe,stroke:#2563eb,stroke-width:2px,color:#1e3a8a"),t.push("    classDef artifactScan fill:#bbf7d0,stroke:#16a34a,stroke-width:3px,color:#14532d"),t.push("    classDef signing fill:#fed7aa,stroke:#ea580c,stroke-width:3px,color:#7c2d12"),t.push("    classDef package fill:#e0f2fe,stroke:#0369a1,stroke-width:3px,color:#0c4a6e"),t.push("    classDef release fill:#bbf7d0,stroke:#16a34a,stroke-width:3px,color:#14532d"),t.push("    classDef stageCritical fill:#fecaca,stroke:#D13438,stroke-width:5px,color:#7f1d1d"),t.push("    classDef jobCritical fill:#fecaca,stroke:#D13438,stroke-width:5px,color:#7f1d1d"),o.forEach(e=>{t.push(`    linkStyle ${e} stroke:#D13438,stroke-width:3px`)}),t.join("\n")}_calculateCriticalPath(e){const t=e.stages.length>0?e.stages:e.jobs,n=e.dependencyGraph.filter(t=>t.type===(e.stages.length>0?"stage":"job"));if(0===t.length)return[];const s=new Map,i=new Map;t.forEach(e=>{s.set(e.name,[]),i.set(e.name,[])}),n.forEach(e=>{s.has(e.from)||s.set(e.from,[]),i.has(e.to)||i.set(e.to,[]),s.get(e.from).push(e.to),i.get(e.to).push(e.from)});const r=new Map,o=new Map;t.forEach(e=>{r.set(e.name,0),o.set(e.name,null)});const a=new Set,l=[],dfs=e=>{if(a.has(e))return;a.add(e);(i.get(e)||[]).forEach(e=>dfs(e)),l.push(e)};t.forEach(e=>dfs(e.name)),l.forEach(e=>{const t=i.get(e)||[];if(0===t.length)r.set(e,1);else{let n=0,s=null;t.forEach(e=>{const t=r.get(e)||0;t>n&&(n=t,s=e)}),r.set(e,n+1),o.set(e,s)}});let c=0,p=null;r.forEach((e,t)=>{(e>c||e===c&&(!p||t<p))&&(c=e,p=t)});const u=[];let f=p;for(;null!==f;)u.unshift(f),f=o.get(f);return u}generateTextReport(e){const t=["# Pipeline Dependencies\n"];if(e.error)return t.push(`‚ö†Ô∏è Error: ${e.error}\n`),t.join("\n");const n=this._calculateCriticalPath(e);if(n.length>0&&(t.push("## üî¥ Critical Path\n"),t.push(`${n.join(" ‚Üí ")}`),t.push(`\n*Path Length: ${n.length} ${e.stages.length>0?"stages":"jobs"}*\n`)),e.stages.length>0&&(t.push("## Stages\n"),e.stages.forEach(e=>{const s=n.includes(e.name)?"üî¥ ":"";t.push(`${s}**${e.displayName}**`),e.dependsOn&&e.dependsOn.length>0&&t.push(`  ‚Ü≥ ${e.dependsOn.join(", ")}`),e.jobs&&e.jobs.length>0&&t.push(`  ‚îú‚îÄ ${e.jobs.length} job${1!==e.jobs.length?"s":""}`)}),t.push("")),e.jobs.length>0&&0===e.stages.length&&(t.push("## Jobs\n"),e.jobs.forEach(e=>{const s=n.includes(e.name)?"üî¥ ":"";t.push(`${s}**${e.displayName}**`),e.dependsOn&&e.dependsOn.length>0&&t.push(`  ‚Ü≥ ${e.dependsOn.join(", ")}`),e.stepCount&&t.push(`  ‚îú‚îÄ ${e.stepCount} step${1!==e.stepCount?"s":""}`)}),t.push("")),e.templates.length>0){t.push("## Templates\n");const n=new Map;e.templates.forEach(e=>{n.has(e.path)||n.set(e.path,[]),n.get(e.path).push(e.usedIn)}),n.forEach((e,n)=>{t.push(`\`${n}\``)}),t.push("")}return e.resources.length>0&&(t.push("## Resources\n"),e.resources.forEach(e=>{"repository"===e.type?t.push(`üì¶ ${e.name}`):"pipeline"===e.type?t.push(`‚öôÔ∏è ${e.name}`):"container"===e.type&&t.push(`üê≥ ${e.name}`)}),t.push("")),0===e.dependencyGraph.length&&0===e.stages.length&&0===e.jobs.length&&t.push("*No dependencies found*\n"),t.join("\n")}_sanitizeId(e){return e.replace(/[^a-zA-Z0-9_]/g,"_")}}}},e=>{"use strict";e.exports=require("vscode")},(e,t,n)=>{e=n.nmd(e);const s=n(1),i=n(5),r=n(2),o=n(7),a=n(84),l=n(85),{analyzeTemplateHints:c}=n(6),p="6d15af64-176c-496d-b583-fd2ae21d4df4@1",u=Object.freeze({script:"CmdLine@2",bash:"Bash@3",pwsh:"PowerShell@2",powershell:"PowerShell@2",checkout:p});class AzurePipelineParser{constructor(e={}){this.expressionCache=new Map,this.globQuotePattern=/[\*\?\[\]]|\/[\*\?\[]|[*/]\/|\/[*/]/,this.skipSyntax=e.skipSyntax||!1}expandPipelineFromFile(e,t={}){const n=s.readFileSync(e,"utf8"),i={...t,fileName:e,baseDir:r.dirname(e),templateStack:[e]};return this.expandPipelineFromString(n,i)}expandPipelineFromString(e,t={}){const{yaml:n}=this.expandPipeline(e,t);return n}expandPipeline(e,t={}){const n=void 0!==t.skipSyntax?t.skipSyntax:this.skipSyntax,{yamlDoc:s,jsonDoc:i}=this.parseYamlDocument(e,void 0,n),r=this.buildExecutionContext(i,t);r.errors=[],r.sourceLines=e.split("\n"),r.sourceText=e;const{quoteStyles:a,save:l}=this.captureQuoteStyles(s.contents,[]);r.quoteResult={quoteStyles:a,save:l},r.quoteResult.stringsWithExpressions=new Set,r.quoteResult.fullParameterExpressions=new Set,r.azureCompatible=t.azureCompatible||!1,r.templateQuoteStyles=new Map;const c=this.expandNode(i,r);if(r.errors.length>0){const e=[],t=new Set;for(const n of r.errors)t.has(n.message)||(e.push(n.message),t.add(n.message));const n=e.join("\n\n");throw new Error(n)}this.convertVariablesToArrayFormat(c,r);const p=o.parseDocument(o.stringify(c));this.restoreQuoteStyles(p.contents,[],r),console.log(`Azure Compatibility mode: ${r.azureCompatible}`),this.applyBlockScalarStyles(p.contents,r);let u=p.toString({lineWidth:0,indent:2,defaultStringType:"PLAIN",defaultKeyType:"PLAIN",simpleKeys:!1,aliasDuplicateObjects:!1});return u=u.replace(/^(\s*(?:-\s+)?[^":\n]+:\s*)["'](\d+(?:\.\d+)?)["']/gm,(e,t,n)=>t.includes('"')?e:t+n),u=u.replace(/(['\"]?)__(TRUE|FALSE)__\1/g,(e,t,n)=>{const s="TRUE"===n?"True":"False";return t?`${t}${s}${t}`:s}),r.azureCompatible?(u=u.replace(/^(\S.+)\n\n(\s*-\s)/gm,"$1\n$2"),u=u.replace(/^(\S.+)\n\n(\s*\w+:)/gm,"$1\n$2"),u.endsWith("\n\n\n")||(u=u.replace(/\n*$/,"\n\n\n"))):u=u.replace(/\n*$/,"\n"),r.azureCompatible&&(u=this.addHeredocListSpacing(u)),{document:c,yaml:u,context:r}}convertVariablesToArrayFormat(e,t){if(!e.variables||"object"!=typeof e.variables||Array.isArray(e.variables))return;const n=new Map,s=this.getQuoteStylesMap(t);Object.entries(e.variables).forEach(([e,t])=>{if("string"==typeof t){const i=this.getQuoteStyleUniqueKey(["variables",e],t),r=s.get(i);r&&n.set(e,{value:t,quoteStyle:r})}}),e.variables=Object.entries(e.variables).map(([e,t])=>({name:e,value:t})),0!==n.size&&e.variables.forEach((e,t)=>{const i=n.get(e.name);if(i&&i.value===e.value){const n=this.getQuoteStyleUniqueKey(["variables",t,"value"],e.value);s.set(n,i.quoteStyle)}})}extractQuoteStyles(e,t,n){const s=this.buildQuoteHandler(this.setQuoteStyle.bind(this),{});this.traverseQuoteStyleNodes(e,t,s,n)}captureQuoteStyles(e,t){const n=new Map;try{this.extractQuoteStyles(e,t,n)}catch(e){}return{quoteStyles:n,save:(e,t)=>{const s=new Map(n);if(t&&t.templateQuoteStyles)for(const[,e]of t.templateQuoteStyles.entries())for(const[t,n]of e.entries())s.has(t)||s.set(t,n);return e.__quoteStyles=s,s}}}validateYamlSyntaxHints(e,t){const n=c(e);if(n.length){const e=`\n  ${n.join("\n  ")}`;throw new Error(t?`Template '${t}' potential issues:${e}`:`Potential template issues:${e}`)}}parseYamlDocument(e,t,n=!1,s=void 0){if(!n)try{this.validateYamlSyntaxHints(e,t)}catch(e){const t=e&&e.message?e.message:String(e);throw new Error(this.formatErrorWithStack(t,s))}try{let t;try{if(t=o.parseAllDocuments(e).find(e=>null!==e.contents&&void 0!==e.contents),!t)throw new Error("Empty YAML document")}catch(n){t=o.parseDocument(e)}const n=t.toJSON()||{};return{yamlDoc:t,jsonDoc:n}}catch(e){const n=t?`Failed to parse template '${t}': ${e.message}`:`Failed to parse YAML: ${e.message}`;throw new Error(this.formatErrorWithStack(n,s))}}restoreQuoteStyles(e,t,n={}){const s=this.getQuoteStylesMap(n),i=this.buildQuoteHandler(this.getQuoteStyle.bind(this),{post:(e,t,s)=>{if(!this.isStringNodeValue(t))return;const i=t.value,r=this.hasFullParameterExpression(i,s,n);""===i?t.type="QUOTE_DOUBLE"!==e||r?"QUOTE_SINGLE":"QUOTE_DOUBLE":r?this.hasColon(i)||this.isConditionExpression(i)||(this.isGlobPattern(i)||this.isKeyValueLike(i))&&(t.type="QUOTE_SINGLE"):this.hadMixedExpression(i,s,n)||this.hasRuntimeVariable(i)?t.type="PLAIN":this.isKeyValueLike(i)?t.type="QUOTE_SINGLE":e&&(t.type=e)}});this.traverseQuoteStyleNodes(e,t,i,s)}getQuoteStyleUniqueKey(e,t){return`${e.filter(e=>!this.hasTemplateExpr(e)).join(".")}:${t}`}setQuoteStyle(e,t,n,s){const i=n.type;if("QUOTE_SINGLE"!==i&&"QUOTE_DOUBLE"!==i)return;if("string"!=typeof n.value)return;const r=this.getQuoteStyleUniqueKey(e,n.value);s.set(r,i)}getQuoteStyle(e,t,n,s){if(!s)return;const i=t&&t.value?t.value:void 0,r=this.isStringNodeValue(n)?n.value:void 0;if(void 0!==i&&void 0!==r){const t=this.getQuoteStyleUniqueKey(e,r);return s.get(t)}}traverseQuoteStyleNodes(e,t,n,s=new Map){if(e)if(e.items&&"YAMLMap"===e.constructor.name)for(const i of e.items){const e=i.key;if(e&&e.value){t.push(e.value);try{n(i,t,s)}catch(e){}i.value&&this.traverseQuoteStyleNodes(i.value,t,n,s),t.pop()}}else if(e.items&&"YAMLSeq"===e.constructor.name)for(let i=0;i<e.items.length;i+=1)t.push(i),this.traverseQuoteStyleNodes(e.items[i],t,n,s),t.pop()}buildQuoteHandler(e,t={}){const{post:n=null}=t;return(t,s,i)=>{const r=t.key,o=t.value;if(!this.isStringNodeValue(r)||!this.isStringNodeValue(o))return;const a=e(s,r,o,i);if("function"==typeof n)try{n(a,o,s)}catch(e){}}}applyBlockScalarStyles(e,t={}){if(e)if(e.items&&"YAMLMap"===e.constructor.name)for(const n of e.items){if(!n.key?.value||!n.value)continue;const{value:e}=n;if(!this.isMultilineString(e.value)){this.applyBlockScalarStyles(e,t);continue}let s=e.value;const i=t.azureCompatible&&this.hasTrailingSpaces(s);if(i||"QUOTE_DOUBLE"===e.type){i&&(e.type="QUOTE_DOUBLE"),this.applyBlockScalarStyles(e,t);continue}const r=s.replace(/\s+$/,""),o=t.scriptsWithExpressions?.has(r);e.type=o&&t.azureCompatible?"BLOCK_FOLDED":"BLOCK_LITERAL",e.value=this.normalizeTrailingNewlines(s,t.azureCompatible),this.applyBlockScalarStyles(e,t)}else if(e.items&&"YAMLSeq"===e.constructor.name)for(const n of e.items)this.applyBlockScalarStyles(n,t)}buildExecutionContext(e,t){const{parameters:n,parameterMap:s}=this.extractParameters(e),i=this.extractVariables(e),o=this.normalizeResourcesConfig(e&&"object"==typeof e?e.resources:void 0),a=t.parameters||{},l=t.variables||{},c=this.normalizeResourcesConfig(t.resources),p=t.locals||{},u=t.baseDir||(t.fileName?r.dirname(t.fileName):process.cwd()),f=void 0!==t.repoBaseDir?t.repoBaseDir:u,d=void 0!==t.rootRepoBaseDir?t.rootRepoBaseDir:f,h=this.mergeResourcesConfig(o,c),m=t.resourceLocations||{},g=void 0!==t.skipSyntax?t.skipSyntax:this.skipSyntax;return{parameters:{...n,...a},parameterMap:{...s},variables:{...i,...l},globalVariables:{...i,...l},stageVariables:{},jobVariables:{},resources:h,locals:{...p},baseDir:u,repoBaseDir:f,rootRepoBaseDir:d,resourceLocations:m,templateStack:t.templateStack||[],rootTemplate:t.rootTemplate||t.fileName||(Array.isArray(t.templateStack)?t.templateStack[0]:void 0),expansionPath:[],scriptsWithExpressions:new Set,scriptsWithLastLineExpressions:new Set,stringsWithExpressions:new Set,stageIndex:-1,jobIndex:-1,stepIndex:-1,skipSyntax:g}}normalizeResourcesConfig(e){if(!e||"object"!=typeof e)return{};const t=Object.keys(e).reduce((t,n)=>("repositories"===n||(t[n]=this.deepClone(e[n])),t),{});return void 0!==e.repositories&&(t.repositories=this.normalizeRepositoryList(e.repositories)),t}mergeResourcesConfig(e={},t={}){const n={};return Object.entries(e||{}).forEach(([e,t])=>{"repositories"!==e&&(n[e]=this.deepClone(t))}),n.repositories=this.mergeRepositoryConfigs(e?.repositories,t?.repositories),Object.entries(t||{}).forEach(([e,t])=>{"repositories"!==e&&(n[e]=this.deepClone(t))}),n}normalizeRepositoryList(e){if(!e)return[];const t=[];if(Array.isArray(e))for(const n of e)n&&"object"==typeof n&&t.push(this.deepClone(n));else if("object"==typeof e)for(const[n,s]of Object.entries(e)){if(!s||"object"!=typeof s)continue;const e=this.deepClone(s);!e.repository&&n&&(e.repository=n),t.push(e)}return this.attachRepositoryAliases(t)}mergeRepositoryConfigs(e,t){const n=this.normalizeRepositoryList(e),s=this.normalizeRepositoryList(t);if(!s.length)return n;const i=[],r=new Map,addEntry=(e,t)=>{if(!e||"object"!=typeof e)return;const n=this.deepClone(e),s=n.__match&&"object"==typeof n.__match?n.__match:void 0;s&&delete n.__match;const o=this.getRepositoryAlias(n),a=o&&!this.isNumericString(o)?o:`__index_${i.length}`;n.repository||!o||this.isNumericString(o)||(n.repository=o);const l=r.get(a);"override"===t&&l&&s&&!this.repositoryMatchesCriteria(l,s)||("override"===t&&n.location&&l&&!l.location&&(l.location=n.location),l?r.set(a,{...l,...n}):(r.set(a,n),i.push(a)))};n.forEach(e=>addEntry(e,"base")),s.forEach(e=>addEntry(e,"override"));const o=i.map(e=>this.deepClone(r.get(e)));return this.attachRepositoryAliases(o)}attachRepositoryAliases(e){if(!Array.isArray(e))return e;const t=new Set;return e.forEach(n=>{const s=this.getRepositoryAlias(n);!s||this.isNumericString(s)||t.has(s)||(Object.defineProperty(e,s,{value:n,writable:!0,enumerable:!0,configurable:!0}),t.add(s))}),e}getRepositoryAlias(e){if(e&&"object"==typeof e)return"string"==typeof e.repository&&e.repository.length?e.repository:"string"==typeof e.alias&&e.alias.length?e.alias:"string"==typeof e.name&&e.name.length?e.name:void 0}repositoryMatchesCriteria(e,t={}){if(!e||"object"!=typeof e)return!1;for(const[n,s]of Object.entries(t))if(null!=s&&""!==s){if(!Object.prototype.hasOwnProperty.call(e,n))return!1;if(e[n]!==s)return!1}return!0}deepClone(e){return null==e||"object"!=typeof e?e:JSON.parse(JSON.stringify(e))}isNumericString(e){return"string"==typeof e&&/^\d+$/.test(e)}extractParameters(e){const t={parameters:{},parameterMap:{}};if(!e||"object"!=typeof e)return t;const{parameters:n}=e;if(!n)return t;if(Array.isArray(n)){for(const e of n)if(e&&"object"==typeof e&&e.name){const s=e.default;t.parameters[e.name]=void 0!==s?s:null,t.parameterMap[`parameters.${e.name}`]=`parameters.${n.indexOf(e)}.default`}}else if("object"==typeof n)for(const[e,s]of Object.entries(n)){if(s&&"object"==typeof s){const n=s.default;t.parameters[e]=void 0!==n?n:null}else t.parameters[e]=s;t.parameterMap[`parameters.${e}`]=`parameters.${e}`}return t}validateTemplateParameters(e,t,n,s){if(!e||"object"!=typeof e||!e.parameters)return;const i={missingRequired:[],invalidValues:[],typeErrors:[],unknownParameters:[]},checkParameter=(e,n)=>this.validateParameter(e,n,t,i);if(Array.isArray(e.parameters))for(const t of e.parameters)checkParameter(t);else if("object"==typeof e.parameters)for(const[t,n]of Object.entries(e.parameters))checkParameter(n,t);this.checkUnknownParameters(e.parameters,t,i),this.reportValidationErrors(i,n,s)}validateParameter(e,t,n,s){if(!e||"object"!=typeof e)return;const i=t||e.name;if(!i)return;const r=void 0!==e.default||void 0!==e.value||void 0!==e.values,o=n&&Object.prototype.hasOwnProperty.call(n,i),a=o?n[i]:void 0;r||o||s.missingRequired.push(i);const l="string"==typeof a&&/\$\([^)]+\)/.test(a);if(o&&void 0!==e.type&&void 0!==a&&!l){const t=this.validateParameterType(i,e.type,a);t&&s.typeErrors.push(t)}o&&e.values&&Array.isArray(e.values)&&(l||e.values.includes(a)||s.invalidValues.push({name:i,value:a,allowed:e.values}))}validateParameterType(e,t,n){const s=String(t).toLowerCase(),i=typeof n;switch(s){case"string":if(!["string","number","boolean"].includes(i))return{name:e,expected:"string",actual:i,value:n};break;case"number":if("number"!==i&&("string"!==i||isNaN(n)))return{name:e,expected:"number",actual:i,value:n};break;case"boolean":if("boolean"!==i){if("string"!==i)return{name:e,expected:"boolean",actual:i,value:n};{const t=n.toLowerCase();if(!["true","false","__true__","__false__"].includes(t))return{name:e,expected:"boolean",actual:i,value:n}}}break;case"object":if("dependsOn"===e){if("string"!==i&&("object"!==i||null===n))return{name:e,expected:"object",actual:i,value:n}}else if("object"!==i||null===n)return{name:e,expected:"object",actual:i,value:n};break;case"step":case"steplist":case"job":case"joblist":case"deployment":case"deploymentlist":case"stage":case"stagelist":if(!Array.isArray(n))return{name:e,expected:"array ("+s+")",actual:i,value:n}}return null}checkUnknownParameters(e,t,n){if(!t||"object"!=typeof t)return;const s=new Set;Array.isArray(e)?e.forEach(e=>e?.name&&s.add(e.name)):"object"==typeof e&&Object.keys(e).forEach(e=>s.add(e)),Object.keys(t).forEach(e=>{""===e||s.has(e)||n.unknownParameters.push(e)})}getTemplateCallStack(e,t){const n=Array.isArray(e?.templateStack)?[...e.templateStack]:[];if(e?.rootTemplate&&(0!==n.length&&n[0]===e.rootTemplate||n.unshift(e.rootTemplate)),0===n.length)return"";const s=[];s.push("Template call stack:");const i=t?`${n[0]}:${t}`:n[0];s.push("    "+i);for(let e=1;e<n.length;e++)s.push("    "+"  ".repeat(e)+"‚îî‚îÄ‚îÄ "+n[e]);return"\n"+s.join("\n")}getFirstTemplateStackPath(e){const t=Array.isArray(e?.templateStack)?[...e.templateStack]:[];return e?.rootTemplate&&(0!==t.length&&t[0]===e.rootTemplate||t.unshift(e.rootTemplate)),t.length>0?t[0]:void 0}formatErrorWithStack(e,t){try{if(e.includes("Template call stack:"))return e;const n=this.getTemplateCallStack(t);return n?`${e}${n}`:e}catch(t){return e}}reportValidationErrors(e,t,n){const s=[],i=t||"template";if(e.missingRequired.length>0){const t=e.missingRequired.map(e=>`  * ${e}`).join("\n");s.push(`Missing required parameter(s) for template '${i}'\nFollowing parameters do not have default values and must be provided when calling the template.\n${t}`)}if(e.typeErrors.length>0){const t=e.typeErrors.map(e=>`Parameter '${e.name}' expects type '${e.expected}' but received '${e.actual}' (value: ${JSON.stringify(e.value)})`).join("\n    ");s.push(`Invalid parameter type(s) for template '${i}':\n    ${t}`)}if(e.invalidValues.length>0){const t=e.invalidValues.map(e=>`Parameter '${e.name}' has value '${e.value}' which is not in allowed values: [${e.allowed.join(", ")}]`).join("\n    ");s.push(`Invalid parameter value(s) for template '${i}':\n    ${t}`)}if(e.unknownParameters.length>0){const t=e.unknownParameters.map(e=>`* ${e}`).join("\n  ");s.push(`Unknown parameter(s) for template: '${i}'\nFollowing parameters are not defined in the template\n  ${t}`)}if(s.length>0){let e=s.join("\n\n");const t=this.getTemplateCallStack(n);throw t&&(e+=t),new Error(e)}}extractVariables(e){const t={};if(!e||"object"!=typeof e)return t;const{variables:n}=e;if(!n)return t;if(Array.isArray(n))for(const e of n)e&&"object"==typeof e&&e.name&&(t[e.name]=e.value);else if("object"==typeof n)for(const[e,s]of Object.entries(n))t[e]=s&&"object"==typeof s&&"value"in s?s.value:s;return t}expandNode(e,t,n=null){let s;if(s=Array.isArray(e)?this.expandArray(e,t,n):e&&"object"==typeof e?this.expandObject(e,t,n):this.expandScalar(e,t),null===n&&this.isNonArrayObject(s)){s.__scriptsWithExpressions=t.scriptsWithExpressions||new Set,s.__scriptsWithLastLineExpressions=t.scriptsWithLastLineExpressions||new Set;const e=t.quoteResult;e&&"function"==typeof e.save&&e.save(s,t),t.scriptsWithExpressions=s.__scriptsWithExpressions||new Set,delete s.__scriptsWithExpressions,t.scriptsWithLastLineExpressions=s.__scriptsWithLastLineExpressions||new Set,delete s.__scriptsWithLastLineExpressions,s.__quoteStyles&&delete s.__quoteStyles}return s}expandArray(e,t,n=null){const s=[],i="variables"===n;for(let r=0;r<e.length;r+=1){const o=e[r];if(!o)continue;const a=this.isTemplateReference(o),l=this.isSingleKeyObject(o)&&(this.isConditionalDirective(Object.keys(o)[0])||this.isEachDirective(Object.keys(o)[0])),c=l||a?r:this.trackIndicesForItems(o,n,t,r);t.expansionPath&&!l&&t.expansionPath.push(c);try{if(a){this.expandTemplateReferenceToResult(o,t,s,n);continue}const l=this.handleSingleKeyObject(o,e,r,t,s,n);if(l.handled){r="number"==typeof l.nextIndex?l.nextIndex:r;continue}const c=this.createScopedContext(t,o,n),p=this.expandNode(o,c,n);if(void 0===p)continue;const u=Array.isArray(p)?p:[p];this.expandAndAppendArrayItems(u,t,s,i)}finally{t.expansionPath&&!l&&t.expansionPath.pop()}}return s}expandTemplateReferenceToResult(e,t,n,s=""){const i=e.template,o=this.expandTemplateReference(e,t);if(Array.isArray(o)&&o.length){const e=n.length,a={steps:t.stepIndex,jobs:t.jobIndex,stages:t.stageIndex},l=Object.prototype.hasOwnProperty.call(a,s)?a[s]+1:e;if(n.push(...o),!t.expansionPath||t.expansionPath.length<2)return;for(let n=0;n<o.length;n++){const i=o[n];i&&"object"==typeof i&&!Array.isArray(i)&&("variables"===s&&i.name&&void 0!==i.value&&(t.variables[i.name]=i.value),this.trackIndicesForItems(i,s,t,e+n))}let c=[];if(c="jobs"===s?["stages",t.stageIndex]:"steps"===s?["stages",t.stageIndex,"jobs",t.jobIndex]:t.expansionPath.slice(0,-2),i&&t.templateQuoteStyles){const e=this.replaceExpressionsInString(i,t);for(const[n]of t.templateQuoteStyles.entries())(n.includes(e)||e.includes(r.basename(n)))&&this.remapTemplateQuoteStylesByValue(n,s,o,l,c,t)}}}remapTemplateQuoteStylesByValue(e,t,n,s,i,r){const o=this.getQuoteStylesMap(r),a=r.templateQuoteStyles.get(e);if(a&&0!==a.size)for(const[e,r]of a.entries()){const a=e.lastIndexOf(":");if(-1===a)continue;const l=e.substring(0,a),c=e.substring(a+1);if(l.startsWith("parameters."))continue;const p=l.split(".");if(p[0]!==t)continue;const u=parseInt(p[1],10);if(isNaN(u))continue;const f=p.slice(2).join(".");let d=-1;if(u>=0&&u<n.length){const e=n[u];if(e&&"object"==typeof e){this.getNestedValue(e,f)===c&&(d=u)}}if(-1===d)for(let e=0;e<n.length;e++){const t=n[e];if(!t||"object"!=typeof t)continue;if(this.getNestedValue(t,f)===c){d=e;break}}if(-1===d)continue;const h=[...i,t,s+d];f&&h.push(...f.split("."));const m=`${h.join(".")}:${c}`;o.set(m,r)}}getNestedValue(e,t){if(!t)return e;const n=t.split(".");let s=e;for(const e of n){if(null==s||"object"!=typeof s)return;s=s[e]}return s}expandAndAppendArrayItems(e,t,n,s){for(const i of e)this.isTemplateReference(i)?this.expandTemplateReferenceToResult(i,t,n,s):(n.push(i),this.updateVariableContext(i,s,t))}updateVariableContext(e,t,n){if(!t||!e||"object"!=typeof e||Array.isArray(e))return;const s=e.name,i=e.value;s&&void 0!==i&&(n.variables[s]=i,n.jobIndex>=0?n.jobVariables[s]=i:n.stageIndex>=0?n.stageVariables[s]=i:n.globalVariables[s]=i)}getQuoteStylesMap(e){return e.quoteResult?.quoteStyles||new Map}ensureContextSet(e,t){const n=e&&e[t];if(n instanceof Set)return n;const s=new Set;return e&&(e[t]=s),s}ensureStringsWithExpressions(e){return this.ensureContextSet(e.quoteResult,"stringsWithExpressions")}ensureFullParameterExpressions(e){return this.ensureContextSet(e.quoteResult,"fullParameterExpressions")}trackExpressionValue(e,t,n){const{hadMultilineExpr:s,lastLineHadExpression:i}=n;if(!s||"string"!=typeof e)return;const r=e.replace(/\s+$/,"");this.ensureContextSet(t,"scriptsWithExpressions").add(r),i&&this.ensureContextSet(t,"scriptsWithLastLineExpressions").add(r)}trackQuoteStylesForExpressions(e,t,n,s){const{isMixedExpression:i,isSingleLineFullExpression:r}=s;if(!n.expansionPath||"string"!=typeof e)return;const o=this.getQuoteStylesMap(n);let a=[];if(n.stepIndex>=0){const e=this.relativePathAfterKey(n.expansionPath,"steps");a=["stages",n.stageIndex,"jobs",n.jobIndex,"steps",n.stepIndex,...e]}else if(n.jobIndex>=0){const e=this.relativePathAfterKey(n.expansionPath,"jobs");a=["stages",n.stageIndex,"jobs",n.jobIndex,...e]}else if(n.stageIndex>=0){const e=this.relativePathAfterKey(n.expansionPath,"stages");a=["stages",n.stageIndex,...e]}else a=[...n.expansionPath];const l=this.getQuoteStyleUniqueKey(a,e);if(i&&!this.isMultilineString(e))return void(this.isKeyValueLike(e)||this.ensureStringsWithExpressions(n).add(l));let c=null;if(r){const s=this.getQuoteStyleUniqueKey(a,t),i=this.isConditionExpression(e);if(c=o.get(s),!c&&(""===e||this.isGlobPattern(e)&&!i)){const s=this.stripExpressionDelimiters(t);let r=null;if(s.includes("(")&&s.includes(")")?r=this.extractSourceParameter(s):this.isParameter(t)&&(r=s),r){let t=a;n.parameterMap[r]&&(t=n.parameterMap[r].split("."));const s=this.getQuoteStyleUniqueKey(t,e);this.hasColon(e)||(c=o.get(s))}c||!this.isGlobPattern(e)||i||(c="QUOTE_SINGLE")}if(c&&(this.hasColon(e)||o.set(l,this.isKeyValueLike(e)?"QUOTE_SINGLE":c),n.expansionPath.length>=3&&"variables"===n.expansionPath[2])){const t=n.expansionPath.filter((e,t)=>2!==t),s=this.getQuoteStyleUniqueKey(t,e);o.set(s,c)}if(this.ensureFullParameterExpressions(n).add(l),""===e){const t=this.getQuoteStyleUniqueKey(a,e);this.ensureStringsWithExpressions(n).add(t)}}}trackIndicesForItems(e,t,n,s=0){return Array.isArray(e)?s:"stages"===t&&e&&"object"==typeof e&&"stage"in e?(n.stageIndex+=1,n.jobIndex=-1,n.stepIndex=-1,n.stageIndex):"jobs"===t&&e&&"object"==typeof e&&"job"in e?(n.jobIndex+=1,n.stepIndex=-1,n.jobIndex):"steps"===t&&e&&"object"==typeof e?(n.stepIndex+=1,n.stepIndex):s}handleSingleKeyObject(e,t,n,s,i,r=null){if(!this.isSingleKeyObject(e))return{handled:!1};const o=Object.keys(e)[0];if(this.isEachDirective(o)){const t=this.applyEachDirective(o,e[o],s);return t&&Array.isArray(t.items)&&t.items.length&&(this.trackIndicesForItems(t.items,r,s),i.push(...t.items)),{handled:!0}}if(this.isConditionalDirective(o)){const e=this.expandConditionalBlock(t,n,s,r);return e&&Array.isArray(e.items)&&e.items.length&&(this.trackIndicesForItems(e.items,r,s),i.push(...e.items)),{handled:!0,nextIndex:e.nextIndex}}return{handled:!1}}expandObject(e,t,n=null){const s=Object.entries(e),i={};for(let e=0;e<s.length;e+=1){const[n,r]=s[e];if(this.isEachDirective(n)){const n=this.expandEachEntries(s,e,t);Object.assign(i,n.merged),e=n.nextIndex;continue}if(this.isConditionalDirective(n)){const n=this.expandConditionalEntries(s,e,t);Object.assign(i,n.merged),e=n.nextIndex;continue}if(this.isInsertDirective(n)){const e=this.expandNodePreservingTemplates(r,t);this.isNonArrayObject(e)&&Object.assign(i,e);continue}const o=this.replaceExpressionsInString(n,t);t.expansionPath&&t.expansionPath.push(o);try{const e={hadMultilineExpr:this.hasTemplateExpr(r)&&this.isMultilineString(r),stringHadExpressions:this.hasTemplateExpr(r),lastLineHadExpression:this.lastLineHasTemplateExpression(r)&&this.isMultilineString(r),isSingleLineFullExpression:this.isSingleLineFullExpression(r),isMixedExpression:!1};e.isMixedExpression=e.stringHadExpressions&&!e.isSingleLineFullExpression;const n=this.expandNode(r,t,o);if(void 0===n)continue;if(this.trackQuoteStylesForExpressions(n,r,t,e),this.trackExpressionValue(n,t,e),e.isSingleLineFullExpression&&this.isMultilineString(n)){const e=n.replace(/\s+$/,"");t.scriptsWithExpressions.add(e),t.scriptsWithLastLineExpressions.add(e)}i[o]=n}finally{t.expansionPath&&t.expansionPath.pop()}}const r=["bash","script","pwsh","powershell","checkout"].find(e=>Object.prototype.hasOwnProperty.call(i,e));if(r&&!i.task&&!i.inputs&&!i.targetType&&"inputs"!==n){const e=i[r];delete i[r];const t={task:u[r]};if("checkout"===r){const{condition:n,displayName:s,...r}=i;s&&(t.displayName=s);const o=void 0!==n?n:"none"!==e&&void 0;void 0!==o&&(t.condition=o),t.inputs=Object.assign({repository:e},r)}else{const{workingDirectory:n,...s}=i;let o;Object.assign(t,s),"script"!==r?(o={targetType:"inline",script:e},"pwsh"===r&&(o.pwsh=!0)):o={script:e},void 0!==n&&(o.workingDirectory=n),t.inputs=o}return t}return i.pool&&"string"==typeof i.pool&&(i.pool={name:i.pool}),i.dependsOn&&"string"==typeof i.dependsOn&&(i.dependsOn=[i.dependsOn]),i.task!==p||"none"!==i.inputs?.repository||i.condition||(i.condition=!1),i}expandScalar(e,t){if("string"!=typeof e)return e;const n=e.trim();if(this.isFullExpression(n)){const e=this.stripExpressionDelimiters(n),s=this.evaluateExpression(e,t);if(this.isTemplateReference(s)){const e=this.expandTemplateReference(s,t);return 1===e.length?e[0]:e}return"boolean"==typeof s?this.returnBoolean(s):s}return this.replaceExpressionsInString(e,t,{preserveEmptyLines:this.isMultilineString(e)})}expandConditionalBlock(e,t,n,s=null){let i=t,r=!1,o=[];for(;i<e.length;){const a=e[i];if(!this.isSingleKeyObject(a))break;const[l]=Object.keys(a),c=a[l];if(!this.isConditionalDirective(l))break;if(this.isIfDirective(l)&&i!==t)break;if(!r&&this.evaluateConditional(l,n)&&(o=this.flattenBranchValue(c,n,s),r=!0),i+=1,this.isElseDirective(l))break}return{items:o,nextIndex:i-1}}expandConditionalEntries(e,t,n){let s=t,i=!1,r={};for(;s<e.length;){const[t,o]=e[s];if(!this.isConditionalDirective(t))break;if(!i&&this.evaluateConditional(t,n)&&(r=this.expandConditionalMappingBranch(o,n),i=!0),s+=1,this.isElseDirective(t))break}return{merged:r,nextIndex:Math.max(t,s-1)}}expandConditionalMappingBranch(e,t){if(Array.isArray(e))return this.expandArray(e,t).reduce((e,t)=>this.isNonArrayObject(t)?{...e,...t}:e,{});if(e&&"object"==typeof e){return this.expandObject(e,t)}const n=this.expandScalar(e,t);return void 0===n?{}:{value:n}}expandEachEntries(e,t,n){let s=t;const i={};for(;s<e.length;){const[t,r]=e[s];if(!this.isEachDirective(t))break;const o=this.parseEachDirective(t);if(!o){s+=1;continue}const a=this.evaluateExpression(o.collection,n);this.normalizeCollection(a).forEach((e,t)=>{const s={[o.variable]:e,[`${o.variable}Index`]:t},a=this.createChildContext(n,s),l=this.expandConditionalMappingBranch(r,a);if(Object.prototype.hasOwnProperty.call(l,"--")){const n=this.resolveEachIterationKey(e,t,a,o.variable),s=l["--"];delete l["--"],null!=n&&(i[n]=s)}Object.assign(i,l)}),s+=1}return{merged:i,nextIndex:Math.max(t,s-1)}}resolveEachIterationKey(e,t,n,s){if(null==e)return String(t);const unwrap=e=>{if(null!=e)return"string"==typeof e||"number"==typeof e||"boolean"==typeof e?String(e):void 0},i=unwrap(e);if(void 0!==i)return i;if(e&&"object"==typeof e){const t=["key","name","matrixKey","label","id"];for(const n of t)if(Object.prototype.hasOwnProperty.call(e,n)){const t=unwrap(e[n]);if(void 0!==t)return t}if(Object.prototype.hasOwnProperty.call(e,"value")){const t=unwrap(e.value);if(void 0!==t)return t}}if("string"==typeof s&&s.length){const e=unwrap(this.evaluateExpression(s,n));if(void 0!==e)return e}return String(t)}flattenBranchValue(e,t,n=null){if(Array.isArray(e))return this.expandArray(e,t,n);if(e&&"object"==typeof e)return[this.expandObject(e,t,n)];const s=this.expandScalar(e,t);return void 0===s?[]:[s]}applyEachDirective(e,t,n,s=null){const i=this.parseEachDirective(e);if(!i)return{items:[]};const r=this.evaluateExpression(i.collection,n),o=this.normalizeCollection(r),a=[];return o.forEach((e,r)=>{const o={[i.variable]:e,[`${i.variable}Index`]:r},l=this.createChildContext(n,o),c=this.flattenBranchValue(t,l,s);a.push(...c)}),{items:a}}replaceExpressionsInString(e,t,n={}){if("string"!=typeof e)return e;const s=void 0!==n.preserveEmptyLines?n.preserveEmptyLines:this.isMultilineString(e)&&!0===t?.azureCompatible;let i=e.replace(/\$\{\{\s*(.+?)\s*\}\}/g,(e,n)=>{const s=this.evaluateExpression(n,t);if(null==s){if(n.trim().startsWith("parameters.")){return`$(${n.trim().substring(11)})`}return""}if("object"==typeof s)return JSON.stringify(s);if("string"==typeof s){const e=s.toLowerCase();if("__true__"===e)return"True";if("__false__"===e)return"False"}return"boolean"==typeof s?this.returnBoolean(s):String(s)});return s||(i=i.replace(/^[ \t]+$/gm,"")),t?.azureCompatible&&(i=this.addHeredocListSpacing(i)),i}addHeredocListSpacing(e){if(!e||"string"!=typeof e)return e;const t=e.split("\n"),n=[];let s=!1,i="";const isBullet=e=>/^\s*-\s*\[/.test(e.trim());for(let e=0;e<t.length;e+=1){const r=t[e];if(!s){const e=r.match(/<<\s*([A-Za-z0-9_]+)/);e&&(s=!0,i=e[1]),n.push(r);continue}const o=r.trim();if(i&&o===i){s=!1,i="",n.push(r);continue}n.push(r);const a=t[e+1];void 0!==a&&(isBullet(r)&&isBullet(a)&&a.trim().length>0&&n.push(""))}return n.join("\n")}evaluateExpression(e,t){if(null==e)return;const n=String(e).trim();if(0===n.length)return;const s=this.parseExpressionAst(n);if(s)return this.evaluateAst(s,t);const i=this.resolveContextValue(n,t);return void 0!==i?i:this.looksLikeContextPath(n)?void 0:n}evaluateFunction(e,t){const n=String(e||""),s=l[n];return s?s(t):void 0}parseExpressionAst(e){if(this.expressionCache.has(e))return this.expressionCache.get(e);try{const t=this.preprocessExpressionString(e),n=a(t);return this.expressionCache.set(e,n),n}catch(t){return this.expressionCache.set(e,null),null}}preprocessExpressionString(e){return"string"!=typeof e?e:e.replace(/(['"])((?:\\.|(?!\1).)*?)\1/g,(e,t,n)=>{let s="",i=0;for(;i<n.length;)if("\\"===n[i]){let e=0;for(;i<n.length&&"\\"===n[i];)e++,i++;s+="\\".repeat(e%2==1?e+1:e)}else s+=n[i++];return t+s+t})}evaluateAst(e,t){if(e)switch(e.type){case"Literal":return e.value;case"Identifier":return this.resolveIdentifier(e.name,t);case"ThisExpression":return t;case"ArrayExpression":return e.elements.map(e=>this.evaluateAst(e,t));case"ObjectExpression":{const n={};return e.properties.forEach(e=>{const s=e.key,i=this.evaluatePropertyKey(s,e.computed,t);void 0!==i&&(n[i]=this.evaluateAst(e.value,t))}),n}case"UnaryExpression":return this.evaluateUnary(e.operator,this.evaluateAst(e.argument,t));case"BinaryExpression":return this.evaluateBinary(e.operator,this.evaluateAst(e.left,t),this.evaluateAst(e.right,t));case"LogicalExpression":{const n=this.evaluateAst(e.left,t);return"&&"===e.operator?this.toBoolean(n)?this.evaluateAst(e.right,t):n:"||"===e.operator?this.toBoolean(n)?n:this.evaluateAst(e.right,t):"??"===e.operator?null!=n?n:this.evaluateAst(e.right,t):void 0}case"ConditionalExpression":return this.toBoolean(this.evaluateAst(e.test,t))?this.evaluateAst(e.consequent,t):this.evaluateAst(e.alternate,t);case"MemberExpression":{const n=this.evaluateAst(e.object,t);if(null==n)return;const s=this.evaluatePropertyKey(e.property,e.computed,t);if(null==s)return;if(n===t.parameters&&!Object.prototype.hasOwnProperty.call(n,s)){const e=String(s),n=[`Undefined template parameter '${e}'.`];let i=null;if(t.sourceLines){const n=[`parameters.${e}`,e];for(const e of n){for(let n=0;n<t.sourceLines.length;n++)if(t.sourceLines[n].includes(e)){i=n+1;break}if(i)break}}const r=this.getFirstTemplateStackPath(t);i&&r&&n.push(`${r}:${i}`),n.push("Tips:"),n.push(`- Ensure '${e}' is declared in the 'parameters' section`);const o=`- Check if the reference should use a loop object instead of parameters (For e.g. {{ each cfg in configurations }}:, properties inside cfg should be referred with cfg.${e})`;n.push(o);const a=n.join("\n");if(t.errors)return void t.errors.push({message:a,line:i});throw new Error(a)}return n[s]}case"CallExpression":{const n=this.resolveCallable(e.callee,t),s=e.arguments.map(e=>this.evaluateAst(e,t));if(n?.builtinName){const e=this.evaluateFunction(n.builtinName,s);if(void 0!==e)return e}return n&&"function"==typeof n.fn?n.fn.apply(void 0!==n.thisArg?n.thisArg:t,s):void 0}default:return}}resolveIdentifier(e,t){if(!e)return;const n=e.toLowerCase();if("true"===n)return!0;if("false"===n)return!1;if("null"===n)return null;if("undefined"!==n){if(t.locals&&Object.prototype.hasOwnProperty.call(t.locals,e))return t.locals[e];if(Object.prototype.hasOwnProperty.call(t.parameters,e))return t.parameters[e];if(Object.prototype.hasOwnProperty.call(t.variables,e))return t.variables[e];switch(e){case"parameters":return t.parameters;case"variables":return t.variables;case"resources":return t.resources;case"locals":return t.locals;default:return}}}resolveCallable(e,t){if(!e)return{};if("Identifier"===e.type){const n=e.name,s=this.resolveIdentifier(n,t);return"function"==typeof s?{fn:s}:{builtinName:n}}if("MemberExpression"===e.type){const n=this.evaluateAst(e.object,t);if(null==n)return{};const s=this.evaluatePropertyKey(e.property,e.computed,t);if(null==s)return{};const i=n[s];return"function"==typeof i?{fn:i,thisArg:n}:{builtinName:s}}const n=this.evaluateAst(e,t);return"function"==typeof n?{fn:n}:{}}evaluateUnary(e,t){switch(e){case"!":return!this.toBoolean(t);case"+":return Number(t);case"-":return-Number(t);default:return}}evaluateBinary(e,t,n){switch(e){case"==":case"===":return 0===this.compareValues(t,n);case"!=":case"!==":return 0!==this.compareValues(t,n);case"<":return this.compareValues(t,n)<0;case"<=":return this.compareValues(t,n)<=0;case">":return this.compareValues(t,n)>0;case">=":return this.compareValues(t,n)>=0;case"+":return"string"==typeof t||"string"==typeof n?`${t??""}${n??""}`:(Number(t)||0)+(Number(n)||0);case"-":return(Number(t)||0)-(Number(n)||0);case"*":return(Number(t)||0)*(Number(n)||0);case"/":return(Number(t)||0)/(Number(n)||0);case"%":return(Number(t)||0)%(Number(n)||0);default:return}}contains(e,t){return"string"==typeof e?"string"==typeof t&&e.includes(t):Array.isArray(e)?e.some(e=>0===this.compareValues(e,t)):!(!e||"object"!=typeof e)&&Object.prototype.hasOwnProperty.call(e,t)}compareValues(e,t){const normalize=e=>{if(null==e)return"";if("string"==typeof e){const t=e.trim();if(0===t.length)return"";const n=t.toLowerCase();return"true"===n||"__true__"===n||"false"!==n&&"__false__"!==n&&(/^-?\d+(?:\.\d+)?$/.test(t)?Number(t):t)}return e},n=normalize(e),s=normalize(t);if(n===s)return 0;if(typeof n==typeof s&&("number"==typeof n||"boolean"==typeof n))return n>s?1:-1;const i=String(n),r=String(s);return i===r?0:i>r?1:-1}resolveContextValue(e,t){const n=this.sanitizePath(e).split(".").filter(e=>e.length>0);if(0===n.length)return;const[s,...i]=n;if("parameters"===s){const e=t.parameters||{};if(0===i.length)return e;const n=i[0];if(!Object.prototype.hasOwnProperty.call(e,n)){const e=[`Undefined template parameter '${n}'.`];let s=null;if(t.sourceLines){const e=[`parameters.${n}`,n];for(const n of e){for(let e=0;e<t.sourceLines.length;e++)if(t.sourceLines[e].includes(n)){s=e+1;break}if(s)break}}const i=this.getFirstTemplateStackPath(t);s&&i&&e.push(`${i}:${s}`),e.push("Tips:"),e.push(`- Ensure '${n}' is declared in the 'parameters' section`);const r=`- Check if the reference should use a loop object instead of parameters (For e.g. {{ each cfg in configurations }}:, properties inside cfg should be referred with cfg.${n})`;e.push(r);const o=e.join("\n");if(t.errors)return void t.errors.push({message:o,line:s});throw new Error(o)}return this.walkSegments(e,i)}const walkIfHas=e=>e&&Object.prototype.hasOwnProperty.call(e,s)?this.walkSegments(e[s],i):void 0,r=walkIfHas(t.locals);if(void 0!==r)return r;const o={variables:t.variables,resources:t.resources};if(Object.prototype.hasOwnProperty.call(o,s))return this.walkSegments(o[s],i);const a=walkIfHas(t.parameters);if(void 0!==a)return a;const l=walkIfHas(t.variables);return void 0!==l?l:void 0}walkSegments(e,t){let n=e;for(let e=0;e<t.length;e++){const s=t[e];if(null==n)return;if(e>0&&this.isNonArrayObject(n)&&!(s in n))return"";n=n[s]}return n}sanitizePath(e){return e.replace(/\[(\d+)\]/g,".$1").replace(/\[(?:'|")([^'"]+)(?:'|")\]/g,".$1")}looksLikeContextPath(e){return"string"==typeof e&&/^[a-zA-Z_][\w]*[.\[]/.test(e.trim())}toBoolean(e){switch(typeof e){case"boolean":return e;case"number":return 0!==e;case"string":{const t=e.toLowerCase();return"__true__"===t||"true"===t||"__false__"!==t&&"false"!==t&&0!==t.length&&Boolean(e)}default:return Boolean(e)}}returnBoolean(e){return e?"__TRUE__":"__FALSE__"}createChildContext(e,t){return{parameters:e.parameters,parameterMap:e.parameterMap,variables:e.variables,globalVariables:e.globalVariables,stageVariables:e.stageVariables,jobVariables:e.jobVariables,resources:e.resources,locals:{...e.locals,...t},baseDir:e.baseDir,repoBaseDir:e.repoBaseDir,rootRepoBaseDir:e.rootRepoBaseDir,resourceLocations:e.resourceLocations||{},scriptsWithExpressions:e.scriptsWithExpressions,scriptsWithLastLineExpressions:e.scriptsWithLastLineExpressions,templateQuoteStyles:e.templateQuoteStyles,quoteResult:e.quoteResult,stageIndex:e.stageIndex,jobIndex:e.jobIndex,stepIndex:e.stepIndex,templateStack:e.templateStack||[],rootTemplate:e.rootTemplate,sourceLines:e.sourceLines,sourceText:e.sourceText,errors:e.errors}}createTemplateContext(e,t,n,s={}){return{parameters:{...t},parameterMap:{...e.parameterMap},variables:{...e.variables},globalVariables:e.globalVariables,stageVariables:e.stageVariables,jobVariables:e.jobVariables,resources:e.resources,locals:{...e.locals},baseDir:n||e.baseDir,repoBaseDir:void 0!==s.repoBaseDir?s.repoBaseDir:e.repoBaseDir,rootRepoBaseDir:e.rootRepoBaseDir,resourceLocations:e.resourceLocations||{},templateStack:e.templateStack||[],templateQuoteStyles:e.templateQuoteStyles,scriptsWithExpressions:e.scriptsWithExpressions,scriptsWithLastLineExpressions:e.scriptsWithLastLineExpressions,expansionPath:[],stringsWithExpressions:e.stringsWithExpressions,quoteResult:e.quoteResult,stageIndex:e.stageIndex,jobIndex:e.jobIndex,stepIndex:e.stepIndex,rootTemplate:e.rootTemplate,sourceLines:e.sourceLines,sourceText:e.sourceText,errors:e.errors}}normalizeCollection(e){return Array.isArray(e)?e:e&&"object"==typeof e?Object.entries(e).map(([e,t])=>({key:e,value:t})):[]}createScopedContext(e,t,n){if("stages"===n&&t&&"object"==typeof t&&"stage"in t){const n={...e};if(n.stageVariables={},n.jobVariables={},n.variables={...e.globalVariables},t.variables){const e=this.extractVariablesFromNode(t.variables);Object.assign(n.stageVariables,e),Object.assign(n.variables,e)}return n}if("jobs"===n&&t&&"object"==typeof t&&"job"in t){const n={...e};if(n.jobVariables={},n.variables={...e.globalVariables,...e.stageVariables},t.variables){const e=this.extractVariablesFromNode(t.variables);Object.assign(n.jobVariables,e),Object.assign(n.variables,e)}return n}return e}extractVariablesFromNode(e){const t={};if(!e)return t;if(Array.isArray(e)){for(const n of e)if(this.isNonArrayObject(n)){const e=n.name,s=n.value;e&&void 0!==s&&(t[e]=s)}}else if("object"==typeof e)for(const[n,s]of Object.entries(e))if(this.isNonArrayObject(s)){const e=s.value;void 0!==e&&(t[n]=e)}else t[n]=s;return t}isSingleKeyObject(e){return this.isNonArrayObject(e)&&1===Object.keys(e).length}isEmptyObject(e){return this.isNonArrayObject(e)&&0===Object.keys(e).length}isTemplateReference(e){return this.isNonArrayObject(e)&&"template"in e}isNonArrayObject(e){return e&&"object"==typeof e&&!Array.isArray(e)}expandTemplateReference(e,t){const n=e.template,i="string"==typeof n?this.replaceExpressionsInString(n,t):this.expandScalar(n,t);if(!i||"string"!=typeof i)return[];const o=this.parseRepositoryTemplateReference(i),a=o&&this.isSelfRepositoryAlias(o.repository);let l,c,p=t.repoBaseDir||void 0;if(a){const e=t.rootRepoBaseDir||t.repoBaseDir,n=this.resolveRepoBaseDirectory(e,t);p=n;const s=t.baseDir||n;if(l=this.resolveRepoTemplate(o.templatePath,s,n),!l)throw new Error(this.formatErrorWithStack(`Template file not found for repository '${o.repository}': ${o.templatePath}`,t));c=r.dirname(l)}else if(o){const e=this.resolveRepositoryEntry(o.repository,t);if(!e)throw new Error(this.formatErrorWithStack(`Repository resource '${o.repository}' is not defined for template '${i}'.`,t));const n=this.resolveRepositoryLocation(e,t);if(!n)throw new Error(this.formatErrorWithStack(`Repository resource '${o.repository}' does not define a local location. Set a 'location' for this resource (for example via the 'azurePipelineStudio.resourceLocations' setting).`,t));const s=this.resolveRepoBaseDirectory(n,t);p=s;const a=t.baseDir||s;if(l=this.resolveRepoTemplate(o.templatePath,a,s),!l)throw new Error(this.formatErrorWithStack(`Template file not found for repository '${o.repository}': ${o.templatePath}`,t));c=r.dirname(l)}else{const e=t.repoBaseDir||void 0,n=this.resolveRepoTemplate(i,t.baseDir,e);if(n)l=n,c=r.dirname(l),p=p||e;else{const e=t.baseDir||process.cwd();l=r.isAbsolute(i)?i:r.resolve(e,i),c=r.dirname(l)}}if(!s.existsSync(l)){const e=o?`${o.templatePath}@${o.repository}`:i;throw new Error(this.formatErrorWithStack(`Template file not found: ${e}`,t))}const u=s.readFileSync(l,"utf8"),f=o?`${o.templatePath}@${o.repository}`:i;let d;try{const e=void 0!==t.skipSyntax&&t.skipSyntax,{yamlDoc:n,jsonDoc:s}=this.parseYamlDocument(u,f,e,t);d=s;const i=new Map;if(this.extractQuoteStyles(n.contents,[],i),i.size>0&&(t.templateQuoteStyles.set(l,i),t.quoteResult&&t.quoteResult.quoteStyles))for(const[e,n]of i.entries())t.quoteResult.quoteStyles.has(e)||t.quoteResult.quoteStyles.set(e,n)}catch(e){const n="string"==typeof e?.message?e.message:String(e),s=o?`${o.templatePath}@${o.repository}`:i;if(n.includes(s))throw new Error(this.formatErrorWithStack(n,t));throw new Error(this.formatErrorWithStack(`Failed to parse template '${i}': ${n}`,t))}const h=this.extractParameters(d),m=this.normalizeTemplateParameters(e.parameters,t),g={...h.parameters,...m},y=o?`${o.templatePath}@${o.repository}`:i,b={...t,templateStack:[...t.templateStack||[],y],parameterMap:{...h.parameterMap}};this.validateTemplateParameters(d,m,i,b);const v=this.createTemplateContext(b,g,c,{repoBaseDir:p}),x=this.expandNode(d,v)||{};this.convertVariablesToArrayFormat(x,v);return this.extractTemplateBody(x)}parseRepositoryTemplateReference(e){if("string"!=typeof e)return;const t=e.lastIndexOf("@");if(t<=0||t===e.length-1)return;const n=e.slice(0,t).trim(),s=e.slice(t+1).trim();return n&&s?{templatePath:n,repository:s}:void 0}isSelfRepositoryAlias(e){return"string"==typeof e&&"self"===e.trim().toLowerCase()}resolveRepositoryEntry(e,t){if(!e||!t)return;let n;if(t.resources){const s=t.resources.repositories;s&&(s[e]?n=s[e]:Array.isArray(s)&&(n=s.find(t=>this.getRepositoryAlias(t)===e)))}if(n&&t.resourceLocations&&t.resourceLocations[e]){n.location||n.path||n.directory||n.localPath||(n={...n,location:t.resourceLocations[e]})}return!n&&t.resourceLocations&&t.resourceLocations[e]&&(n={repository:e,location:t.resourceLocations[e]}),n}resolveRepositoryLocation(e,t){if(!e||"object"!=typeof e)return;const n=[e.location,e.path,e.directory,e.localPath].find(e=>"string"==typeof e&&e.trim().length);if(!n)return;const s=this.replaceExpressionsInString(n,t);if(!s||"string"!=typeof s)return;const i=s.trim();if(!i)return;const r=this.expandUserHome(i);return r&&"object"==typeof e&&(e.__resolvedLocation=r,e.location&&e.location!==n&&e.location!==i?e.localLocation||(e.localLocation=r):e.location=r),r}expandUserHome(e){return"string"!=typeof e?e:e.startsWith("~")?r.join(i.homedir(),e.slice(1)):e}resolveRepoBaseDirectory(e,t){const n=t.baseDir||process.cwd();if(!e)return n;const i=r.isAbsolute(e)?e:r.resolve(n,e);try{const e=s.statSync(i);if(e.isFile())return r.dirname(i);if(e.isDirectory())return i}catch(e){}return i}resolveRepoTemplate(e,t,n){if(!e)return;const i=String(e).replace(/^[\\/]+/,"").split(/[\\/]+/).filter(e=>e?.length),o=[];if(n&&o.push(n),!t||n&&r.normalize(n)===r.normalize(t)||o.push(t),!o.length)return;const a=o.map(e=>i.length?r.resolve(e,...i):r.normalize(e));for(const e of a)try{if(s.statSync(e).isFile())return r.normalize(e)}catch(e){}return a[0]}expandNodePreservingTemplates(e,t){return null===e?e:Array.isArray(e)?this.expandArrayPreservingTemplates(e,t):"object"==typeof e?this.expandObjectPreservingTemplates(e,t):this.expandScalar(e,t)}expandArrayPreservingTemplates(e,t){const n=[];let s=0;for(;s<e.length;){const i=e[s];if(this.isTemplateReference(i)){n.push(i),s++;continue}if(this.isNonArrayObject(i)){const r=this.handleSingleKeyObject(i,e,s,t,n);if(r&&r.handled){s=void 0!==r.nextIndex?r.nextIndex+1:s+1;continue}}const r=this.expandNodePreservingTemplates(i,t);if(null!==r){if(this.isEmptyObject(r)){s++;continue}n.push(r)}s++}return n}expandObjectPreservingTemplates(e,t){if(this.isTemplateReference(e)){const n={template:e.template};return e.parameters&&(n.parameters=this.expandNodePreservingTemplates(e.parameters,t)),n}const n={},s=Object.entries(e);let i=0;for(;i<s.length;){const[e,r]=s[i];if(this.isConditionalDirective(e)){let e=!1,r=i;for(;r<s.length;){const[i,o]=s[r];if(!this.isConditionalDirective(i))break;if(!e&&this.evaluateConditional(i,t)){const s=this.expandNodePreservingTemplates(o,t);this.isNonArrayObject(s)&&Object.assign(n,s),e=!0}if(r++,this.isElseDirective(i))break}i=r;continue}if(this.isInsertDirective(e)){const e=this.expandNodePreservingTemplates(r,t);e&&this.isNonArrayObject(e)&&Object.assign(n,e),i++;continue}n["string"==typeof e?this.replaceExpressionsInString(e,t):e]=this.expandNodePreservingTemplates(r,t),i++}return n}normalizeTemplateParameters(e,t){if(void 0===e)return{};const n=this.expandNodePreservingTemplates(e,t);return n&&this.isNonArrayObject(n)?n:this.normalizeParameterArray(n)}normalizeParameterArray(e){const t={};return e.forEach(e=>{if(e&&"object"==typeof e&&!Array.isArray(e)){if(Object.prototype.hasOwnProperty.call(e,"name")){const n=e.name;if("string"==typeof n&&n.trim().length){const s=e.default;t[n.trim()]=s}return}Object.entries(e).forEach(([e,n])=>{"string"==typeof e&&e.trim().length&&(t[e.trim()]=n)})}}),t}extractTemplateBody(e){if(!e||"object"!=typeof e)return[];if(Array.isArray(e))return e;const t=["stages","jobs","steps","variables","stage","job","deployment","deployments"];for(const n of t)if("parameters"!==n&&Object.prototype.hasOwnProperty.call(e,n)){const t=e[n];if(Array.isArray(t))return t;if(void 0!==t)return[t]}return[]}evaluatePropertyKey(e,t,n){return t?this.evaluateAst(e,n):"Identifier"===e.type?e.name:this.evaluateAst(e,n)}isVariableArray(e){return!(!Array.isArray(e)||0===e.length)&&e.some(e=>this.isNonArrayObject(e)&&("name"in e&&"value"in e||1===Object.keys(e).length&&!("template"in e)))}evaluateConditional(e,t){if(this.isElseDirective(e))return!0;const n=this.isIfDirective(e)?this.parseIfCondition(e):this.parseElseIfCondition(e);return this.toBoolean(this.evaluateExpression(n,t))}isFullExpression(e){if("string"!=typeof e)return!1;const t=e.trim();if(!t.startsWith("${{")||!t.endsWith("}}"))return!1;return!t.slice(3,-2).includes("}}")}stripExpressionDelimiters(e){if("string"!=typeof e)return"";return e.trim().replace(/^\$\{\{/,"").replace(/\}\}$/,"").trim()}isInsertDirective(e){const t=e.trim();return!!this.isFullExpression(t)&&("string"==typeof e&&/^\$\{\{\s*insert\s*\}\}$/.test(t))}isEachDirective(e){return"string"==typeof e&&/^\$\{\{\s*each\s+/.test(e.trim())}isConditionalDirective(e){return this.isIfDirective(e)||this.isElseIfDirective(e)||this.isElseDirective(e)}isIfDirective(e){return"string"==typeof e&&/^\$\{\{\s*if\s+/.test(e.trim())}isElseIfDirective(e){return"string"==typeof e&&/^\$\{\{\s*elseif\s+/.test(e.trim())}isElseDirective(e){return"string"==typeof e&&/^\$\{\{\s*else\s*\}\}$/.test(e.trim())}isParameter(e){return"string"==typeof e&&/^\$\{\{\s*parameters\./.test(e.trim())}isVariable(e){return"string"==typeof e&&/^\$\{\{\s*variables\./.test(e.trim())}hasTrailingSpaces(e){const t=e.split("\n");return t.some((e,n)=>(n<t.length-1||""!==e)&&/[ \t]$/.test(e))}isMultilineString(e){return"string"==typeof e&&e.includes("\n")}isSingleLineFullExpression(e){if("string"!=typeof e)return!1;const t=e.trim();return this.isFullExpression(t)&&!t.includes("\n")}hasTemplateExpr(e){return"string"==typeof e&&e.includes("${{")}hasRuntimeVariable(e){return"string"==typeof e&&/\$\([^)]+\)/.test(e)}isKeyValueLike(e){return"string"==typeof e&&/: /.test(e)}relativePathAfterKey(e,t){if(!Array.isArray(e))return[];const n=e.indexOf(t);return n>=0?e.slice(n+2):e}hasColon(e){return"string"==typeof e&&e.includes(":")}isGlobPattern(e){return"string"==typeof e&&this.globQuotePattern.test(e)}isConditionExpression(e){if("string"!=typeof e)return!1;const t=e.trim();if(!t)return!1;const n=/^[a-zA-Z_][\w\.]*\(.*\)$/.test(t),s=/\b(?:variables|parameters|env|dependencies)\[/.test(t);return n||s}extractSourceParameter(e){const t=e.match(/parameters\.[a-zA-Z_][\w.]*/g);return t&&t.length>0?t[t.length-1]:/^parameters\.[a-zA-Z_][\w.]*$/.test(e)?e:null}isStringNodeValue(e){return void 0!==e?.value&&"string"==typeof e.value}hadMixedExpression(e,t,n){if("string"!=typeof e||!n.stringsWithExpressions)return!1;const s=this.getQuoteStyleUniqueKey(t,e);return n.stringsWithExpressions.has(s)}hasFullParameterExpression(e,t,n){const s=n.quoteResult?.fullParameterExpressions;if("string"!=typeof e||!s)return!1;const i=this.getQuoteStyleUniqueKey(t,e);return s.has(i)}normalizeTrailingNewlines(e,t){return t?/\n[ \t]*\n\s*$/.test(e)?e.replace(/\n+$/,"")+"\n\n":e:/\n\n+$/.test(e)?e.replace(/\n+$/,"")+"\n":e}lastLineHasTemplateExpression(e){if(!e||!this.isMultilineString(e))return!1;const t=e.split("\n");for(let e=t.length-1;e>=0;e--){const n=t[e].trim();if(n)return n.endsWith("}}")}return!1}parseIfCondition(e){if("string"!=typeof e)return"";const t=e.trim().match(/^\$\{\{\s*if\s+(.+?)\s*\}\}$/);return t?t[1]:""}parseElseIfCondition(e){if("string"!=typeof e)return"";const t=e.trim().match(/^\$\{\{\s*elseif\s+(.+?)\s*\}\}$/);return t?t[1]:""}parseEachDirective(e){if("string"!=typeof e)return;const t=e.trim().match(/^\$\{\{\s*each\s+([a-zA-Z_]\w*)\s+in\s+(.+?)\s*\}\}$/);return t?{variable:t[1],collection:t[2]}:void 0}}if(e.exports={AzurePipelineParser},n.c[n.s]===e){const e=process.argv.slice(2);0===e.length&&(console.error("Usage: node parser.js <yaml-file-path>"),process.exit(1));const t=e[0],n=new AzurePipelineParser({printTree:!1});try{const e=n.expandPipelineFromFile(t);process.stdout.write(e)}catch(e){console.error(`Failed to expand pipeline: ${e.message}`),process.exit(1)}}},e=>{"use strict";class Jsep{static get version(){return"1.4.0"}static toString(){return"JavaScript Expression Parser (JSEP) v"+Jsep.version}static addUnaryOp(e){return Jsep.max_unop_len=Math.max(e.length,Jsep.max_unop_len),Jsep.unary_ops[e]=1,Jsep}static addBinaryOp(e,t,n){return Jsep.max_binop_len=Math.max(e.length,Jsep.max_binop_len),Jsep.binary_ops[e]=t,n?Jsep.right_associative.add(e):Jsep.right_associative.delete(e),Jsep}static addIdentifierChar(e){return Jsep.additional_identifier_chars.add(e),Jsep}static addLiteral(e,t){return Jsep.literals[e]=t,Jsep}static removeUnaryOp(e){return delete Jsep.unary_ops[e],e.length===Jsep.max_unop_len&&(Jsep.max_unop_len=Jsep.getMaxKeyLen(Jsep.unary_ops)),Jsep}static removeAllUnaryOps(){return Jsep.unary_ops={},Jsep.max_unop_len=0,Jsep}static removeIdentifierChar(e){return Jsep.additional_identifier_chars.delete(e),Jsep}static removeBinaryOp(e){return delete Jsep.binary_ops[e],e.length===Jsep.max_binop_len&&(Jsep.max_binop_len=Jsep.getMaxKeyLen(Jsep.binary_ops)),Jsep.right_associative.delete(e),Jsep}static removeAllBinaryOps(){return Jsep.binary_ops={},Jsep.max_binop_len=0,Jsep}static removeLiteral(e){return delete Jsep.literals[e],Jsep}static removeAllLiterals(){return Jsep.literals={},Jsep}get char(){return this.expr.charAt(this.index)}get code(){return this.expr.charCodeAt(this.index)}constructor(e){this.expr=e,this.index=0}static parse(e){return new Jsep(e).parse()}static getMaxKeyLen(e){return Math.max(0,...Object.keys(e).map(e=>e.length))}static isDecimalDigit(e){return e>=48&&e<=57}static binaryPrecedence(e){return Jsep.binary_ops[e]||0}static isIdentifierStart(e){return e>=65&&e<=90||e>=97&&e<=122||e>=128&&!Jsep.binary_ops[String.fromCharCode(e)]||Jsep.additional_identifier_chars.has(String.fromCharCode(e))}static isIdentifierPart(e){return Jsep.isIdentifierStart(e)||Jsep.isDecimalDigit(e)}throwError(e){const t=new Error(e+" at character "+this.index);throw t.index=this.index,t.description=e,t}runHook(e,t){if(Jsep.hooks[e]){const n={context:this,node:t};return Jsep.hooks.run(e,n),n.node}return t}searchHook(e){if(Jsep.hooks[e]){const t={context:this};return Jsep.hooks[e].find(function(e){return e.call(t.context,t),t.node}),t.node}}gobbleSpaces(){let e=this.code;for(;e===Jsep.SPACE_CODE||e===Jsep.TAB_CODE||e===Jsep.LF_CODE||e===Jsep.CR_CODE;)e=this.expr.charCodeAt(++this.index);this.runHook("gobble-spaces")}parse(){this.runHook("before-all");const e=this.gobbleExpressions(),t=1===e.length?e[0]:{type:Jsep.COMPOUND,body:e};return this.runHook("after-all",t)}gobbleExpressions(e){let t,n,s=[];for(;this.index<this.expr.length;)if(t=this.code,t===Jsep.SEMCOL_CODE||t===Jsep.COMMA_CODE)this.index++;else if(n=this.gobbleExpression())s.push(n);else if(this.index<this.expr.length){if(t===e)break;this.throwError('Unexpected "'+this.char+'"')}return s}gobbleExpression(){const e=this.searchHook("gobble-expression")||this.gobbleBinaryExpression();return this.gobbleSpaces(),this.runHook("after-expression",e)}gobbleBinaryOp(){this.gobbleSpaces();let e=this.expr.substr(this.index,Jsep.max_binop_len),t=e.length;for(;t>0;){if(Jsep.binary_ops.hasOwnProperty(e)&&(!Jsep.isIdentifierStart(this.code)||this.index+e.length<this.expr.length&&!Jsep.isIdentifierPart(this.expr.charCodeAt(this.index+e.length))))return this.index+=t,e;e=e.substr(0,--t)}return!1}gobbleBinaryExpression(){let e,t,n,s,i,r,o,a,l;if(r=this.gobbleToken(),!r)return r;if(t=this.gobbleBinaryOp(),!t)return r;for(i={value:t,prec:Jsep.binaryPrecedence(t),right_a:Jsep.right_associative.has(t)},o=this.gobbleToken(),o||this.throwError("Expected expression after "+t),s=[r,i,o];t=this.gobbleBinaryOp();){if(n=Jsep.binaryPrecedence(t),0===n){this.index-=t.length;break}i={value:t,prec:n,right_a:Jsep.right_associative.has(t)},l=t;const comparePrev=e=>i.right_a&&e.right_a?n>e.prec:n<=e.prec;for(;s.length>2&&comparePrev(s[s.length-2]);)o=s.pop(),t=s.pop().value,r=s.pop(),e={type:Jsep.BINARY_EXP,operator:t,left:r,right:o},s.push(e);e=this.gobbleToken(),e||this.throwError("Expected expression after "+l),s.push(i,e)}for(a=s.length-1,e=s[a];a>1;)e={type:Jsep.BINARY_EXP,operator:s[a-1].value,left:s[a-2],right:e},a-=2;return e}gobbleToken(){let e,t,n,s;if(this.gobbleSpaces(),s=this.searchHook("gobble-token"),s)return this.runHook("after-token",s);if(e=this.code,Jsep.isDecimalDigit(e)||e===Jsep.PERIOD_CODE)return this.gobbleNumericLiteral();if(e===Jsep.SQUOTE_CODE||e===Jsep.DQUOTE_CODE)s=this.gobbleStringLiteral();else if(e===Jsep.OBRACK_CODE)s=this.gobbleArray();else{for(t=this.expr.substr(this.index,Jsep.max_unop_len),n=t.length;n>0;){if(Jsep.unary_ops.hasOwnProperty(t)&&(!Jsep.isIdentifierStart(this.code)||this.index+t.length<this.expr.length&&!Jsep.isIdentifierPart(this.expr.charCodeAt(this.index+t.length)))){this.index+=n;const e=this.gobbleToken();return e||this.throwError("missing unaryOp argument"),this.runHook("after-token",{type:Jsep.UNARY_EXP,operator:t,argument:e,prefix:!0})}t=t.substr(0,--n)}Jsep.isIdentifierStart(e)?(s=this.gobbleIdentifier(),Jsep.literals.hasOwnProperty(s.name)?s={type:Jsep.LITERAL,value:Jsep.literals[s.name],raw:s.name}:s.name===Jsep.this_str&&(s={type:Jsep.THIS_EXP})):e===Jsep.OPAREN_CODE&&(s=this.gobbleGroup())}return s?(s=this.gobbleTokenProperty(s),this.runHook("after-token",s)):this.runHook("after-token",!1)}gobbleTokenProperty(e){this.gobbleSpaces();let t=this.code;for(;t===Jsep.PERIOD_CODE||t===Jsep.OBRACK_CODE||t===Jsep.OPAREN_CODE||t===Jsep.QUMARK_CODE;){let n;if(t===Jsep.QUMARK_CODE){if(this.expr.charCodeAt(this.index+1)!==Jsep.PERIOD_CODE)break;n=!0,this.index+=2,this.gobbleSpaces(),t=this.code}this.index++,t===Jsep.OBRACK_CODE?((e={type:Jsep.MEMBER_EXP,computed:!0,object:e,property:this.gobbleExpression()}).property||this.throwError('Unexpected "'+this.char+'"'),this.gobbleSpaces(),t=this.code,t!==Jsep.CBRACK_CODE&&this.throwError("Unclosed ["),this.index++):t===Jsep.OPAREN_CODE?e={type:Jsep.CALL_EXP,arguments:this.gobbleArguments(Jsep.CPAREN_CODE),callee:e}:(t===Jsep.PERIOD_CODE||n)&&(n&&this.index--,this.gobbleSpaces(),e={type:Jsep.MEMBER_EXP,computed:!1,object:e,property:this.gobbleIdentifier()}),n&&(e.optional=!0),this.gobbleSpaces(),t=this.code}return e}gobbleNumericLiteral(){let e,t,n="";for(;Jsep.isDecimalDigit(this.code);)n+=this.expr.charAt(this.index++);if(this.code===Jsep.PERIOD_CODE)for(n+=this.expr.charAt(this.index++);Jsep.isDecimalDigit(this.code);)n+=this.expr.charAt(this.index++);if(e=this.char,"e"===e||"E"===e){for(n+=this.expr.charAt(this.index++),e=this.char,"+"!==e&&"-"!==e||(n+=this.expr.charAt(this.index++));Jsep.isDecimalDigit(this.code);)n+=this.expr.charAt(this.index++);Jsep.isDecimalDigit(this.expr.charCodeAt(this.index-1))||this.throwError("Expected exponent ("+n+this.char+")")}return t=this.code,Jsep.isIdentifierStart(t)?this.throwError("Variable names cannot start with a number ("+n+this.char+")"):(t===Jsep.PERIOD_CODE||1===n.length&&n.charCodeAt(0)===Jsep.PERIOD_CODE)&&this.throwError("Unexpected period"),{type:Jsep.LITERAL,value:parseFloat(n),raw:n}}gobbleStringLiteral(){let e="";const t=this.index,n=this.expr.charAt(this.index++);let s=!1;for(;this.index<this.expr.length;){let t=this.expr.charAt(this.index++);if(t===n){s=!0;break}if("\\"===t)switch(t=this.expr.charAt(this.index++),t){case"n":e+="\n";break;case"r":e+="\r";break;case"t":e+="\t";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:e+=t}else e+=t}return s||this.throwError('Unclosed quote after "'+e+'"'),{type:Jsep.LITERAL,value:e,raw:this.expr.substring(t,this.index)}}gobbleIdentifier(){let e=this.code,t=this.index;for(Jsep.isIdentifierStart(e)?this.index++:this.throwError("Unexpected "+this.char);this.index<this.expr.length&&(e=this.code,Jsep.isIdentifierPart(e));)this.index++;return{type:Jsep.IDENTIFIER,name:this.expr.slice(t,this.index)}}gobbleArguments(e){const t=[];let n=!1,s=0;for(;this.index<this.expr.length;){this.gobbleSpaces();let i=this.code;if(i===e){n=!0,this.index++,e===Jsep.CPAREN_CODE&&s&&s>=t.length&&this.throwError("Unexpected token "+String.fromCharCode(e));break}if(i===Jsep.COMMA_CODE){if(this.index++,s++,s!==t.length)if(e===Jsep.CPAREN_CODE)this.throwError("Unexpected token ,");else if(e===Jsep.CBRACK_CODE)for(let e=t.length;e<s;e++)t.push(null)}else if(t.length!==s&&0!==s)this.throwError("Expected comma");else{const e=this.gobbleExpression();e&&e.type!==Jsep.COMPOUND||this.throwError("Expected comma"),t.push(e)}}return n||this.throwError("Expected "+String.fromCharCode(e)),t}gobbleGroup(){this.index++;let e=this.gobbleExpressions(Jsep.CPAREN_CODE);if(this.code===Jsep.CPAREN_CODE)return this.index++,1===e.length?e[0]:!!e.length&&{type:Jsep.SEQUENCE_EXP,expressions:e};this.throwError("Unclosed (")}gobbleArray(){return this.index++,{type:Jsep.ARRAY_EXP,elements:this.gobbleArguments(Jsep.CBRACK_CODE)}}}const t=new class Hooks{add(e,t,n){if("string"!=typeof arguments[0])for(let e in arguments[0])this.add(e,arguments[0][e],arguments[1]);else(Array.isArray(e)?e:[e]).forEach(function(e){this[e]=this[e]||[],t&&this[e][n?"unshift":"push"](t)},this)}run(e,t){this[e]=this[e]||[],this[e].forEach(function(e){e.call(t&&t.context?t.context:t,t)})}};Object.assign(Jsep,{hooks:t,plugins:new class Plugins{constructor(e){this.jsep=e,this.registered={}}register(...e){e.forEach(e=>{if("object"!=typeof e||!e.name||!e.init)throw new Error("Invalid JSEP plugin format");this.registered[e.name]||(e.init(this.jsep),this.registered[e.name]=e)})}}(Jsep),COMPOUND:"Compound",SEQUENCE_EXP:"SequenceExpression",IDENTIFIER:"Identifier",MEMBER_EXP:"MemberExpression",LITERAL:"Literal",THIS_EXP:"ThisExpression",CALL_EXP:"CallExpression",UNARY_EXP:"UnaryExpression",BINARY_EXP:"BinaryExpression",ARRAY_EXP:"ArrayExpression",TAB_CODE:9,LF_CODE:10,CR_CODE:13,SPACE_CODE:32,PERIOD_CODE:46,COMMA_CODE:44,SQUOTE_CODE:39,DQUOTE_CODE:34,OPAREN_CODE:40,CPAREN_CODE:41,OBRACK_CODE:91,CBRACK_CODE:93,QUMARK_CODE:63,SEMCOL_CODE:59,COLON_CODE:58,unary_ops:{"-":1,"!":1,"~":1,"+":1},binary_ops:{"||":1,"??":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10,"**":11},right_associative:new Set(["**"]),additional_identifier_chars:new Set(["$","_"]),literals:{true:!0,false:!1,null:null},this_str:"this"}),Jsep.max_unop_len=Jsep.getMaxKeyLen(Jsep.unary_ops),Jsep.max_binop_len=Jsep.getMaxKeyLen(Jsep.binary_ops);const jsep=e=>new Jsep(e).parse(),n=Object.getOwnPropertyNames(class Test{});Object.getOwnPropertyNames(Jsep).filter(e=>!n.includes(e)&&void 0===jsep[e]).forEach(e=>{jsep[e]=Jsep[e]}),jsep.Jsep=Jsep;var s={name:"ternary",init(e){e.hooks.add("after-expression",function gobbleTernary(t){if(t.node&&this.code===e.QUMARK_CODE){this.index++;const n=t.node,s=this.gobbleExpression();if(s||this.throwError("Expected expression"),this.gobbleSpaces(),this.code===e.COLON_CODE){this.index++;const i=this.gobbleExpression();if(i||this.throwError("Expected expression"),t.node={type:"ConditionalExpression",test:n,consequent:s,alternate:i},n.operator&&e.binary_ops[n.operator]<=.9){let s=n;for(;s.right.operator&&e.binary_ops[s.right.operator]<=.9;)s=s.right;t.node.test=s.right,s.right=t.node,t.node=n}}else this.throwError("Expected :")}})}};jsep.plugins.register(s),e.exports=jsep},e=>{function returnBoolean(e){return e?"__TRUE__":"__FALSE__"}function toBoolean(e){if("boolean"==typeof e)return e;if("number"==typeof e)return 0!==e;if("string"==typeof e){const t=e.toLowerCase();if("__true__"===t||"true"===t)return!0;if("__false__"===t||"false"===t||0===t.length)return!1}return Boolean(e)}function compareValues(e,t){const normalize=e=>{if(null==e)return"";if("string"==typeof e){const t=e.trim();if(0===t.length)return"";const n=t.toLowerCase();return"true"===n||"__true__"===n||"false"!==n&&"__false__"!==n&&(/^-?\d+(?:\.\d+)?$/.test(t)?Number(t):t)}return e},n=normalize(e),s=normalize(t);if(n===s)return 0;if(typeof n==typeof s&&("number"==typeof n||"boolean"==typeof n))return n>s?1:-1;const i=String(n),r=String(s);return i===r?0:i>r?1:-1}function formatString(e){if(!e||0===e.length)return"";let t=String(e[0]);const n=e.slice(1);return t=t.replace(/\{(\d+)(?::([^}]+))?\}/g,(e,t,s)=>{const i=parseInt(t,10);if(i>=n.length)return e;let r=n[i];return s&&r instanceof Date?function formatDateTime(e,t){const pad=(e,t=2)=>String(e).padStart(t,"0");return t.replace(/yyyy/g,e.getFullYear()).replace(/yy/g,String(e.getFullYear()).slice(-2)).replace(/MM/g,pad(e.getMonth()+1)).replace(/M/g,e.getMonth()+1).replace(/dd/g,pad(e.getDate())).replace(/d/g,e.getDate()).replace(/HH/g,pad(e.getHours())).replace(/H/g,e.getHours()).replace(/mm/g,pad(e.getMinutes())).replace(/m/g,e.getMinutes()).replace(/ss/g,pad(e.getSeconds())).replace(/s/g,e.getSeconds()).replace(/ffff/g,pad(e.getMilliseconds(),4)).replace(/ff/g,pad(Math.floor(e.getMilliseconds()/10))).replace(/f/g,Math.floor(e.getMilliseconds()/100))}(r,s):null==r?"":String(r)}),t=t.replace(/\{\{/g,"{").replace(/\}\}/g,"}"),t}const t=new Map;const n={returnBoolean,toBoolean,eq:function eq(e){return returnBoolean(0===compareValues(e[0],e[1]))},ne:function ne(e){return returnBoolean(0!==compareValues(e[0],e[1]))},gt:function gt(e){return returnBoolean(compareValues(e[0],e[1])>0)},ge:function ge(e){return returnBoolean(compareValues(e[0],e[1])>=0)},lt:function lt(e){return returnBoolean(compareValues(e[0],e[1])<0)},le:function le(e){return returnBoolean(compareValues(e[0],e[1])<=0)},and:function and(e){return returnBoolean((e||[]).every(e=>toBoolean(e)))},or:function or(e){return returnBoolean((e||[]).some(e=>toBoolean(e)))},not:function not(e){return returnBoolean(!toBoolean(e[0]))},xor:function xor(e){return returnBoolean(toBoolean(e[0])!==toBoolean(e[1]))},coalesce:function coalesce(e){return(e||[]).find(e=>null!=e&&""!==e)},contains:function containsFn(e){return returnBoolean(function containsHelper(e,t){return"string"==typeof e?"string"==typeof t&&e.includes(t):Array.isArray(e)?e.some(e=>0===compareValues(e,t)):!(!e||"object"!=typeof e)&&Object.prototype.hasOwnProperty.call(e,t)}(e[0],e[1]))},containsValue:function containsValue(e){return returnBoolean(function containsValueHelper(e,t){return Array.isArray(e)?e.some(e=>0===compareValues(e,t)):!(!e||"object"!=typeof e)&&Object.values(e).some(e=>0===compareValues(e,t))}(e[0],e[1]))},in:function inFn(e){return returnBoolean((e||[]).slice(1).some(t=>0===compareValues(e[0],t)))},notIn:function notIn(e){return returnBoolean(!(e||[]).slice(1).some(t=>0===compareValues(e[0],t)))},lower:function lower(e){return"string"==typeof e[0]?e[0].toLowerCase():e[0]},upper:function upper(e){return"string"==typeof e[0]?e[0].toUpperCase():e[0]},startsWith:function startsWith(e){return returnBoolean(function startsWithHelper(e,t){return"string"==typeof e&&"string"==typeof t&&e.toLowerCase().startsWith(t.toLowerCase())}(e[0],e[1]))},endsWith:function endsWith(e){return returnBoolean(function endsWithHelper(e,t){return"string"==typeof e&&"string"==typeof t&&e.toLowerCase().endsWith(t.toLowerCase())}(e[0],e[1]))},trim:function trim(e){return"string"==typeof e[0]?e[0].trim():e[0]},replace:function replace(e){return function replaceString(e,t,n){return"string"!=typeof e?e:("string"!=typeof t&&(t=String(t)),"string"!=typeof n&&(n=String(n)),e.split(t).join(n))}(e[0],e[1],e[2])},split:function split(e){return function splitString(e,t){return"string"!=typeof e?[e]:("string"!=typeof t&&(t=String(t)),e.split(t))}(e[0],e[1])},join:function join(e){return function joinArray(e,t){return Array.isArray(t)?("string"!=typeof e&&(e=String(e)),t.map(e=>null==e||"object"==typeof e?"":String(e)).join(e)):"string"==typeof t?t:String(t)}(e[0],e[1])},format:function format(e){return formatString(e)},length:function length(e){return"string"==typeof e[0]||Array.isArray(e[0])?e[0].length:e[0]&&"object"==typeof e[0]?Object.keys(e[0]).length:0},convertToJson:function convertToJson(e){return function convertToJsonHelper(e){if(void 0===e)return"null";try{return JSON.stringify(e,(e,t)=>"boolean"==typeof t?t?"True":"False":"string"==typeof t&&/^-?\d+(\.\d+)?$/.test(t)?parseFloat(t):t,2)}catch(t){return String(e)}}(e[0])},counter:function counterFn(e){return function counter(e,n){const s=String(e||""),i="number"==typeof n?n:parseInt(n,10)||0;t.has(s)||t.set(s,i);const r=t.get(s);return t.set(s,r+1),r}(e[0],e[1])},iif:function iif(e){return toBoolean(e[0])?e[1]:e[2]},if:function ifFn(e){return toBoolean(e[0])?e[1]:e[2]},elseif:function elseif(e){return toBoolean(e[0])?e[1]:e[2]},always:function always(e){return returnBoolean(!0)},canceled:function canceled(e){return returnBoolean(!1)},failed:function failed(e){return returnBoolean(!1)},succeeded:function succeeded(e){return returnBoolean(!0)},succeededOrFailed:function succeededOrFailed(e){return returnBoolean(!0)}};e.exports=n},e=>{"use strict";e.exports=require("dns")}],t={};function __webpack_require__(n){var s=t[n];if(void 0!==s)return s.exports;var i=t[n]={id:n,loaded:!1,exports:{}};return e[n](i,i.exports,__webpack_require__),i.loaded=!0,i.exports}__webpack_require__.c=t,__webpack_require__.nmd=e=>(e.paths=[],e.children||(e.children=[]),e);var n=__webpack_require__(__webpack_require__.s=0);module.exports=n})();